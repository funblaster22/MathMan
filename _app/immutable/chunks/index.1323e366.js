var ir=Object.defineProperty;var or=(t,e,n)=>e in t?ir(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var pn=(t,e,n)=>(or(t,typeof e!="symbol"?e+"":e,n),n);import{e as Qt}from"./singletons.7dffa960.js";import{i as ar}from"./isInt.dabd68aa.js";const F=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,I=Object.keys,M=Array.isArray;function V(t,e){return typeof e!="object"||I(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||F.Promise||(F.Promise=Promise);const Se=Object.getPrototypeOf,ur={}.hasOwnProperty;function U(t,e){return ur.call(t,e)}function Ke(t,e){typeof e=="function"&&(e=e(Se(t))),(typeof Reflect>"u"?I:Reflect.ownKeys)(e).forEach(n=>{ee(t,n,e[n])})}const Kn=Object.defineProperty;function ee(t,e,n,r){Kn(t,e,V(n&&U(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Oe(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ee(t.prototype,"constructor",t),{extend:Ke.bind(null,t.prototype)}}}}const lr=Object.getOwnPropertyDescriptor;function Xt(t,e){let n;return lr(t,e)||(n=Se(t))&&Xt(n,e)}const cr=[].slice;function lt(t,e,n){return cr.call(t,e,n)}function jn(t,e){return e(t)}function Ie(t){if(!t)throw new Error("Assertion Failed")}function Dn(t){F.setImmediate?setImmediate(t):setTimeout(t,0)}function te(t,e){if(typeof e=="string"&&U(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var o=te(t,e[r]);n.push(o)}return n}var i=e.indexOf(".");if(i!==-1){var u=t[e.substr(0,i)];return u===void 0?void 0:te(u,e.substr(i+1))}}function W(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Ie(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)W(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var i=e.substr(0,o),u=e.substr(o+1);if(u==="")n===void 0?M(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n;else{var a=t[i];a&&U(t,i)||(a=t[i]={}),W(a,u,n)}}else n===void 0?M(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function qn(t){var e={};for(var n in t)U(t,n)&&(e[n]=t[n]);return e}const hr=[].concat;function Tn(t){return hr.apply([],t)}const fr="Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Tn([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>F[t]),Bn=new Set(fr.map(t=>F[t]));function In(t){const e={};for(const n in t)if(U(t,n)){const r=t[n];e[n]=!r||typeof r!="object"||Bn.has(r.constructor)?r:In(r)}return e}let Ne=null;function oe(t){Ne=new WeakMap;const e=Ct(t);return Ne=null,e}function Ct(t){if(!t||typeof t!="object")return t;let e=Ne.get(t);if(e)return e;if(M(t)){e=[],Ne.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Ct(t[n]))}else if(Bn.has(t.constructor))e=t;else{const o=Se(t);for(var s in e=o===Object.prototype?{}:Object.create(o),Ne.set(t,e),t)U(t,s)&&(e[s]=Ct(t[s]))}return e}const{toString:dr}={};function St(t){return dr.call(t).slice(8,-1)}const Kt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",pr=typeof Kt=="symbol"?function(t){var e;return t!=null&&(e=t[Kt])&&e.apply(t)}:function(){return null};function Re(t,e){const n=t.indexOf(e);return n>=0&&t.splice(n,1),n>=0}const xe={};function J(t){var e,n,r,s;if(arguments.length===1){if(M(t))return t.slice();if(this===xe&&typeof t=="string")return[t];if(s=pr(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const Jt=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var re=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Rn(t,e){re=t,Fn=e}var Fn=()=>!0;const mr=!new Error("").stack;function be(){if(mr)try{throw be.arguments,new Error}catch(t){return t}return new Error}function jt(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Fn).map(r=>`
`+r).join("")):""}var Nn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Zt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Nn),yr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ae(t,e){this._e=be(),this.name=t,this.message=e}function Mn(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function ct(t,e,n,r){this._e=be(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Mn(t,e)}function Pe(t,e){this._e=be(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=Mn(t,this.failures)}Oe(Ae).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+jt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Oe(ct).from(Ae),Oe(Pe).from(Ae);var en=Zt.reduce((t,e)=>(t[e]=e+"Error",t),{});const gr=Ae;var C=Zt.reduce((t,e)=>{var n=e+"Error";function r(s,o){this._e=be(),this.name=n,s?typeof s=="string"?(this.message=`${s}${o?`
 `+o:""}`,this.inner=o||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=yr[e]||n,this.inner=null)}return Oe(r).from(gr),t[e]=r,t},{});C.Syntax=SyntaxError,C.Type=TypeError,C.Range=RangeError;var mn=Nn.reduce((t,e)=>(t[e+"Error"]=C[e],t),{}),nt=Zt.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=C[e]),t),{});function j(){}function ze(t){return t}function br(t,e){return t==null||t===ze?e:function(n){return e(t(n))}}function me(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function vr(t,e){return t===j?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?me(r,this.onsuccess):r),s&&(this.onerror=this.onerror?me(s,this.onerror):s),o!==void 0?o:n}}function wr(t,e){return t===j?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?me(n,this.onsuccess):n),r&&(this.onerror=this.onerror?me(r,this.onerror):r)}}function _r(t,e){return t===j?e:function(n){var r=t.apply(this,arguments);V(n,r);var s=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?me(s,this.onsuccess):s),o&&(this.onerror=this.onerror?me(o,this.onerror):o),r===void 0?i===void 0?void 0:i:V(r,i)}}function kr(t,e){return t===j?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function tn(t,e){return t===j?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,o=new Array(s);s--;)o[s]=arguments[s];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}nt.ModifyError=ct,nt.DexieError=Ae,nt.BulkError=Pe;var Ve={};const[yn,ht,xr]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Se(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Se(e),t]})(),Pr=ht&&ht.then,rt=yn&&yn.constructor,nn=!!xr;var Dt=!1,Me=function(t,e){Fe.push([t,e]),ft&&(queueMicrotask(Or),ft=!1)},qt=!0,ft=!0,fe=[],st=[],Tt=null,Bt=ze,ie={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:j,pgp:!1,env:{},finalize:j},A=ie,Fe=[],de=0,it=[];function P(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=A;if(re&&(this._stackHolder=be(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ve)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Rt(this,this._value))}this._state=null,this._value=null,++e.ref,Ln(this,t)}const It={get:function(){var t=A,e=dt;function n(r,s){var o=!t.global&&(t!==A||e!==dt);const i=o&&!ue();var u=new P((a,f)=>{rn(this,new $n(pt(r,t,o,i),pt(s,t,o,i),a,f,t))});return re&&Vn(u,this),u}return n.prototype=Ve,n},set:function(t){ee(this,"then",t&&t.prototype===Ve?It:{get:function(){return t},set:It.set})}};function $n(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function Ln(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&je();n&&typeof n.then=="function"?Ln(t,(s,o)=>{n instanceof P?n._then(s,o):n.then(s,o)}):(t._state=!0,t._value=n,Un(t)),r&&De()}},Rt.bind(null,t))}catch(n){Rt(t,n)}}function Rt(t,e){if(st.push(e),t._state===null){var n=t._lib&&je();e=Bt(e),t._state=!1,t._value=e,re&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,o){try{r.apply(null,o)}catch(i){s&&s(i)}}(()=>{var r=Xt(e,"stack");e._promise=t,ee(e,"stack",{get:()=>Dt?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){fe.some(s=>s._value===r._value)||fe.push(r)}(t),Un(t),n&&De()}}function Un(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)rn(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),de===0&&(++de,Me(()=>{--de==0&&sn()},[]))}function rn(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++de,Me(Er,[n,t,e])}else t._listeners.push(e)}function Er(t,e,n){try{Tt=e;var r,s=e._value;e._state?r=t(s):(st.length&&(st=[]),r=t(s),st.indexOf(s)===-1&&function(o){for(var i=fe.length;i;)if(fe[--i]._value===o._value)return void fe.splice(i,1)}(e)),n.resolve(r)}catch(o){n.reject(o)}finally{Tt=null,--de==0&&sn(),--n.psd.ref||n.psd.finalize()}}function zn(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,o,i=t._value;i!=null?(s=i.name||"Error",o=i.message||i,r=jt(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return re&&((r=jt(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&zn(t._prev,e,n)),e}function Vn(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function Or(){ye(ie,()=>{je()&&De()})}function je(){var t=qt;return qt=!1,ft=!1,t}function De(){var t,e,n;do for(;Fe.length>0;)for(t=Fe,Fe=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Fe.length>0);qt=!0,ft=!0}function sn(){var t=fe;fe=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=it.slice(0),n=e.length;n;)e[--n]()}function He(t){return new P(Ve,!1,t)}function q(t,e){var n=A;return function(){var r=je(),s=A;try{return le(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{le(s,!1),r&&De()}}}Ke(P.prototype,{then:It,_then:function(t,e){rn(this,new $n(null,null,t,e,A))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):He(r)):this.then(null,r=>r&&r.name===e?n(r):He(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),He(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Dt=!0;var t=zn(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Dt=!1}}},timeout:function(t,e){return t<1/0?new P((n,r)=>{var s=setTimeout(()=>r(new C.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ee(P.prototype,Symbol.toStringTag,"Dexie.Promise"),ie.env=Wn(),Ke(P,{all:function(){var t=J.apply(null,arguments).map(Qe);return new P(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,o)=>P.resolve(s).then(i=>{t[o]=i,--r||e(t)},n))})},resolve:t=>{if(t instanceof P)return t;if(t&&typeof t.then=="function")return new P((n,r)=>{t.then(n,r)});var e=new P(Ve,!0,t);return Vn(e,Tt),e},reject:He,race:function(){var t=J.apply(null,arguments).map(Qe);return new P((e,n)=>{t.map(r=>P.resolve(r).then(e,n))})},PSD:{get:()=>A,set:t=>A=t},totalEchoes:{get:()=>dt},newPSD:ae,usePSD:ye,scheduler:{get:()=>Me,set:t=>{Me=t}},rejectionMapper:{get:()=>Bt,set:t=>{Bt=t}},follow:(t,e)=>new P((n,r)=>ae((s,o)=>{var i=A;i.unhandleds=[],i.onunhandled=o,i.finalize=me(function(){(function(u){function a(){u(),it.splice(it.indexOf(a),1)}it.push(a),++de,Me(()=>{--de==0&&sn()},[])})(()=>{this.unhandleds.length===0?s():o(this.unhandleds[0])})},i.finalize),t()},e,n,r))}),rt&&(rt.allSettled&&ee(P,"allSettled",function(){const t=J.apply(null,arguments).map(Qe);return new P(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,o)=>P.resolve(s).then(i=>r[o]={status:"fulfilled",value:i},i=>r[o]={status:"rejected",reason:i}).then(()=>--n||e(r)))})}),rt.any&&typeof AggregateError<"u"&&ee(P,"any",function(){const t=J.apply(null,arguments).map(Qe);return new P((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((o,i)=>P.resolve(o).then(u=>e(u),u=>{s[i]=u,--r||n(new AggregateError(s))}))})}));const N={awaits:0,echoes:0,id:0};var Ar=0,ot=[],wt=0,dt=0,Cr=0;function ae(t,e,n,r){var s=A,o=Object.create(s);o.parent=s,o.ref=0,o.global=!1,o.id=++Cr;var i=ie.env;o.env=nn?{Promise:P,PromiseProp:{value:P,configurable:!0,writable:!0},all:P.all,race:P.race,allSettled:P.allSettled,any:P.any,resolve:P.resolve,reject:P.reject,nthen:gn(i.nthen,o),gthen:gn(i.gthen,o)}:{},e&&V(o,e),++s.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=ye(o,t,n,r);return o.ref===0&&o.finalize(),u}function qe(){return N.id||(N.id=++Ar),++N.awaits,N.echoes+=100,N.id}function ue(){return!!N.awaits&&(--N.awaits==0&&(N.id=0),N.echoes=100*N.awaits,!0)}function Qe(t){return N.echoes&&t&&t.constructor===rt?(qe(),t.then(e=>(ue(),e),e=>(ue(),B(e)))):t}function Sr(t){++dt,N.echoes&&--N.echoes!=0||(N.echoes=N.id=0),ot.push(A),le(t,!0)}function Kr(){var t=ot[ot.length-1];ot.pop(),le(t,!1)}function le(t,e){var n=A;if((e?!N.echoes||wt++&&t===A:!wt||--wt&&t===A)||queueMicrotask(e?Sr.bind(null,t):Kr),t!==A&&(A=t,n===ie&&(ie.env=Wn()),nn)){var r=ie.env.Promise,s=t.env;ht.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(F,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function Wn(){var t=F.Promise;return nn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(F,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:ht.then,gthen:t.prototype.then}:{}}function ye(t,e,n,r,s){var o=A;try{return le(t,!0),e(n,r,s)}finally{le(o,!1)}}function pt(t,e,n,r){return typeof t!="function"?t:function(){var s=A;n&&qe(),le(e,!0);try{return t.apply(this,arguments)}finally{le(s,!1),r&&queueMicrotask(ue)}}}function gn(t,e){return function(n,r){return t.call(this,pt(n,e),pt(r,e))}}(""+Pr).indexOf("[native code]")===-1&&(qe=ue=j);var B=P.reject;function Ft(t,e,n,r){if(t.idbdb&&(t._state.openComplete||A.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===en.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Ft(t,e,n,r))):B(o)}return s._promise(e,(o,i)=>ae(()=>(A.trans=s,r(o,i,s)))).then(o=>{if(e==="readwrite")try{s.idbtrans.commit()}catch{}return e==="readonly"?o:s._completion.then(()=>o)})}if(t._state.openComplete)return B(new C.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return B(new C.DatabaseClosed);t.open().catch(j)}return t._state.dbReadyPromise.then(()=>Ft(t,e,n,r))}const he=String.fromCharCode(65535),X="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",$e=[],bt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),jr=bt,Dr=bt,Yn=t=>!/(dexie\.js|dexie\.min\.js)/.test(t);function ge(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Gn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Xe(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=oe(e))[t],e)}function qr(){throw C.Type()}function K(t,e){try{const n=bn(t),r=bn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,o){const i=s.length,u=o.length,a=i<u?i:u;for(let f=0;f<a;++f)if(s[f]!==o[f])return s[f]<o[f]?-1:1;return i===u?0:i<u?-1:1}(vn(t),vn(e));case"Array":return function(s,o){const i=s.length,u=o.length,a=i<u?i:u;for(let f=0;f<a;++f){const h=K(s[f],o[f]);if(h!==0)return h}return i===u?0:i<u?-1:1}(t,e)}}catch{}return NaN}function bn(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=St(t);return n==="ArrayBuffer"?"binary":n}function vn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class wn{_trans(e,n,r){const s=this._tx||A.trans,o=this.name;function i(a,f,h){if(!h.schema[o])throw new C.NotFound("Table "+o+" not part of transaction");return n(h.idbtrans,h)}const u=je();try{return s&&s.db._novip===this.db._novip?s===A.trans?s._promise(e,i,r):ae(()=>s._promise(e,i,r),{trans:s,transless:A.transless||A}):Ft(this.db,e,[this.name],i)}finally{u&&De()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(M(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=I(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(f=>{if(f.compound&&n.every(h=>f.keyPath.indexOf(h)>=0)){for(let h=0;h<n.length;++h)if(n.indexOf(f.keyPath[h])===-1)return!1;return!0}return!1}).sort((f,h)=>f.keyPath.length-h.keyPath.length)[0];if(r&&this.db._maxKey!==he){const f=r.keyPath.slice(0,n.length);return this.where(f).equals(f.map(h=>e[h]))}!r&&re&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,o=this.db._deps.indexedDB;function i(f,h){return o.cmp(f,h)===0}const[u,a]=n.reduce(([f,h],l)=>{const c=s[l],p=e[l];return[f||c,f||!c?ge(h,c&&c.multi?g=>{const y=te(g,l);return M(y)&&y.some(b=>i(p,b))}:g=>i(p,te(g,l))):h]},[null,null]);return u?this.where(u.name).equals(e[u.keyPath]).filter(a):r?this.filter(a):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,M(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){const{db:n,name:r}=this;this.schema.mappedClass=e,e.prototype instanceof qr&&(e=class extends e{get db(){return n}table(){return r}});const s=new Set;for(let i=e.prototype;i;i=Se(i))Object.getOwnPropertyNames(i).forEach(u=>s.add(u));const o=i=>{if(!i)return i;const u=Object.create(e.prototype);for(let a in i)if(!s.has(a))try{u[a]=i[a]}catch{}return u};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),e}defineClass(){return this.mapToClass(function(e){V(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let o=e;return s&&r&&(o=Xe(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"add",keys:n!=null?[n]:null,values:[o]})).then(i=>i.numFailures?P.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{W(e,s,i)}catch{}return i})}update(e,n){if(typeof e!="object"||M(e))return this.where(":id").equals(e).modify(n);{const r=te(e,this.schema.primKey.keyPath);return r===void 0?B(new C.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let o=e;return s&&r&&(o=Xe(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"put",values:[o],keys:n!=null?[n]:null})).then(i=>i.numFailures?P.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{W(e,s,i)}catch{}return i})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?P.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Gn})).then(e=>e.numFailures?P.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,o=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:u,keyPath:a}=this.schema.primKey;if(a&&s)throw new C.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");const f=e.length;let h=a&&u?e.map(Xe(a)):e;return this.core.mutate({trans:i,type:"add",keys:s,values:h,wantResults:o}).then(({numFailures:l,results:c,lastResult:p,failures:g})=>{if(l===0)return o?c:p;throw new Pe(`${this.name}.bulkAdd(): ${l} of ${f} operations failed`,g)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,o=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:u,keyPath:a}=this.schema.primKey;if(a&&s)throw new C.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");const f=e.length;let h=a&&u?e.map(Xe(a)):e;return this.core.mutate({trans:i,type:"put",keys:s,values:h,wantResults:o}).then(({numFailures:l,results:c,lastResult:p,failures:g})=>{if(l===0)return o?c:p;throw new Pe(`${this.name}.bulkPut(): ${l} of ${f} operations failed`,g)})})}bulkUpdate(e){const n=this.core,r=e.map(i=>i.key),s=e.map(i=>i.changes),o=[];return this._trans("readwrite",i=>n.getMany({trans:i,keys:r,cache:"clone"}).then(u=>{const a=[],f=[];e.forEach(({key:l,changes:c},p)=>{const g=u[p];if(g){for(const y of Object.keys(c)){const b=c[y];if(y===this.schema.primKey.keyPath){if(K(b,l)!==0)throw new C.Constraint("Cannot update primary key in bulkUpdate()")}else W(g,y,b)}o.push(p),a.push(l),f.push(g)}});const h=a.length;return n.mutate({trans:i,type:"put",keys:a,values:f,updates:{keys:r,changeSpecs:s}}).then(({numFailures:l,failures:c})=>{if(l===0)return h;for(const p of Object.keys(c)){const g=o[Number(p)];if(g!=null){const y=c[p];delete c[p],c[g]=y}}throw new Pe(`${this.name}.bulkUpdate(): ${l} of ${h} operations failed`,c)})}))}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:o})=>{if(r===0)return s;throw new Pe(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,o)})}}function Le(t){var e={},n=function(u,a){if(a){for(var f=arguments.length,h=new Array(f-1);--f;)h[f-1]=arguments[f];return e[u].subscribe.apply(null,h),t}if(typeof u=="string")return e[u]};n.addEventType=o;for(var r=1,s=arguments.length;r<s;++r)o(arguments[r]);return n;function o(u,a,f){if(typeof u=="object")return i(u);a||(a=kr),f||(f=j);var h={subscribers:[],fire:f,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=a(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(c){return c!==l}),h.fire=h.subscribers.reduce(a,f)}};return e[u]=n[u]=h,h}function i(u){I(u).forEach(function(a){var f=u[a];if(M(f))o(a,u[a][0],u[a][1]);else{if(f!=="asap")throw new C.InvalidArgument("Invalid event config");var h=o(a,ze,function(){for(var l=arguments.length,c=new Array(l);l--;)c[l]=arguments[l];h.subscribers.forEach(function(p){Dn(function(){p.apply(null,c)})})})}})}}function Be(t,e){return Oe(e).from({prototype:t}),e}function _e(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function _t(t,e){t.filter=ge(t.filter,e)}function kt(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>ge(r(),e()):e,t.justLimit=n&&!r}function at(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new C.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function _n(t,e,n){const r=at(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Je(t,e,n,r){const s=t.replayFilter?ge(t.filter,t.replayFilter()):t.filter;if(t.or){const o={},i=(u,a,f)=>{if(!s||s(a,f,c=>a.stop(c),c=>a.fail(c))){var h=a.primaryKey,l=""+h;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),U(o,l)||(o[l]=!0,e(u,a,f))}};return Promise.all([t.or._iterate(i,n),kn(_n(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])}return kn(_n(t,r,n),ge(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function kn(t,e,n,r){var s=q(r?(o,i,u)=>n(r(o),i,u):n);return t.then(o=>{if(o)return o.start(()=>{var i=()=>o.continue();e&&!e(o,u=>i=u,u=>{o.stop(u),i=j},u=>{o.fail(u),i=j})||s(o.value,o,u=>i=u),i()})})}class Tr{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,B.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,B.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=ge(n.algorithm,e)}_iterate(e,n){return Je(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&V(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>Je(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(_e(r,!0))return s.count({trans:n,query:{index:at(r,s.schema),range:r.range}}).then(i=>Math.min(i,r.limit));var o=0;return Je(r,()=>(++o,!1),n,s).then(()=>o)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],o=r.length-1;function i(f,h){return h?i(f[r[h]],h-1):f[s]}var u=this._ctx.dir==="next"?1:-1;function a(f,h){var l=i(f,o),c=i(h,o);return l<c?-u:l>c?u:0}return this.toArray(function(f){return f.sort(a)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&_e(r,!0)&&r.limit>0){const{valueMapper:s}=r,o=at(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:o,range:r.range}}).then(({result:i})=>s?i.map(s):i)}{const s=[];return Je(r,o=>s.push(o),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,_e(n)?kt(n,()=>{var r=e;return(s,o)=>r===0||(r===1?(--r,!1):(o(()=>{s.advance(r),r=0}),!1))}):kt(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),kt(this._ctx,()=>{var n=e;return function(r,s,o){return--n<=0&&s(o),n>=0}},!0),this}until(e,n){return _t(this._ctx,function(r,s,o){return!e(r.value)||(s(o),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return _t(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=ge(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,o){r.push(o.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&_e(n,!0)&&n.limit>0)return this._read(s=>{var o=at(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return _t(this._ctx,function(s){var o=s.primaryKey.toString(),i=U(r,o);return r[o]=!0,!i}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var o=I(e),i=o.length;s=function(y){for(var b=!1,m=0;m<i;++m){var d=o[m],v=e[d];te(y,d)!==v&&(W(y,d,v),b=!0)}return b}}const u=n.table.core,{outbound:a,extractKey:f}=u.schema.primaryKey,h=this.db._options.modifyChunkSize||200,l=[];let c=0;const p=[],g=(y,b)=>{const{failures:m,numFailures:d}=b;c+=y-d;for(let v of I(m))l.push(m[v])};return this.clone().primaryKeys().then(y=>{const b=m=>{const d=Math.min(h,y.length-m);return u.getMany({trans:r,keys:y.slice(m,m+d),cache:"immutable"}).then(v=>{const E=[],k=[],w=a?[]:null,x=[];for(let _=0;_<d;++_){const S=v[_],D={value:oe(S),primKey:y[m+_]};s.call(D,D.value,D)!==!1&&(D.value==null?x.push(y[m+_]):a||K(f(S),f(D.value))===0?(k.push(D.value),a&&w.push(y[m+_])):(x.push(y[m+_]),E.push(D.value)))}const O=_e(n)&&n.limit===1/0&&(typeof e!="function"||e===xt)&&{index:n.index,range:n.range};return Promise.resolve(E.length>0&&u.mutate({trans:r,type:"add",values:E}).then(_=>{for(let S in _.failures)x.splice(parseInt(S),1);g(E.length,_)})).then(()=>(k.length>0||O&&typeof e=="object")&&u.mutate({trans:r,type:"put",keys:w,values:k,criteria:O,changeSpec:typeof e!="function"&&e}).then(_=>g(k.length,_))).then(()=>(x.length>0||O&&e===xt)&&u.mutate({trans:r,type:"delete",keys:x,criteria:O}).then(_=>g(x.length,_))).then(()=>y.length>m+d&&b(m+h))})};return b(0).then(()=>{if(l.length>0)throw new ct("Error modifying one or more objects",l,c,p);return y.length})})})}delete(){var e=this._ctx,n=e.range;return _e(e)&&(e.isPrimKey&&!Dr||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,o=n;return e.table.core.count({trans:r,query:{index:s,range:o}}).then(i=>e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(({failures:u,lastResult:a,results:f,numFailures:h})=>{if(h)throw new ct("Could not delete some values",Object.keys(u).map(l=>u[l]),i-h);return i-h}))}):this.modify(xt)}}const xt=(t,e)=>e.value=null;function Br(t,e){return t<e?-1:t===e?0:1}function Ir(t,e){return t>e?-1:t===e?0:1}function z(t,e,n){var r=t instanceof Qn?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function ke(t){return new t.Collection(t,()=>Hn("")).limit(0)}function Rr(t,e,n,r,s,o){for(var i=Math.min(t.length,r.length),u=-1,a=0;a<i;++a){var f=e[a];if(f!==r[a])return s(t[a],n[a])<0?t.substr(0,a)+n[a]+n.substr(a+1):s(t[a],r[a])<0?t.substr(0,a)+r[a]+n.substr(a+1):u>=0?t.substr(0,u)+e[u]+n.substr(u+1):null;s(t[a],f)<0&&(u=a)}return i<r.length&&o==="next"?t+n.substr(t.length):i<t.length&&o==="prev"?t.substr(0,n.length):u<0?null:t.substr(0,u)+r[u]+n.substr(u+1)}function Ze(t,e,n,r){var s,o,i,u,a,f,h,l=n.length;if(!n.every(y=>typeof y=="string"))return z(t,"String expected.");function c(y){s=function(m){return m==="next"?d=>d.toUpperCase():d=>d.toLowerCase()}(y),o=function(m){return m==="next"?d=>d.toLowerCase():d=>d.toUpperCase()}(y),i=y==="next"?Br:Ir;var b=n.map(function(m){return{lower:o(m),upper:s(m)}}).sort(function(m,d){return i(m.lower,d.lower)});u=b.map(function(m){return m.upper}),a=b.map(function(m){return m.lower}),f=y,h=y==="next"?"":r}c("next");var p=new t.Collection(t,()=>se(u[0],a[l-1]+r));p._ondirectionchange=function(y){c(y)};var g=0;return p._addAlgorithm(function(y,b,m){var d=y.key;if(typeof d!="string")return!1;var v=o(d);if(e(v,a,g))return!0;for(var E=null,k=g;k<l;++k){var w=Rr(d,v,u[k],a[k],i,f);w===null&&E===null?g=k+1:(E===null||i(E,w)>0)&&(E=w)}return b(E!==null?function(){y.continue(E+h)}:m),!1}),p}function se(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Hn(t){return{type:1,lower:t,upper:t}}class Qn{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?ke(this):new this.Collection(this,()=>se(e,n,!r,!s))}catch{return z(this,X)}}equals(e){return e==null?z(this,X):new this.Collection(this,()=>Hn(e))}above(e){return e==null?z(this,X):new this.Collection(this,()=>se(e,void 0,!0))}aboveOrEqual(e){return e==null?z(this,X):new this.Collection(this,()=>se(e,void 0,!1))}below(e){return e==null?z(this,X):new this.Collection(this,()=>se(void 0,e,!1,!0))}belowOrEqual(e){return e==null?z(this,X):new this.Collection(this,()=>se(void 0,e))}startsWith(e){return typeof e!="string"?z(this,"String expected."):this.between(e,e+he,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Ze(this,(n,r)=>n.indexOf(r[0])===0,[e],he)}equalsIgnoreCase(e){return Ze(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=J.apply(xe,arguments);return e.length===0?ke(this):Ze(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=J.apply(xe,arguments);return e.length===0?ke(this):Ze(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,he)}anyOf(){const e=J.apply(xe,arguments);let n=this._cmp;try{e.sort(n)}catch{return z(this,X)}if(e.length===0)return ke(this);const r=new this.Collection(this,()=>se(e[0],e[e.length-1]));r._ondirectionchange=o=>{n=o==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((o,i,u)=>{const a=o.key;for(;n(a,e[s])>0;)if(++s,s===e.length)return i(u),!1;return n(a,e[s])===0||(i(()=>{o.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[-(1/0),e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=J.apply(xe,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return z(this,X)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[-(1/0),s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,o=this._descending,i=this._min,u=this._max;if(e.length===0)return ke(this);if(!e.every(d=>d[0]!==void 0&&d[1]!==void 0&&s(d[0],d[1])<=0))return z(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",C.InvalidArgument);const a=!n||n.includeLowers!==!1,f=n&&n.includeUppers===!0;let h,l=s;function c(d,v){return l(d[0],v[0])}try{h=e.reduce(function(d,v){let E=0,k=d.length;for(;E<k;++E){const w=d[E];if(r(v[0],w[1])<0&&r(v[1],w[0])>0){w[0]=i(w[0],v[0]),w[1]=u(w[1],v[1]);break}}return E===k&&d.push(v),d},[]),h.sort(c)}catch{return z(this,X)}let p=0;const g=f?d=>s(d,h[p][1])>0:d=>s(d,h[p][1])>=0,y=a?d=>o(d,h[p][0])>0:d=>o(d,h[p][0])>=0;let b=g;const m=new this.Collection(this,()=>se(h[0][0],h[h.length-1][1],!a,!f));return m._ondirectionchange=d=>{d==="next"?(b=g,l=s):(b=y,l=o),h.sort(c)},m._addAlgorithm((d,v,E)=>{for(var k=d.key;b(k);)if(++p,p===h.length)return v(E),!1;return!!function(w){return!g(w)&&!y(w)}(k)||(this._cmp(k,h[p][1])===0||this._cmp(k,h[p][0])===0||v(()=>{l===s?d.continue(h[p][0]):d.continue(h[p][1])}),!1)}),m}startsWithAnyOf(){const e=J.apply(xe,arguments);return e.every(n=>typeof n=="string")?e.length===0?ke(this):this.inAnyRange(e.map(n=>[n,n+he])):z(this,"startsWithAnyOf() only works with strings")}}function Q(t){return q(function(e){return We(e),t(e.target.error),!1})}function We(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const ne=Le(null,"storagemutated");class Fr{_lock(){return Ie(!A.global),++this._reculock,this._reculock!==1||A.global||(A.lockOwnerFor=this),this}_unlock(){if(Ie(!A.global),--this._reculock==0)for(A.global||(A.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ye(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&A.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Ie(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new C.DatabaseClosed(r);case"MissingAPIError":throw new C.MissingAPI(r.message,r);default:throw new C.OpenFailed(r)}if(!this.active)throw new C.TransactionInactive;return Ie(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=q(s=>{We(s),this._reject(e.error)}),e.onabort=q(s=>{We(s),this.active&&this._reject(new C.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=q(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&ne.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return B(new C.ReadOnly("Transaction is readonly"));if(!this.active)return B(new C.TransactionInactive);if(this._locked())return new P((o,i)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(o,i)},A])});if(r)return ae(()=>{var o=new P((i,u)=>{this._lock();const a=n(i,u,this);a&&a.then&&a.then(i,u)});return o.finally(()=>this._unlock()),o._lib=!0,o});var s=new P((o,i)=>{var u=n(o,i,this);u&&u.then&&u.then(o,i)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=P.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=i)})()}var o=n._waitingFor;return new P((i,u)=>{r.then(a=>n._waitingQueue.push(q(i.bind(null,a))),a=>n._waitingQueue.push(q(u.bind(null,a)))).finally(()=>{n._waitingFor===o&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new C.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(U(n,e))return n[e];const r=this.schema[e];if(!r)throw new C.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function Nt(t,e,n,r,s,o,i){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:o,src:(n&&!i?"&":"")+(r?"*":"")+(s?"++":"")+Xn(e)}}function Xn(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Jn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:(r=n,s=o=>[o.name,o],r.reduce((o,i,u)=>{var a=s(i,u);return a&&(o[a[0]]=a[1]),o},{}))};var r,s}let Ye=t=>{try{return t.only([[]]),Ye=()=>[[]],[[]]}catch{return Ye=()=>he,he}};function Mt(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>te(n,e)}(t):e=>te(e,t)}function xn(t){return[].slice.call(t)}let Nr=0;function Ue(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Mr(t,e,n){function r(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:f,upper:h,lowerOpen:l,upperOpen:c}=a;return f===void 0?h===void 0?null:e.upperBound(h,!!c):h===void 0?e.lowerBound(f,!!l):e.bound(f,h,!!l,!!c)}const{schema:s,hasGetAll:o}=function(a,f){const h=xn(a.objectStoreNames);return{schema:{name:a.name,tables:h.map(l=>f.objectStore(l)).map(l=>{const{keyPath:c,autoIncrement:p}=l,g=M(c),y=c==null,b={},m={name:l.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y,compound:g,keyPath:c,autoIncrement:p,unique:!0,extractKey:Mt(c)},indexes:xn(l.indexNames).map(d=>l.index(d)).map(d=>{const{name:v,unique:E,multiEntry:k,keyPath:w}=d,x={name:v,compound:M(w),keyPath:w,unique:E,multiEntry:k,extractKey:Mt(w)};return b[Ue(w)]=x,x}),getIndexByKeyPath:d=>b[Ue(d)]};return b[":id"]=m.primaryKey,c!=null&&(b[Ue(c)]=m.primaryKey),m})},hasGetAll:h.length>0&&"getAll"in f.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),i=s.tables.map(a=>function(f){const h=f.name;return{name:h,schema:f,mutate:function({trans:l,type:c,keys:p,values:g,range:y}){return new Promise((b,m)=>{b=q(b);const d=l.objectStore(h),v=d.keyPath==null,E=c==="put"||c==="add";if(!E&&c!=="delete"&&c!=="deleteRange")throw new Error("Invalid operation type: "+c);const{length:k}=p||g||{length:1};if(p&&g&&p.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(k===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let w;const x=[],O=[];let _=0;const S=R=>{++_,We(R)};if(c==="deleteRange"){if(y.type===4)return b({numFailures:_,failures:O,results:[],lastResult:void 0});y.type===3?x.push(w=d.clear()):x.push(w=d.delete(r(y)))}else{const[R,$]=E?v?[g,p]:[g,null]:[p,null];if(E)for(let T=0;T<k;++T)x.push(w=$&&$[T]!==void 0?d[c](R[T],$[T]):d[c](R[T])),w.onerror=S;else for(let T=0;T<k;++T)x.push(w=d[c](R[T])),w.onerror=S}const D=R=>{const $=R.target.result;x.forEach((T,ve)=>T.error!=null&&(O[ve]=T.error)),b({numFailures:_,failures:O,results:c==="delete"?p:x.map(T=>T.result),lastResult:$})};w.onerror=R=>{S(R),D(R)},w.onsuccess=D})},getMany:({trans:l,keys:c})=>new Promise((p,g)=>{p=q(p);const y=l.objectStore(h),b=c.length,m=new Array(b);let d,v=0,E=0;const k=x=>{const O=x.target;m[O._pos]=O.result,++E===v&&p(m)},w=Q(g);for(let x=0;x<b;++x)c[x]!=null&&(d=y.get(c[x]),d._pos=x,d.onsuccess=k,d.onerror=w,++v);v===0&&p(m)}),get:({trans:l,key:c})=>new Promise((p,g)=>{p=q(p);const y=l.objectStore(h).get(c);y.onsuccess=b=>p(b.target.result),y.onerror=Q(g)}),query:function(l){return c=>new Promise((p,g)=>{p=q(p);const{trans:y,values:b,limit:m,query:d}=c,v=m===1/0?void 0:m,{index:E,range:k}=d,w=y.objectStore(h),x=E.isPrimaryKey?w:w.index(E.name),O=r(k);if(m===0)return p({result:[]});if(l){const _=b?x.getAll(O,v):x.getAllKeys(O,v);_.onsuccess=S=>p({result:S.target.result}),_.onerror=Q(g)}else{let _=0;const S=b||!("openKeyCursor"in x)?x.openCursor(O):x.openKeyCursor(O),D=[];S.onsuccess=R=>{const $=S.result;return $?(D.push(b?$.value:$.primaryKey),++_===m?p({result:D}):void $.continue()):p({result:D})},S.onerror=Q(g)}})}(o),openCursor:function({trans:l,values:c,query:p,reverse:g,unique:y}){return new Promise((b,m)=>{b=q(b);const{index:d,range:v}=p,E=l.objectStore(h),k=d.isPrimaryKey?E:E.index(d.name),w=g?y?"prevunique":"prev":y?"nextunique":"next",x=c||!("openKeyCursor"in k)?k.openCursor(r(v),w):k.openKeyCursor(r(v),w);x.onerror=Q(m),x.onsuccess=q(O=>{const _=x.result;if(!_)return void b(null);_.___id=++Nr,_.done=!1;const S=_.continue.bind(_);let D=_.continuePrimaryKey;D&&(D=D.bind(_));const R=_.advance.bind(_),$=()=>{throw new Error("Cursor not stopped")};_.trans=l,_.stop=_.continue=_.continuePrimaryKey=_.advance=()=>{throw new Error("Cursor not started")},_.fail=q(m),_.next=function(){let T=1;return this.start(()=>T--?this.continue():this.stop()).then(()=>this)},_.start=T=>{const ve=new Promise((G,we)=>{G=q(G),x.onerror=Q(we),_.fail=we,_.stop=Te=>{_.stop=_.continue=_.continuePrimaryKey=_.advance=$,G(Te)}}),Y=()=>{if(x.result)try{T()}catch(G){_.fail(G)}else _.done=!0,_.start=()=>{throw new Error("Cursor behind last entry")},_.stop()};return x.onsuccess=q(G=>{x.onsuccess=Y,Y()}),_.continue=S,_.continuePrimaryKey=D,_.advance=R,Y(),ve},b(_)},m)})},count({query:l,trans:c}){const{index:p,range:g}=l;return new Promise((y,b)=>{const m=c.objectStore(h),d=p.isPrimaryKey?m:m.index(p.name),v=r(g),E=v?d.count(v):d.count();E.onsuccess=q(k=>y(k.target.result)),E.onerror=Q(b)})}}}(a)),u={};return i.forEach(a=>u[a.name]=a),{stack:"dbcore",transaction:t.transaction.bind(t),table(a){if(!u[a])throw new Error(`Table '${a}' not found`);return u[a]},MIN_KEY:-1/0,MAX_KEY:Ye(e),schema:s}}function $t(t,e){const n=e.db,r=function(s,o,{IDBKeyRange:i,indexedDB:u},a){return{dbcore:function(h,l){return l.reduce((c,{create:p})=>({...c,...p(c)}),h)}(Mr(o,i,a),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const o=s.name;t.core.schema.tables.some(i=>i.name===o)&&(s.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=s.core))})}function mt(t,e,n,r){n.forEach(s=>{const o=r[s];e.forEach(i=>{const u=Xt(i,s);(!u||"value"in u&&u.value===void 0)&&(i===t.Transaction.prototype||i instanceof t.Transaction?ee(i,s,{get(){return this.table(s)},set(a){Kn(this,s,{value:a,writable:!0,configurable:!0,enumerable:!0})}}):i[s]=new t.Table(s,o))})})}function Lt(t,e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function $r(t,e){return t._cfg.version-e._cfg.version}function Lr(t,e,n,r){const s=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,s);o.create(n),o._completion.catch(r);const i=o._reject.bind(o),u=A.transless||A;ae(()=>{A.trans=o,A.transless=u,e===0?(I(s).forEach(a=>{Pt(n,a,s[a].primKey,s[a].indexes)}),$t(t,n),P.follow(()=>t.on.populate.fire(o)).catch(i)):function(a,f,h,l){const c=[],p=a._versions;let g=a._dbSchema=zt(a,a.idbdb,l),y=!1;function b(){return c.length?P.resolve(c.shift()(h.idbtrans)).then(b):P.resolve()}return p.filter(m=>m._cfg.version>=f).forEach(m=>{c.push(()=>{const d=g,v=m._cfg.dbschema;Vt(a,d,l),Vt(a,v,l),g=a._dbSchema=v;const E=Zn(d,v);E.add.forEach(w=>{Pt(l,w[0],w[1].primKey,w[1].indexes)}),E.change.forEach(w=>{if(w.recreate)throw new C.Upgrade("Not yet support for changing primary key");{const x=l.objectStore(w.name);w.add.forEach(O=>Ut(x,O)),w.change.forEach(O=>{x.deleteIndex(O.name),Ut(x,O)}),w.del.forEach(O=>x.deleteIndex(O))}});const k=m._cfg.contentUpgrade;if(k&&m._cfg.version>f){$t(a,l),h._memoizedTables={},y=!0;let w=qn(v);E.del.forEach(S=>{w[S]=d[S]}),Lt(a,[a.Transaction.prototype]),mt(a,[a.Transaction.prototype],I(w),w),h.schema=w;const x=Jt(k);let O;x&&qe();const _=P.follow(()=>{if(O=k(h),O&&x){var S=ue.bind(null,null);O.then(S,S)}});return O&&typeof O.then=="function"?P.resolve(O):_.then(()=>O)}}),c.push(d=>{(!y||!jr)&&function(v,E){[].slice.call(E.db.objectStoreNames).forEach(k=>v[k]==null&&E.db.deleteObjectStore(k))}(m._cfg.dbschema,d),Lt(a,[a.Transaction.prototype]),mt(a,[a.Transaction.prototype],a._storeNames,a._dbSchema),h.schema=a._dbSchema})}),b().then(()=>{var m,d;d=l,I(m=g).forEach(v=>{d.db.objectStoreNames.contains(v)||Pt(d,v,m[v].primKey,m[v].indexes)})})}(t,e,o,n).catch(i)})}function Zn(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],o=e[r];if(s){const i={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||s.primKey.auto!==o.primKey.auto&&!bt)i.recreate=!0,n.change.push(i);else{const u=s.idxByName,a=o.idxByName;let f;for(f in u)a[f]||i.del.push(f);for(f in a){const h=u[f],l=a[f];h?h.src!==l.src&&i.change.push(l):i.add.push(l)}(i.del.length>0||i.add.length>0||i.change.length>0)&&n.change.push(i)}}else n.add.push([r,o])}return n}function Pt(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(o=>Ut(s,o)),s}function Ut(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function zt(t,e,n){const r={};return lt(e.objectStoreNames,0).forEach(s=>{const o=n.objectStore(s);let i=o.keyPath;const u=Nt(Xn(i),i||"",!1,!1,!!o.autoIncrement,i&&typeof i!="string",!0),a=[];for(let h=0;h<o.indexNames.length;++h){const l=o.index(o.indexNames[h]);i=l.keyPath;var f=Nt(l.name,i,!!l.unique,!!l.multiEntry,!1,i&&typeof i!="string",!1);a.push(f)}r[s]=Jn(s,u,a)}),r}function Vt(t,e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const o=r[s],i=n.objectStore(o);t._hasGetAll="getAll"in i;for(let u=0;u<i.indexNames.length;++u){const a=i.indexNames[u],f=i.index(a).keyPath,h=typeof f=="string"?f:"["+lt(f).join("+")+"]";if(e[o]){const l=e[o].idxByName[h];l&&(l.name=a,delete e[o].idxByName[h],e[o].idxByName[a]=l)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&F.WorkerGlobalScope&&F instanceof F.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Ur{_parseStoresSpec(e,n){I(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((i,u)=>{const a=(i=i.trim()).replace(/([&*]|\+\+)/g,""),f=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Nt(a,f||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),M(f),u===0)}),o=s.shift();if(o.multi)throw new C.Schema("Primary key cannot be multi-valued");s.forEach(i=>{if(i.auto)throw new C.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new C.Schema("Index must have a name and cannot be an empty string")}),n[r]=Jn(r,o,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?V(this._cfg.storesSource,e):e;const r=n._versions,s={};let o={};return r.forEach(i=>{V(s,i._cfg.storesSource),o=i._cfg.dbschema={},i._parseStoresSpec(s,o)}),n._dbSchema=o,Lt(n,[n._allTables,n,n.Transaction.prototype]),mt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],I(o),o),n._storeNames=I(o),this}upgrade(e){return this._cfg.contentUpgrade=tn(this._cfg.contentUpgrade||j,e),this}}function on(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new pe("__dbnames",{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function an(t){return t&&typeof t.databases=="function"}function Wt(t){return ae(function(){return A.letThrough=!0,t()})}function zr(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function un(t){return!("from"in t)}const L=function(t,e){if(!this){const n=new L;return t&&"d"in t&&V(n,t),n}V(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Ge(t,e,n){const r=K(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(un(t))return V(t,{from:e,to:n,d:1});const s=t.l,o=t.r;if(K(n,t.from)<0)return s?Ge(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Pn(t);if(K(e,t.to)>0)return o?Ge(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Pn(t);K(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),K(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const i=!t.r;s&&!t.l&&yt(t,s),o&&i&&yt(t,o)}function yt(t,e){un(e)||function n(r,{from:s,to:o,l:i,r:u}){Ge(r,s,o),i&&n(r,i),u&&n(r,u)}(t,e)}function Yt(t,e){const n=Gt(e);let r=n.next();if(r.done)return!1;let s=r.value;const o=Gt(t);let i=o.next(s.from),u=i.value;for(;!r.done&&!i.done;){if(K(u.from,s.to)<=0&&K(u.to,s.from)>=0)return!0;K(s.from,u.from)<0?s=(r=n.next(u.from)).value:u=(i=o.next(s.from)).value}return!1}function Gt(t){let e=un(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&K(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||K(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Pn(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const o=s==="r"?"l":"r",i={...t},u=t[s];t.from=u.from,t.to=u.to,t[s]=u[s],i[s]=u[o],t[o]=i,i.d=En(i)}t.d=En(t)}function En({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}function vt(t,e){return I(e).forEach(n=>{t[n]?yt(t[n],e[n]):t[n]=In(e[n])}),t}function er(t,e){return Object.keys(t).some(n=>e[n]&&Yt(e[n],t[n]))}Ke(L.prototype,{add(t){return yt(this,t),this},addKey(t){return Ge(this,t,t),this},addKeys(t){return t.forEach(e=>Ge(this,e,e)),this},[Kt](){return Gt(this)}});const Ee={};let Et={},Ot=!1;function At(t){vt(Et,t),Ot||(Ot=!0,setTimeout(()=>{Ot=!1;const e=Et;Et={},ln(e)},0))}function ln(t,e=!1){const n=new Set;for(const r in t){const s=/^idb\:\/\/(.*)\/(.*)\//.exec(r);if(s){const[,o,i]=s,u=Ee[`idb://${o}/${i}`];u&&Vr(u,t,n,e)}}n.forEach(r=>r())}function Vr(t,e,n,r){const s=r&&[];for(const[o,i]of Object.entries(t.queries.query)){const u=r&&[];for(const a of i)a.obsSet&&er(e,a.obsSet)?a.subscribers.forEach(f=>n.add(f)):r&&u.push(a);r&&s.push([o,u])}if(r)for(const[o,i]of s)t.queries.query[o]=i}function Wr(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?B(e.dbOpenError):t);re&&(e.openCanceller._stackHolder=be()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new C.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,i=null,u=!1;return P.race([r,(typeof navigator>"u"?P.resolve():zr()).then(()=>new P((a,f)=>{if(s(),!n)throw new C.MissingAPI;const h=t.name,l=e.autoSchema?n.open(h):n.open(h,Math.round(10*t.verno));if(!l)throw new C.MissingAPI;l.onerror=Q(f),l.onblocked=q(t._fireOnBlocked),l.onupgradeneeded=q(c=>{if(i=l.transaction,e.autoSchema&&!t._options.allowEmptyDB){l.onerror=We,i.abort(),l.result.close();const g=n.deleteDatabase(h);g.onsuccess=g.onerror=q(()=>{f(new C.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{i.onerror=Q(f);var p=c.oldVersion>Math.pow(2,62)?0:c.oldVersion;u=p<1,t.idbdb=l.result,Lr(t,p/10,i,f)}},f),l.onsuccess=q(()=>{i=null;const c=t.idbdb=l.result,p=lt(c.objectStoreNames);if(p.length>0)try{const y=c.transaction((g=p).length===1?g[0]:g,"readonly");e.autoSchema?function(b,m,d){b.verno=m.version/10;const v=b._dbSchema=zt(0,m,d);b._storeNames=lt(m.objectStoreNames,0),mt(b,[b._allTables],I(v),v)}(t,c,y):(Vt(t,t._dbSchema,y),function(b,m){const d=Zn(zt(0,b.idbdb,m),b._dbSchema);return!(d.add.length||d.change.some(v=>v.add.length||v.change.length))}(t,y)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),$t(t,y)}catch{}var g;$e.push(t),c.onversionchange=q(y=>{e.vcFired=!0,t.on("versionchange").fire(y)}),c.onclose=q(y=>{t.on("close").fire(y)}),u&&function({indexedDB:y,IDBKeyRange:b},m){!an(y)&&m!=="__dbnames"&&on(y,b).put({name:m}).catch(j)}(t._deps,h),a()},f)}))]).then(()=>(s(),e.onReadyBeingFired=[],P.resolve(Wt(()=>t.on.ready.fire(t.vip))).then(function a(){if(e.onReadyBeingFired.length>0){let f=e.onReadyBeingFired.reduce(tn,j);return e.onReadyBeingFired=[],P.resolve(Wt(()=>f(t.vip))).then(a)}}))).finally(()=>{e.openCanceller===r&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(a=>{e.dbOpenError=a;try{i&&i.abort()}catch{}return r===e.openCanceller&&t._close(),B(a)}).finally(()=>{e.openComplete=!0,o()}).then(()=>{if(u){const a={};t.tables.forEach(f=>{f.schema.indexes.forEach(h=>{h.name&&(a[`idb://${t.name}/${f.name}/${h.name}`]=new L(-1/0,[[[]]]))}),a[`idb://${t.name}/${f.name}/`]=a[`idb://${t.name}/${f.name}/:dels`]=new L(-1/0,[[[]]])}),ne("storagemutated").fire(a),ln(a,!0)}return t})}function Ht(t){var e=o=>t.next(o),n=s(e),r=s(o=>t.throw(o));function s(o){return i=>{var u=o(i),a=u.value;return u.done?a:a&&typeof a.then=="function"?a.then(n,r):M(a)?Promise.all(a).then(n,r):n(a)}}return s(e)()}function Yr(t,e,n){var r=arguments.length;if(r<2)throw new C.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];n=s.pop();var o=Tn(s);return[t,o,n]}function tr(t,e,n,r,s){return P.resolve().then(()=>{const o=A.transless||A,i=t._createTransaction(e,n,t._dbSchema,r);i.explicit=!0;const u={trans:i,transless:o};if(r)i.idbtrans=r.idbtrans;else try{i.create(),t._state.PR1398_maxLoop=3}catch(l){return l.name===en.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>tr(t,e,n,null,s))):B(l)}const a=Jt(s);let f;a&&qe();const h=P.follow(()=>{if(f=s.call(i,i),f)if(a){var l=ue.bind(null,null);f.then(l,l)}else typeof f.next=="function"&&typeof f.throw=="function"&&(f=Ht(f))},u);return(f&&typeof f.then=="function"?P.resolve(f).then(l=>i.active?l:B(new C.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>f)).then(l=>(r&&i._resolve(),i._completion.then(()=>l))).catch(l=>(i._reject(l),B(l)))})}function et(t,e,n){const r=M(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const Gr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},o=[];function i(h,l,c){const p=Ue(h),g=s[p]=s[p]||[],y=h==null?0:typeof h=="string"?1:h.length,b=l>0,m={...c,name:b?`${p}(virtual-from:${c.name})`:c.name,lowLevelIndex:c,isVirtual:b,keyTail:l,keyLength:y,extractKey:Mt(h),unique:!b&&c.unique};return g.push(m),m.isPrimaryKey||o.push(m),y>1&&i(y===2?h[0]:h.slice(0,y-1),l+1,c),g.sort((d,v)=>d.keyTail-v.keyTail),m}const u=i(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[u];for(const h of r.indexes)i(h.keyPath,0,h);function a(h){const l=h.query.index;return l.isVirtual?{...h,query:{index:l.lowLevelIndex,range:(c=h.query.range,p=l.keyTail,{type:c.type===1?2:c.type,lower:et(c.lower,c.lowerOpen?t.MAX_KEY:t.MIN_KEY,p),lowerOpen:!0,upper:et(c.upper,c.upperOpen?t.MIN_KEY:t.MAX_KEY,p),upperOpen:!0})}}:h;var c,p}return{...n,schema:{...r,primaryKey:u,indexes:o,getIndexByKeyPath:function(h){const l=s[Ue(h)];return l&&l[0]}},count:h=>n.count(a(h)),query:h=>n.query(a(h)),openCursor(h){const{keyTail:l,isVirtual:c,keyLength:p}=h.query.index;return c?n.openCursor(a(h)).then(g=>g&&function(y){return Object.create(y,{continue:{value:function(m){m!=null?y.continue(et(m,h.reverse?t.MAX_KEY:t.MIN_KEY,l)):h.unique?y.continue(y.key.slice(0,p).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,l)):y.continue()}},continuePrimaryKey:{value(m,d){y.continuePrimaryKey(et(m,t.MAX_KEY,l),d)}},primaryKey:{get:()=>y.primaryKey},key:{get(){const m=y.key;return p===1?m[0]:m.slice(0,p)}},value:{get:()=>y.value}})}(g)):n.openCursor(h)}}}}}};function cn(t,e,n,r){return n=n||{},r=r||"",I(t).forEach(s=>{if(U(e,s)){var o=t[s],i=e[s];if(typeof o=="object"&&typeof i=="object"&&o&&i){const u=St(o);u!==St(i)?n[r+s]=e[s]:u==="Object"?cn(o,i,n,r+s+"."):o!==i&&(n[r+s]=e[s])}else o!==i&&(n[r+s]=e[s])}else n[r+s]=void 0}),I(e).forEach(s=>{U(t,s)||(n[r+s]=e[s])}),n}function hn(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}const Hr={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(o){const i=A.trans,{deleting:u,creating:a,updating:f}=i.table(e).hook;switch(o.type){case"add":if(a.fire===j)break;return i._promise("readwrite",()=>h(o),!0);case"put":if(a.fire===j&&f.fire===j)break;return i._promise("readwrite",()=>h(o),!0);case"delete":if(u.fire===j)break;return i._promise("readwrite",()=>h(o),!0);case"deleteRange":if(u.fire===j)break;return i._promise("readwrite",()=>function(c){return l(c.trans,c.range,1e4)}(o),!0)}return n.mutate(o);function h(c){const p=A.trans,g=c.keys||hn(r,c);if(!g)throw new Error("Keys missing");return(c=c.type==="add"||c.type==="put"?{...c,keys:g}:{...c}).type!=="delete"&&(c.values=[...c.values]),c.keys&&(c.keys=[...c.keys]),function(y,b,m){return b.type==="add"?Promise.resolve([]):y.getMany({trans:b.trans,keys:m,cache:"immutable"})}(n,c,g).then(y=>{const b=g.map((m,d)=>{const v=y[d],E={onerror:null,onsuccess:null};if(c.type==="delete")u.fire.call(E,m,v,p);else if(c.type==="add"||v===void 0){const k=a.fire.call(E,m,c.values[d],p);m==null&&k!=null&&(m=k,c.keys[d]=m,r.outbound||W(c.values[d],r.keyPath,m))}else{const k=cn(v,c.values[d]),w=f.fire.call(E,k,m,v,p);if(w){const x=c.values[d];Object.keys(w).forEach(O=>{U(x,O)?x[O]=w[O]:W(x,O,w[O])})}}return E});return n.mutate(c).then(({failures:m,results:d,numFailures:v,lastResult:E})=>{for(let k=0;k<g.length;++k){const w=d?d[k]:g[k],x=b[k];w==null?x.onerror&&x.onerror(m[k]):x.onsuccess&&x.onsuccess(c.type==="put"&&y[k]?c.values[k]:w)}return{failures:m,results:d,numFailures:v,lastResult:E}}).catch(m=>(b.forEach(d=>d.onerror&&d.onerror(m)),Promise.reject(m)))})}function l(c,p,g){return n.query({trans:c,values:!1,query:{index:r,range:p},limit:g}).then(({result:y})=>h({type:"delete",keys:y,trans:c}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):y.length<g?{failures:[],numFailures:0,lastResult:void 0}:l(c,{...p,lower:y[y.length-1],lowerOpen:!0},g)))}}}}})};function nr(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,o=0;s<e.keys.length&&o<t.length;++s)K(e.keys[s],t[o])===0&&(r.push(n?oe(e.values[s]):e.values[s]),++o);return r.length===t.length?r:null}catch{return null}}const Qr={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=nr(r.keys,r.trans._cache,r.cache==="clone");return s?P.resolve(s):n.getMany(r).then(o=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?oe(o):o},o))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function rr(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function sr(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}const Xr={stack:"dbcore",level:0,name:"Observability",create:t=>{const e=t.schema.name,n=new L(t.MIN_KEY,t.MAX_KEY);return{...t,transaction:(r,s,o)=>{if(A.subscr&&s!=="readonly")throw new C.ReadOnly(`Readwrite transaction in liveQuery context. Querier source: ${A.querier}`);return t.transaction(r,s,o)},table:r=>{const s=t.table(r),{schema:o}=s,{primaryKey:i}=o,{extractKey:u,outbound:a}=i,f={...s,mutate:c=>{const p=c.trans,g=c.mutatedParts||(c.mutatedParts={}),y=w=>{const x=`idb://${e}/${r}/${w}`;return g[x]||(g[x]=new L)},b=y(""),m=y(":dels"),{type:d}=c;let[v,E]=c.type==="deleteRange"?[c.range]:c.type==="delete"?[c.keys]:c.values.length<50?[hn(i,c).filter(w=>w),c.values]:[];const k=c.trans._cache;if(M(v)){b.addKeys(v);const w=d==="delete"||v.length===E.length?nr(v,k):null;w||d==="add"||m.addKeys(v),(w||E)&&function(x,O,_,S){function D(R){const $=x(R.name||"");function T(Y){return Y!=null?R.extractKey(Y):null}const ve=Y=>R.multiEntry&&M(Y)?Y.forEach(G=>$.addKey(G)):$.addKey(Y);(_||S).forEach((Y,G)=>{const we=_&&T(_[G]),Te=S&&T(S[G]);K(we,Te)!==0&&(we!=null&&ve(we),Te!=null&&ve(Te))})}O.indexes.forEach(D)}(y,o,w,E)}else if(v){const w={from:v.lower,to:v.upper};m.add(w),b.add(w)}else b.add(n),m.add(n),o.indexes.forEach(w=>y(w.name).add(n));return s.mutate(c).then(w=>(!v||c.type!=="add"&&c.type!=="put"||b.addKeys(w.results),p.mutatedParts=vt(p.mutatedParts||{},g),w))}},h=({query:{index:c,range:p}})=>{var g,y;return[c,new L((g=p.lower)!==null&&g!==void 0?g:t.MIN_KEY,(y=p.upper)!==null&&y!==void 0?y:t.MAX_KEY)]},l={get:c=>[i,new L(c.key)],getMany:c=>[i,new L().addKeys(c.keys)],count:h,query:h,openCursor:h};return I(l).forEach(c=>{f[c]=function(p){const{subscr:g}=A,y=!!g,m=rr(A,s)&&sr(c,p)?p.obsSet={}:g;if(y){const d=x=>{const O=`idb://${e}/${r}/${x}`;return m[O]||(m[O]=new L)},v=d(""),E=d(":dels"),[k,w]=l[c](p);if(d(k.name||"").add(w),!k.isPrimaryKey){if(c!=="count"){const x=c==="query"&&a&&p.values&&s.query({...p,values:!1});return s[c].apply(this,arguments).then(O=>{if(c==="query"){if(a&&p.values)return x.then(({result:S})=>(v.addKeys(S),O));const _=p.values?O.result.map(u):O.result;p.values?v.addKeys(_):E.addKeys(_)}else if(c==="openCursor"){const _=O,S=p.values;return _&&Object.create(_,{key:{get:()=>(E.addKey(_.primaryKey),_.key)},primaryKey:{get(){const D=_.primaryKey;return E.addKey(D),D}},value:{get:()=>(S&&v.addKey(_.primaryKey),_.value)}})}return O})}E.add(n)}}return s[c].apply(this,arguments)}}),f}}}};function On(t,e){return function(n,r){return r.lower===void 0||(r.lowerOpen?K(n,r.lower)>0:K(n,r.lower)>=0)}(t,e)&&function(n,r){return r.upper===void 0||(r.upperOpen?K(n,r.upper)<0:K(n,r.upper)<=0)}(t,e)}function An(t,e,n,r,s,o){if(!n||n.length===0)return t;const i=e.query.index,u=r.schema.primaryKey.extractKey,a=i.extractKey,f=(i.lowLevelIndex||i).extractKey;let h=n.reduce((l,c)=>{let p=l;const g=c.type==="add"||c.type==="put"?c.values.filter(y=>On(a(y),e.query.range)).map(y=>(y=oe(y),o&&Object.freeze(y),y)):[];switch(c.type){case"add":p=l.concat(e.values?g:g.map(d=>u(d)));break;case"put":const y=new L().addKeys(c.values.map(d=>u(d)));p=l.filter(d=>{const v=e.values?u(d):d;return!Yt(new L(v),y)}).concat(e.values?g:g.map(d=>u(d)));break;case"delete":const b=new L().addKeys(c.keys);p=l.filter(d=>{const v=e.values?u(d):d;return!Yt(new L(v),b)});break;case"deleteRange":const m=c.range;p=l.filter(d=>!On(u(d),m))}return p},t);return h===t?t:(h.sort((l,c)=>K(f(l),f(c))||K(u(l),u(c))),e.limit&&e.limit<1/0&&(h.length>e.limit?h.length=e.limit:t.length===e.limit&&h.length<e.limit&&(s.dirty=!0)),o?Object.freeze(h):h)}function Cn(t,e){return K(t.lower,e.lower)===0&&K(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Jr(t,e){return function(n,r,s,o){if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;const i=K(n,r);if(i===0){if(s&&o)return 0;if(s)return 1;if(o)return-1}return i}(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&function(n,r,s,o){if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;const i=K(n,r);if(i===0){if(s&&o)return 0;if(s)return-1;if(o)return 1}return i}(t.upper,e.upper,t.upperOpen,e.upperOpen)>=0}function Zr(t,e,n,r){t.subscribers.add(n),r.addEventListener("abort",()=>{t.subscribers.delete(n),t.subscribers.size===0&&function(s,o){setTimeout(()=>{s.subscribers.size===0&&Re(o,s)},3e3)}(t,e)})}const es={stack:"dbcore",level:0,name:"Cache",create:t=>{const e=t.schema.name;return{...t,transaction:(r,s,o)=>{const i=t.transaction(r,s,o);if(s==="readwrite"){const u=new AbortController,{signal:a}=u,f=h=>()=>{if(u.abort(),s==="readwrite"){const l=new Set;for(const c of r){const p=Ee[`idb://${e}/${c}`],g=t.table(c);if(p){const y=p.optimisticOps.filter(b=>b.trans===i);if(y.length>0){p.optimisticOps=p.optimisticOps.filter(b=>b.trans!==i);for(const b of Object.values(p.queries.query))for(const m of b.slice())if(m.res!=null&&i.mutatedParts)if(h&&!m.dirty){const d=Object.isFrozen(m.res),v=An(m.res,m.req,y,g,m,d);m.dirty?(Re(b,m),m.subscribers.forEach(E=>l.add(E))):v!==m.res&&(m.res=v,m.promise=P.resolve({result:v}))}else m.dirty&&Re(b,m),m.subscribers.forEach(d=>l.add(d))}}}l.forEach(c=>c())}};i.addEventListener("abort",f(!1),{signal:a}),i.addEventListener("error",f(!1),{signal:a}),i.addEventListener("complete",f(!0),{signal:a})}return i},table(r){const s=t.table(r),o=s.schema.primaryKey;return{...s,mutate(u){if(o.outbound||A.trans.db._options.cache==="disabled")return s.mutate(u);const a=Ee[`idb://${e}/${r}`];if(!a)return s.mutate(u);const f=s.mutate(u);return u.type!=="add"&&u.type!=="put"||!(u.values.length>=50||hn(o,u).some(h=>h==null))?(a.optimisticOps.push(u),At(u.mutatedParts),f.catch(()=>{Re(a.optimisticOps,u),At(u.mutatedParts)})):f.then(h=>{const l={...u,values:u.values.map((c,p)=>{const g=o.keyPath.includes(".")?oe(c):{...c};return W(g,o.keyPath,h.results[p]),g})};a.optimisticOps.push(l),queueMicrotask(()=>At(u.mutatedParts))}),f},query(u){if(!rr(A,s)||!sr("query",u))return s.query(u);const a=A.trans.db._options.cache==="immutable",{requery:f,signal:h}=A;let[l,c,p,g]=function(y,b,m,d){const v=Ee[`idb://${y}/${b}`];if(!v)return[];const E=v.queries[m];if(!E)return[null,!1,v,null];const k=E[(d.query?d.query.index.name:null)||""];if(!k)return[null,!1,v,null];switch(m){case"query":const w=k.find(O=>O.req.limit===d.limit&&O.req.values===d.values&&Cn(O.req.query.range,d.query.range));return w?[w,!0,v,k]:[k.find(O=>("limit"in O.req?O.req.limit:1/0)>=d.limit&&(!d.values||O.req.values)&&Jr(O.req.query.range,d.query.range)),!1,v,k];case"count":const x=k.find(O=>Cn(O.req.query.range,d.query.range));return[x,!!x,v,k]}}(e,r,"query",u);if(l&&c)l.obsSet=u.obsSet;else{const y=s.query(u).then(b=>{const m=b.result;if(l.res=m,a){for(let d=0,v=m.length;d<v;++d)Object.freeze(m[d]);Object.freeze(m)}else b.result=oe(m);return b}).catch(b=>(g&&l&&Re(g,l),Promise.reject(b)));l={obsSet:u.obsSet,promise:y,subscribers:new Set,type:"query",req:u,dirty:!1},g?g.push(l):(g=[l],p||(p=Ee[`idb://${e}/${r}`]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),p.queries.query[u.query.index.name||""]=g)}return Zr(l,g,f,h),l.promise.then(y=>({result:An(y.result,u,p==null?void 0:p.optimisticOps,s,l,a)}))}}}}}};function tt(t,e){return new Proxy(t,{get:(n,r,s)=>r==="db"?e:Reflect.get(n,r,s)})}class pe{constructor(e,n){this._middlewares={},this.verno=0;const r=pe.dependencies;this._options=n={addons:pe.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned",...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:j,dbReadyPromise:null,cancelOpen:j,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new P(a=>{o.dbReadyResolve=a}),o.openCanceller=new P((a,f)=>{o.cancelOpen=f}),this._state=o,this.name=e,this.on=Le(this,"populate","blocked","versionchange","close",{ready:[tn,j]}),this.on.ready.subscribe=jn(this.on.ready.subscribe,a=>(f,h)=>{pe.vip(()=>{const l=this._state;if(l.openComplete)l.dbOpenError||P.resolve().then(f),h&&a(f);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(f),h&&a(f);else{a(f);const c=this;h||a(function p(){c.on.ready.unsubscribe(f),c.on.ready.unsubscribe(p)})}})}),this.Collection=(i=this,Be(Tr.prototype,function(a,f){this.db=i;let h=Gn,l=null;if(f)try{h=f()}catch(y){l=y}const c=a._ctx,p=c.table,g=p.hook.reading.fire;this._ctx={table:p,index:c.index,isPrimKey:!c.index||p.schema.primKey.keyPath&&c.index===p.schema.primKey.name,range:h,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:l,or:c.or,valueMapper:g!==ze?g:null}})),this.Table=function(a){return Be(wn.prototype,function(f,h,l){this.db=a,this._tx=l,this.name=f,this.schema=h,this.hook=a._allTables[f]?a._allTables[f].hook:Le(null,{creating:[vr,j],reading:[br,ze],updating:[_r,j],deleting:[wr,j]})})}(this),this.Transaction=function(a){return Be(Fr.prototype,function(f,h,l,c,p){this.db=a,this.mode=f,this.storeNames=h,this.schema=l,this.chromeTransactionDurability=c,this.idbtrans=null,this.on=Le(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new P((g,y)=>{this._resolve=g,this._reject=y}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},g=>{var y=this.active;return this.active=!1,this.on.error.fire(g),this.parent?this.parent._reject(g):y&&this.idbtrans&&this.idbtrans.abort(),B(g)})})}(this),this.Version=function(a){return Be(Ur.prototype,function(f){this.db=a,this._cfg={version:f,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return Be(Qn.prototype,function(f,h,l){if(this.db=a,this._ctx={table:f,index:h===":id"?null:h,or:l},this._cmp=this._ascending=K,this._descending=(c,p)=>K(p,c),this._max=(c,p)=>K(c,p)>0?c:p,this._min=(c,p)=>K(c,p)<0?c:p,this._IDBKeyRange=a._deps.IDBKeyRange,!this._IDBKeyRange)throw new C.MissingAPI})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close({disableAutoOpen:!1}),this._state.openComplete=!1}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=Ye(n.IDBKeyRange),this._createTransaction=(a,f,h,l)=>new this.Transaction(a,f,h,this._options.chromeTransactionDurability,l),this._fireOnBlocked=a=>{this.on("blocked").fire(a),$e.filter(f=>f.name===this.name&&f!==this&&!f._state.vcFired).map(f=>f.on("versionchange").fire(a))},this.use(Qr),this.use(es),this.use(Xr),this.use(Gr),this.use(Hr);const u=new Proxy(this,{get:(a,f,h)=>{if(f==="_vip")return!0;if(f==="table")return c=>tt(this.table(c),u);const l=Reflect.get(a,f,h);return l instanceof wn?tt(l,u):f==="tables"?l.map(c=>tt(c,u)):f==="_createTransaction"?function(){const c=l.apply(this,arguments);return tt(c,u)}:l}});this.vip=u,s.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new C.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new C.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort($r),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||A.letThrough||this._vip)?e():new P((n,r)=>{if(this._state.openComplete)return r(new C.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new C.DatabaseClosed);this.open().catch(j)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:n,level:r??10,name:s}),o.sort((i,u)=>i.level-u.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return ye(ie,()=>Wr(this))}_close(){const e=this._state,n=$e.indexOf(this);if(n>=0&&$e.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.dbReadyPromise=new P(r=>{e.dbReadyResolve=r}),e.openCanceller=new P((r,s)=>{e.cancelOpen=s})}close({disableAutoOpen:e}={disableAutoOpen:!0}){this._close();const n=this._state;e&&(this._options.autoOpen=!1),n.dbOpenError=new C.DatabaseClosed,n.isBeingOpened&&n.cancelOpen(n.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new P((r,s)=>{const o=()=>{this.close({disableAutoOpen:!1});var i=this._deps.indexedDB.deleteDatabase(this.name);i.onsuccess=q(()=>{(function({indexedDB:u,IDBKeyRange:a},f){!an(u)&&f!=="__dbnames"&&on(u,a).delete(f).catch(j)})(this._deps,this.name),r()}),i.onerror=Q(s),i.onblocked=this._fireOnBlocked};if(e)throw new C.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return I(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Yr.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=A.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const o=e.indexOf("?")!==-1;let i,u;e=e.replace("!","").replace("?","");try{if(u=n.map(f=>{var h=f instanceof this.Table?f.name:f;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),e=="r"||e==="readonly")i="readonly";else{if(e!="rw"&&e!="readwrite")throw new C.InvalidArgument("Invalid transaction mode: "+e);i="readwrite"}if(s){if(s.mode==="readonly"&&i==="readwrite"){if(!o)throw new C.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&u.forEach(f=>{if(s&&s.storeNames.indexOf(f)===-1){if(!o)throw new C.SubTransaction("Table "+f+" not included in parent transaction.");s=null}}),o&&s&&!s.active&&(s=null)}}catch(f){return s?s._promise(null,(h,l)=>{l(f)}):B(f)}const a=tr.bind(null,this,i,u,s,r);return s?s._promise(i,a,"lock"):A.trans?ye(A.transless,()=>this._whenReady(a)):this._whenReady(a)}table(e){if(!U(this._allTables,e))throw new C.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const ts=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ns{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[ts](){return this}}let gt;try{gt={indexedDB:F.indexedDB||F.mozIndexedDB||F.webkitIndexedDB||F.msIndexedDB,IDBKeyRange:F.IDBKeyRange||F.webkitIDBKeyRange}}catch{gt={indexedDB:null,IDBKeyRange:null}}function rs(t){let e,n=!1;const r=new ns(s=>{const o=Jt(t);let i,u=!1,a={},f={};const h={get closed(){return u},unsubscribe:()=>{u||(u=!0,i&&i.abort(),l&&ne.storagemutated.unsubscribe(c))}};s.start&&s.start(h);let l=!1;const c=g=>{vt(a,g),er(f,a)&&p()},p=()=>{if(u||!gt.indexedDB)return;a={};const g={};i&&i.abort(),i=new AbortController;const y={subscr:g,signal:i.signal,requery:p,querier:t,trans:null},b=function(m){const d=je();try{o&&qe();const v=ae(t,m);return o&&v.finally(ue),v}finally{d&&De()}}(y);Promise.resolve(b).then(m=>{n=!0,e=m,u||y.signal.aborted||(a={},f=g,function(d){for(const v in d)if(U(d,v))return!1;return!0}(f)||l||(ne("storagemutated",c),l=!0),s.next&&s.next(m))},m=>{if(n=!1,!["DatabaseClosedError","AbortError"].includes(m==null?void 0:m.name)){if(u)return;s.error&&s.error(m)}})};return p(),h});return r.hasValue=()=>n,r.getValue=()=>e,r}const ce=pe;function ut(t){let e=Z;try{Z=!0,ne.storagemutated.fire(t),ln(t,!0)}finally{Z=e}}Ke(ce,{...nt,delete:t=>new ce(t,{addons:[]}).delete(),exists:t=>new ce(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return an(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!=="__dbnames")):on(e,n).toCollection().primaryKeys()}(ce.dependencies).then(t)}catch{return B(new C.MissingAPI)}},defineClass:()=>function(t){V(this,t)},ignoreTransaction:t=>A.trans?ye(A.transless,t):t(),vip:Wt,async:function(t){return function(){try{var e=Ht(t.apply(this,arguments));return e&&typeof e.then=="function"?e:P.resolve(e)}catch(n){return B(n)}}},spawn:function(t,e,n){try{var r=Ht(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:P.resolve(r)}catch(s){return B(s)}},currentTransaction:{get:()=>A.trans||null},waitFor:function(t,e){const n=P.resolve(typeof t=="function"?ce.ignoreTransaction(t):t).timeout(e||6e4);return A.trans?A.trans.waitFor(n):n},Promise:P,debug:{get:()=>re,set:t=>{Rn(t,t==="dexie"?()=>!0:Yn)}},derive:Oe,extend:V,props:Ke,override:jn,Events:Le,on:ne,liveQuery:rs,extendObservabilitySet:vt,getByKeyPath:te,setByKeyPath:W,delByKeyPath:function(t,e){typeof e=="string"?W(t,e,void 0):"length"in e&&[].map.call(e,function(n){W(t,n,void 0)})},shallowClone:qn,deepClone:oe,getObjectDiff:cn,cmp:K,asap:Dn,minKey:-(1/0),addons:[],connections:$e,errnames:en,dependencies:gt,cache:Ee,semVer:"4.0.1-beta.1",version:"4.0.1-beta.1".split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),ce.maxKey=Ye(ce.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ne("storagemutated",t=>{if(!Z){let e;bt?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,t)):e=new CustomEvent("x-storagemutated-1",{detail:t}),Z=!0,dispatchEvent(e),Z=!1}}),addEventListener("x-storagemutated-1",({detail:t})=>{Z||ut(t)}));let Z=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel("x-storagemutated-1");typeof t.unref=="function"&&t.unref(),ne("storagemutated",e=>{Z||t.postMessage(e)}),t.onmessage=e=>{e.data&&ut(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ne("storagemutated",e=>{try{Z||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:"x-storagemutated-1",changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key==="x-storagemutated-1"){const n=JSON.parse(e.newValue);n&&ut(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type==="x-storagemutated-1"&&ut(e.changedParts)})}P.rejectionMapper=function(t,e){if(!t||t instanceof Ae||t instanceof TypeError||t instanceof SyntaxError||!t.name||!mn[t.name])return t;var n=new mn[t.name](e||t.message,t);return"stack"in t&&ee(n,"stack",{get:function(){return this.inner.stack}}),n},Rn(re,Yn);function ss(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function H(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function Sn(t,e){for(var n="",r=0,s=-1,o=0,i,u=0;u<=t.length;++u){if(u<t.length)i=t.charCodeAt(u);else{if(i===47)break;i=47}if(i===47){if(!(s===u-1||o===1))if(s!==u-1&&o===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var a=n.lastIndexOf("/");if(a!==n.length-1){a===-1?(n="",r=0):(n=n.slice(0,a),r=n.length-1-n.lastIndexOf("/")),s=u,o=0;continue}}else if(n.length===2||n.length===1){n="",r=0,s=u,o=0;continue}}e&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+="/"+t.slice(s+1,u):n=t.slice(s+1,u),r=u-s-1;s=u,o=0}else i===46&&o!==-1?++o:o=-1}return n}function is(t,e){var n=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+r:n+t+r:r}var Ce={resolve:function(){for(var e="",n=!1,r,s=arguments.length-1;s>=-1&&!n;s--){var o;s>=0?o=arguments[s]:(r===void 0&&(r=process.cwd()),o=r),H(o),o.length!==0&&(e=o+"/"+e,n=o.charCodeAt(0)===47)}return e=Sn(e,!n),n?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(H(e),e.length===0)return".";var n=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Sn(e,!n),e.length===0&&!n&&(e="."),e.length>0&&r&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return H(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,n=0;n<arguments.length;++n){var r=arguments[n];H(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Ce.normalize(e)},relative:function(e,n){if(H(e),H(n),e===n||(e=Ce.resolve(e),n=Ce.resolve(n),e===n))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,o=s-r,i=1;i<n.length&&n.charCodeAt(i)===47;++i);for(var u=n.length,a=u-i,f=o<a?o:a,h=-1,l=0;l<=f;++l){if(l===f){if(a>f){if(n.charCodeAt(i+l)===47)return n.slice(i+l+1);if(l===0)return n.slice(i+l)}else o>f&&(e.charCodeAt(r+l)===47?h=l:l===0&&(h=0));break}var c=e.charCodeAt(r+l),p=n.charCodeAt(i+l);if(c!==p)break;c===47&&(h=l)}var g="";for(l=r+h+1;l<=s;++l)(l===s||e.charCodeAt(l)===47)&&(g.length===0?g+="..":g+="/..");return g.length>0?g+n.slice(i+h):(i+=h,n.charCodeAt(i)===47&&++i,n.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(H(e),e.length===0)return".";for(var n=e.charCodeAt(0),r=n===47,s=-1,o=!0,i=e.length-1;i>=1;--i)if(n=e.charCodeAt(i),n===47){if(!o){s=i;break}}else o=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');H(e);var r=0,s=-1,o=!0,i;if(n!==void 0&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var u=n.length-1,a=-1;for(i=e.length-1;i>=0;--i){var f=e.charCodeAt(i);if(f===47){if(!o){r=i+1;break}}else a===-1&&(o=!1,a=i+1),u>=0&&(f===n.charCodeAt(u)?--u===-1&&(s=i):(u=-1,s=a))}return r===s?s=a:s===-1&&(s=e.length),e.slice(r,s)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!o){r=i+1;break}}else s===-1&&(o=!1,s=i+1);return s===-1?"":e.slice(r,s)}},extname:function(e){H(e);for(var n=-1,r=0,s=-1,o=!0,i=0,u=e.length-1;u>=0;--u){var a=e.charCodeAt(u);if(a===47){if(!o){r=u+1;break}continue}s===-1&&(o=!1,s=u+1),a===46?n===-1?n=u:i!==1&&(i=1):n!==-1&&(i=-1)}return n===-1||s===-1||i===0||i===1&&n===s-1&&n===r+1?"":e.slice(n,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return is("/",e)},parse:function(e){H(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return n;var r=e.charCodeAt(0),s=r===47,o;s?(n.root="/",o=1):o=0;for(var i=-1,u=0,a=-1,f=!0,h=e.length-1,l=0;h>=o;--h){if(r=e.charCodeAt(h),r===47){if(!f){u=h+1;break}continue}a===-1&&(f=!1,a=h+1),r===46?i===-1?i=h:l!==1&&(l=1):i!==-1&&(l=-1)}return i===-1||a===-1||l===0||l===1&&i===a-1&&i===u+1?a!==-1&&(u===0&&s?n.base=n.name=e.slice(1,a):n.base=n.name=e.slice(u,a)):(u===0&&s?(n.name=e.slice(1,i),n.base=e.slice(1,a)):(n.name=e.slice(u,i),n.base=e.slice(u,a)),n.ext=e.slice(i,a)),u>0?n.dir=e.slice(0,u-1):s&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};Ce.posix=Ce;var os=Ce;const fn=ss(os);function fs(...t){return fn.join("/",Qt,...t)}function as(t,e=""){return decodeURIComponent(new URL(t,"http://example.com/"+e+(e?"/":"")).pathname.substring(1))}function ds(t,e){return fn.join(t.data.path.at(-1)||Qt,e)}function ps(t){return fn.join("..",t.url.pathname.split("/").at(-2)||Qt)}class dn extends pe{constructor(){super("MathMan");pn(this,"files");this.version(33).stores({files:"++id, route"})}async newFile({basePath:n="",route:r=""}={}){if(r.length===0){const i=prompt("Enter path of file to create");if(i==null)return-1;if(i==="")return alert("Need at least filename"),-1;r=i}const s=as(r,n).split("/"),o=s.pop();return s.some(i=>ar(i))?(alert("Folder cannot be only a number, might confuse with file."),-1):us.files.add({attempts:[dn.newBlankAttempt()],name:o,route:s.join("/"),flagged:!1})}static newBlankAttempt(){const n=document.createElement("canvas").getContext("2d").getImageData(0,0,1,1);return{date:new Date,work:n,error:n,questions:n,rois:[],duration:0,mistakeCount:0,questionCount:0}}}const us=new dn;function ms(t){const e=new URLSearchParams(location.search);for(const[n,r]of Object.entries(t))e.set(n,r);return"?"+e.toString()}function ys(t,e){const n=Number.parseFloat(t),r=Number.parseFloat(e);if(isNaN(n)&&!isNaN(r))return-1;if(isNaN(r)&&!isNaN(n))return 1;const s=n-r;return isNaN(s)?t.localeCompare(e):s}function gs(){return"ontouchstart"in window||navigator.maxTouchPoints>0}export{dn as D,fs as a,ps as b,ms as c,us as d,ds as e,gs as i,os as p,ys as s,rs as u};
//# sourceMappingURL=index.1323e366.js.map
