import{s as $e,n as ne,e as Pe,f as Ue,o as Ye}from"../chunks/scheduler.21a3a156.js";import{S as Ve,i as Ie,e as je,a as C,d as O,p as Ke,b as We,t as J,f as _,y as ze,g as m,m as D,s as E,r as be,h as v,j as b,n as y,c as $,u as we,k as d,l as qe,x as c,v as ke,o as B,w as De,z as Le,A as Ge,B as He}from"../chunks/index.5cde54b0.js";import{u as Je,d as ye}from"../chunks/db.0a5d7a2c.js";import{e as H,p as G,u as Qe,d as Re,n as Xe}from"../chunks/index.bada3710.js";import{e as Ee}from"../chunks/singletons.75c95cf8.js";import{p as Ne}from"../chunks/stores.df503cfe.js";function Te(r,e,l){const n=r.slice();return n[3]=e[l],n}function Be(r){let e,l=(r[3]||"/")+"",n,s,f,a,o;return a=new Oe({props:{fileStruct:r[0][r[3]],indentLevel:r[1]+1,fullPath:G.join(r[2],r[3])}}),{c(){e=m("a"),n=D(l),f=E(),be(a.$$.fragment),this.h()},l(t){e=v(t,"A",{href:!0,class:!0});var i=b(e);n=y(i,l),i.forEach(_),f=$(t),we(a.$$.fragment,t),this.h()},h(){d(e,"href",s=G.join("/",Ee,r[2],r[3])),d(e,"class","w-full block text-left"),qe(e,"padding-left",r[1]*15+"px")},m(t,i){C(t,e,i),c(e,n),C(t,f,i),ke(a,t,i),o=!0},p(t,i){(!o||i&1)&&l!==(l=(t[3]||"/")+"")&&B(n,l),(!o||i&5&&s!==(s=G.join("/",Ee,t[2],t[3])))&&d(e,"href",s),i&2&&qe(e,"padding-left",t[1]*15+"px");const u={};i&1&&(u.fileStruct=t[0][t[3]]),i&2&&(u.indentLevel=t[1]+1),i&5&&(u.fullPath=G.join(t[2],t[3])),a.$set(u)},i(t){o||(O(a.$$.fragment,t),o=!0)},o(t){J(a.$$.fragment,t),o=!1},d(t){t&&(_(e),_(f)),De(a,t)}}}function Ze(r){let e,l,n=H(Object.keys(r[0]??{})),s=[];for(let a=0;a<n.length;a+=1)s[a]=Be(Te(r,n,a));const f=a=>J(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=je()},l(a){for(let o=0;o<s.length;o+=1)s[o].l(a);e=je()},m(a,o){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(a,o);C(a,e,o),l=!0},p(a,[o]){if(o&7){n=H(Object.keys(a[0]??{}));let t;for(t=0;t<n.length;t+=1){const i=Te(a,n,t);s[t]?(s[t].p(i,o),O(s[t],1)):(s[t]=Be(i),s[t].c(),O(s[t],1),s[t].m(e.parentNode,e))}for(Ke(),t=n.length;t<s.length;t+=1)f(t);We()}},i(a){if(!l){for(let o=0;o<n.length;o+=1)O(s[o]);l=!0}},o(a){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)J(s[o]);l=!1},d(a){a&&_(e),ze(s,a)}}}function xe(r,e,l){let{fileStruct:n}=e,{indentLevel:s=0}=e,{fullPath:f=""}=e;return r.$$set=a=>{"fileStruct"in a&&l(0,n=a.fileStruct),"indentLevel"in a&&l(1,s=a.indentLevel),"fullPath"in a&&l(2,f=a.fullPath)},[n,s,f]}class Oe extends Ve{constructor(e){super(),Ie(this,e,xe,Ze,$e,{fileStruct:0,indentLevel:1,fullPath:2})}}function et(r,e,l){const n=r.slice();return n[3]=e[l],n}function Ce(r,e,l){const n=r.slice();n[6]=e[l];const s=G.join("/",Ee,n[0].params.path,n[6].id.toString());n[7]=s;const f=at(n[6]);return n[8]=f,n}function Fe(r,e){let l,n,s,f,a,o,t=se(e[8].date)+"",i,u,h,w,F,A=e[8].duration+"",p,S,k,V,L,M=e[6].attempts.length+"",Q,R,ie,j,re,U=e[6].questions+"",X,oe,q,fe,Y=e[6].mistakes+"",Z,x,ue,T,Se="🔻",ce,P,N,K=e[6].flagged?new Date().getMonth()===5?"🏳️‍🌈 ":"🚩 ":"",ee,W=e[6].name+"",te,le,he;return{key:r,first:null,c(){l=m("div"),n=m("div"),s=m("a"),f=m("div"),a=m("div"),o=D("-"),i=D(t),h=E(),w=m("div"),F=D("⏱️ "),p=D(A),k=E(),V=m("div"),L=D("✏️ "),Q=D(M),R=m("div"),ie=E(),j=m("div"),re=D("❔ "),X=D(U),oe=E(),q=m("div"),fe=D("❌ "),Z=D(Y),ue=E(),T=m("button"),T.textContent=Se,ce=E(),P=m("a"),N=m("div"),ee=D(K),te=D(W),he=E(),this.h()},l(z){l=v(z,"DIV",{class:!0});var g=b(l);n=v(g,"DIV",{class:!0});var ae=b(n);s=v(ae,"A",{href:!0});var Ae=b(s);f=v(Ae,"DIV",{class:!0});var I=b(f);a=v(I,"DIV",{class:!0,title:!0});var de=b(a);o=y(de,"-"),i=y(de,t),de.forEach(_),h=$(I),w=v(I,"DIV",{class:!0,title:!0});var _e=b(w);F=y(_e,"⏱️ "),p=y(_e,A),_e.forEach(_),k=$(I),V=v(I,"DIV",{class:!0,title:!0});var me=b(V);L=y(me,"✏️ "),Q=y(me,M),me.forEach(_),R=v(I,"DIV",{}),b(R).forEach(_),ie=$(I),j=v(I,"DIV",{class:!0,title:!0});var ve=b(j);re=y(ve,"❔ "),X=y(ve,U),ve.forEach(_),oe=$(I),q=v(I,"DIV",{class:!0,title:!0});var pe=b(q);fe=y(pe,"❌ "),Z=y(pe,Y),pe.forEach(_),I.forEach(_),Ae.forEach(_),ue=$(ae),T=v(ae,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Le(T)!=="svelte-g19542"&&(T.textContent=Se),ae.forEach(_),ce=$(g),P=v(g,"A",{href:!0});var Me=b(P);N=v(Me,"DIV",{});var ge=b(N);ee=y(ge,K),te=y(ge,W),ge.forEach(_),Me.forEach(_),he=$(g),g.forEach(_),this.h()},h(){d(a,"class","m-auto"),d(a,"title",u="Time since last attempt ("+se(e[8].date,!1)+")"),d(w,"class","m-auto"),d(w,"title",S="Duration of last attempt ("+e[8].duration+" minutes)"),d(V,"class","m-auto"),d(V,"title","Number of attempts"),d(j,"class","m-auto"),d(j,"title","Number of unresolved questions"),d(q,"class","m-auto"),d(q,"title","Weighted average of incorrect problems"),d(f,"class","w-full aspect-square border m-auto grid grid-cols-2 grid-rows-3"),d(s,"href",x=e[7]),d(T,"class","attempt-dropdown svelte-wqw3oy"),d(T,"title","Show attempts"),d(n,"class","relative"),d(P,"href",le=e[7]),d(l,"class","text-center w-[6rem] mr-[11px]"),this.first=l},m(z,g){C(z,l,g),c(l,n),c(n,s),c(s,f),c(f,a),c(a,o),c(a,i),c(f,h),c(f,w),c(w,F),c(w,p),c(f,k),c(f,V),c(V,L),c(V,Q),c(f,R),c(f,ie),c(f,j),c(j,re),c(j,X),c(f,oe),c(f,q),c(q,fe),c(q,Z),c(n,ue),c(n,T),c(l,ce),c(l,P),c(P,N),c(N,ee),c(N,te),c(l,he)},p(z,g){e=z,g&4&&t!==(t=se(e[8].date)+"")&&B(i,t),g&4&&u!==(u="Time since last attempt ("+se(e[8].date,!1)+")")&&d(a,"title",u),g&4&&A!==(A=e[8].duration+"")&&B(p,A),g&4&&S!==(S="Duration of last attempt ("+e[8].duration+" minutes)")&&d(w,"title",S),g&4&&M!==(M=e[6].attempts.length+"")&&B(Q,M),g&4&&U!==(U=e[6].questions+"")&&B(X,U),g&4&&Y!==(Y=e[6].mistakes+"")&&B(Z,Y),g&5&&x!==(x=e[7])&&d(s,"href",x),g&4&&K!==(K=e[6].flagged?new Date().getMonth()===5?"🏳️‍🌈 ":"🚩 ":"")&&B(ee,K),g&4&&W!==(W=e[6].name+"")&&B(te,W),g&5&&le!==(le=e[7])&&d(P,"href",le)},d(z){z&&_(l)}}}function tt(r){let e;return{c(){e=m("div"),this.h()},l(l){e=v(l,"DIV",{class:!0}),b(e).forEach(_),this.h()},h(){d(e,"class","w-[6rem] mr-[11px]")},m(l,n){C(l,e,n)},p:ne,d(l){l&&_(e)}}}function lt(r){let e,l=[],n=new Map,s,f=H(r[2]??[]);const a=i=>i[6].id;for(let i=0;i<f.length;i+=1){let u=Ce(r,f,i),h=a(u);n.set(h,l[i]=Fe(h,u))}let o=H(Array(10)),t=[];for(let i=0;i<o.length;i+=1)t[i]=tt(et(r,o,i));return{c(){e=m("div");for(let i=0;i<l.length;i+=1)l[i].c();s=E();for(let i=0;i<t.length;i+=1)t[i].c();this.h()},l(i){e=v(i,"DIV",{class:!0});var u=b(e);for(let h=0;h<l.length;h+=1)l[h].l(u);s=$(u);for(let h=0;h<t.length;h+=1)t[h].l(u);u.forEach(_),this.h()},h(){d(e,"class","flex flex-wrap justify-evenly gap-3")},m(i,u){C(i,e,u);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(e,null);c(e,s);for(let h=0;h<t.length;h+=1)t[h]&&t[h].m(e,null)},p(i,[u]){u&5&&(f=H(i[2]??[]),l=Qe(l,u,a,1,i,f,n,e,Re,Fe,s,Ce))},i:ne,o:ne,d(i){i&&_(e);for(let u=0;u<l.length;u+=1)l[u].d();ze(t,i)}}}function at(r){return r.attempts.length===0?{date:new Date(0),duration:0}:r.attempts.reduce((e,l)=>l.date>e.date?l:e)}function se(r,e=!0){const l=new Date,n=(l.getTime()-r.getTime())/(1e3*60*60*24);if(n<=10)return Math.floor(n)+(e?"d":" days");const s=n/7;if(s<=16)return Math.floor(s)+(e?"w":" weeks");const a=(l.getFullYear()-r.getFullYear())*12+(l.getMonth()-r.getMonth());return a<12?a+(e?"m":" months"):Math.floor(a/12)+(e?"y":" years")}function st(r,e,l){let n,s,f=ne,a=()=>(f(),f=Ue(o,t=>l(2,s=t)),o);Pe(r,Ne,t=>l(0,n=t)),r.$$.on_destroy.push(()=>f());let o;return r.$$.update=()=>{r.$$.dirty&1&&a(l(1,o=Je(()=>ye.files.where({"[route]":[["",...n.params.path?n.params.path.split("/"):[]]]}).toArray())))},[n,o,s]}class nt extends Ve{constructor(e){super(),Ie(this,e,st,lt,$e,{})}}function it(r){let e,l,n,s,f="➕ file",a,o,t,i,u,h,w,F,A;return t=new Oe({props:{fileStruct:r[0]}}),h=new nt({}),{c(){e=E(),l=m("div"),n=m("div"),s=m("button"),s.textContent=f,a=E(),o=m("div"),be(t.$$.fragment),i=E(),u=m("div"),be(h.$$.fragment),this.h()},l(p){Ge("svelte-8s10wx",document.head).forEach(_),e=$(p),l=v(p,"DIV",{id:!0,class:!0});var k=b(l);n=v(k,"DIV",{id:!0,class:!0});var V=b(n);s=v(V,"BUTTON",{"data-svelte-h":!0}),Le(s)!=="svelte-k3nzco"&&(s.textContent=f),V.forEach(_),a=$(k),o=v(k,"DIV",{id:!0,class:!0});var L=b(o);we(t.$$.fragment,L),L.forEach(_),i=$(k),u=v(k,"DIV",{id:!0,class:!0});var M=b(u);we(h.$$.fragment,M),M.forEach(_),k.forEach(_),this.h()},h(){document.title="MathMan Browse",d(n,"id","ribbon"),d(n,"class","text-right svelte-1huhyzt"),d(o,"id","folders"),d(o,"class","svelte-1huhyzt"),d(u,"id","files"),d(u,"class","svelte-1huhyzt"),d(l,"id","grid"),d(l,"class","svelte-1huhyzt")},m(p,S){C(p,e,S),C(p,l,S),c(l,n),c(n,s),c(l,a),c(l,o),ke(t,o,null),c(l,i),c(l,u),ke(h,u,null),w=!0,F||(A=He(s,"click",r[2]),F=!0)},p(p,[S]){const k={};S&1&&(k.fileStruct=p[0]),t.$set(k)},i(p){w||(O(t.$$.fragment,p),O(h.$$.fragment,p),w=!0)},o(p){J(t.$$.fragment,p),J(h.$$.fragment,p),w=!1},d(p){p&&(_(e),_(l)),De(t),De(h),F=!1,A()}}}function rt(r,e,l){let n;Pe(r,Ne,t=>l(3,n=t));let s={};async function f(){const t={},i=await ye.files.orderBy("[route]").uniqueKeys().then(u=>u.flat(1));for(const u of i){let h=t;for(const w of u)w in h||(h[w]={}),h=h[w]}return t}function a(...t){var i;if(t.length===0){const u=(i=prompt("Enter path of file to create"))==null?void 0:i.split("/");if(u==null)return;if(u.length===0)throw"Need at least filename";t=u}t.unshift(...n.params.path.split("/")),ye.files.add({attempts:[Xe()],parent:t.at(-2)??"",route:["",...t.slice(0,t.length-1)],name:t.at(-1),questions:0,mistakes:0,flagged:!1})}return Ye(()=>{f().then(t=>l(0,s=t))}),[s,a,()=>a()]}class _t extends Ve{constructor(e){super(),Ie(this,e,rt,it,$e,{})}}export{_t as component};
