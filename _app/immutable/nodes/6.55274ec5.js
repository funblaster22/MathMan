import{s as P,n as E,b as j,q as C,e as T,o as W,v as $}from"../chunks/scheduler.d208cd37.js";import{S as B,i as O,g,h as b,j as x,f as u,k as w,l as D,a as z,x as I,A as q,I as A,s as V,r as H,c as M,u as N,v as R,d as S,t as U,w as X}from"../chunks/index.c95bd50b.js";import{d as Y}from"../chunks/db.064e3cfe.js";import{p as F}from"../chunks/stores.37894995.js";function G(c){let t,i,r,s;return{c(){t=g("div"),i=g("div"),this.h()},l(e){t=b(e,"DIV",{class:!0});var l=x(t);i=b(l,"DIV",{class:!0}),x(i).forEach(u),l.forEach(u),this.h()},h(){w(i,"class","absolute right-0 bottom-0 w-5 h-5 bg-red-50 cursor-nw-resize svelte-1o3tvyk"),w(t,"class","relative overflow-auto border min-w-12 min-h-12 svelte-1o3tvyk"),D(t,"width",c[0][0]+"px"),D(t,"height",c[0][1]+"px")},m(e,l){z(e,t,l),I(t,i),r||(s=q(i,"pointerdown",c[1]),r=!0)},p(e,[l]){l&1&&D(t,"width",e[0][0]+"px"),l&1&&D(t,"height",e[0][1]+"px")},i:E,o:E,d(e){e&&u(t),r=!1,s()}}}function J(){document.onpointermove=document.onpointerup=null}function K(c,t,i){let{size:r=[170,70]}=t,s=[0,0];function e(o){s[0]=o.clientX,s[1]=o.clientY}function l(o){document.onpointermove=h,document.onpointerup=J,e(o)}function h(o){i(0,r[0]+=o.clientX-s[0],r),i(0,r[1]+=o.clientY-s[1],r),e(o)}return c.$$set=o=>{"size"in o&&i(0,r=o.size)},[r,l]}class L extends B{constructor(t){super(),O(this,t,K,G,P,{size:0})}}function Q(c){let t,i,r,s,e,l,h,o,m,a,f,p;function v(n){c[4](n)}let y={};return c[1]!==void 0&&(y.size=c[1]),e=new L({props:y}),j.push(()=>A(e,"size",v)),{c(){t=g("div"),i=g("video"),r=V(),s=g("div"),H(e.$$.fragment),h=V(),o=g("div"),m=g("button"),this.h()},l(n){t=b(n,"DIV",{class:!0});var d=x(t);i=b(d,"VIDEO",{class:!0}),x(i).forEach(u),d.forEach(u),r=M(n),s=b(n,"DIV",{class:!0});var _=x(s);N(e.$$.fragment,_),_.forEach(u),h=M(n),o=b(n,"DIV",{class:!0});var k=x(o);m=b(k,"BUTTON",{class:!0}),x(m).forEach(u),k.forEach(u),this.h()},h(){w(i,"class","w-full"),w(t,"class","fixed inset-x-0 inset-y-0"),w(s,"class","fixed w-full h-[60vh] inset-x-0 top-0 flex items-center justify-center"),w(m,"class","rounded-full bg-gray-200 m-auto block w-12 h-12"),w(o,"class","fixed inset-x-0 bottom-12")},m(n,d){z(n,t,d),I(t,i),c[3](i),z(n,r,d),z(n,s,d),R(e,s,null),z(n,h,d),z(n,o,d),I(o,m),a=!0,f||(p=q(m,"click",c[2]),f=!0)},p(n,[d]){const _={};!l&&d&2&&(l=!0,_.size=n[1],C(()=>l=!1)),e.$set(_)},i(n){a||(S(e.$$.fragment,n),a=!0)},o(n){U(e.$$.fragment,n),a=!1},d(n){n&&(u(t),u(r),u(s),u(h),u(o)),c[3](null),X(e),f=!1,p()}}}function Z(c,t,i){let r;T(c,F,a=>i(5,r=a));let s,e;W(()=>{navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then(a=>{i(0,s.srcObject=a,s),s.play()}).catch(a=>{console.error(`An error occurred: ${a}`)})}),$(()=>{s.srcObject.getVideoTracks()[0].stop()});function l(a){const[f,p]=[s.videoWidth,s.videoHeight],v=document.createElement("canvas");v.width=f,v.height=p;const y=v.getContext("2d");y.drawImage(s,0,0,f,p);const n=h(),d=f/window.innerWidth,_=y.getImageData(n.x*d,n.y*d,n.width*d,n.height*d);Y.files.update(Number.parseInt(r.params.problemId),{question:_}).then(()=>history.back())}function h(){const{clientWidth:a,clientHeight:f}=document.documentElement,p=a/2,v=f*.3;return{x:Math.round(p-e[0]/2),y:Math.round(v-e[1]/2),width:e[0],height:e[1]}}function o(a){j[a?"unshift":"push"](()=>{s=a,i(0,s)})}function m(a){e=a,i(1,e)}return[s,e,l,o,m]}class ie extends B{constructor(t){super(),O(this,t,Z,Q,P,{})}}export{ie as component};
