import{s as ee,n as H,f as ue,e as Z,m as Re,k as Ne,o as qe,j as Se,b as ie,p as je,r as Ue}from"../chunks/scheduler.d208cd37.js";import{S as te,i as ne,s as V,g as N,c as O,h as q,C as oe,k as w,l as R,a as T,A as B,D as Ae,f as _,j as L,x as S,r as G,m as x,u as X,n as $,v as J,d as F,t as z,w as K,E as He,F as ge,o as fe,y as Le,G as me,H as We,p as Pe,b as Be,B as Fe}from"../chunks/index.c95bd50b.js";import{e as le,u as Qe,s as ze,a as Ve,d as Ye,o as Ge}from"../chunks/index.3b6591eb.js";import{j as Xe,w as _e,k as be}from"../chunks/singletons.018b9b40.js";import{a as de,d as Y,u as Oe,D as Je,b as pe}from"../chunks/db.14d889bd.js";import{p as ae}from"../chunks/stores.376f6390.js";var Q=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Select=4]="Select",n))(Q||{});const Ke=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function we(n){let e,t="Show Solution";return{c(){e=N("button"),e.textContent=t,this.h()},l(s){e=q(s,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),oe(e)!=="svelte-on8fyx"&&(e.textContent=t),this.h()},h(){w(e,"class","border text-center"),R(e,"position","fixed"),R(e,"left",n[1][0]+"px"),R(e,"top",n[1][1]+"px"),R(e,"width",n[2][0]-n[1][0]+"px"),R(e,"height",n[2][1]-n[1][1]+"px")},m(s,r){T(s,e,r)},p(s,r){r&2&&R(e,"left",s[1][0]+"px"),r&2&&R(e,"top",s[1][1]+"px"),r&6&&R(e,"width",s[2][0]-s[1][0]+"px"),r&6&&R(e,"height",s[2][1]-s[1][1]+"px")},d(s){s&&_(e)}}}function Ze(n){let e,t,s='<div style="background-color: green">✅</div>',r,a,i=n[1][1]&&we(n);return{c(){i&&i.c(),e=V(),t=N("div"),t.innerHTML=s,this.h()},l(o){i&&i.l(o),e=O(o),t=q(o,"DIV",{class:!0,"data-svelte-h":!0}),oe(t)!=="svelte-aiv1v7"&&(t.innerHTML=s),this.h()},h(){w(t,"class","tool"),R(t,"height",n[0]?"100%":"30px")},m(o,l){i&&i.m(o,l),T(o,e,l),T(o,t,l),r||(a=B(t,"pointerdown",Ae(n[8])),r=!0)},p(o,[l]){o[1][1]?i?i.p(o,l):(i=we(o),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),l&1&&R(t,"height",o[0]?"100%":"30px")},i:H,o:H,d(o){o&&(_(e),_(t)),i&&i.d(o),r=!1,a()}}}function xe(n,e,t){let s;const r=Q.Select;let a=!1,i=!1,o=[],l=[],f,h,p=ue("selection");Z(n,p,k=>t(7,s=k)),window.addEventListener("pointerdown",k=>{a&&(i=!0,t(5,o=t(6,l=[k.x,k.y])))}),window.addEventListener("pointermove",k=>{i&&t(6,l=[k.x,k.y])}),window.addEventListener("pointerup",()=>{i=!1});const m=()=>p.set(a?Q.None:r);return n.$$.update=()=>{n.$$.dirty&128&&t(0,a=s===r),n.$$.dirty&96&&(t(1,f=[Math.min(o[0],l[0]),Math.min(o[1],l[1])]),t(2,h=[Math.max(o[0],l[0]),Math.max(o[1],l[1])]))},[a,f,h,r,p,o,l,s,m]}class $e extends te{constructor(e){super(),ne(this,e,xe,Ze,ee,{})}}const et=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href;function tt(n){let e,t,s,r,a;return{c(){e=N("div"),t=N("img"),this.h()},l(i){e=q(i,"DIV",{class:!0});var o=L(e);t=q(o,"IMG",{style:!0,src:!0,title:!0,draggable:!0}),o.forEach(_),this.h()},h(){R(t,"filter",n[1]),Re(t.src,s=et)||w(t,"src",s),w(t,"title",n[2]),w(t,"draggable","false"),w(e,"class","tool"),R(e,"height",n[3]?"100%":"30px")},m(i,o){T(i,e,o),S(e,t),r||(a=B(e,"pointerdown",Ae(n[6])),r=!0)},p(i,[o]){o&2&&R(t,"filter",i[1]),o&4&&w(t,"title",i[2]),o&8&&R(e,"height",i[3]?"100%":"30px")},i:H,o:H,d(i){i&&_(e),r=!1,a()}}}function nt(n,e,t){let s,{tool:r}=e,{filter:a=""}=e,{title:i}=e,o=ue("selection");Z(n,o,h=>t(5,s=h));let l=!1;const f=()=>o.set(l?Q.None:r);return n.$$set=h=>{"tool"in h&&t(0,r=h.tool),"filter"in h&&t(1,a=h.filter),"title"in h&&t(2,i=h.title)},n.$$.update=()=>{n.$$.dirty&33&&t(3,l=s===r)},[r,a,i,l,o,s,f]}class he extends te{constructor(e){super(),ne(this,e,nt,tt,ee,{tool:0,filter:1,title:2})}}function st(n){let e,t,s,r,a,i,o,l,f,h,p,m,k,y,E=`<img src="${Ke}" title="Eraser" draggable="false" class="svelte-h3rgmi"/>`,A,D,j;return t=new $e({}),l=new he({props:{tool:Q.Draw,filter:"grayscale(1)",title:"Your work"}}),h=new he({props:{tool:Q.Correct,filter:"hue-rotate(136deg)",title:"Correct"}}),m=new he({props:{tool:Q.Question,title:"Question"}}),{c(){e=N("div"),G(t.$$.fragment),s=V(),r=N("a"),a=x("📷"),o=V(),G(l.$$.fragment),f=V(),G(h.$$.fragment),p=V(),G(m.$$.fragment),k=V(),y=N("div"),y.innerHTML=E,this.h()},l(g){e=q(g,"DIV",{id:!0,class:!0});var C=L(e);X(t.$$.fragment,C),s=O(C),r=q(C,"A",{href:!0});var P=L(r);a=$(P,"📷"),P.forEach(_),o=O(C),X(l.$$.fragment,C),f=O(C),X(h.$$.fragment,C),p=O(C),X(m.$$.fragment,C),k=O(C),y=q(C,"DIV",{class:!0,"data-svelte-h":!0}),oe(y)!=="svelte-19p7wft"&&(y.innerHTML=E),C.forEach(_),this.h()},h(){w(r,"href",i=de("camera",n[1].params.problemId)),w(y,"class","tool"),R(y,"height",n[0]?"100%":"30px"),w(e,"id","tools"),w(e,"class","svelte-h3rgmi")},m(g,C){T(g,e,C),J(t,e,null),S(e,s),S(e,r),S(r,a),S(e,o),J(l,e,null),S(e,f),J(h,e,null),S(e,p),J(m,e,null),S(e,k),S(e,y),A=!0,D||(j=B(y,"click",n[3]),D=!0)},p(g,[C]){(!A||C&2&&i!==(i=de("camera",g[1].params.problemId)))&&w(r,"href",i),C&1&&R(y,"height",g[0]?"100%":"30px")},i(g){A||(F(t.$$.fragment,g),F(l.$$.fragment,g),F(h.$$.fragment,g),F(m.$$.fragment,g),A=!0)},o(g){z(t.$$.fragment,g),z(l.$$.fragment,g),z(h.$$.fragment,g),z(m.$$.fragment,g),A=!1},d(g){g&&_(e),K(t),K(l),K(h),K(m),D=!1,j()}}}function lt(n,e,t){let s,r;Z(n,ae,l=>t(1,r=l));let{selected:a}=e;Ne("selection",a);let i=ue("eraserEnabled");Z(n,i,l=>t(0,s=l));function o(l){i.set(!s)}return n.$$set=l=>{"selected"in l&&t(4,a=l.selected)},[s,r,i,o,a]}class rt extends te{constructor(e){super(),ne(this,e,lt,st,ee,{selected:4})}}function ot(n){let e,t,s,r,a,i,o;return{c(){e=N("canvas"),t=V(),s=N("canvas"),r=V(),a=N("canvas"),this.h()},l(l){e=q(l,"CANVAS",{width:!0,height:!0,class:!0}),L(e).forEach(_),t=O(l),s=q(l,"CANVAS",{width:!0,height:!0,class:!0}),L(s).forEach(_),r=O(l),a=q(l,"CANVAS",{width:!0,height:!0,class:!0}),L(a).forEach(_),this.h()},h(){w(e,"width",n[2]),w(e,"height",n[3]),w(e,"class","svelte-86e4yd"),w(s,"width",n[2]),w(s,"height",n[3]),w(s,"class","svelte-86e4yd"),w(a,"width",n[2]),w(a,"height",n[3]),w(a,"class","svelte-86e4yd")},m(l,f){T(l,e,f),n[8](e),T(l,t,f),T(l,s,f),n[9](s),T(l,r,f),T(l,a,f),n[10](a),i||(o=B(a,"pointerdown",He(n[5])),i=!0)},p(l,[f]){f&4&&w(e,"width",l[2]),f&8&&w(e,"height",l[3]),f&4&&w(s,"width",l[2]),f&8&&w(s,"height",l[3]),f&4&&w(a,"width",l[2]),f&8&&w(a,"height",l[3])},i:H,o:H,d(l){l&&(_(e),_(t),_(s),_(r),_(a)),n[8](null),n[9](null),n[10](null),i=!1,o()}}}function it(n,e,t){let s,r=H,a=()=>(r(),r=Se(o,u=>t(13,s=u)),o),i;n.$$.on_destroy.push(()=>r());let{selectedTool:o}=e;a();let{problemId:l}=e,{attemptId:f}=e,h=0,p=0,m=!1,k=ue("eraserEnabled");Z(n,k,u=>t(14,i=u));let y,E=[];function A(){typeof window>"u"||l===0||(t(2,h=window.innerWidth),t(3,p=window.innerHeight),requestAnimationFrame(async()=>{if(E[0]==null)return;const u=(await Y.files.get(l)).attempts[f];E[Q.Draw].putImageData(u.work,0,0),E[Q.Correct].putImageData(u.error,0,0),E[Q.Question].putImageData(u.questions,0,0)}))}const D=()=>{const u=[0,0,h,p];Y.files.update(l,v=>{const U=v.attempts[f];U.date=new Date,U.duration=Math.floor((new Date().getTime()-y)/1e3/60),s==Q.Correct&&(U.mistakeCount=1),s==Q.Question&&(U.questionCount=1),U[["work","error","questions"][s]]=E[s].getImageData(...u)})},j=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,g={[Q.Draw]:j?"white":"black",[Q.Correct]:"red",[Q.Question]:"blue"},C=u=>{if(s>=Q.None)return;const v=E[s];m=!0,v.strokeStyle=g[s],v.lineWidth=i?20:1,v.globalCompositeOperation=i?"destination-out":"source-over",v.beginPath(),v.moveTo(u.clientX,u.clientY)},P=()=>{m&&D(),m=!1},I=u=>{if(m){const v=E[s];v.lineTo(u.clientX,u.clientY),v.stroke()}};qe(()=>{window.addEventListener("resize",A),document.addEventListener("pointermove",I),document.addEventListener("pointerup",P),document.addEventListener("touchstart",u=>u.preventDefault()),E.forEach(u=>u.addEventListener("touchstart",v=>v.preventDefault())),t(1,E=E.map(u=>u.getContext("2d",{willReadFrequently:!0})))});function b(u){ie[u?"unshift":"push"](()=>{E[Q.Draw]=u,t(1,E)})}function d(u){ie[u?"unshift":"push"](()=>{E[Q.Correct]=u,t(1,E)})}function c(u){ie[u?"unshift":"push"](()=>{E[Q.Question]=u,t(1,E)})}return n.$$set=u=>{"selectedTool"in u&&a(t(0,o=u.selectedTool)),"problemId"in u&&t(6,l=u.problemId),"attemptId"in u&&t(7,f=u.attemptId)},n.$$.update=()=>{if(n.$$.dirty&194){A(),y=new Date().getTime();for(const u of E){const v=u.canvas;u.clearRect(0,0,v.width,v.height)}}},[o,E,h,p,k,C,l,f,b,d,c]}class at extends te{constructor(e){super(),ne(this,e,it,ot,ee,{selectedTool:0,problemId:6,attemptId:7})}}const re=Xe("goto");function ve(n,e,t){const s=n.slice();return s[19]=e[t],s[21]=t,s}function ke(n,e,t){const s=n.slice();return s[22]=e[t],s}function Ie(n){let e,t="🧠 Resolve questions",s,r;return{c(){e=N("button"),e.textContent=t},l(a){e=q(a,"BUTTON",{"data-svelte-h":!0}),oe(e)!=="svelte-ykge1i"&&(e.textContent=t)},m(a,i){T(a,e,i),s||(r=B(e,"click",n[11]),s=!0)},p:H,d(a){a&&_(e),s=!1,r()}}}function Ce(n){let e,t=n[6][n[22]]+"",s;return{c(){e=N("option"),s=x(t),this.h()},l(r){e=q(r,"OPTION",{});var a=L(e);s=$(a,t),a.forEach(_),this.h()},h(){e.__value=n[22],me(e,e.__value)},m(r,a){T(r,e,a),S(e,s)},p:H,d(r){r&&_(e)}}}function Ee(n,e){let t,s=e[19].name+"",r,a,i;return{key:n,first:null,c(){t=N("option"),r=x(s),this.h()},l(o){t=q(o,"OPTION",{});var l=L(t);r=$(l,s),l.forEach(_),this.h()},h(){t.__value=a=e[21],me(t,t.__value),t.selected=i=e[19].id===e[0],this.first=t},m(o,l){T(o,t,l),S(t,r)},p(o,l){e=o,l&16&&s!==(s=e[19].name+"")&&fe(r,s),l&16&&a!==(a=e[21])&&(t.__value=a,me(t,t.__value)),l&17&&i!==(i=e[19].id===e[0])&&(t.selected=i)},d(o){o&&_(t)}}}function ut(n){var I,b,d;let e,t,s=n[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️",r,a,i,o,l,f,h=[],p=new Map,m,k,y="➡️",E,A,D=((d=(b=(I=n[4][n[2]])==null?void 0:I.attempts)==null?void 0:b[n[1]])==null?void 0:d.questions)>0&&Ie(n),j=le(Object.keys(n[6])),g=[];for(let c=0;c<j.length;c+=1)g[c]=Ce(ke(n,j,c));let C=le(n[4]);const P=c=>c[19].id;for(let c=0;c<C.length;c+=1){let u=ve(n,C,c),v=P(u);p.set(v,h[c]=Ee(v,u))}return{c(){D&&D.c(),e=V(),t=N("button"),r=x(s),i=V(),o=N("select");for(let c=0;c<g.length;c+=1)g[c].c();l=V(),f=N("select");for(let c=0;c<h.length;c+=1)h[c].c();m=V(),k=N("button"),k.textContent=y,this.h()},l(c){D&&D.l(c),e=O(c),t=q(c,"BUTTON",{title:!0});var u=L(t);r=$(u,s),u.forEach(_),i=O(c),o=q(c,"SELECT",{});var v=L(o);for(let W=0;W<g.length;W+=1)g[W].l(v);v.forEach(_),l=O(c),f=q(c,"SELECT",{});var U=L(f);for(let W=0;W<h.length;W+=1)h[W].l(U);U.forEach(_),m=O(c),k=q(c,"BUTTON",{"data-svelte-h":!0}),oe(k)!=="svelte-1wjt799"&&(k.textContent=y),this.h()},h(){w(t,"title",a=(n[5]?"un":"")+"flag for later"),n[3]===void 0&&je(()=>n[15].call(o))},m(c,u){D&&D.m(c,u),T(c,e,u),T(c,t,u),S(t,r),T(c,i,u),T(c,o,u);for(let v=0;v<g.length;v+=1)g[v]&&g[v].m(o,null);ge(o,n[3],!0),T(c,l,u),T(c,f,u);for(let v=0;v<h.length;v+=1)h[v]&&h[v].m(f,null);T(c,m,u),T(c,k,u),E||(A=[B(t,"click",n[9]),B(o,"change",n[15]),B(f,"change",n[7]),B(k,"click",n[8])],E=!0)},p(c,[u]){var v,U,W;if(((W=(U=(v=c[4][c[2]])==null?void 0:v.attempts)==null?void 0:U[c[1]])==null?void 0:W.questions)>0?D?D.p(c,u):(D=Ie(c),D.c(),D.m(e.parentNode,e)):D&&(D.d(1),D=null),u&32&&s!==(s=c[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️")&&fe(r,s),u&32&&a!==(a=(c[5]?"un":"")+"flag for later")&&w(t,"title",a),u&64){j=le(Object.keys(c[6]));let M;for(M=0;M<j.length;M+=1){const se=ke(c,j,M);g[M]?g[M].p(se,u):(g[M]=Ce(se),g[M].c(),g[M].m(o,null))}for(;M<g.length;M+=1)g[M].d(1);g.length=j.length}u&72&&ge(o,c[3]),u&17&&(C=le(c[4]),h=Qe(h,u,P,1,c,C,p,f,Ye,Ee,null,ve))},i:H,o:H,d(c){c&&(_(e),_(t),_(i),_(o),_(l),_(f),_(m),_(k)),D&&D.d(c),Le(g,c);for(let u=0;u<h.length;u+=1)h[u].d();E=!1,Ue(A)}}}function ft(n,e,t){let s,r;Z(n,ae,I=>t(14,r=I));var a=(I=>(I.Work="Work",I.Mistakes="Mistakes",I.Questions="Questions",I))(a||{});let{problemRoute:i}=e,{problemId:o}=e,l=-1,f=0,h=r.url.searchParams.get("studyMode")??"Work",p=!1,m;function k(I){t(2,f=Number.parseInt(I.target.value)),t(1,l=-1),A()}function y(){return g[f].attempts.findIndex((I,b)=>I.questions>0&&b>l)}function E(){const I=l;if((h!=="Questions"||y()===-1)&&(t(2,f++,f),t(1,l=-1)),f>=g.length)if(h==="Work"){const b=Array.from(m.matchAll(/\d+/g)).at(-1);let d;b!=null&&(d=m.substring(0,b.index)+(Number.parseInt(b[0])+1)+m.substring(b.index+b[0].length)),Y.newFile({basePath:r.params.path,route:d}).then(c=>{c>=0&&re(String(c))})}else{alert("Hooray! You are done!"),t(2,f--,f),t(1,l=I);return}A()}function A(){t(1,l=h=="Questions"?y():g[f].attempts.length-1)}function D(){t(5,p=!p),Y.files.update(o,{flagged:p})}const j=Oe(()=>Y.files.where("route").startsWith(r.params.path).toArray().then(I=>I.map(b=>({id:b.id,route:b.route,name:b.name,flagged:b.flagged,attempts:b.attempts.map(d=>({questions:d.questionCount,mistakes:d.mistakeCount}))}))));Z(n,j,I=>t(13,s=I));let g=[];function C(){Y.files.update(o,I=>{I.attempts[l].questionCount=0}),E()}function P(){h=We(this),t(3,h),t(6,a)}return n.$$set=I=>{"problemRoute"in I&&t(12,i=I.problemRoute),"problemId"in I&&t(0,o=I.problemId)},n.$$.update=()=>{var I;if(n.$$.dirty&16384&&t(1,l=r.data.attemptIdx),n.$$.dirty&12296){const b=s??[];switch(h){case"Work":t(4,g=b.filter(d=>d.route===i).sort((d,c)=>ze(d.name,c.name)));break;case"Mistakes":t(4,g=b.filter(d=>d.attempts.at(-1).mistakes>0||d.flagged));break;case"Questions":t(4,g=b.filter(d=>d.attempts.some(c=>c.questions>0)));break}}if(n.$$.dirty&17&&t(2,f=Math.max(0,g.findIndex(b=>b.id===o))),n.$$.dirty&30){const b=(I=g[f])==null?void 0:I.id;b&&re(String(b)+Ve({studyMode:h,attempt:String(l+1)}))}n.$$.dirty&1&&Y.files.get(o).then(b=>{t(5,p=(b==null?void 0:b.flagged)??!1),m=(b==null?void 0:b.name)??""})},[o,l,f,h,g,p,a,k,E,D,j,C,i,s,r,P]}class ct extends te{constructor(e){super(),ne(this,e,ft,ut,ee,{problemRoute:12,problemId:0})}}function ht(n){let e,t,s,r,a=n[0]+1+"",i;return{c(){e=N("div"),t=N("canvas"),r=x(`
    Attempt `),i=x(a),this.h()},l(o){e=q(o,"DIV",{class:!0});var l=L(e);t=q(l,"CANVAS",{width:!0,height:!0}),L(t).forEach(_),r=$(l,`
    Attempt `),i=$(l,a),l.forEach(_),this.h()},h(){w(t,"width",n[1]),w(t,"height",s=n[1]-24),w(e,"class","text-center bg-gray-50 rounded-md"),R(e,"width",n[1]+"px")},m(o,l){T(o,e,l),S(e,t),n[4](t),S(e,r),S(e,i)},p(o,[l]){l&2&&w(t,"width",o[1]),l&2&&s!==(s=o[1]-24)&&w(t,"height",s),l&1&&a!==(a=o[0]+1+"")&&fe(i,a),l&2&&R(e,"width",o[1]+"px")},i:H,o:H,d(o){o&&_(e),n[4](null)}}}function mt(n,e,t){let{attempt:s}=e,{idx:r}=e,{size:a=100}=e,i;function o(f,h){const p=document.createElement("canvas");p.width=h[0].width,p.height=h[0].height,f.scale(a/p.width,(a-24)/p.height);for(const m of h)p.getContext("2d").putImageData(m,0,0),f.drawImage(p,0,0)}qe(async()=>{const f=i.getContext("2d");o(f,[s.work,s.error,s.questions])});function l(f){ie[f?"unshift":"push"](()=>{i=f,t(2,i)})}return n.$$set=f=>{"attempt"in f&&t(3,s=f.attempt),"idx"in f&&t(0,r=f.idx),"size"in f&&t(1,a=f.size)},[r,a,i,s,l]}class dt extends te{constructor(e){super(),ne(this,e,mt,ht,ee,{attempt:3,idx:0,size:1})}}function De(n,e,t){const s=n.slice();return s[5]=e[t],s[7]=t,s}function Te(n,e){let t,s,r,a,i;s=new dt({props:{attempt:e[5],idx:e[7]}});function o(){return e[4](e[7])}return{key:n,first:null,c(){t=N("button"),G(s.$$.fragment),this.h()},l(l){t=q(l,"BUTTON",{});var f=L(t);X(s.$$.fragment,f),f.forEach(_),this.h()},h(){this.first=t},m(l,f){T(l,t,f),J(s,t,null),r=!0,a||(i=B(t,"click",o),a=!0)},p(l,f){e=l;const h={};f&4&&(h.attempt=e[5]),f&4&&(h.idx=e[7]),s.$set(h)},i(l){r||(F(s.$$.fragment,l),r=!0)},o(l){z(s.$$.fragment,l),r=!1},d(l){l&&_(t),K(s),a=!1,i()}}}function pt(n){let e=[],t=new Map,s,r,a=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">➕</div>
    New Attempt`,i,o,l,f=le(n[2]??[]);const h=p=>""+p[0]+p[7];for(let p=0;p<f.length;p+=1){let m=De(n,f,p),k=h(m);t.set(k,e[p]=Te(k,m))}return{c(){for(let p=0;p<e.length;p+=1)e[p].c();s=V(),r=N("button"),r.innerHTML=a,this.h()},l(p){for(let m=0;m<e.length;m+=1)e[m].l(p);s=O(p),r=q(p,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(r)!=="svelte-1goxpwn"&&(r.innerHTML=a),this.h()},h(){w(r,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(p,m){for(let k=0;k<e.length;k+=1)e[k]&&e[k].m(p,m);T(p,s,m),T(p,r,m),i=!0,o||(l=B(r,"click",n[3]),o=!0)},p(p,[m]){m&5&&(f=le(p[2]??[]),Pe(),e=Qe(e,m,h,1,p,f,t,s.parentNode,Ge,Te,s,De),Be())},i(p){if(!i){for(let m=0;m<f.length;m+=1)F(e[m]);i=!0}},o(p){for(let m=0;m<e.length;m+=1)z(e[m]);i=!1},d(p){p&&(_(s),_(r));for(let m=0;m<e.length;m+=1)e[m].d(p);o=!1,l()}}}function gt(n,e,t){let s,r=H,a=()=>(r(),r=Se(o,h=>t(2,s=h)),o);n.$$.on_destroy.push(()=>r());let{problemId:i}=e,o;function l(){Y.files.update(i,h=>{re("?attempt="+h.attempts.push(Je.newBlankAttempt()))})}const f=h=>re(Ve({attempt:String(h+1)}));return n.$$set=h=>{"problemId"in h&&t(0,i=h.problemId)},n.$$.update=()=>{n.$$.dirty&1&&a(t(1,o=Oe(()=>Y.files.get(i).then(h=>h.attempts))))},[i,o,s,l,f]}class _t extends te{constructor(e){super(),ne(this,e,gt,pt,ee,{problemId:0})}}function bt(n){let e,t,s;return{c(){e=N("canvas"),this.h()},l(r){e=q(r,"CANVAS",{class:!0}),L(e).forEach(_),this.h()},h(){w(e,"class","fixed left-0 top-[2em]")},m(r,a){T(r,e,a),n[3](e),t||(s=B(e,"mousedown",n[1]),t=!0)},p:H,i:H,o:H,d(r){r&&_(e),n[3](null),t=!1,s()}}}function wt(n,e,t){let{problemId:s}=e,r,a;function i(l){setTimeout(()=>{a.dragStart(l)})}function o(l){ie[l?"unshift":"push"](()=>{r=l,t(0,r),t(2,s)})}return n.$$set=l=>{"problemId"in l&&t(2,s=l.problemId)},n.$$.update=()=>{n.$$.dirty&5&&Y.files.get(s).then(l=>{l!=null&&l.question&&(t(0,r.width=l.question.width,r),t(0,r.height=l.question.height,r),r.getContext("2d").putImageData(l.question,0,0))})},[r,i,s,o]}class vt extends te{constructor(e){super(),ne(this,e,wt,bt,ee,{problemId:2})}}function ye(n,e,t){const s=n.slice();return s[9]=e[t],s}function Me(n){let e,t=n[9]+"",s;return{c(){e=x("/"),s=x(t)},l(r){e=$(r,"/"),s=$(r,t)},m(r,a){T(r,e,a),T(r,s,a)},p(r,a){a&4&&t!==(t=r[9]+"")&&fe(s,t)},d(r){r&&(_(e),_(s))}}}function kt(n){let e,t,s,r,a,i,o,l,f,h,p,m,k,y,E,A,D,j,g,C,P;t=new vt({props:{problemId:n[0]}}),r=new at({props:{selectedTool:n[4],problemId:n[0],attemptId:n[3]}});let I=le(n[2].params.path.split("/")),b=[];for(let d=0;d<I.length;d+=1)b[d]=Me(ye(n,I,d));return y=new ct({props:{problemId:n[0],problemRoute:n[1]}}),D=new rt({props:{selected:n[4]}}),C=new _t({props:{problemId:n[0]}}),{c(){e=V(),G(t.$$.fragment),s=V(),G(r.$$.fragment),a=V(),i=N("div"),o=N("div"),l=N("a"),f=x("🏠"),p=V();for(let d=0;d<b.length;d+=1)b[d].c();m=V(),k=N("div"),G(y.$$.fragment),E=V(),A=N("div"),G(D.$$.fragment),j=V(),g=N("div"),G(C.$$.fragment),this.h()},l(d){Fe("svelte-pyemm1",document.head).forEach(_),e=O(d),X(t.$$.fragment,d),s=O(d),X(r.$$.fragment,d),a=O(d),i=q(d,"DIV",{id:!0,class:!0});var u=L(i);o=q(u,"DIV",{id:!0,class:!0});var v=L(o);l=q(v,"A",{href:!0});var U=L(l);f=$(U,"🏠"),U.forEach(_),p=O(v);for(let ce=0;ce<b.length;ce+=1)b[ce].l(v);v.forEach(_),m=O(u),k=q(u,"DIV",{id:!0,class:!0});var W=L(k);X(y.$$.fragment,W),W.forEach(_),E=O(u),A=q(u,"DIV",{id:!0,class:!0});var M=L(A);X(D.$$.fragment,M),M.forEach(_),j=O(u),g=q(u,"DIV",{id:!0,class:!0});var se=L(g);X(C.$$.fragment,se),se.forEach(_),u.forEach(_),this.h()},h(){document.title="MathMan Draw",w(l,"href",h=pe(n[2])),w(o,"id","breadcrumbs"),w(o,"class","svelte-1je8nl3"),w(k,"id","question-management"),w(k,"class","text-right svelte-1je8nl3"),w(A,"id","tools-container"),w(A,"class","svelte-1je8nl3"),w(g,"id","attempts-container"),w(g,"class","flex flex-col p-3 gap-3 svelte-1je8nl3"),w(i,"id","grid"),w(i,"class","svelte-1je8nl3")},m(d,c){T(d,e,c),J(t,d,c),T(d,s,c),J(r,d,c),T(d,a,c),T(d,i,c),S(i,o),S(o,l),S(l,f),S(o,p);for(let u=0;u<b.length;u+=1)b[u]&&b[u].m(o,null);S(i,m),S(i,k),J(y,k,null),S(i,E),S(i,A),J(D,A,null),S(i,j),S(i,g),J(C,g,null),P=!0},p(d,[c]){const u={};c&1&&(u.problemId=d[0]),t.$set(u);const v={};if(c&1&&(v.problemId=d[0]),c&8&&(v.attemptId=d[3]),r.$set(v),(!P||c&4&&h!==(h=pe(d[2])))&&w(l,"href",h),c&4){I=le(d[2].params.path.split("/"));let M;for(M=0;M<I.length;M+=1){const se=ye(d,I,M);b[M]?b[M].p(se,c):(b[M]=Me(se),b[M].c(),b[M].m(o,null))}for(;M<b.length;M+=1)b[M].d(1);b.length=I.length}const U={};c&1&&(U.problemId=d[0]),c&2&&(U.problemRoute=d[1]),y.$set(U);const W={};c&1&&(W.problemId=d[0]),C.$set(W)},i(d){P||(F(t.$$.fragment,d),F(r.$$.fragment,d),F(y.$$.fragment,d),F(D.$$.fragment,d),F(C.$$.fragment,d),P=!0)},o(d){z(t.$$.fragment,d),z(r.$$.fragment,d),z(y.$$.fragment,d),z(D.$$.fragment,d),z(C.$$.fragment,d),P=!1},d(d){d&&(_(e),_(s),_(a),_(i)),K(t,d),K(r,d),Le(b,d),K(y),K(D),K(C)}}}function It(n,e,t){let s,r,a;Z(n,ae,m=>t(2,r=m));const i=_e(Q.None),o=_e(!1);Ne("eraserEnabled",o);const l=be(ae,m=>m.data.problemId);Z(n,l,m=>t(0,s=m));const f=be(ae,m=>m.data.attemptIdx);Z(n,f,m=>t(3,a=m));let h;function p(m){s!==0&&(m?(t(1,h=m.route),h.startsWith(r.params.path)||re(de(h,r.params.problemId))):re(pe(r)))}return n.$$.update=()=>{n.$$.dirty&1&&Y.files.get(s).then(p)},[s,h,r,a,i,l,f]}class Nt extends te{constructor(e){super(),ne(this,e,It,kt,ee,{})}}export{Nt as component};
