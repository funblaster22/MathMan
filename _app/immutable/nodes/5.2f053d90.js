import{s as $,n as z,j as ce,e as K,k as Qe,l as ye,o as Se,f as Ne,b as ie,m as Re,r as je}from"../chunks/scheduler.a731e211.js";import{S as ee,i as te,s as j,g as y,c as O,h as S,C as fe,k as b,l as R,a as M,A as B,D as Ae,f as _,j as L,x as A,r as F,m as Z,u as Y,n as x,v as G,d as W,t as H,w as X,E as ge,o as he,y as qe,F as pe,G as Oe,p as ze,b as Pe,B as Ue}from"../chunks/index.80c1ccc5.js";import{p as se,g as re,e as ne,u as Le,d as We,o as He}from"../chunks/navigation.aabef7fc.js";import{e as le,w as _e,j as be}from"../chunks/singletons.bf1a5a4f.js";import{p as ue}from"../chunks/stores.0d4ecd43.js";import{d as J,u as Ve,D as Be}from"../chunks/db.073ea4c6.js";var V=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Select=4]="Select",n))(V||{});const Fe=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function we(n){let e,t="Show Solution";return{c(){e=y("button"),e.textContent=t,this.h()},l(s){e=S(s,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),fe(e)!=="svelte-on8fyx"&&(e.textContent=t),this.h()},h(){b(e,"class","border text-center"),R(e,"position","fixed"),R(e,"left",n[1][0]+"px"),R(e,"top",n[1][1]+"px"),R(e,"width",n[2][0]-n[1][0]+"px"),R(e,"height",n[2][1]-n[1][1]+"px")},m(s,l){M(s,e,l)},p(s,l){l&2&&R(e,"left",s[1][0]+"px"),l&2&&R(e,"top",s[1][1]+"px"),l&6&&R(e,"width",s[2][0]-s[1][0]+"px"),l&6&&R(e,"height",s[2][1]-s[1][1]+"px")},d(s){s&&_(e)}}}function Ye(n){let e,t,s='<div style="background-color: green">‚úÖ</div>',l,i,o=n[1][1]&&we(n);return{c(){o&&o.c(),e=j(),t=y("div"),t.innerHTML=s,this.h()},l(a){o&&o.l(a),e=O(a),t=S(a,"DIV",{class:!0,"data-svelte-h":!0}),fe(t)!=="svelte-aiv1v7"&&(t.innerHTML=s),this.h()},h(){b(t,"class","tool"),R(t,"height",n[0]?"100%":"30px")},m(a,r){o&&o.m(a,r),M(a,e,r),M(a,t,r),l||(i=B(t,"pointerdown",Ae(n[8])),l=!0)},p(a,[r]){a[1][1]?o?o.p(a,r):(o=we(a),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),r&1&&R(t,"height",a[0]?"100%":"30px")},i:z,o:z,d(a){a&&(_(e),_(t)),o&&o.d(a),l=!1,i()}}}function Ge(n,e,t){let s;const l=V.Select;let i=!1,o=!1,a=[],r=[],f,h,m=ce("selection");K(n,m,I=>t(7,s=I)),window.addEventListener("pointerdown",I=>{i&&(o=!0,t(5,a=t(6,r=[I.x,I.y])))}),window.addEventListener("pointermove",I=>{o&&t(6,r=[I.x,I.y])}),window.addEventListener("pointerup",()=>{o=!1});const c=()=>m.set(i?V.None:l);return n.$$.update=()=>{n.$$.dirty&128&&t(0,i=s===l),n.$$.dirty&96&&(t(1,f=[Math.min(a[0],r[0]),Math.min(a[1],r[1])]),t(2,h=[Math.max(a[0],r[0]),Math.max(a[1],r[1])]))},[i,f,h,l,m,a,r,s,c]}class Xe extends ee{constructor(e){super(),te(this,e,Ge,Ye,$,{})}}const Je=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href;function Ke(n){let e,t,s,l,i;return{c(){e=y("div"),t=y("img"),this.h()},l(o){e=S(o,"DIV",{class:!0});var a=L(e);t=S(a,"IMG",{style:!0,src:!0,title:!0,draggable:!0}),a.forEach(_),this.h()},h(){R(t,"filter",n[1]),Qe(t.src,s=Je)||b(t,"src",s),b(t,"title",n[2]),b(t,"draggable","false"),b(e,"class","tool"),R(e,"height",n[3]?"100%":"30px")},m(o,a){M(o,e,a),A(e,t),l||(i=B(e,"pointerdown",Ae(n[6])),l=!0)},p(o,[a]){a&2&&R(t,"filter",o[1]),a&4&&b(t,"title",o[2]),a&8&&R(e,"height",o[3]?"100%":"30px")},i:z,o:z,d(o){o&&_(e),l=!1,i()}}}function Ze(n,e,t){let s,{tool:l}=e,{filter:i=""}=e,{title:o}=e,a=ce("selection");K(n,a,h=>t(5,s=h));let r=!1;const f=()=>a.set(r?V.None:l);return n.$$set=h=>{"tool"in h&&t(0,l=h.tool),"filter"in h&&t(1,i=h.filter),"title"in h&&t(2,o=h.title)},n.$$.update=()=>{n.$$.dirty&33&&t(3,r=s===l)},[l,i,o,r,a,s,f]}class de extends ee{constructor(e){super(),te(this,e,Ze,Ke,$,{tool:0,filter:1,title:2})}}function xe(n){let e,t,s,l,i,o,a,r,f,h,m,c,I,T,D=`<img src="${Fe}" title="Eraser" draggable="false" class="svelte-h3rgmi"/>`,E,C,w;return t=new Xe({}),r=new de({props:{tool:V.Draw,filter:"grayscale(1)",title:"Your work"}}),h=new de({props:{tool:V.Correct,filter:"hue-rotate(136deg)",title:"Correct"}}),c=new de({props:{tool:V.Question,title:"Question"}}),{c(){e=y("div"),F(t.$$.fragment),s=j(),l=y("a"),i=Z("üì∑"),a=j(),F(r.$$.fragment),f=j(),F(h.$$.fragment),m=j(),F(c.$$.fragment),I=j(),T=y("div"),T.innerHTML=D,this.h()},l(g){e=S(g,"DIV",{id:!0,class:!0});var u=L(e);Y(t.$$.fragment,u),s=O(u),l=S(u,"A",{href:!0});var v=L(l);i=x(v,"üì∑"),v.forEach(_),a=O(u),Y(r.$$.fragment,u),f=O(u),Y(h.$$.fragment,u),m=O(u),Y(c.$$.fragment,u),I=O(u),T=S(u,"DIV",{class:!0,"data-svelte-h":!0}),fe(T)!=="svelte-19p7wft"&&(T.innerHTML=D),u.forEach(_),this.h()},h(){b(l,"href",o=se.join("/",le,"camera",n[1].params.problemId)),b(T,"class","tool"),R(T,"height",n[0]?"100%":"30px"),b(e,"id","tools"),b(e,"class","svelte-h3rgmi")},m(g,u){M(g,e,u),G(t,e,null),A(e,s),A(e,l),A(l,i),A(e,a),G(r,e,null),A(e,f),G(h,e,null),A(e,m),G(c,e,null),A(e,I),A(e,T),E=!0,C||(w=B(T,"click",n[3]),C=!0)},p(g,[u]){(!E||u&2&&o!==(o=se.join("/",le,"camera",g[1].params.problemId)))&&b(l,"href",o),u&1&&R(T,"height",g[0]?"100%":"30px")},i(g){E||(W(t.$$.fragment,g),W(r.$$.fragment,g),W(h.$$.fragment,g),W(c.$$.fragment,g),E=!0)},o(g){H(t.$$.fragment,g),H(r.$$.fragment,g),H(h.$$.fragment,g),H(c.$$.fragment,g),E=!1},d(g){g&&_(e),X(t),X(r),X(h),X(c),C=!1,w()}}}function $e(n,e,t){let s,l;K(n,ue,r=>t(1,l=r));let{selected:i}=e;ye("selection",i);let o=ce("eraserEnabled");K(n,o,r=>t(0,s=r));function a(r){o.set(!s)}return n.$$set=r=>{"selected"in r&&t(4,i=r.selected)},[s,l,o,a,i]}class et extends ee{constructor(e){super(),te(this,e,$e,xe,$,{selected:4})}}function tt(n){let e,t,s,l,i,o,a;return{c(){e=y("canvas"),t=j(),s=y("canvas"),l=j(),i=y("canvas"),this.h()},l(r){e=S(r,"CANVAS",{width:!0,height:!0,class:!0}),L(e).forEach(_),t=O(r),s=S(r,"CANVAS",{width:!0,height:!0,class:!0}),L(s).forEach(_),l=O(r),i=S(r,"CANVAS",{width:!0,height:!0,class:!0}),L(i).forEach(_),this.h()},h(){b(e,"width",n[2]),b(e,"height",n[3]),b(e,"class","svelte-1rofrvo"),b(s,"width",n[2]),b(s,"height",n[3]),b(s,"class","svelte-1rofrvo"),b(i,"width",n[2]),b(i,"height",n[3]),b(i,"class","svelte-1rofrvo")},m(r,f){M(r,e,f),n[8](e),M(r,t,f),M(r,s,f),n[9](s),M(r,l,f),M(r,i,f),n[10](i),o||(a=B(i,"pointerdown",n[5]),o=!0)},p(r,[f]){f&4&&b(e,"width",r[2]),f&8&&b(e,"height",r[3]),f&4&&b(s,"width",r[2]),f&8&&b(s,"height",r[3]),f&4&&b(i,"width",r[2]),f&8&&b(i,"height",r[3])},i:z,o:z,d(r){r&&(_(e),_(t),_(s),_(l),_(i)),n[8](null),n[9](null),n[10](null),o=!1,a()}}}function nt(n,e,t){let s,l=z,i=()=>(l(),l=Ne(a,p=>t(13,s=p)),a),o;n.$$.on_destroy.push(()=>l());let{selectedTool:a}=e;i();let{problemId:r}=e,{attemptId:f}=e,h=0,m=0,c=!1,I=ce("eraserEnabled");K(n,I,p=>t(14,o=p));let T,D=[];function E(){typeof window>"u"||(t(2,h=window.innerWidth),t(3,m=window.innerHeight),requestAnimationFrame(async()=>{if(D[0]==null)return;const p=(await J.files.get(r)).attempts[f];D[V.Draw].putImageData(p.work,0,0),D[V.Correct].putImageData(p.error,0,0),D[V.Question].putImageData(p.questions,0,0)}))}const C=()=>{const p=[0,0,h,m];J.files.update(r,q=>{const U=q.attempts[f];U.date=new Date,U.duration=Math.floor((new Date().getTime()-T)/1e3/60),s==V.Correct&&(U.mistakeCount=1),s==V.Question&&(U.questionCount=1),U[["work","error","questions"][s]]=D[s].getImageData(...p)})},w=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,g={[V.Draw]:w?"white":"black",[V.Correct]:"red",[V.Question]:"blue"},u=p=>{if(s>=V.None)return;const q=D[s];c=!0,q.strokeStyle=g[s],q.lineWidth=o?20:1,q.globalCompositeOperation=o?"destination-out":"source-over",q.beginPath(),q.moveTo(p.clientX,p.clientY)},v=()=>{c&&C(),c=!1},k=p=>{if(c){const q=D[s];q.lineTo(p.clientX,p.clientY),q.stroke()}};Se(()=>{window.addEventListener("resize",E),document.addEventListener("pointermove",k),document.addEventListener("pointerup",v),t(1,D=D.map(p=>p.getContext("2d",{willReadFrequently:!0})))});function N(p){ie[p?"unshift":"push"](()=>{D[V.Draw]=p,t(1,D)})}function d(p){ie[p?"unshift":"push"](()=>{D[V.Correct]=p,t(1,D)})}function Q(p){ie[p?"unshift":"push"](()=>{D[V.Question]=p,t(1,D)})}return n.$$set=p=>{"selectedTool"in p&&i(t(0,a=p.selectedTool)),"problemId"in p&&t(6,r=p.problemId),"attemptId"in p&&t(7,f=p.attemptId)},n.$$.update=()=>{if(n.$$.dirty&194){E(),T=new Date().getTime();for(const p of D){const q=p.canvas;p.clearRect(0,0,q.width,q.height)}}},[a,D,h,m,I,u,r,f,N,d,Q]}class st extends ee{constructor(e){super(),te(this,e,nt,tt,$,{selectedTool:0,problemId:6,attemptId:7})}}function rt(n,e){const t=new URLSearchParams(location.search);return t.set(n,e),re("?"+t.toString())}function ve(n,e,t){const s=n.slice();return s[15]=e[t],s[17]=t,s}function ke(n,e,t){const s=n.slice();return s[18]=e[t],s}function Ie(n){let e,t=n[4][n[18]]+"",s;return{c(){e=y("option"),s=Z(t),this.h()},l(l){e=S(l,"OPTION",{});var i=L(e);s=x(i,t),i.forEach(_),this.h()},h(){e.__value=n[18],pe(e,e.__value)},m(l,i){M(l,e,i),A(e,s)},p:z,d(l){l&&_(e)}}}function Ce(n,e){let t,s=e[15].name+"",l,i,o;return{key:n,first:null,c(){t=y("option"),l=Z(s),this.h()},l(a){t=S(a,"OPTION",{});var r=L(t);l=x(r,s),r.forEach(_),this.h()},h(){t.__value=i=e[17],pe(t,t.__value),t.selected=o=e[15].id===e[0],this.first=t},m(a,r){M(a,t,r),A(t,l)},p(a,r){e=a,r&4&&s!==(s=e[15].name+"")&&he(l,s),r&4&&i!==(i=e[17])&&(t.__value=i,pe(t,t.__value)),r&5&&o!==(o=e[15].id===e[0])&&(t.selected=o)},d(a){a&&_(t)}}}function lt(n){let e,t=n[3]?new Date().getMonth()===5?"üè≥Ô∏è‚Äçüåà":"üö©":"üè≥Ô∏è",s,l,i,o,a,r,f=[],h=new Map,m,c,I="‚û°Ô∏è",T,D,E=ne(Object.keys(n[4])),C=[];for(let u=0;u<E.length;u+=1)C[u]=Ie(ke(n,E,u));let w=ne(n[2]);const g=u=>u[15].id;for(let u=0;u<w.length;u+=1){let v=ve(n,w,u),k=g(v);h.set(k,f[u]=Ce(k,v))}return{c(){e=y("button"),s=Z(t),i=j(),o=y("select");for(let u=0;u<C.length;u+=1)C[u].c();a=j(),r=y("select");for(let u=0;u<f.length;u+=1)f[u].c();m=j(),c=y("button"),c.textContent=I,this.h()},l(u){e=S(u,"BUTTON",{title:!0});var v=L(e);s=x(v,t),v.forEach(_),i=O(u),o=S(u,"SELECT",{});var k=L(o);for(let d=0;d<C.length;d+=1)C[d].l(k);k.forEach(_),a=O(u),r=S(u,"SELECT",{});var N=L(r);for(let d=0;d<f.length;d+=1)f[d].l(N);N.forEach(_),m=O(u),c=S(u,"BUTTON",{"data-svelte-h":!0}),fe(c)!=="svelte-1wjt799"&&(c.textContent=I),this.h()},h(){b(e,"title",l=(n[3]?"un":"")+"flag for later"),n[1]===void 0&&Re(()=>n[12].call(o))},m(u,v){M(u,e,v),A(e,s),M(u,i,v),M(u,o,v);for(let k=0;k<C.length;k+=1)C[k]&&C[k].m(o,null);ge(o,n[1],!0),M(u,a,v),M(u,r,v);for(let k=0;k<f.length;k+=1)f[k]&&f[k].m(r,null);M(u,m,v),M(u,c,v),T||(D=[B(e,"click",n[7]),B(o,"change",n[12]),B(r,"change",n[5]),B(c,"click",n[6])],T=!0)},p(u,[v]){if(v&8&&t!==(t=u[3]?new Date().getMonth()===5?"üè≥Ô∏è‚Äçüåà":"üö©":"üè≥Ô∏è")&&he(s,t),v&8&&l!==(l=(u[3]?"un":"")+"flag for later")&&b(e,"title",l),v&16){E=ne(Object.keys(u[4]));let k;for(k=0;k<E.length;k+=1){const N=ke(u,E,k);C[k]?C[k].p(N,v):(C[k]=Ie(N),C[k].c(),C[k].m(o,null))}for(;k<C.length;k+=1)C[k].d(1);C.length=E.length}v&18&&ge(o,u[1]),v&5&&(w=ne(u[2]),f=Le(f,v,g,1,u,w,h,r,We,Ce,null,ve))},i:z,o:z,d(u){u&&(_(e),_(i),_(o),_(a),_(r),_(m),_(c)),qe(C,u);for(let v=0;v<f.length;v+=1)f[v].d();T=!1,je(D)}}}function ot(n,e,t){let s,l;K(n,ue,w=>t(14,l=w));var i=(w=>(w.Work="Work",w.Mistakes="Mistakes",w.Questions="Questions",w))(i||{});let{problemRoute:o}=e,{problemId:a}=e,r=0,f=l.url.searchParams.get("studyMode")??"Work",h=!1,m;function c(w){t(10,r=Number.parseInt(w.target.value))}function I(){if(t(10,++r)>=E.length)if(f==="Work"){const w=Array.from(m.matchAll(/\d+/g)).at(-1);let g;w!=null&&(g=m.substring(0,w.index)+(Number.parseInt(w[0])+1)+m.substring(w.index+w[0].length)),J.newFile({basePath:l.params.path,route:g}).then(u=>{u>=0&&re(String(u))})}else alert("Hooray! You are done!"),t(10,r--,r)}function T(){t(3,h=!h),J.files.update(a,{flagged:h})}const D=Ve(()=>J.files.where("route").startsWith(l.params.path).toArray().then(w=>w.map(g=>({id:g.id,route:g.route,name:g.name,attempts:g.attempts.map(u=>({questions:u.questionCount,mistakes:u.mistakeCount}))}))));K(n,D,w=>t(11,s=w));let E=[];function C(){f=Oe(this),t(1,f),t(4,i)}return n.$$set=w=>{"problemRoute"in w&&t(9,o=w.problemRoute),"problemId"in w&&t(0,a=w.problemId)},n.$$.update=()=>{var w;if(n.$$.dirty&2562){const g=s??[];switch(f){case"Work":t(2,E=g.filter(u=>u.route===o).sort((u,v)=>u.name.localeCompare(v.name)));break;case"Mistakes":t(2,E=g.filter(u=>u.attempts.at(-1).mistakes>0));break;case"Questions":t(2,E=g.filter(u=>u.attempts.some(v=>v.questions>0)));break}}n.$$.dirty&5&&t(10,r=Math.max(0,E.findIndex(g=>g.id===a))),n.$$.dirty&1028&&re(String(((w=E[r])==null?void 0:w.id)??0)),n.$$.dirty&1&&J.files.get(a).then(g=>{t(3,h=(g==null?void 0:g.flagged)??!1),m=(g==null?void 0:g.name)??""})},[a,f,E,h,i,c,I,T,D,o,r,s,C]}class at extends ee{constructor(e){super(),te(this,e,ot,lt,$,{problemRoute:9,problemId:0})}}function it(n){let e,t,s,l,i=n[0]+1+"",o;return{c(){e=y("div"),t=y("canvas"),l=Z(`
    Attempt `),o=Z(i),this.h()},l(a){e=S(a,"DIV",{class:!0});var r=L(e);t=S(r,"CANVAS",{width:!0,height:!0}),L(t).forEach(_),l=x(r,`
    Attempt `),o=x(r,i),r.forEach(_),this.h()},h(){b(t,"width",n[1]),b(t,"height",s=n[1]-24),b(e,"class","text-center bg-gray-50 rounded-md"),R(e,"width",n[1]+"px")},m(a,r){M(a,e,r),A(e,t),n[4](t),A(e,l),A(e,o)},p(a,[r]){r&2&&b(t,"width",a[1]),r&2&&s!==(s=a[1]-24)&&b(t,"height",s),r&1&&i!==(i=a[0]+1+"")&&he(o,i),r&2&&R(e,"width",a[1]+"px")},i:z,o:z,d(a){a&&_(e),n[4](null)}}}function ut(n,e,t){let{attempt:s}=e,{idx:l}=e,{size:i=100}=e,o;function a(f,h){const m=document.createElement("canvas");m.width=h[0].width,m.height=h[0].height,f.scale(i/m.width,(i-24)/m.height);for(const c of h)m.getContext("2d").putImageData(c,0,0),f.drawImage(m,0,0)}Se(async()=>{const f=o.getContext("2d");a(f,[s.work,s.error,s.questions])});function r(f){ie[f?"unshift":"push"](()=>{o=f,t(2,o)})}return n.$$set=f=>{"attempt"in f&&t(3,s=f.attempt),"idx"in f&&t(0,l=f.idx),"size"in f&&t(1,i=f.size)},[l,i,o,s,r]}class ft extends ee{constructor(e){super(),te(this,e,ut,it,$,{attempt:3,idx:0,size:1})}}function Ee(n,e,t){const s=n.slice();return s[5]=e[t],s[7]=t,s}function De(n,e){let t,s,l,i,o;s=new ft({props:{attempt:e[5],idx:e[7]}});function a(){return e[4](e[7])}return{key:n,first:null,c(){t=y("button"),F(s.$$.fragment),this.h()},l(r){t=S(r,"BUTTON",{});var f=L(t);Y(s.$$.fragment,f),f.forEach(_),this.h()},h(){this.first=t},m(r,f){M(r,t,f),G(s,t,null),l=!0,i||(o=B(t,"click",a),i=!0)},p(r,f){e=r;const h={};f&4&&(h.attempt=e[5]),f&4&&(h.idx=e[7]),s.$set(h)},i(r){l||(W(s.$$.fragment,r),l=!0)},o(r){H(s.$$.fragment,r),l=!1},d(r){r&&_(t),X(s),i=!1,o()}}}function ct(n){let e=[],t=new Map,s,l,i=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,o,a,r,f=ne(n[2]??[]);const h=m=>""+m[0]+m[7];for(let m=0;m<f.length;m+=1){let c=Ee(n,f,m),I=h(c);t.set(I,e[m]=De(I,c))}return{c(){for(let m=0;m<e.length;m+=1)e[m].c();s=j(),l=y("button"),l.innerHTML=i,this.h()},l(m){for(let c=0;c<e.length;c+=1)e[c].l(m);s=O(m),l=S(m,"BUTTON",{class:!0,"data-svelte-h":!0}),fe(l)!=="svelte-1goxpwn"&&(l.innerHTML=i),this.h()},h(){b(l,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(m,c){for(let I=0;I<e.length;I+=1)e[I]&&e[I].m(m,c);M(m,s,c),M(m,l,c),o=!0,a||(r=B(l,"click",n[3]),a=!0)},p(m,[c]){c&5&&(f=ne(m[2]??[]),ze(),e=Le(e,c,h,1,m,f,t,s.parentNode,He,De,s,Ee),Pe())},i(m){if(!o){for(let c=0;c<f.length;c+=1)W(e[c]);o=!0}},o(m){for(let c=0;c<e.length;c+=1)H(e[c]);o=!1},d(m){m&&(_(s),_(l));for(let c=0;c<e.length;c+=1)e[c].d(m);a=!1,r()}}}function ht(n,e,t){let s,l=z,i=()=>(l(),l=Ne(a,h=>t(2,s=h)),a);n.$$.on_destroy.push(()=>l());let{problemId:o}=e,a;function r(){J.files.update(o,h=>{re("?attempt="+h.attempts.push(Be.newBlankAttempt()))})}const f=h=>rt("attempt",String(h+1));return n.$$set=h=>{"problemId"in h&&t(0,o=h.problemId)},n.$$.update=()=>{n.$$.dirty&1&&i(t(1,a=Ve(()=>J.files.get(o).then(h=>h.attempts))))},[o,a,s,r,f]}class mt extends ee{constructor(e){super(),te(this,e,ht,ct,$,{problemId:0})}}function dt(n){let e,t,s;return{c(){e=y("canvas"),this.h()},l(l){e=S(l,"CANVAS",{class:!0}),L(e).forEach(_),this.h()},h(){b(e,"class","fixed left-0 top-[2em]")},m(l,i){M(l,e,i),n[3](e),t||(s=B(e,"mousedown",n[1]),t=!0)},p:z,i:z,o:z,d(l){l&&_(e),n[3](null),t=!1,s()}}}function pt(n,e,t){let{problemId:s}=e,l,i;function o(r){setTimeout(()=>{i.dragStart(r)})}function a(r){ie[r?"unshift":"push"](()=>{l=r,t(0,l),t(2,s)})}return n.$$set=r=>{"problemId"in r&&t(2,s=r.problemId)},n.$$.update=()=>{n.$$.dirty&5&&J.files.get(s).then(r=>{r!=null&&r.question&&(t(0,l.width=r.question.width,l),t(0,l.height=r.question.height,l),l.getContext("2d").putImageData(r.question,0,0))})},[l,o,s,a]}class gt extends ee{constructor(e){super(),te(this,e,pt,dt,$,{problemId:2})}}function Me(n,e,t){const s=n.slice();return s[9]=e[t],s}function Te(n){let e,t=n[9]+"",s;return{c(){e=Z("/"),s=Z(t)},l(l){e=x(l,"/"),s=x(l,t)},m(l,i){M(l,e,i),M(l,s,i)},p(l,i){i&4&&t!==(t=l[9]+"")&&he(s,t)},d(l){l&&(_(e),_(s))}}}function _t(n){let e,t,s,l,i,o,a,r,f,h,m,c,I,T,D,E,C,w,g,u,v;t=new gt({props:{problemId:n[0]}}),l=new st({props:{selectedTool:n[4],problemId:n[0],attemptId:n[3]}});let k=ne(n[2].params.path.split("/")),N=[];for(let d=0;d<k.length;d+=1)N[d]=Te(Me(n,k,d));return T=new at({props:{problemId:n[0],problemRoute:n[1]}}),C=new et({props:{selected:n[4]}}),u=new mt({props:{problemId:n[0]}}),{c(){e=j(),F(t.$$.fragment),s=j(),F(l.$$.fragment),i=j(),o=y("div"),a=y("div"),r=y("a"),f=Z("üè†"),m=j();for(let d=0;d<N.length;d+=1)N[d].c();c=j(),I=y("div"),F(T.$$.fragment),D=j(),E=y("div"),F(C.$$.fragment),w=j(),g=y("div"),F(u.$$.fragment),this.h()},l(d){Ue("svelte-pyemm1",document.head).forEach(_),e=O(d),Y(t.$$.fragment,d),s=O(d),Y(l.$$.fragment,d),i=O(d),o=S(d,"DIV",{id:!0,class:!0});var p=L(o);a=S(p,"DIV",{id:!0,class:!0});var q=L(a);r=S(q,"A",{href:!0});var U=L(r);f=x(U,"üè†"),U.forEach(_),m=O(q);for(let me=0;me<N.length;me+=1)N[me].l(q);q.forEach(_),c=O(p),I=S(p,"DIV",{id:!0,class:!0});var oe=L(I);Y(T.$$.fragment,oe),oe.forEach(_),D=O(p),E=S(p,"DIV",{id:!0,class:!0});var P=L(E);Y(C.$$.fragment,P),P.forEach(_),w=O(p),g=S(p,"DIV",{id:!0,class:!0});var ae=L(g);Y(u.$$.fragment,ae),ae.forEach(_),p.forEach(_),this.h()},h(){document.title="MathMan Draw",b(r,"href",h=se.join("/",le,n[2].params.path)),b(a,"id","breadcrumbs"),b(a,"class","svelte-1edzgew"),b(I,"id","question-management"),b(I,"class","text-right svelte-1edzgew"),b(E,"id","tools-container"),b(E,"class","svelte-1edzgew"),b(g,"id","attempts-container"),b(g,"class","flex flex-col p-3 gap-3 svelte-1edzgew"),b(o,"id","grid"),b(o,"class","svelte-1edzgew")},m(d,Q){M(d,e,Q),G(t,d,Q),M(d,s,Q),G(l,d,Q),M(d,i,Q),M(d,o,Q),A(o,a),A(a,r),A(r,f),A(a,m);for(let p=0;p<N.length;p+=1)N[p]&&N[p].m(a,null);A(o,c),A(o,I),G(T,I,null),A(o,D),A(o,E),G(C,E,null),A(o,w),A(o,g),G(u,g,null),v=!0},p(d,[Q]){const p={};Q&1&&(p.problemId=d[0]),t.$set(p);const q={};if(Q&1&&(q.problemId=d[0]),Q&8&&(q.attemptId=d[3]),l.$set(q),(!v||Q&4&&h!==(h=se.join("/",le,d[2].params.path)))&&b(r,"href",h),Q&4){k=ne(d[2].params.path.split("/"));let P;for(P=0;P<k.length;P+=1){const ae=Me(d,k,P);N[P]?N[P].p(ae,Q):(N[P]=Te(ae),N[P].c(),N[P].m(a,null))}for(;P<N.length;P+=1)N[P].d(1);N.length=k.length}const U={};Q&1&&(U.problemId=d[0]),Q&2&&(U.problemRoute=d[1]),T.$set(U);const oe={};Q&1&&(oe.problemId=d[0]),u.$set(oe)},i(d){v||(W(t.$$.fragment,d),W(l.$$.fragment,d),W(T.$$.fragment,d),W(C.$$.fragment,d),W(u.$$.fragment,d),v=!0)},o(d){H(t.$$.fragment,d),H(l.$$.fragment,d),H(T.$$.fragment,d),H(C.$$.fragment,d),H(u.$$.fragment,d),v=!1},d(d){d&&(_(e),_(s),_(i),_(o)),X(t,d),X(l,d),qe(N,d),X(T),X(C),X(u)}}}function bt(n,e,t){let s,l,i;K(n,ue,c=>t(2,l=c));const o=_e(V.None),a=_e(!1);ye("eraserEnabled",a);const r=be(ue,c=>c.data.problemId);K(n,r,c=>t(0,s=c));const f=be(ue,c=>Number.parseInt(c.url.searchParams.get("attempt")??"1")-1);K(n,f,c=>t(3,i=c));let h;function m(c){s!==0&&(c?(t(1,h=c.route),h.startsWith(l.params.path)||re(se.join("/",le,h,l.params.problemId))):re(se.join("/",le,l.params.path)))}return n.$$.update=()=>{n.$$.dirty&1&&J.files.get(s).then(m)},[s,h,l,i,o,r,f]}class Dt extends ee{constructor(e){super(),te(this,e,bt,_t,$,{})}}export{Dt as component};
