import{s as ee,n as U,f as ue,e as Z,m as Re,k as ye,o as Se,j as qe,b as ie,p as je,r as Fe}from"../chunks/scheduler.d208cd37.js";import{S as te,i as ne,s as V,g as y,c as O,h as S,C as oe,k as w,l as R,a as D,A as H,D as Ae,f as _,j as L,x as q,r as G,m as x,u as X,n as $,v as J,d as B,t as z,w as K,E as ge,o as fe,y as Le,F as he,G as Ue,p as Pe,b as We,B as He}from"../chunks/index.8c8d301a.js";import{e as re,u as Qe,d as Be,o as ze}from"../chunks/each.8e1ff643.js";import{j as Ye,w as _e,k as be}from"../chunks/singletons.0faa33c2.js";import{a as de,d as Y,u as Ve,D as Ge,b as pe}from"../chunks/db.cd2f8b65.js";import{p as ae}from"../chunks/stores.0afcb3e7.js";var Q=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Select=4]="Select",n))(Q||{});const Xe=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function we(n){let e,t="Show Solution";return{c(){e=y("button"),e.textContent=t,this.h()},l(s){e=S(s,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),oe(e)!=="svelte-on8fyx"&&(e.textContent=t),this.h()},h(){w(e,"class","border text-center"),R(e,"position","fixed"),R(e,"left",n[1][0]+"px"),R(e,"top",n[1][1]+"px"),R(e,"width",n[2][0]-n[1][0]+"px"),R(e,"height",n[2][1]-n[1][1]+"px")},m(s,l){D(s,e,l)},p(s,l){l&2&&R(e,"left",s[1][0]+"px"),l&2&&R(e,"top",s[1][1]+"px"),l&6&&R(e,"width",s[2][0]-s[1][0]+"px"),l&6&&R(e,"height",s[2][1]-s[1][1]+"px")},d(s){s&&_(e)}}}function Je(n){let e,t,s='<div style="background-color: green">✅</div>',l,a,i=n[1][1]&&we(n);return{c(){i&&i.c(),e=V(),t=y("div"),t.innerHTML=s,this.h()},l(o){i&&i.l(o),e=O(o),t=S(o,"DIV",{class:!0,"data-svelte-h":!0}),oe(t)!=="svelte-aiv1v7"&&(t.innerHTML=s),this.h()},h(){w(t,"class","tool"),R(t,"height",n[0]?"100%":"30px")},m(o,r){i&&i.m(o,r),D(o,e,r),D(o,t,r),l||(a=H(t,"pointerdown",Ae(n[8])),l=!0)},p(o,[r]){o[1][1]?i?i.p(o,r):(i=we(o),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),r&1&&R(t,"height",o[0]?"100%":"30px")},i:U,o:U,d(o){o&&(_(e),_(t)),i&&i.d(o),l=!1,a()}}}function Ke(n,e,t){let s;const l=Q.Select;let a=!1,i=!1,o=[],r=[],u,m,p=ue("selection");Z(n,p,v=>t(7,s=v)),window.addEventListener("pointerdown",v=>{a&&(i=!0,t(5,o=t(6,r=[v.x,v.y])))}),window.addEventListener("pointermove",v=>{i&&t(6,r=[v.x,v.y])}),window.addEventListener("pointerup",()=>{i=!1});const h=()=>p.set(a?Q.None:l);return n.$$.update=()=>{n.$$.dirty&128&&t(0,a=s===l),n.$$.dirty&96&&(t(1,u=[Math.min(o[0],r[0]),Math.min(o[1],r[1])]),t(2,m=[Math.max(o[0],r[0]),Math.max(o[1],r[1])]))},[a,u,m,l,p,o,r,s,h]}class Ze extends te{constructor(e){super(),ne(this,e,Ke,Je,ee,{})}}const xe=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href;function $e(n){let e,t,s,l,a;return{c(){e=y("div"),t=y("img"),this.h()},l(i){e=S(i,"DIV",{class:!0});var o=L(e);t=S(o,"IMG",{style:!0,src:!0,title:!0,draggable:!0}),o.forEach(_),this.h()},h(){R(t,"filter",n[1]),Re(t.src,s=xe)||w(t,"src",s),w(t,"title",n[2]),w(t,"draggable","false"),w(e,"class","tool"),R(e,"height",n[3]?"100%":"30px")},m(i,o){D(i,e,o),q(e,t),l||(a=H(e,"pointerdown",Ae(n[6])),l=!0)},p(i,[o]){o&2&&R(t,"filter",i[1]),o&4&&w(t,"title",i[2]),o&8&&R(e,"height",i[3]?"100%":"30px")},i:U,o:U,d(i){i&&_(e),l=!1,a()}}}function et(n,e,t){let s,{tool:l}=e,{filter:a=""}=e,{title:i}=e,o=ue("selection");Z(n,o,m=>t(5,s=m));let r=!1;const u=()=>o.set(r?Q.None:l);return n.$$set=m=>{"tool"in m&&t(0,l=m.tool),"filter"in m&&t(1,a=m.filter),"title"in m&&t(2,i=m.title)},n.$$.update=()=>{n.$$.dirty&33&&t(3,r=s===l)},[l,a,i,r,o,s,u]}class me extends te{constructor(e){super(),ne(this,e,et,$e,ee,{tool:0,filter:1,title:2})}}function tt(n){let e,t,s,l,a,i,o,r,u,m,p,h,v,T,N=`<img src="${Xe}" title="Eraser" draggable="false" class="svelte-h3rgmi"/>`,A,E,j;return t=new Ze({}),r=new me({props:{tool:Q.Draw,filter:"grayscale(1)",title:"Your work"}}),m=new me({props:{tool:Q.Correct,filter:"hue-rotate(136deg)",title:"Correct"}}),h=new me({props:{tool:Q.Question,title:"Question"}}),{c(){e=y("div"),G(t.$$.fragment),s=V(),l=y("a"),a=x("📷"),o=V(),G(r.$$.fragment),u=V(),G(m.$$.fragment),p=V(),G(h.$$.fragment),v=V(),T=y("div"),T.innerHTML=N,this.h()},l(g){e=S(g,"DIV",{id:!0,class:!0});var C=L(e);X(t.$$.fragment,C),s=O(C),l=S(C,"A",{href:!0});var W=L(l);a=$(W,"📷"),W.forEach(_),o=O(C),X(r.$$.fragment,C),u=O(C),X(m.$$.fragment,C),p=O(C),X(h.$$.fragment,C),v=O(C),T=S(C,"DIV",{class:!0,"data-svelte-h":!0}),oe(T)!=="svelte-19p7wft"&&(T.innerHTML=N),C.forEach(_),this.h()},h(){w(l,"href",i=de("camera",n[1].params.problemId)),w(T,"class","tool"),R(T,"height",n[0]?"100%":"30px"),w(e,"id","tools"),w(e,"class","svelte-h3rgmi")},m(g,C){D(g,e,C),J(t,e,null),q(e,s),q(e,l),q(l,a),q(e,o),J(r,e,null),q(e,u),J(m,e,null),q(e,p),J(h,e,null),q(e,v),q(e,T),A=!0,E||(j=H(T,"click",n[3]),E=!0)},p(g,[C]){(!A||C&2&&i!==(i=de("camera",g[1].params.problemId)))&&w(l,"href",i),C&1&&R(T,"height",g[0]?"100%":"30px")},i(g){A||(B(t.$$.fragment,g),B(r.$$.fragment,g),B(m.$$.fragment,g),B(h.$$.fragment,g),A=!0)},o(g){z(t.$$.fragment,g),z(r.$$.fragment,g),z(m.$$.fragment,g),z(h.$$.fragment,g),A=!1},d(g){g&&_(e),K(t),K(r),K(m),K(h),E=!1,j()}}}function nt(n,e,t){let s,l;Z(n,ae,r=>t(1,l=r));let{selected:a}=e;ye("selection",a);let i=ue("eraserEnabled");Z(n,i,r=>t(0,s=r));function o(r){i.set(!s)}return n.$$set=r=>{"selected"in r&&t(4,a=r.selected)},[s,l,i,o,a]}class st extends te{constructor(e){super(),ne(this,e,nt,tt,ee,{selected:4})}}function rt(n){let e,t,s,l,a,i,o;return{c(){e=y("canvas"),t=V(),s=y("canvas"),l=V(),a=y("canvas"),this.h()},l(r){e=S(r,"CANVAS",{width:!0,height:!0,class:!0}),L(e).forEach(_),t=O(r),s=S(r,"CANVAS",{width:!0,height:!0,class:!0}),L(s).forEach(_),l=O(r),a=S(r,"CANVAS",{width:!0,height:!0,class:!0}),L(a).forEach(_),this.h()},h(){w(e,"width",n[2]),w(e,"height",n[3]),w(e,"class","svelte-1rofrvo"),w(s,"width",n[2]),w(s,"height",n[3]),w(s,"class","svelte-1rofrvo"),w(a,"width",n[2]),w(a,"height",n[3]),w(a,"class","svelte-1rofrvo")},m(r,u){D(r,e,u),n[8](e),D(r,t,u),D(r,s,u),n[9](s),D(r,l,u),D(r,a,u),n[10](a),i||(o=H(a,"pointerdown",n[5]),i=!0)},p(r,[u]){u&4&&w(e,"width",r[2]),u&8&&w(e,"height",r[3]),u&4&&w(s,"width",r[2]),u&8&&w(s,"height",r[3]),u&4&&w(a,"width",r[2]),u&8&&w(a,"height",r[3])},i:U,o:U,d(r){r&&(_(e),_(t),_(s),_(l),_(a)),n[8](null),n[9](null),n[10](null),i=!1,o()}}}function lt(n,e,t){let s,l=U,a=()=>(l(),l=qe(o,c=>t(13,s=c)),o),i;n.$$.on_destroy.push(()=>l());let{selectedTool:o}=e;a();let{problemId:r}=e,{attemptId:u}=e,m=0,p=0,h=!1,v=ue("eraserEnabled");Z(n,v,c=>t(14,i=c));let T,N=[];function A(){typeof window>"u"||r===0||(t(2,m=window.innerWidth),t(3,p=window.innerHeight),requestAnimationFrame(async()=>{if(N[0]==null)return;const c=(await Y.files.get(r)).attempts[u];N[Q.Draw].putImageData(c.work,0,0),N[Q.Correct].putImageData(c.error,0,0),N[Q.Question].putImageData(c.questions,0,0)}))}const E=()=>{const c=[0,0,m,p];Y.files.update(r,k=>{const F=k.attempts[u];F.date=new Date,F.duration=Math.floor((new Date().getTime()-T)/1e3/60),s==Q.Correct&&(F.mistakeCount=1),s==Q.Question&&(F.questionCount=1),F[["work","error","questions"][s]]=N[s].getImageData(...c)})},j=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,g={[Q.Draw]:j?"white":"black",[Q.Correct]:"red",[Q.Question]:"blue"},C=c=>{if(s>=Q.None)return;const k=N[s];h=!0,k.strokeStyle=g[s],k.lineWidth=i?20:1,k.globalCompositeOperation=i?"destination-out":"source-over",k.beginPath(),k.moveTo(c.clientX,c.clientY)},W=()=>{h&&E(),h=!1},I=c=>{if(h){const k=N[s];k.lineTo(c.clientX,c.clientY),k.stroke()}};Se(()=>{window.addEventListener("resize",A),document.addEventListener("pointermove",I),document.addEventListener("pointerup",W),t(1,N=N.map(c=>c.getContext("2d",{willReadFrequently:!0})))});function b(c){ie[c?"unshift":"push"](()=>{N[Q.Draw]=c,t(1,N)})}function d(c){ie[c?"unshift":"push"](()=>{N[Q.Correct]=c,t(1,N)})}function f(c){ie[c?"unshift":"push"](()=>{N[Q.Question]=c,t(1,N)})}return n.$$set=c=>{"selectedTool"in c&&a(t(0,o=c.selectedTool)),"problemId"in c&&t(6,r=c.problemId),"attemptId"in c&&t(7,u=c.attemptId)},n.$$.update=()=>{if(n.$$.dirty&194){A(),T=new Date().getTime();for(const c of N){const k=c.canvas;c.clearRect(0,0,k.width,k.height)}}},[o,N,m,p,v,C,r,u,b,d,f]}class ot extends te{constructor(e){super(),ne(this,e,lt,rt,ee,{selectedTool:0,problemId:6,attemptId:7})}}const le=Ye("goto");function Oe(n){const e=new URLSearchParams(location.search);for(const[t,s]of Object.entries(n))e.set(t,s);return"?"+e.toString()}function it(n,e){const t=Number.parseFloat(n),s=Number.parseFloat(e);if(isNaN(t)&&!isNaN(s))return-1;if(isNaN(s)&&!isNaN(t))return 1;const l=t-s;return isNaN(l)?n.localeCompare(e):l}function ve(n,e,t){const s=n.slice();return s[19]=e[t],s[21]=t,s}function ke(n,e,t){const s=n.slice();return s[22]=e[t],s}function Ie(n){let e,t="🧠 Resolve questions",s,l;return{c(){e=y("button"),e.textContent=t},l(a){e=S(a,"BUTTON",{"data-svelte-h":!0}),oe(e)!=="svelte-ykge1i"&&(e.textContent=t)},m(a,i){D(a,e,i),s||(l=H(e,"click",n[11]),s=!0)},p:U,d(a){a&&_(e),s=!1,l()}}}function Ce(n){let e,t=n[6][n[22]]+"",s;return{c(){e=y("option"),s=x(t),this.h()},l(l){e=S(l,"OPTION",{});var a=L(e);s=$(a,t),a.forEach(_),this.h()},h(){e.__value=n[22],he(e,e.__value)},m(l,a){D(l,e,a),q(e,s)},p:U,d(l){l&&_(e)}}}function Ee(n,e){let t,s=e[19].name+"",l,a,i;return{key:n,first:null,c(){t=y("option"),l=x(s),this.h()},l(o){t=S(o,"OPTION",{});var r=L(t);l=$(r,s),r.forEach(_),this.h()},h(){t.__value=a=e[21],he(t,t.__value),t.selected=i=e[19].id===e[0],this.first=t},m(o,r){D(o,t,r),q(t,l)},p(o,r){e=o,r&16&&s!==(s=e[19].name+"")&&fe(l,s),r&16&&a!==(a=e[21])&&(t.__value=a,he(t,t.__value)),r&17&&i!==(i=e[19].id===e[0])&&(t.selected=i)},d(o){o&&_(t)}}}function at(n){var I,b,d;let e,t,s=n[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️",l,a,i,o,r,u,m=[],p=new Map,h,v,T="➡️",N,A,E=((d=(b=(I=n[4][n[2]])==null?void 0:I.attempts)==null?void 0:b[n[1]])==null?void 0:d.questions)>0&&Ie(n),j=re(Object.keys(n[6])),g=[];for(let f=0;f<j.length;f+=1)g[f]=Ce(ke(n,j,f));let C=re(n[4]);const W=f=>f[19].id;for(let f=0;f<C.length;f+=1){let c=ve(n,C,f),k=W(c);p.set(k,m[f]=Ee(k,c))}return{c(){E&&E.c(),e=V(),t=y("button"),l=x(s),i=V(),o=y("select");for(let f=0;f<g.length;f+=1)g[f].c();r=V(),u=y("select");for(let f=0;f<m.length;f+=1)m[f].c();h=V(),v=y("button"),v.textContent=T,this.h()},l(f){E&&E.l(f),e=O(f),t=S(f,"BUTTON",{title:!0});var c=L(t);l=$(c,s),c.forEach(_),i=O(f),o=S(f,"SELECT",{});var k=L(o);for(let P=0;P<g.length;P+=1)g[P].l(k);k.forEach(_),r=O(f),u=S(f,"SELECT",{});var F=L(u);for(let P=0;P<m.length;P+=1)m[P].l(F);F.forEach(_),h=O(f),v=S(f,"BUTTON",{"data-svelte-h":!0}),oe(v)!=="svelte-1wjt799"&&(v.textContent=T),this.h()},h(){w(t,"title",a=(n[5]?"un":"")+"flag for later"),n[3]===void 0&&je(()=>n[15].call(o))},m(f,c){E&&E.m(f,c),D(f,e,c),D(f,t,c),q(t,l),D(f,i,c),D(f,o,c);for(let k=0;k<g.length;k+=1)g[k]&&g[k].m(o,null);ge(o,n[3],!0),D(f,r,c),D(f,u,c);for(let k=0;k<m.length;k+=1)m[k]&&m[k].m(u,null);D(f,h,c),D(f,v,c),N||(A=[H(t,"click",n[9]),H(o,"change",n[15]),H(u,"change",n[7]),H(v,"click",n[8])],N=!0)},p(f,[c]){var k,F,P;if(((P=(F=(k=f[4][f[2]])==null?void 0:k.attempts)==null?void 0:F[f[1]])==null?void 0:P.questions)>0?E?E.p(f,c):(E=Ie(f),E.c(),E.m(e.parentNode,e)):E&&(E.d(1),E=null),c&32&&s!==(s=f[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️")&&fe(l,s),c&32&&a!==(a=(f[5]?"un":"")+"flag for later")&&w(t,"title",a),c&64){j=re(Object.keys(f[6]));let M;for(M=0;M<j.length;M+=1){const se=ke(f,j,M);g[M]?g[M].p(se,c):(g[M]=Ce(se),g[M].c(),g[M].m(o,null))}for(;M<g.length;M+=1)g[M].d(1);g.length=j.length}c&72&&ge(o,f[3]),c&17&&(C=re(f[4]),m=Qe(m,c,W,1,f,C,p,u,Be,Ee,null,ve))},i:U,o:U,d(f){f&&(_(e),_(t),_(i),_(o),_(r),_(u),_(h),_(v)),E&&E.d(f),Le(g,f);for(let c=0;c<m.length;c+=1)m[c].d();N=!1,Fe(A)}}}function ut(n,e,t){let s,l;Z(n,ae,I=>t(14,l=I));var a=(I=>(I.Work="Work",I.Mistakes="Mistakes",I.Questions="Questions",I))(a||{});let{problemRoute:i}=e,{problemId:o}=e,r=-1,u=0,m=l.url.searchParams.get("studyMode")??"Work",p=!1,h;function v(I){t(2,u=Number.parseInt(I.target.value)),t(1,r=-1),A()}function T(){return g[u].attempts.findIndex((I,b)=>I.questions>0&&b>r)}function N(){const I=r;if((m!=="Questions"||T()===-1)&&(t(2,u++,u),t(1,r=-1)),u>=g.length)if(m==="Work"){const b=Array.from(h.matchAll(/\d+/g)).at(-1);let d;b!=null&&(d=h.substring(0,b.index)+(Number.parseInt(b[0])+1)+h.substring(b.index+b[0].length)),Y.newFile({basePath:l.params.path,route:d}).then(f=>{f>=0&&le(String(f))})}else{alert("Hooray! You are done!"),t(2,u--,u),t(1,r=I);return}A()}function A(){t(1,r=m=="Questions"?T():g[u].attempts.length-1)}function E(){t(5,p=!p),Y.files.update(o,{flagged:p})}const j=Ve(()=>Y.files.where("route").startsWith(l.params.path).toArray().then(I=>I.map(b=>({id:b.id,route:b.route,name:b.name,flagged:b.flagged,attempts:b.attempts.map(d=>({questions:d.questionCount,mistakes:d.mistakeCount}))}))));Z(n,j,I=>t(13,s=I));let g=[];function C(){Y.files.update(o,I=>{I.attempts[r].questionCount=0}),N()}function W(){m=Ue(this),t(3,m),t(6,a)}return n.$$set=I=>{"problemRoute"in I&&t(12,i=I.problemRoute),"problemId"in I&&t(0,o=I.problemId)},n.$$.update=()=>{var I;if(n.$$.dirty&16384&&t(1,r=l.data.attemptIdx),n.$$.dirty&12296){const b=s??[];switch(m){case"Work":t(4,g=b.filter(d=>d.route===i).sort((d,f)=>it(d.name,f.name)));break;case"Mistakes":t(4,g=b.filter(d=>d.attempts.at(-1).mistakes>0||d.flagged));break;case"Questions":t(4,g=b.filter(d=>d.attempts.some(f=>f.questions>0)));break}}if(n.$$.dirty&17&&t(2,u=Math.max(0,g.findIndex(b=>b.id===o))),n.$$.dirty&30){const b=(I=g[u])==null?void 0:I.id;b&&le(String(b)+Oe({studyMode:m,attempt:String(r+1)}))}n.$$.dirty&1&&Y.files.get(o).then(b=>{t(5,p=(b==null?void 0:b.flagged)??!1),h=(b==null?void 0:b.name)??""})},[o,r,u,m,g,p,a,v,N,E,j,C,i,s,l,W]}class ft extends te{constructor(e){super(),ne(this,e,ut,at,ee,{problemRoute:12,problemId:0})}}function ct(n){let e,t,s,l,a=n[0]+1+"",i;return{c(){e=y("div"),t=y("canvas"),l=x(`
    Attempt `),i=x(a),this.h()},l(o){e=S(o,"DIV",{class:!0});var r=L(e);t=S(r,"CANVAS",{width:!0,height:!0}),L(t).forEach(_),l=$(r,`
    Attempt `),i=$(r,a),r.forEach(_),this.h()},h(){w(t,"width",n[1]),w(t,"height",s=n[1]-24),w(e,"class","text-center bg-gray-50 rounded-md"),R(e,"width",n[1]+"px")},m(o,r){D(o,e,r),q(e,t),n[4](t),q(e,l),q(e,i)},p(o,[r]){r&2&&w(t,"width",o[1]),r&2&&s!==(s=o[1]-24)&&w(t,"height",s),r&1&&a!==(a=o[0]+1+"")&&fe(i,a),r&2&&R(e,"width",o[1]+"px")},i:U,o:U,d(o){o&&_(e),n[4](null)}}}function mt(n,e,t){let{attempt:s}=e,{idx:l}=e,{size:a=100}=e,i;function o(u,m){const p=document.createElement("canvas");p.width=m[0].width,p.height=m[0].height,u.scale(a/p.width,(a-24)/p.height);for(const h of m)p.getContext("2d").putImageData(h,0,0),u.drawImage(p,0,0)}Se(async()=>{const u=i.getContext("2d");o(u,[s.work,s.error,s.questions])});function r(u){ie[u?"unshift":"push"](()=>{i=u,t(2,i)})}return n.$$set=u=>{"attempt"in u&&t(3,s=u.attempt),"idx"in u&&t(0,l=u.idx),"size"in u&&t(1,a=u.size)},[l,a,i,s,r]}class ht extends te{constructor(e){super(),ne(this,e,mt,ct,ee,{attempt:3,idx:0,size:1})}}function De(n,e,t){const s=n.slice();return s[5]=e[t],s[7]=t,s}function Ne(n,e){let t,s,l,a,i;s=new ht({props:{attempt:e[5],idx:e[7]}});function o(){return e[4](e[7])}return{key:n,first:null,c(){t=y("button"),G(s.$$.fragment),this.h()},l(r){t=S(r,"BUTTON",{});var u=L(t);X(s.$$.fragment,u),u.forEach(_),this.h()},h(){this.first=t},m(r,u){D(r,t,u),J(s,t,null),l=!0,a||(i=H(t,"click",o),a=!0)},p(r,u){e=r;const m={};u&4&&(m.attempt=e[5]),u&4&&(m.idx=e[7]),s.$set(m)},i(r){l||(B(s.$$.fragment,r),l=!0)},o(r){z(s.$$.fragment,r),l=!1},d(r){r&&_(t),K(s),a=!1,i()}}}function dt(n){let e=[],t=new Map,s,l,a=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">➕</div>
    New Attempt`,i,o,r,u=re(n[2]??[]);const m=p=>""+p[0]+p[7];for(let p=0;p<u.length;p+=1){let h=De(n,u,p),v=m(h);t.set(v,e[p]=Ne(v,h))}return{c(){for(let p=0;p<e.length;p+=1)e[p].c();s=V(),l=y("button"),l.innerHTML=a,this.h()},l(p){for(let h=0;h<e.length;h+=1)e[h].l(p);s=O(p),l=S(p,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(l)!=="svelte-1goxpwn"&&(l.innerHTML=a),this.h()},h(){w(l,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(p,h){for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(p,h);D(p,s,h),D(p,l,h),i=!0,o||(r=H(l,"click",n[3]),o=!0)},p(p,[h]){h&5&&(u=re(p[2]??[]),Pe(),e=Qe(e,h,m,1,p,u,t,s.parentNode,ze,Ne,s,De),We())},i(p){if(!i){for(let h=0;h<u.length;h+=1)B(e[h]);i=!0}},o(p){for(let h=0;h<e.length;h+=1)z(e[h]);i=!1},d(p){p&&(_(s),_(l));for(let h=0;h<e.length;h+=1)e[h].d(p);o=!1,r()}}}function pt(n,e,t){let s,l=U,a=()=>(l(),l=qe(o,m=>t(2,s=m)),o);n.$$.on_destroy.push(()=>l());let{problemId:i}=e,o;function r(){Y.files.update(i,m=>{le("?attempt="+m.attempts.push(Ge.newBlankAttempt()))})}const u=m=>le(Oe({attempt:String(m+1)}));return n.$$set=m=>{"problemId"in m&&t(0,i=m.problemId)},n.$$.update=()=>{n.$$.dirty&1&&a(t(1,o=Ve(()=>Y.files.get(i).then(m=>m.attempts))))},[i,o,s,r,u]}class gt extends te{constructor(e){super(),ne(this,e,pt,dt,ee,{problemId:0})}}function _t(n){let e,t,s;return{c(){e=y("canvas"),this.h()},l(l){e=S(l,"CANVAS",{class:!0}),L(e).forEach(_),this.h()},h(){w(e,"class","fixed left-0 top-[2em]")},m(l,a){D(l,e,a),n[3](e),t||(s=H(e,"mousedown",n[1]),t=!0)},p:U,i:U,o:U,d(l){l&&_(e),n[3](null),t=!1,s()}}}function bt(n,e,t){let{problemId:s}=e,l,a;function i(r){setTimeout(()=>{a.dragStart(r)})}function o(r){ie[r?"unshift":"push"](()=>{l=r,t(0,l),t(2,s)})}return n.$$set=r=>{"problemId"in r&&t(2,s=r.problemId)},n.$$.update=()=>{n.$$.dirty&5&&Y.files.get(s).then(r=>{r!=null&&r.question&&(t(0,l.width=r.question.width,l),t(0,l.height=r.question.height,l),l.getContext("2d").putImageData(r.question,0,0))})},[l,i,s,o]}class wt extends te{constructor(e){super(),ne(this,e,bt,_t,ee,{problemId:2})}}function Te(n,e,t){const s=n.slice();return s[9]=e[t],s}function Me(n){let e,t=n[9]+"",s;return{c(){e=x("/"),s=x(t)},l(l){e=$(l,"/"),s=$(l,t)},m(l,a){D(l,e,a),D(l,s,a)},p(l,a){a&4&&t!==(t=l[9]+"")&&fe(s,t)},d(l){l&&(_(e),_(s))}}}function vt(n){let e,t,s,l,a,i,o,r,u,m,p,h,v,T,N,A,E,j,g,C,W;t=new wt({props:{problemId:n[0]}}),l=new ot({props:{selectedTool:n[4],problemId:n[0],attemptId:n[3]}});let I=re(n[2].params.path.split("/")),b=[];for(let d=0;d<I.length;d+=1)b[d]=Me(Te(n,I,d));return T=new ft({props:{problemId:n[0],problemRoute:n[1]}}),E=new st({props:{selected:n[4]}}),C=new gt({props:{problemId:n[0]}}),{c(){e=V(),G(t.$$.fragment),s=V(),G(l.$$.fragment),a=V(),i=y("div"),o=y("div"),r=y("a"),u=x("🏠"),p=V();for(let d=0;d<b.length;d+=1)b[d].c();h=V(),v=y("div"),G(T.$$.fragment),N=V(),A=y("div"),G(E.$$.fragment),j=V(),g=y("div"),G(C.$$.fragment),this.h()},l(d){He("svelte-pyemm1",document.head).forEach(_),e=O(d),X(t.$$.fragment,d),s=O(d),X(l.$$.fragment,d),a=O(d),i=S(d,"DIV",{id:!0,class:!0});var c=L(i);o=S(c,"DIV",{id:!0,class:!0});var k=L(o);r=S(k,"A",{href:!0});var F=L(r);u=$(F,"🏠"),F.forEach(_),p=O(k);for(let ce=0;ce<b.length;ce+=1)b[ce].l(k);k.forEach(_),h=O(c),v=S(c,"DIV",{id:!0,class:!0});var P=L(v);X(T.$$.fragment,P),P.forEach(_),N=O(c),A=S(c,"DIV",{id:!0,class:!0});var M=L(A);X(E.$$.fragment,M),M.forEach(_),j=O(c),g=S(c,"DIV",{id:!0,class:!0});var se=L(g);X(C.$$.fragment,se),se.forEach(_),c.forEach(_),this.h()},h(){document.title="MathMan Draw",w(r,"href",m=pe(n[2])),w(o,"id","breadcrumbs"),w(o,"class","svelte-1je8nl3"),w(v,"id","question-management"),w(v,"class","text-right svelte-1je8nl3"),w(A,"id","tools-container"),w(A,"class","svelte-1je8nl3"),w(g,"id","attempts-container"),w(g,"class","flex flex-col p-3 gap-3 svelte-1je8nl3"),w(i,"id","grid"),w(i,"class","svelte-1je8nl3")},m(d,f){D(d,e,f),J(t,d,f),D(d,s,f),J(l,d,f),D(d,a,f),D(d,i,f),q(i,o),q(o,r),q(r,u),q(o,p);for(let c=0;c<b.length;c+=1)b[c]&&b[c].m(o,null);q(i,h),q(i,v),J(T,v,null),q(i,N),q(i,A),J(E,A,null),q(i,j),q(i,g),J(C,g,null),W=!0},p(d,[f]){const c={};f&1&&(c.problemId=d[0]),t.$set(c);const k={};if(f&1&&(k.problemId=d[0]),f&8&&(k.attemptId=d[3]),l.$set(k),(!W||f&4&&m!==(m=pe(d[2])))&&w(r,"href",m),f&4){I=re(d[2].params.path.split("/"));let M;for(M=0;M<I.length;M+=1){const se=Te(d,I,M);b[M]?b[M].p(se,f):(b[M]=Me(se),b[M].c(),b[M].m(o,null))}for(;M<b.length;M+=1)b[M].d(1);b.length=I.length}const F={};f&1&&(F.problemId=d[0]),f&2&&(F.problemRoute=d[1]),T.$set(F);const P={};f&1&&(P.problemId=d[0]),C.$set(P)},i(d){W||(B(t.$$.fragment,d),B(l.$$.fragment,d),B(T.$$.fragment,d),B(E.$$.fragment,d),B(C.$$.fragment,d),W=!0)},o(d){z(t.$$.fragment,d),z(l.$$.fragment,d),z(T.$$.fragment,d),z(E.$$.fragment,d),z(C.$$.fragment,d),W=!1},d(d){d&&(_(e),_(s),_(a),_(i)),K(t,d),K(l,d),Le(b,d),K(T),K(E),K(C)}}}function kt(n,e,t){let s,l,a;Z(n,ae,h=>t(2,l=h));const i=_e(Q.None),o=_e(!1);ye("eraserEnabled",o);const r=be(ae,h=>h.data.problemId);Z(n,r,h=>t(0,s=h));const u=be(ae,h=>h.data.attemptIdx);Z(n,u,h=>t(3,a=h));let m;function p(h){s!==0&&(h?(t(1,m=h.route),m.startsWith(l.params.path)||le(de(m,l.params.problemId))):le(pe(l)))}return n.$$.update=()=>{n.$$.dirty&1&&Y.files.get(s).then(p)},[s,m,l,a,i,r,u]}class Mt extends te{constructor(e){super(),ne(this,e,kt,vt,ee,{})}}export{Mt as component};
