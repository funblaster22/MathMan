import{s as B,n as I,b as C,q as T,e as W,o as $,v as H}from"../chunks/scheduler.d208cd37.js";import{S as M,i as O,g as _,h as g,j as b,f as d,k as z,l as D,a as x,z as k,C as q,J as N,s as V,r as P,c as j,u as R,v as S,d as U,t as A,w as F}from"../chunks/index.13b201f4.js";import{d as J}from"../chunks/db.011a468d.js";import{p as X}from"../chunks/stores.30bfc001.js";function Y(c){let t,o,a,n;return{c(){t=_("div"),o=_("div"),this.h()},l(e){t=g(e,"DIV",{class:!0});var i=b(t);o=g(i,"DIV",{class:!0}),b(o).forEach(d),i.forEach(d),this.h()},h(){z(o,"class","absolute right-0 bottom-0 w-5 h-5 bg-red-50 cursor-nw-resize svelte-1o3tvyk"),z(t,"class","relative overflow-auto border min-w-12 min-h-12 svelte-1o3tvyk"),D(t,"width",c[0][0]+"px"),D(t,"height",c[0][1]+"px")},m(e,i){x(e,t,i),k(t,o),a||(n=q(o,"pointerdown",c[1]),a=!0)},p(e,[i]){i&1&&D(t,"width",e[0][0]+"px"),i&1&&D(t,"height",e[0][1]+"px")},i:I,o:I,d(e){e&&d(t),a=!1,n()}}}function G(){document.onpointermove=document.onpointerup=null}function K(c,t,o){let{size:a=[170,70]}=t;function n(){document.onpointermove=e,document.onpointerup=G}function e(i){o(0,a[0]+=i.movementX,a),o(0,a[1]+=i.movementY,a)}return c.$$set=i=>{"size"in i&&o(0,a=i.size)},[a,n]}class L extends M{constructor(t){super(),O(this,t,K,Y,B,{size:0})}}function Q(c){let t,o,a,n,e,i,w,u,m,r,h,f;function p(s){c[4](s)}let y={};return c[1]!==void 0&&(y.size=c[1]),e=new L({props:y}),C.push(()=>N(e,"size",p)),{c(){t=_("div"),o=_("video"),a=V(),n=_("div"),P(e.$$.fragment),w=V(),u=_("div"),m=_("button"),this.h()},l(s){t=g(s,"DIV",{class:!0});var l=b(t);o=g(l,"VIDEO",{class:!0}),b(o).forEach(d),l.forEach(d),a=j(s),n=g(s,"DIV",{class:!0});var v=b(n);R(e.$$.fragment,v),v.forEach(d),w=j(s),u=g(s,"DIV",{class:!0});var E=b(u);m=g(E,"BUTTON",{class:!0}),b(m).forEach(d),E.forEach(d),this.h()},h(){z(o,"class","w-full"),z(t,"class","fixed inset-x-0 inset-y-0"),z(n,"class","fixed w-full h-[60vh] inset-x-0 top-0 flex items-center justify-center"),z(m,"class","rounded-full bg-gray-200 m-auto block w-12 h-12"),z(u,"class","fixed inset-x-0 bottom-12")},m(s,l){x(s,t,l),k(t,o),c[3](o),x(s,a,l),x(s,n,l),S(e,n,null),x(s,w,l),x(s,u,l),k(u,m),r=!0,h||(f=q(m,"click",c[2]),h=!0)},p(s,[l]){const v={};!i&&l&2&&(i=!0,v.size=s[1],T(()=>i=!1)),e.$set(v)},i(s){r||(U(e.$$.fragment,s),r=!0)},o(s){A(e.$$.fragment,s),r=!1},d(s){s&&(d(t),d(a),d(n),d(w),d(u)),c[3](null),F(e),h=!1,f()}}}function Z(c,t,o){let a;W(c,X,r=>o(5,a=r));let n,e;$(()=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(r=>{o(0,n.srcObject=r,n),n.play()}).catch(r=>{console.error(`An error occurred: ${r}`)})}),H(()=>{n.srcObject.getVideoTracks()[0].stop()});function i(r){const[h,f]=[n.videoWidth,n.videoHeight],p=document.createElement("canvas");p.width=h,p.height=f;const y=p.getContext("2d");y.drawImage(n,0,0,h,f);const s=w(),l=h/window.innerWidth,v=y.getImageData(s.x*l,s.y*l,s.width*l,s.height*l);J.files.update(Number.parseInt(a.params.problemId),{question:v}).then(()=>history.back())}function w(){const{clientWidth:r,clientHeight:h}=document.documentElement,f=r/2,p=h*.3;return{x:Math.round(f-e[0]/2),y:Math.round(p-e[1]/2),width:e[0],height:e[1]}}function u(r){C[r?"unshift":"push"](()=>{n=r,o(0,n)})}function m(r){e=r,o(1,e)}return[n,e,i,u,m]}class oe extends M{constructor(t){super(),O(this,t,Z,Q,B,{})}}export{oe as component};
