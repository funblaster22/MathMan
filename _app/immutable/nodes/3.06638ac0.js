import{s as X,n as S,r as Ee,e as te,o as De,f as Ae,b as ie}from"../chunks/scheduler.75de2e2f.js";import{S as $,i as G,g as I,m as x,s as M,h as C,j as y,n as Y,f as g,c as V,A as O,k as p,l as B,a as D,x as b,B as Q,y as he,C as pe,o as me,d as j,p as ye,b as Te,t as R,r as J,u as K,v as Z,w as ee,z as qe}from"../chunks/index.141df97b.js";import{p as ne,e as se,n as Me}from"../chunks/index.83e76776.js";import{e as ae,j as Ve,w as Ne,k as ge}from"../chunks/singletons.e8b0b2c2.js";import{p as ce}from"../chunks/stores.e8f2cc35.js";import{d as W,u as ke}from"../chunks/db.0a5d7a2c.js";var k=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Erase=4]="Erase",n))(k||{});const fe=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href,ze=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function Le(n){let e,s,r,a,i,u,o=`<img src="${fe}" title="Your work" draggable="false"/>`,t,h,c=`<img src="${fe}" title="Correct" draggable="false"/>`,f,l,v=`<img src="${fe}" title="Question" draggable="false"/>`,_,E,L=`<img src="${ze}" title="Eraser" draggable="false"/>`,z,F;return{c(){e=I("div"),s=I("a"),r=x("üì∑"),i=M(),u=I("div"),u.innerHTML=o,t=M(),h=I("div"),h.innerHTML=c,f=M(),l=I("div"),l.innerHTML=v,_=M(),E=I("div"),E.innerHTML=L,this.h()},l(A){e=C(A,"DIV",{id:!0});var w=y(e);s=C(w,"A",{href:!0});var H=y(s);r=Y(H,"üì∑"),H.forEach(g),i=V(w),u=C(w,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),O(u)!=="svelte-1um81qx"&&(u.innerHTML=o),t=V(w),h=C(w,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),O(h)!=="svelte-lqddij"&&(h.innerHTML=c),f=V(w),l=C(w,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),O(l)!=="svelte-1ovzcqk"&&(l.innerHTML=v),_=V(w),E=C(w,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),O(E)!=="svelte-p2qgw2"&&(E.innerHTML=L),w.forEach(g),this.h()},h(){p(s,"href",a=ne.join("/",ae,"camera",n[0].params.problemId)),B(u,"width","30px"),B(u,"filter","grayscale(1)"),p(u,"data-tool",k.Draw),B(h,"width","30px"),B(h,"filter","hue-rotate(136deg)"),p(h,"data-tool",k.Correct),B(l,"width","30px"),p(l,"data-tool",k.Question),B(E,"width","30px"),p(E,"data-tool",k.Erase),p(e,"id","tools")},m(A,w){D(A,e,w),b(e,s),b(s,r),b(e,i),b(e,u),b(e,t),b(e,h),b(e,f),b(e,l),b(e,_),b(e,E),z||(F=[Q(u,"click",n[1]),Q(h,"click",n[1]),Q(l,"click",n[1]),Q(E,"click",n[2])],z=!0)},p(A,[w]){w&1&&a!==(a=ne.join("/",ae,"camera",A[0].params.problemId))&&p(s,"href",a)},i:S,o:S,d(A){A&&g(e),z=!1,Ee(F)}}}function Se(n,e,s){let r;te(n,ce,o=>s(0,r=o));let{selected:a}=e;function i(o){o.stopPropagation();const t=o.currentTarget,h=t.style.height=="100%";for(const c of document.querySelectorAll("#tools > div"))c.style.height="30px";for(const c of document.querySelectorAll(".tool"))c.id="";if(h){a.set(k.None);return}a.set(Number.parseInt(t.dataset.tool)),t.style.height="100%"}function u(o){i(o)}return n.$$set=o=>{"selected"in o&&s(3,a=o.selected)},[r,i,u,a]}class He extends ${constructor(e){super(),G(this,e,Se,Le,X,{selected:3})}}function je(n){let e,s,r,a,i,u,o;return{c(){e=I("canvas"),s=M(),r=I("canvas"),a=M(),i=I("canvas"),this.h()},l(t){e=C(t,"CANVAS",{width:!0,height:!0,class:!0}),y(e).forEach(g),s=V(t),r=C(t,"CANVAS",{width:!0,height:!0,class:!0}),y(r).forEach(g),a=V(t),i=C(t,"CANVAS",{width:!0,height:!0,class:!0}),y(i).forEach(g),this.h()},h(){p(e,"width",n[2]),p(e,"height",n[3]),p(e,"class","svelte-1rofrvo"),p(r,"width",n[2]),p(r,"height",n[3]),p(r,"class","svelte-1rofrvo"),p(i,"width",n[2]),p(i,"height",n[3]),p(i,"class","svelte-1rofrvo")},m(t,h){D(t,e,h),n[7](e),D(t,s,h),D(t,r,h),n[8](r),D(t,a,h),D(t,i,h),n[9](i),u||(o=Q(i,"pointerdown",n[4]),u=!0)},p(t,[h]){h&4&&p(e,"width",t[2]),h&8&&p(e,"height",t[3]),h&4&&p(r,"width",t[2]),h&8&&p(r,"height",t[3]),h&4&&p(i,"width",t[2]),h&8&&p(i,"height",t[3])},i:S,o:S,d(t){t&&(g(e),g(s),g(r),g(a),g(i)),n[7](null),n[8](null),n[9](null),u=!1,o()}}}function Qe(n,e,s){let r,a=S,i=()=>(a(),a=Ae(u,m=>s(11,r=m)),u);n.$$.on_destroy.push(()=>a());let{selectedTool:u}=e;i();let{problemId:o}=e,{attemptId:t}=e,h=0,c=0,f=!1,l=[];function v(){typeof window>"u"||(s(2,h=window.innerWidth),s(3,c=window.innerHeight),requestAnimationFrame(async()=>{const m=(await W.files.get(o)).attempts[t];l[k.Draw].putImageData(m.work,0,0),l[k.Correct].putImageData(m.error,0,0),l[k.Question].putImageData(m.questions,0,0)}))}function _(){const m=[0,0,h,c];W.files.update(o,d=>{d.attempts[t]={date:new Date,work:l[k.Draw].getImageData(...m),error:l[k.Correct].getImageData(...m),questions:l[k.Question].getImageData(...m),rois:d.attempts[t].rois}})}const E=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,L={[k.Draw]:E?"white":"black",[k.Correct]:"red",[k.Question]:"blue"},z=m=>{if(r==k.None)return;const d=l[r];f=!0,d.strokeStyle=L[r],d.beginPath(),d.moveTo(m.clientX,m.clientY)},F=()=>{f&&_(),f=!1},A=m=>{if(f){const d=l[r];d.lineTo(m.clientX,m.clientY),d.stroke()}};De(()=>{window.onresize=v,document.onpointermove=A,document.onpointerup=F,s(1,l=l.map(m=>m.getContext("2d",{willReadFrequently:!0})))});function w(m){ie[m?"unshift":"push"](()=>{l[k.Draw]=m,s(1,l)})}function H(m){ie[m?"unshift":"push"](()=>{l[k.Correct]=m,s(1,l)})}function P(m){ie[m?"unshift":"push"](()=>{l[k.Question]=m,s(1,l)})}return n.$$set=m=>{"selectedTool"in m&&i(s(0,u=m.selectedTool)),"problemId"in m&&s(5,o=m.problemId),"attemptId"in m&&s(6,t=m.attemptId)},n.$$.update=()=>{if(n.$$.dirty&98){v();for(const m of l){const d=m.canvas;m.clearRect(0,0,d.width,d.height)}}},[u,l,h,c,z,o,t,w,H,P]}class Fe extends ${constructor(e){super(),G(this,e,Qe,je,X,{selectedTool:0,problemId:5,attemptId:6})}}const ue=Ve("goto");function _e(n,e,s){const r=n.slice();return r[4]=e[s],r}function ve(n){let e,s=n[4].name+"",r,a;return{c(){e=I("option"),r=x(s),this.h()},l(i){e=C(i,"OPTION",{});var u=y(e);r=Y(u,s),u.forEach(g),this.h()},h(){e.__value=a=n[4].id,pe(e,e.__value)},m(i,u){D(i,e,u),b(e,r)},p(i,u){u&1&&s!==(s=i[4].name+"")&&me(r,s),u&1&&a!==(a=i[4].id)&&(e.__value=a,pe(e,e.__value))},d(i){i&&g(e)}}}function Pe(n){let e,s="üö©",r,a,i,u,o="‚û°Ô∏è",t,h,c=se(n[0]??[]),f=[];for(let l=0;l<c.length;l+=1)f[l]=ve(_e(n,c,l));return{c(){e=I("button"),e.textContent=s,r=M(),a=I("select");for(let l=0;l<f.length;l+=1)f[l].c();i=M(),u=I("button"),u.textContent=o},l(l){e=C(l,"BUTTON",{"data-svelte-h":!0}),O(e)!=="svelte-yzpet0"&&(e.textContent=s),r=V(l),a=C(l,"SELECT",{});var v=y(a);for(let _=0;_<f.length;_+=1)f[_].l(v);v.forEach(g),i=V(l),u=C(l,"BUTTON",{"data-svelte-h":!0}),O(u)!=="svelte-q61pzu"&&(u.textContent=o)},m(l,v){D(l,e,v),D(l,r,v),D(l,a,v);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(a,null);D(l,i,v),D(l,u,v),t||(h=Q(a,"change",n[1]),t=!0)},p(l,[v]){if(v&1){c=se(l[0]??[]);let _;for(_=0;_<c.length;_+=1){const E=_e(l,c,_);f[_]?f[_].p(E,v):(f[_]=ve(E),f[_].c(),f[_].m(a,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=c.length}},i:S,o:S,d(l){l&&(g(e),g(r),g(a),g(i),g(u)),he(f,l),t=!1,h()}}}function Ue(n,e,s){let r,{parentFolder:a}=e;function i(o){const t=o.target.value;ue(t)}const u=ke(()=>W.files.where({parent:a}).toArray());return te(n,u,o=>s(0,r=o)),n.$$set=o=>{"parentFolder"in o&&s(3,a=o.parentFolder)},[r,i,u,a]}class Be extends ${constructor(e){super(),G(this,e,Ue,Pe,X,{parentFolder:3})}}function Re(n){let e,s,r,a,i=n[0]+1+"",u;return{c(){e=I("div"),s=I("canvas"),a=x(`
    Attempt `),u=x(i),this.h()},l(o){e=C(o,"DIV",{class:!0});var t=y(e);s=C(t,"CANVAS",{width:!0,height:!0}),y(s).forEach(g),a=Y(t,`
    Attempt `),u=Y(t,i),t.forEach(g),this.h()},h(){p(s,"width",n[1]),p(s,"height",r=n[1]-24),p(e,"class","text-center bg-gray-50 rounded-md"),B(e,"width",n[1]+"px")},m(o,t){D(o,e,t),b(e,s),n[4](s),b(e,a),b(e,u)},p(o,[t]){t&2&&p(s,"width",o[1]),t&2&&r!==(r=o[1]-24)&&p(s,"height",r),t&1&&i!==(i=o[0]+1+"")&&me(u,i),t&2&&B(e,"width",o[1]+"px")},i:S,o:S,d(o){o&&g(e),n[4](null)}}}function Oe(n,e,s){let{attempt:r}=e,{idx:a}=e,{size:i=100}=e,u;function o(h,c){const f=document.createElement("canvas");f.width=c[0].width,f.height=c[0].height,h.scale(i/f.width,(i-24)/f.height);for(const l of c)f.getContext("2d").putImageData(l,0,0),h.drawImage(f,0,0)}De(async()=>{const h=u.getContext("2d");o(h,[r.work,r.error,r.questions])});function t(h){ie[h?"unshift":"push"](()=>{u=h,s(2,u)})}return n.$$set=h=>{"attempt"in h&&s(3,r=h.attempt),"idx"in h&&s(0,a=h.idx),"size"in h&&s(1,i=h.size)},[a,i,u,r,t]}class xe extends ${constructor(e){super(),G(this,e,Oe,Re,X,{attempt:3,idx:0,size:1})}}function we(n,e,s){const r=n.slice();return r[5]=e[s],r[7]=s,r}function be(n){let e,s,r,a,i;s=new xe({props:{attempt:n[5],idx:n[7]}});function u(){return n[4](n[7])}return{c(){e=I("div"),J(s.$$.fragment)},l(o){e=C(o,"DIV",{});var t=y(e);K(s.$$.fragment,t),t.forEach(g)},m(o,t){D(o,e,t),Z(s,e,null),r=!0,a||(i=Q(e,"click",u),a=!0)},p(o,t){n=o;const h={};t&1&&(h.attempt=n[5]),s.$set(h)},i(o){r||(j(s.$$.fragment,o),r=!0)},o(o){R(s.$$.fragment,o),r=!1},d(o){o&&g(e),ee(s),a=!1,i()}}}function Ye(n){let e,s,r=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,a,i,u,o=se(n[0]??[]),t=[];for(let c=0;c<o.length;c+=1)t[c]=be(we(n,o,c));const h=c=>R(t[c],1,1,()=>{t[c]=null});return{c(){for(let c=0;c<t.length;c+=1)t[c].c();e=M(),s=I("div"),s.innerHTML=r,this.h()},l(c){for(let f=0;f<t.length;f+=1)t[f].l(c);e=V(c),s=C(c,"DIV",{class:!0,"data-svelte-h":!0}),O(s)!=="svelte-59ttd9"&&(s.innerHTML=r),this.h()},h(){p(s,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(c,f){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(c,f);D(c,e,f),D(c,s,f),a=!0,i||(u=Q(s,"click",n[2]),i=!0)},p(c,[f]){if(f&1){o=se(c[0]??[]);let l;for(l=0;l<o.length;l+=1){const v=we(c,o,l);t[l]?(t[l].p(v,f),j(t[l],1)):(t[l]=be(v),t[l].c(),j(t[l],1),t[l].m(e.parentNode,e))}for(ye(),l=o.length;l<t.length;l+=1)h(l);Te()}},i(c){if(!a){for(let f=0;f<o.length;f+=1)j(t[f]);a=!0}},o(c){t=t.filter(Boolean);for(let f=0;f<t.length;f+=1)R(t[f]);a=!1},d(c){c&&(g(e),g(s)),he(t,c),i=!1,u()}}}function We(n,e,s){let r,{problemId:a}=e;const i=ke(()=>W.files.get(a).then(t=>t.attempts));te(n,i,t=>s(0,r=t));function u(){W.files.update(a,t=>{ue("?attempt="+t.attempts.push(Me()))})}const o=t=>ue("?attempt="+(t+1));return n.$$set=t=>{"problemId"in t&&s(3,a=t.problemId)},[r,i,u,a,o]}class Xe extends ${constructor(e){super(),G(this,e,We,Ye,X,{problemId:3})}}function $e(n){let e,s,r;return{c(){e=I("canvas"),this.h()},l(a){e=C(a,"CANVAS",{class:!0}),y(e).forEach(g),this.h()},h(){p(e,"class","fixed left-0 top-[2em]")},m(a,i){D(a,e,i),n[3](e),s||(r=Q(e,"mousedown",n[1]),s=!0)},p:S,i:S,o:S,d(a){a&&g(e),n[3](null),s=!1,r()}}}function Ge(n,e,s){let{problemId:r}=e,a,i;function u(t){t.target,setTimeout(()=>{i.dragStart(t)})}function o(t){ie[t?"unshift":"push"](()=>{a=t,s(0,a),s(2,r)})}return n.$$set=t=>{"problemId"in t&&s(2,r=t.problemId)},n.$$.update=()=>{n.$$.dirty&5&&W.files.get(r).then(t=>{t!=null&&t.question&&(s(0,a.width=t.question.width,a),s(0,a.height=t.question.height,a),a.getContext("2d").putImageData(t.question,0,0))})},[a,u,r,o]}class Je extends ${constructor(e){super(),G(this,e,Ge,$e,X,{problemId:2})}}function Ie(n,e,s){const r=n.slice();return r[7]=e[s],r}function Ce(n){let e,s=n[7]+"",r;return{c(){e=x("/"),r=x(s)},l(a){e=Y(a,"/"),r=Y(a,s)},m(a,i){D(a,e,i),D(a,r,i)},p(a,i){i&2&&s!==(s=a[7]+"")&&me(r,s)},d(a){a&&(g(e),g(r))}}}function Ke(n){let e,s,r,a,i,u,o,t,h,c,f,l,v,_,E,L,z,F,A,w,H;s=new Je({props:{problemId:n[0]}}),a=new Fe({props:{selectedTool:n[3],problemId:n[0],attemptId:n[2]}});let P=se(n[1].params.path.split("/")),m=[];for(let d=0;d<P.length;d+=1)m[d]=Ce(Ie(n,P,d));return _=new Be({props:{parentFolder:n[1].params.path.split("/").at(-1)}}),z=new He({props:{selected:n[3]}}),w=new Xe({props:{problemId:n[0]}}),{c(){e=M(),J(s.$$.fragment),r=M(),J(a.$$.fragment),i=M(),u=I("div"),o=I("div"),t=I("a"),h=x("üè†"),f=M();for(let d=0;d<m.length;d+=1)m[d].c();l=M(),v=I("div"),J(_.$$.fragment),E=M(),L=I("div"),J(z.$$.fragment),F=M(),A=I("div"),J(w.$$.fragment),this.h()},l(d){qe("svelte-pyemm1",document.head).forEach(g),e=V(d),K(s.$$.fragment,d),r=V(d),K(a.$$.fragment,d),i=V(d),u=C(d,"DIV",{id:!0,class:!0});var q=y(u);o=C(q,"DIV",{id:!0,class:!0});var U=y(o);t=C(U,"A",{href:!0});var re=y(t);h=Y(re,"üè†"),re.forEach(g),f=V(U);for(let de=0;de<m.length;de+=1)m[de].l(U);U.forEach(g),l=V(q),v=C(q,"DIV",{id:!0,class:!0});var le=y(v);K(_.$$.fragment,le),le.forEach(g),E=V(q),L=C(q,"DIV",{id:!0,class:!0});var N=y(L);K(z.$$.fragment,N),N.forEach(g),F=V(q),A=C(q,"DIV",{id:!0,class:!0});var oe=y(A);K(w.$$.fragment,oe),oe.forEach(g),q.forEach(g),this.h()},h(){document.title="MathMan Draw",p(t,"href",c=ne.join("/",ae,n[1].params.path)),p(o,"id","breadcrumbs"),p(o,"class","svelte-1edzgew"),p(v,"id","question-management"),p(v,"class","text-right svelte-1edzgew"),p(L,"id","tools-container"),p(L,"class","svelte-1edzgew"),p(A,"id","attempts-container"),p(A,"class","flex flex-col p-3 gap-3 svelte-1edzgew"),p(u,"id","grid"),p(u,"class","svelte-1edzgew")},m(d,T){D(d,e,T),Z(s,d,T),D(d,r,T),Z(a,d,T),D(d,i,T),D(d,u,T),b(u,o),b(o,t),b(t,h),b(o,f);for(let q=0;q<m.length;q+=1)m[q]&&m[q].m(o,null);b(u,l),b(u,v),Z(_,v,null),b(u,E),b(u,L),Z(z,L,null),b(u,F),b(u,A),Z(w,A,null),H=!0},p(d,[T]){const q={};T&1&&(q.problemId=d[0]),s.$set(q);const U={};if(T&1&&(U.problemId=d[0]),T&4&&(U.attemptId=d[2]),a.$set(U),(!H||T&2&&c!==(c=ne.join("/",ae,d[1].params.path)))&&p(t,"href",c),T&2){P=se(d[1].params.path.split("/"));let N;for(N=0;N<P.length;N+=1){const oe=Ie(d,P,N);m[N]?m[N].p(oe,T):(m[N]=Ce(oe),m[N].c(),m[N].m(o,null))}for(;N<m.length;N+=1)m[N].d(1);m.length=P.length}const re={};T&2&&(re.parentFolder=d[1].params.path.split("/").at(-1)),_.$set(re);const le={};T&1&&(le.problemId=d[0]),w.$set(le)},i(d){H||(j(s.$$.fragment,d),j(a.$$.fragment,d),j(_.$$.fragment,d),j(z.$$.fragment,d),j(w.$$.fragment,d),H=!0)},o(d){R(s.$$.fragment,d),R(a.$$.fragment,d),R(_.$$.fragment,d),R(z.$$.fragment,d),R(w.$$.fragment,d),H=!1},d(d){d&&(g(e),g(r),g(i),g(u)),ee(s,d),ee(a,d),he(m,d),ee(_),ee(z),ee(w)}}}function Ze(n,e,s){let r,a,i;te(n,ce,c=>s(1,a=c));const u=Ne(k.None),o=ge(ce,c=>Number.parseInt(c.params.problemId));te(n,o,c=>s(0,r=c));const t=ge(ce,c=>Number.parseInt(c.url.searchParams.get("attempt")??"1")-1);te(n,t,c=>s(2,i=c));function h(c){if(c){const f=c.route.join("/");"/"+a.params.path!==f&&ue(ne.join("/",ae,f,a.params.problemId))}else ue(ne.join("/",ae,a.params.path))}return n.$$.update=()=>{n.$$.dirty&1&&typeof window<"u"&&W.files.get(r).then(h)},[r,a,i,u,o,t]}class lt extends ${constructor(e){super(),G(this,e,Ze,Ke,X,{})}}export{lt as component};
