import{s as ue,i as He,n as X,e as ne,f as Ye,r as Je,o as Qe,h as Re}from"../chunks/scheduler.a731e211.js";import{S as ce,i as he,e as se,a as T,d as $,p as Ke,b as We,t as Y,f as g,y as De,g as b,m as S,s as V,r as re,h as w,j as k,n as D,c as I,u as ie,k as v,l as qe,x as d,v as oe,o as N,w as fe,z as Ve,A as Ie,B as Xe}from"../chunks/index.f53a124d.js";import{d as H,u as Ze}from"../chunks/db.6208fdf7.js";import{e as z,p as U,u as xe,o as et}from"../chunks/index.73019456.js";import{e as Z,w as tt}from"../chunks/singletons.97cacb29.js";import{p as Ae}from"../chunks/stores.e7132964.js";function Fe(t,e,a){const l=t.slice();return l[3]=e[a],l}function Pe(t){let e,a=(t[3]||"/")+"",l,s,u,r,i;return r=new Ge({props:{fileStruct:t[0][t[3]],indentLevel:t[1]+1,fullPath:U.join(t[2],t[3])}}),{c(){e=b("a"),l=S(a),u=V(),re(r.$$.fragment),this.h()},l(n){e=w(n,"A",{href:!0,class:!0});var c=k(e);l=D(c,a),c.forEach(g),u=I(n),ie(r.$$.fragment,n),this.h()},h(){v(e,"href",s=U.join("/",Z,t[2],t[3])),v(e,"class","w-full block text-left"),qe(e,"padding-left",t[1]*15+"px")},m(n,c){T(n,e,c),d(e,l),T(n,u,c),oe(r,n,c),i=!0},p(n,c){(!i||c&1)&&a!==(a=(n[3]||"/")+"")&&N(l,a),(!i||c&5&&s!==(s=U.join("/",Z,n[2],n[3])))&&v(e,"href",s),c&2&&qe(e,"padding-left",n[1]*15+"px");const _={};c&1&&(_.fileStruct=n[0][n[3]]),c&2&&(_.indentLevel=n[1]+1),c&5&&(_.fullPath=U.join(n[2],n[3])),r.$set(_)},i(n){i||($(r.$$.fragment,n),i=!0)},o(n){Y(r.$$.fragment,n),i=!1},d(n){n&&(g(e),g(u)),fe(r,n)}}}function lt(t){let e,a,l=z(Object.keys(t[0]??{})),s=[];for(let r=0;r<l.length;r+=1)s[r]=Pe(Fe(t,l,r));const u=r=>Y(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();e=se()},l(r){for(let i=0;i<s.length;i+=1)s[i].l(r);e=se()},m(r,i){for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(r,i);T(r,e,i),a=!0},p(r,[i]){if(i&7){l=z(Object.keys(r[0]??{}));let n;for(n=0;n<l.length;n+=1){const c=Fe(r,l,n);s[n]?(s[n].p(c,i),$(s[n],1)):(s[n]=Pe(c),s[n].c(),$(s[n],1),s[n].m(e.parentNode,e))}for(Ke(),n=l.length;n<s.length;n+=1)u(n);We()}},i(r){if(!a){for(let i=0;i<l.length;i+=1)$(s[i]);a=!0}},o(r){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)Y(s[i]);a=!1},d(r){r&&g(e),De(s,r)}}}function at(t,e,a){let{fileStruct:l}=e,{indentLevel:s=0}=e,{fullPath:u=""}=e;return t.$$set=r=>{"fileStruct"in r&&a(0,l=r.fileStruct),"indentLevel"in r&&a(1,s=r.indentLevel),"fullPath"in r&&a(2,u=r.fullPath)},[l,s,u]}class Ge extends ce{constructor(e){super(),he(this,e,at,lt,ue,{fileStruct:0,indentLevel:1,fullPath:2})}}function nt(t){let e,a,l,s,u,r,i=Oe(t[4].date)+"",n,c,_,p,m=t[4].duration+"",o,h,f,B,q=t[0].attempts.length+"",E,C,A,y,K,F=t[0].attempts.reduce($e,0)+"",x,de,P,_e,je=t[4].mistakeCount+"",me,ve,O,J=t[2]?"üóëÔ∏è":"üîª",ee,ge,W,G,Q=t[0].flagged?new Date().getMonth()===5?"üè≥Ô∏è‚Äçüåà ":"üö© ":"",te,R=t[0].name+"",le,pe,Ce;return{c(){e=b("div"),a=b("div"),l=b("a"),s=b("div"),u=b("div"),r=S("-"),n=S(i),c=V(),_=b("div"),p=S("‚è±Ô∏è "),o=S(m),h=V(),f=b("div"),B=S("‚úèÔ∏è "),E=S(q),C=b("div"),A=V(),y=b("div"),K=S("‚ùî "),x=S(F),de=V(),P=b("div"),_e=S("‚ùå "),me=S(je),ve=V(),O=b("button"),ee=S(J),ge=V(),W=b("a"),G=b("div"),te=S(Q),le=S(R),this.h()},l(L){e=w(L,"DIV",{class:!0});var j=k(e);a=w(j,"DIV",{class:!0});var ae=k(a);l=w(ae,"A",{href:!0});var Me=k(l);s=w(Me,"DIV",{class:!0});var M=k(s);u=w(M,"DIV",{class:!0,title:!0});var be=k(u);r=D(be,"-"),n=D(be,i),be.forEach(g),c=I(M),_=w(M,"DIV",{class:!0,title:!0});var we=k(_);p=D(we,"‚è±Ô∏è "),o=D(we,m),we.forEach(g),h=I(M),f=w(M,"DIV",{class:!0,title:!0});var Ee=k(f);B=D(Ee,"‚úèÔ∏è "),E=D(Ee,q),Ee.forEach(g),C=w(M,"DIV",{}),k(C).forEach(g),A=I(M),y=w(M,"DIV",{class:!0,title:!0});var ke=k(y);K=D(ke,"‚ùî "),x=D(ke,F),ke.forEach(g),de=I(M),P=w(M,"DIV",{class:!0,title:!0});var ye=k(P);_e=D(ye,"‚ùå "),me=D(ye,je),ye.forEach(g),M.forEach(g),Me.forEach(g),ve=I(ae),O=w(ae,"BUTTON",{class:!0,title:!0});var Be=k(O);ee=D(Be,J),Be.forEach(g),ae.forEach(g),ge=I(j),W=w(j,"A",{href:!0});var Te=k(W);G=w(Te,"DIV",{});var Se=k(G);te=D(Se,Q),le=D(Se,R),Se.forEach(g),Te.forEach(g),j.forEach(g),this.h()},h(){v(u,"class","m-auto"),v(u,"title","Time since last attempt ("+Oe(t[4].date,!1)+")"),v(_,"class","m-auto"),v(_,"title","Duration of last attempt ("+t[4].duration+" minutes)"),v(f,"class","m-auto"),v(f,"title","Number of attempts"),v(y,"class","m-auto"),v(y,"title","Number of unresolved questions"),v(P,"class","m-auto"),v(P,"title","Weighted average of incorrect problems"),v(s,"class","w-full aspect-square border m-auto grid grid-cols-2 grid-rows-3"),v(l,"href",t[3]),v(O,"class","attempt-dropdown svelte-wqw3oy"),v(O,"title","Show attempts"),v(a,"class","relative"),v(W,"href",t[3]),v(e,"class","text-center w-[6rem] mr-[11px]")},m(L,j){T(L,e,j),d(e,a),d(a,l),d(l,s),d(s,u),d(u,r),d(u,n),d(s,c),d(s,_),d(_,p),d(_,o),d(s,h),d(s,f),d(f,B),d(f,E),d(s,C),d(s,A),d(s,y),d(y,K),d(y,x),d(s,de),d(s,P),d(P,_e),d(P,me),d(a,ve),d(a,O),d(O,ee),d(e,ge),d(e,W),d(W,G),d(G,te),d(G,le),pe||(Ce=Ve(O,"click",function(){He(t[5].bind(this,t[0].id))&&t[5].bind(this,t[0].id).apply(this,arguments)}),pe=!0)},p(L,[j]){t=L,j&1&&q!==(q=t[0].attempts.length+"")&&N(E,q),j&1&&F!==(F=t[0].attempts.reduce($e,0)+"")&&N(x,F),j&4&&J!==(J=t[2]?"üóëÔ∏è":"üîª")&&N(ee,J),j&1&&Q!==(Q=t[0].flagged?new Date().getMonth()===5?"üè≥Ô∏è‚Äçüåà ":"üö© ":"")&&N(te,Q),j&1&&R!==(R=t[0].name+"")&&N(le,R)},i:X,o:X,d(L){L&&g(e),pe=!1,Ce()}}}function Oe(t,e=!0){const a=new Date,l=(a.getTime()-t.getTime())/(1e3*60*60*24);if(l<=10)return Math.floor(l)+(e?"d":" days");const s=l/7;if(s<=16)return Math.floor(s)+(e?"w":" weeks");const r=(a.getFullYear()-t.getFullYear())*12+(a.getMonth()-t.getMonth());return r<12?r+(e?"m":" months"):Math.floor(r/12)+(e?"y":" years")}const $e=(t,e)=>t+=e.questionCount;function st(t,e,a){let l,s=X,u=()=>(s(),s=Ye(n,m=>a(2,l=m)),n),r;ne(t,Ae,m=>a(6,r=m)),t.$$.on_destroy.push(()=>s());let{file:i}=e,{deleteEnabled:n}=e;u();const c=U.join("/",Z,r.params.path,i.id.toString()),_=function(m){return m.attempts.length===0?H.newBlankAttempt():m.attempts.reduce((o,h)=>h.date>o.date?h:o)}(i);function p(m){l&&H.files.delete(m)}return t.$$set=m=>{"file"in m&&a(0,i=m.file),"deleteEnabled"in m&&u(a(1,n=m.deleteEnabled))},[i,n,l,c,_,p]}class rt extends ce{constructor(e){super(),he(this,e,st,nt,ue,{file:0,deleteEnabled:1})}}function it(t,e,a){const l=t.slice();return l[6]=e[a],l}function Le(t,e,a){const l=t.slice();return l[9]=e[a],l}function Ne(t,e,a){const l=t.slice();return l[12]=e[a],l}function ze(t){let e,a,l="üìÅ",s,u=t[12]+"",r,i;return{c(){e=b("a"),a=b("div"),a.textContent=l,s=V(),r=S(u),this.h()},l(n){e=w(n,"A",{href:!0,class:!0});var c=k(e);a=w(c,"DIV",{class:!0,"data-svelte-h":!0}),Ie(a)!=="svelte-4573lq"&&(a.textContent=l),s=I(c),r=D(c,u),c.forEach(g),this.h()},h(){v(a,"class","text-7xl aspect-square perfect-center font-mono"),v(e,"href",i=U.join("/",Z,t[3].params.path,t[12])),v(e,"class","text-center w-[6rem]")},m(n,c){T(n,e,c),d(e,a),d(e,s),d(e,r)},p(n,c){c&2&&u!==(u=n[12]+"")&&N(r,u),c&10&&i!==(i=U.join("/",Z,n[3].params.path,n[12]))&&v(e,"href",i)},d(n){n&&g(e)}}}function Ue(t,e){let a,l,s;return l=new rt({props:{file:e[9],deleteEnabled:e[0]}}),{key:t,first:null,c(){a=se(),re(l.$$.fragment),this.h()},l(u){a=se(),ie(l.$$.fragment,u),this.h()},h(){this.first=a},m(u,r){T(u,a,r),oe(l,u,r),s=!0},p(u,r){e=u;const i={};r&4&&(i.file=e[9]),r&1&&(i.deleteEnabled=e[0]),l.$set(i)},i(u){s||($(l.$$.fragment,u),s=!0)},o(u){Y(l.$$.fragment,u),s=!1},d(u){u&&g(a),fe(l,u)}}}function ot(t){let e;return{c(){e=b("div"),this.h()},l(a){e=w(a,"DIV",{class:!0}),k(e).forEach(g),this.h()},h(){v(e,"class","w-[6rem] mr-[11px]")},m(a,l){T(a,e,l)},p:X,d(a){a&&g(e)}}}function ft(t){let e,a,l=[],s=new Map,u,r,i=z(Object.keys(t[1])),n=[];for(let o=0;o<i.length;o+=1)n[o]=ze(Ne(t,i,o));let c=z(t[2]??[]);const _=o=>o[9].id;for(let o=0;o<c.length;o+=1){let h=Le(t,c,o),f=_(h);s.set(f,l[o]=Ue(f,h))}let p=z(Array(10)),m=[];for(let o=0;o<p.length;o+=1)m[o]=ot(it(t,p,o));return{c(){e=b("div");for(let o=0;o<n.length;o+=1)n[o].c();a=V();for(let o=0;o<l.length;o+=1)l[o].c();u=V();for(let o=0;o<m.length;o+=1)m[o].c();this.h()},l(o){e=w(o,"DIV",{class:!0});var h=k(e);for(let f=0;f<n.length;f+=1)n[f].l(h);a=I(h);for(let f=0;f<l.length;f+=1)l[f].l(h);u=I(h);for(let f=0;f<m.length;f+=1)m[f].l(h);h.forEach(g),this.h()},h(){v(e,"class","flex flex-wrap justify-evenly gap-3")},m(o,h){T(o,e,h);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);d(e,a);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);d(e,u);for(let f=0;f<m.length;f+=1)m[f]&&m[f].m(e,null);r=!0},p(o,[h]){if(h&10){i=z(Object.keys(o[1]));let f;for(f=0;f<i.length;f+=1){const B=Ne(o,i,f);n[f]?n[f].p(B,h):(n[f]=ze(B),n[f].c(),n[f].m(e,a))}for(;f<n.length;f+=1)n[f].d(1);n.length=i.length}h&5&&(c=z(o[2]??[]),Ke(),l=xe(l,h,_,1,o,c,s,e,et,Ue,u,Le),We())},i(o){if(!r){for(let h=0;h<c.length;h+=1)$(l[h]);r=!0}},o(o){for(let h=0;h<l.length;h+=1)Y(l[h]);r=!1},d(o){o&&g(e),De(n,o);for(let h=0;h<l.length;h+=1)l[h].d();De(m,o)}}}function ut(t,e,a){let l,s=X,u=()=>(s(),s=Ye(_,p=>a(2,l=p)),_),r;ne(t,Ae,p=>a(3,r=p)),t.$$.on_destroy.push(()=>s());let{fileStruct:i}=e,{deleteEnabled:n}=e,c={},_;return t.$$set=p=>{"fileStruct"in p&&a(5,i=p.fileStruct),"deleteEnabled"in p&&a(0,n=p.deleteEnabled)},t.$$.update=()=>{if(t.$$.dirty&42&&i[""]!=null&&(a(1,c=i[""]),r.params.path!==""))for(const p of r.params.path.split("/"))a(1,c=c[p]);t.$$.dirty&8&&u(a(4,_=Ze(()=>H.files.where({"[route]":[["",...r.params.path?r.params.path.split("/"):[]]]}).toArray()))),t.$$.dirty&4&&console.log("$files",l),t.$$.dirty&2&&console.log("fileSubstruct",c)},[n,c,l,r,_,i]}class ct extends ce{constructor(e){super(),he(this,e,ut,ft,ue,{fileStruct:5,deleteEnabled:0})}}function ht(t){let e,a,l,s,u="üóëÔ∏è file",r,i,n="‚ûï file",c,_,p,m,o,h,f,B,q;return p=new Ge({props:{fileStruct:t[1]}}),h=new ct({props:{fileStruct:t[1],deleteEnabled:t[3]}}),{c(){e=V(),a=b("div"),l=b("div"),s=b("button"),s.textContent=u,r=V(),i=b("button"),i.textContent=n,c=V(),_=b("div"),re(p.$$.fragment),m=V(),o=b("div"),re(h.$$.fragment),this.h()},l(E){Xe("svelte-8s10wx",document.head).forEach(g),e=I(E),a=w(E,"DIV",{id:!0,class:!0});var A=k(a);l=w(A,"DIV",{id:!0,class:!0});var y=k(l);s=w(y,"BUTTON",{"data-svelte-h":!0}),Ie(s)!=="svelte-1e4eght"&&(s.textContent=u),r=I(y),i=w(y,"BUTTON",{"data-svelte-h":!0}),Ie(i)!=="svelte-1ulc69y"&&(i.textContent=n),y.forEach(g),c=I(A),_=w(A,"DIV",{id:!0,class:!0});var K=k(_);ie(p.$$.fragment,K),K.forEach(g),m=I(A),o=w(A,"DIV",{id:!0,class:!0});var F=k(o);ie(h.$$.fragment,F),F.forEach(g),A.forEach(g),this.h()},h(){document.title="MathMan Browse",v(l,"id","ribbon"),v(l,"class","text-right svelte-1huhyzt"),v(_,"id","folders"),v(_,"class","svelte-1huhyzt"),v(o,"id","files"),v(o,"class","svelte-1huhyzt"),v(a,"id","grid"),v(a,"class","svelte-1huhyzt")},m(E,C){T(E,e,C),T(E,a,C),d(a,l),d(l,s),d(l,r),d(l,i),d(a,c),d(a,_),oe(p,_,null),d(a,m),d(a,o),oe(h,o,null),f=!0,B||(q=[Ve(s,"click",t[4]),Ve(i,"click",t[5])],B=!0)},p(E,[C]){const A={};C&2&&(A.fileStruct=E[1]),p.$set(A);const y={};C&2&&(y.fileStruct=E[1]),h.$set(y)},i(E){f||($(p.$$.fragment,E),$(h.$$.fragment,E),f=!0)},o(E){Y(p.$$.fragment,E),Y(h.$$.fragment,E),f=!1},d(E){E&&(g(e),g(a)),fe(p),fe(h),B=!1,Je(q)}}}function dt(t,e,a){let l,s;ne(t,Ae,_=>a(0,l=_));let u={};const r=tt(!1);ne(t,r,_=>a(2,s=_));async function i(){const _={},p=await H.files.orderBy("[route]").uniqueKeys().then(m=>m.flat(1));for(const m of p){let o=_;for(const h of m)h in o||(o[h]={}),o=o[h]}return console.log("fileStruct",_),_}Qe(()=>{window.db=H,i().then(_=>a(1,u=_))});const n=()=>Re(r,s=!s,s),c=()=>H.newFile({basePath:l.data.path});return t.$$.update=()=>{t.$$.dirty&1&&console.log("$page.params",l.params),t.$$.dirty&1&&console.log("$page.data",l.data)},[l,u,s,r,n,c]}class wt extends ce{constructor(e){super(),he(this,e,dt,ht,ue,{})}}export{wt as component};
