import{s as O,n as M,r as Ie,o as we,f as Ce,b as ae,e as ee}from"../chunks/scheduler.03df403d.js";import{S as R,i as Y,g as b,s as q,h as I,j as N,z as S,c as V,f as g,l as H,k as p,a as T,x as D,A as z,y as ie,m as te,n as ne,B as ce,o as oe,d as x,p as ke,b as De,t as Q,r as G,u as J,v as K,w as Z}from"../chunks/index.5bc90a32.js";import{d as B,e as P,a as be,n as Te,p as ue}from"../chunks/index.83a2109c.js";import{j as ye,w as Ee,k as de,e as fe}from"../chunks/singletons.7921de54.js";import{p as le}from"../chunks/stores.2dcd8f63.js";var k=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Erase=4]="Erase",n))(k||{});const re=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href,Ae=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function Ne(n){let e,s,a=`<img src="${re}" title="Your work" draggable="false"/>`,i,l,d=`<img src="${re}" title="Correct" draggable="false"/>`,c,t,h=`<img src="${re}" title="Question" draggable="false"/>`,u,o,r=`<img src="${Ae}" title="Eraser" draggable="false"/>`,v,_;return{c(){e=b("div"),s=b("div"),s.innerHTML=a,i=q(),l=b("div"),l.innerHTML=d,c=q(),t=b("div"),t.innerHTML=h,u=q(),o=b("div"),o.innerHTML=r,this.h()},l(E){e=I(E,"DIV",{id:!0});var C=N(e);s=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),S(s)!=="svelte-1um81qx"&&(s.innerHTML=a),i=V(C),l=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),S(l)!=="svelte-lqddij"&&(l.innerHTML=d),c=V(C),t=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),S(t)!=="svelte-1ovzcqk"&&(t.innerHTML=h),u=V(C),o=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),S(o)!=="svelte-1264pa0"&&(o.innerHTML=r),C.forEach(g),this.h()},h(){H(s,"width","30px"),H(s,"filter","grayscale(1)"),p(s,"data-tool",k.Draw),H(l,"width","30px"),H(l,"filter","hue-rotate(136deg)"),p(l,"data-tool",k.Correct),H(t,"width","30px"),p(t,"data-tool",k.Question),H(o,"width","30px"),p(o,"data-tool",k.Erase),p(e,"id","tools")},m(E,C){T(E,e,C),D(e,s),D(e,i),D(e,l),D(e,c),D(e,t),D(e,u),D(e,o),v||(_=[z(s,"click",n[0]),z(l,"click",n[0]),z(t,"click",n[0]),z(o,"click",n[0])],v=!0)},p:M,i:M,o:M,d(E){E&&g(e),v=!1,Ie(_)}}}function qe(n,e,s){let{selected:a}=e;function i(l){l.stopPropagation();const d=l.currentTarget,c=d.style.height=="100%";for(const t of document.querySelectorAll("#tools > div"))t.style.height="30px";for(const t of document.querySelectorAll(".tool"))t.id="";if(c){a.set(k.None);return}a.set(Number.parseInt(d.dataset.tool)),d.style.height="100%"}return n.$$set=l=>{"selected"in l&&s(1,a=l.selected)},[i,a]}class Ve extends R{constructor(e){super(),Y(this,e,qe,Ne,O,{selected:1})}}function Me(n){let e,s,a,i,l,d,c;return{c(){e=b("canvas"),s=q(),a=b("canvas"),i=q(),l=b("canvas"),this.h()},l(t){e=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(e).forEach(g),s=V(t),a=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(a).forEach(g),i=V(t),l=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(l).forEach(g),this.h()},h(){p(e,"width",n[2]),p(e,"height",n[3]),p(e,"class","svelte-1rofrvo"),p(a,"width",n[2]),p(a,"height",n[3]),p(a,"class","svelte-1rofrvo"),p(l,"width",n[2]),p(l,"height",n[3]),p(l,"class","svelte-1rofrvo")},m(t,h){T(t,e,h),n[7](e),T(t,s,h),T(t,a,h),n[8](a),T(t,i,h),T(t,l,h),n[9](l),d||(c=z(l,"pointerdown",n[4]),d=!0)},p(t,[h]){h&4&&p(e,"width",t[2]),h&8&&p(e,"height",t[3]),h&4&&p(a,"width",t[2]),h&8&&p(a,"height",t[3]),h&4&&p(l,"width",t[2]),h&8&&p(l,"height",t[3])},i:M,o:M,d(t){t&&(g(e),g(s),g(a),g(i),g(l)),n[7](null),n[8](null),n[9](null),d=!1,c()}}}function ze(n,e,s){let a,i=M,l=()=>(i(),i=Ce(d,f=>s(11,a=f)),d);n.$$.on_destroy.push(()=>i());let{selectedTool:d}=e;l();let{problemId:c}=e,{attemptId:t}=e,h=0,u=0,o=!1,r=[];function v(){typeof window>"u"||(s(2,h=window.innerWidth),s(3,u=window.innerHeight),requestAnimationFrame(async()=>{const f=(await B.files.get(c)).attempts[t];r[k.Draw].putImageData(f.work,0,0),r[k.Correct].putImageData(f.error,0,0),r[k.Question].putImageData(f.questions,0,0)}))}function _(){const f=[0,0,h,u];B.files.update(c,w=>{w.attempts[t]={date:new Date,work:r[k.Draw].getImageData(...f),error:r[k.Correct].getImageData(...f),questions:r[k.Question].getImageData(...f),rois:w.attempts[t].rois}})}const E=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,C={[k.Draw]:E?"white":"black",[k.Correct]:"red",[k.Question]:"blue"},F=f=>{if(a==k.None)return;const w=r[a];o=!0,w.strokeStyle=C[a],w.beginPath(),w.moveTo(f.clientX,f.clientY)},$=()=>{o&&_(),o=!1},se=f=>{if(o){const w=r[a];w.lineTo(f.clientX,f.clientY),w.stroke()}};we(()=>{window.onresize=v,document.onpointermove=se,document.onpointerup=$,s(1,r=r.map(f=>f.getContext("2d",{willReadFrequently:!0})))});function L(f){ae[f?"unshift":"push"](()=>{r[k.Draw]=f,s(1,r)})}function y(f){ae[f?"unshift":"push"](()=>{r[k.Correct]=f,s(1,r)})}function m(f){ae[f?"unshift":"push"](()=>{r[k.Question]=f,s(1,r)})}return n.$$set=f=>{"selectedTool"in f&&l(s(0,d=f.selectedTool)),"problemId"in f&&s(5,c=f.problemId),"attemptId"in f&&s(6,t=f.attemptId)},n.$$.update=()=>{if(n.$$.dirty&98){v();for(const f of r){const w=f.canvas;f.clearRect(0,0,w.width,w.height)}}},[d,r,h,u,F,c,t,L,y,m]}class Le extends R{constructor(e){super(),Y(this,e,ze,Me,O,{selectedTool:0,problemId:5,attemptId:6})}}const j=ye("goto");function he(n,e,s){const a=n.slice();return a[4]=e[s],a}function me(n){let e,s=n[4].name+"",a,i;return{c(){e=b("option"),a=te(s),this.h()},l(l){e=I(l,"OPTION",{});var d=N(e);a=ne(d,s),d.forEach(g),this.h()},h(){e.__value=i=n[4].id,ce(e,e.__value)},m(l,d){T(l,e,d),D(e,a)},p(l,d){d&1&&s!==(s=l[4].name+"")&&oe(a,s),d&1&&i!==(i=l[4].id)&&(e.__value=i,ce(e,e.__value))},d(l){l&&g(e)}}}function He(n){let e,s="üö©",a,i,l,d,c="‚û°Ô∏è",t,h,u=P(n[0]??[]),o=[];for(let r=0;r<u.length;r+=1)o[r]=me(he(n,u,r));return{c(){e=b("button"),e.textContent=s,a=q(),i=b("select");for(let r=0;r<o.length;r+=1)o[r].c();l=q(),d=b("button"),d.textContent=c},l(r){e=I(r,"BUTTON",{"data-svelte-h":!0}),S(e)!=="svelte-yzpet0"&&(e.textContent=s),a=V(r),i=I(r,"SELECT",{});var v=N(i);for(let _=0;_<o.length;_+=1)o[_].l(v);v.forEach(g),l=V(r),d=I(r,"BUTTON",{"data-svelte-h":!0}),S(d)!=="svelte-q61pzu"&&(d.textContent=c)},m(r,v){T(r,e,v),T(r,a,v),T(r,i,v);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(i,null);T(r,l,v),T(r,d,v),t||(h=z(i,"change",n[1]),t=!0)},p(r,[v]){if(v&1){u=P(r[0]??[]);let _;for(_=0;_<u.length;_+=1){const E=he(r,u,_);o[_]?o[_].p(E,v):(o[_]=me(E),o[_].c(),o[_].m(i,null))}for(;_<o.length;_+=1)o[_].d(1);o.length=u.length}},i:M,o:M,d(r){r&&(g(e),g(a),g(i),g(l),g(d)),ie(o,r),t=!1,h()}}}function Se(n,e,s){let a,{parentFolder:i}=e;function l(c){const t=c.target.value;j(t)}const d=be(()=>B.files.where({parent:i}).toArray());return ee(n,d,c=>s(0,a=c)),n.$$set=c=>{"parentFolder"in c&&s(3,i=c.parentFolder)},[a,l,d,i]}class xe extends R{constructor(e){super(),Y(this,e,Se,He,O,{parentFolder:3})}}function Qe(n){let e,s,a,i,l=n[0]+1+"",d;return{c(){e=b("div"),s=b("canvas"),i=te(`
    Attempt `),d=te(l),this.h()},l(c){e=I(c,"DIV",{class:!0});var t=N(e);s=I(t,"CANVAS",{width:!0,height:!0}),N(s).forEach(g),i=ne(t,`
    Attempt `),d=ne(t,l),t.forEach(g),this.h()},h(){p(s,"width",n[1]),p(s,"height",a=n[1]-24),p(e,"class","text-center bg-gray-50 rounded-md"),H(e,"width",n[1]+"px")},m(c,t){T(c,e,t),D(e,s),n[4](s),D(e,i),D(e,d)},p(c,[t]){t&2&&p(s,"width",c[1]),t&2&&a!==(a=c[1]-24)&&p(s,"height",a),t&1&&l!==(l=c[0]+1+"")&&oe(d,l),t&2&&H(e,"width",c[1]+"px")},i:M,o:M,d(c){c&&g(e),n[4](null)}}}function Fe(n,e,s){let{attempt:a}=e,{idx:i}=e,{size:l=100}=e,d;function c(h,u){const o=document.createElement("canvas");o.width=u[0].width,o.height=u[0].height,h.scale(l/o.width,(l-24)/o.height);for(const r of u)o.getContext("2d").putImageData(r,0,0),h.drawImage(o,0,0)}we(async()=>{const h=d.getContext("2d");c(h,[a.work,a.error,a.questions])});function t(h){ae[h?"unshift":"push"](()=>{d=h,s(2,d)})}return n.$$set=h=>{"attempt"in h&&s(3,a=h.attempt),"idx"in h&&s(0,i=h.idx),"size"in h&&s(1,l=h.size)},[i,l,d,a,t]}class Ue extends R{constructor(e){super(),Y(this,e,Fe,Qe,O,{attempt:3,idx:0,size:1})}}function pe(n,e,s){const a=n.slice();return a[5]=e[s],a[7]=s,a}function ge(n){let e,s,a,i,l;s=new Ue({props:{attempt:n[5],idx:n[7]}});function d(){return n[4](n[7])}return{c(){e=b("div"),G(s.$$.fragment)},l(c){e=I(c,"DIV",{});var t=N(e);J(s.$$.fragment,t),t.forEach(g)},m(c,t){T(c,e,t),K(s,e,null),a=!0,i||(l=z(e,"click",d),i=!0)},p(c,t){n=c;const h={};t&1&&(h.attempt=n[5]),s.$set(h)},i(c){a||(x(s.$$.fragment,c),a=!0)},o(c){Q(s.$$.fragment,c),a=!1},d(c){c&&g(e),Z(s),i=!1,l()}}}function je(n){let e,s,a=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,i,l,d,c=P(n[0]??[]),t=[];for(let u=0;u<c.length;u+=1)t[u]=ge(pe(n,c,u));const h=u=>Q(t[u],1,1,()=>{t[u]=null});return{c(){for(let u=0;u<t.length;u+=1)t[u].c();e=q(),s=b("div"),s.innerHTML=a,this.h()},l(u){for(let o=0;o<t.length;o+=1)t[o].l(u);e=V(u),s=I(u,"DIV",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-59ttd9"&&(s.innerHTML=a),this.h()},h(){p(s,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(u,o){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(u,o);T(u,e,o),T(u,s,o),i=!0,l||(d=z(s,"click",n[2]),l=!0)},p(u,[o]){if(o&1){c=P(u[0]??[]);let r;for(r=0;r<c.length;r+=1){const v=pe(u,c,r);t[r]?(t[r].p(v,o),x(t[r],1)):(t[r]=ge(v),t[r].c(),x(t[r],1),t[r].m(e.parentNode,e))}for(ke(),r=c.length;r<t.length;r+=1)h(r);De()}},i(u){if(!i){for(let o=0;o<c.length;o+=1)x(t[o]);i=!0}},o(u){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)Q(t[o]);i=!1},d(u){u&&(g(e),g(s)),ie(t,u),l=!1,d()}}}function Be(n,e,s){let a,{problemId:i}=e;const l=be(()=>B.files.get(i).then(t=>t.attempts));ee(n,l,t=>s(0,a=t));function d(){B.files.update(i,t=>{j("?attempt="+t.attempts.push(Te()))})}const c=t=>j("?attempt="+(t+1));return n.$$set=t=>{"problemId"in t&&s(3,i=t.problemId)},[a,l,d,i,c]}class Pe extends R{constructor(e){super(),Y(this,e,Be,je,O,{problemId:3})}}function _e(n,e,s){const a=n.slice();return a[8]=e[s],a}function ve(n){let e,s=n[8]+"",a;return{c(){e=te("/"),a=te(s)},l(i){e=ne(i,"/"),a=ne(i,s)},m(i,l){T(i,e,l),T(i,a,l)},p(i,l){l&2&&s!==(s=i[8]+"")&&oe(a,s)},d(i){i&&(g(e),g(a))}}}function Oe(n){let e,s,a,i,l,d="üè†",c,t,h,u,o,r,v,_,E,C,F,$,se;e=new Le({props:{selectedTool:n[3],problemId:n[0],attemptId:n[2]}});let L=P(n[1].params.path.split("/")),y=[];for(let m=0;m<L.length;m+=1)y[m]=ve(_e(n,L,m));return u=new xe({props:{parentFolder:n[1].params.path.split("/").at(-1)}}),v=new Ve({props:{selected:n[3]}}),C=new Pe({props:{problemId:n[0]}}),{c(){G(e.$$.fragment),s=q(),a=b("div"),i=b("div"),l=b("button"),l.textContent=d,c=q();for(let m=0;m<y.length;m+=1)y[m].c();t=q(),h=b("div"),G(u.$$.fragment),o=q(),r=b("div"),G(v.$$.fragment),_=q(),E=b("div"),G(C.$$.fragment),this.h()},l(m){J(e.$$.fragment,m),s=V(m),a=I(m,"DIV",{id:!0,class:!0});var f=N(a);i=I(f,"DIV",{id:!0,class:!0});var w=N(i);l=I(w,"BUTTON",{"data-svelte-h":!0}),S(l)!=="svelte-1xjub06"&&(l.textContent=d),c=V(w);for(let U=0;U<y.length;U+=1)y[U].l(w);w.forEach(g),t=V(f),h=I(f,"DIV",{id:!0,class:!0});var W=N(h);J(u.$$.fragment,W),W.forEach(g),o=V(f),r=I(f,"DIV",{id:!0,class:!0});var X=N(r);J(v.$$.fragment,X),X.forEach(g),_=V(f),E=I(f,"DIV",{id:!0,class:!0});var A=N(E);J(C.$$.fragment,A),A.forEach(g),f.forEach(g),this.h()},h(){p(i,"id","breadcrumbs"),p(i,"class","svelte-1edzgew"),p(h,"id","question-management"),p(h,"class","text-right svelte-1edzgew"),p(r,"id","tools-container"),p(r,"class","svelte-1edzgew"),p(E,"id","attempts-container"),p(E,"class","flex flex-col p-3 gap-3 svelte-1edzgew"),p(a,"id","grid"),p(a,"class","svelte-1edzgew")},m(m,f){K(e,m,f),T(m,s,f),T(m,a,f),D(a,i),D(i,l),D(i,c);for(let w=0;w<y.length;w+=1)y[w]&&y[w].m(i,null);D(a,t),D(a,h),K(u,h,null),D(a,o),D(a,r),K(v,r,null),D(a,_),D(a,E),K(C,E,null),F=!0,$||(se=z(l,"click",n[6]),$=!0)},p(m,[f]){const w={};if(f&1&&(w.problemId=m[0]),f&4&&(w.attemptId=m[2]),e.$set(w),f&2){L=P(m[1].params.path.split("/"));let A;for(A=0;A<L.length;A+=1){const U=_e(m,L,A);y[A]?y[A].p(U,f):(y[A]=ve(U),y[A].c(),y[A].m(i,null))}for(;A<y.length;A+=1)y[A].d(1);y.length=L.length}const W={};f&2&&(W.parentFolder=m[1].params.path.split("/").at(-1)),u.$set(W);const X={};f&1&&(X.problemId=m[0]),C.$set(X)},i(m){F||(x(e.$$.fragment,m),x(u.$$.fragment,m),x(v.$$.fragment,m),x(C.$$.fragment,m),F=!0)},o(m){Q(e.$$.fragment,m),Q(u.$$.fragment,m),Q(v.$$.fragment,m),Q(C.$$.fragment,m),F=!1},d(m){m&&(g(s),g(a)),Z(e,m),ie(y,m),Z(u),Z(v),Z(C),$=!1,se()}}}function Re(n,e,s){let a,i,l;ee(n,le,o=>s(1,i=o));const d=Ee(k.None),c=de(le,o=>Number.parseInt(o.params.problemId));ee(n,c,o=>s(0,a=o));const t=de(le,o=>Number.parseInt(o.url.searchParams.get("attempt")??"1")-1);ee(n,t,o=>s(2,l=o));function h(o){if(o){const r=o.route.join("/");"/"+i.params.path!==r&&j(ue.join("/",fe,r,i.params.problemId))}else j(ue.join("/",fe,i.params.path))}const u=()=>j("..");return n.$$.update=()=>{n.$$.dirty&1&&typeof window<"u"&&B.files.get(a).then(h)},[a,i,l,d,c,t,u]}class Je extends R{constructor(e){super(),Y(this,e,Re,Oe,O,{})}}export{Je as component};
