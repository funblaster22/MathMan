import{s as ee,n as H,f as ue,e as Z,m as Re,k as Ne,o as qe,j as Se,b as ie,p as je,r as Ue}from"../chunks/scheduler.d208cd37.js";import{S as te,i as ne,s as V,g as N,c as O,h as q,C as oe,k as w,l as R,a as D,A as B,D as Ae,f as _,j as L,x as S,r as G,m as x,u as X,n as $,v as J,d as F,t as z,w as K,E as He,F as ge,o as fe,y as Le,G as me,H as We,p as Pe,b as Be,B as Fe}from"../chunks/index.c95bd50b.js";import{e as re,u as Qe,s as ze,a as Ve,d as Ye,o as Ge}from"../chunks/index.3b6591eb.js";import{j as Xe,w as _e,k as be}from"../chunks/singletons.dc136405.js";import{a as de,d as Y,u as Oe,D as Je,b as pe}from"../chunks/db.6cee3929.js";import{p as ae}from"../chunks/stores.4c7c34c0.js";var Q=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Select=4]="Select",n))(Q||{});const Ke=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function we(n){let e,t="Show Solution";return{c(){e=N("button"),e.textContent=t,this.h()},l(s){e=q(s,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),oe(e)!=="svelte-on8fyx"&&(e.textContent=t),this.h()},h(){w(e,"class","border text-center"),R(e,"position","fixed"),R(e,"left",n[1][0]+"px"),R(e,"top",n[1][1]+"px"),R(e,"width",n[2][0]-n[1][0]+"px"),R(e,"height",n[2][1]-n[1][1]+"px")},m(s,l){D(s,e,l)},p(s,l){l&2&&R(e,"left",s[1][0]+"px"),l&2&&R(e,"top",s[1][1]+"px"),l&6&&R(e,"width",s[2][0]-s[1][0]+"px"),l&6&&R(e,"height",s[2][1]-s[1][1]+"px")},d(s){s&&_(e)}}}function Ze(n){let e,t,s='<div style="background-color: green">✅</div>',l,a,i=n[1][1]&&we(n);return{c(){i&&i.c(),e=V(),t=N("div"),t.innerHTML=s,this.h()},l(o){i&&i.l(o),e=O(o),t=q(o,"DIV",{class:!0,"data-svelte-h":!0}),oe(t)!=="svelte-aiv1v7"&&(t.innerHTML=s),this.h()},h(){w(t,"class","tool"),R(t,"height",n[0]?"100%":"30px")},m(o,r){i&&i.m(o,r),D(o,e,r),D(o,t,r),l||(a=B(t,"pointerdown",Ae(n[8])),l=!0)},p(o,[r]){o[1][1]?i?i.p(o,r):(i=we(o),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),r&1&&R(t,"height",o[0]?"100%":"30px")},i:H,o:H,d(o){o&&(_(e),_(t)),i&&i.d(o),l=!1,a()}}}function xe(n,e,t){let s;const l=Q.Select;let a=!1,i=!1,o=[],r=[],u,h,p=ue("selection");Z(n,p,v=>t(7,s=v)),window.addEventListener("pointerdown",v=>{a&&(i=!0,t(5,o=t(6,r=[v.x,v.y])))}),window.addEventListener("pointermove",v=>{i&&t(6,r=[v.x,v.y])}),window.addEventListener("pointerup",()=>{i=!1});const m=()=>p.set(a?Q.None:l);return n.$$.update=()=>{n.$$.dirty&128&&t(0,a=s===l),n.$$.dirty&96&&(t(1,u=[Math.min(o[0],r[0]),Math.min(o[1],r[1])]),t(2,h=[Math.max(o[0],r[0]),Math.max(o[1],r[1])]))},[a,u,h,l,p,o,r,s,m]}class $e extends te{constructor(e){super(),ne(this,e,xe,Ze,ee,{})}}const et=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href;function tt(n){let e,t,s,l,a;return{c(){e=N("div"),t=N("img"),this.h()},l(i){e=q(i,"DIV",{class:!0});var o=L(e);t=q(o,"IMG",{style:!0,src:!0,title:!0,draggable:!0}),o.forEach(_),this.h()},h(){R(t,"filter",n[1]),Re(t.src,s=et)||w(t,"src",s),w(t,"title",n[2]),w(t,"draggable","false"),w(e,"class","tool"),R(e,"height",n[3]?"100%":"30px")},m(i,o){D(i,e,o),S(e,t),l||(a=B(e,"pointerdown",Ae(n[6])),l=!0)},p(i,[o]){o&2&&R(t,"filter",i[1]),o&4&&w(t,"title",i[2]),o&8&&R(e,"height",i[3]?"100%":"30px")},i:H,o:H,d(i){i&&_(e),l=!1,a()}}}function nt(n,e,t){let s,{tool:l}=e,{filter:a=""}=e,{title:i}=e,o=ue("selection");Z(n,o,h=>t(5,s=h));let r=!1;const u=()=>o.set(r?Q.None:l);return n.$$set=h=>{"tool"in h&&t(0,l=h.tool),"filter"in h&&t(1,a=h.filter),"title"in h&&t(2,i=h.title)},n.$$.update=()=>{n.$$.dirty&33&&t(3,r=s===l)},[l,a,i,r,o,s,u]}class he extends te{constructor(e){super(),ne(this,e,nt,tt,ee,{tool:0,filter:1,title:2})}}function st(n){let e,t,s,l,a,i,o,r,u,h,p,m,v,M,T=`<img src="${Ke}" title="Eraser" draggable="false" class="svelte-h3rgmi"/>`,A,E,j;return t=new $e({}),r=new he({props:{tool:Q.Draw,filter:"grayscale(1)",title:"Your work"}}),h=new he({props:{tool:Q.Correct,filter:"hue-rotate(136deg)",title:"Correct"}}),m=new he({props:{tool:Q.Question,title:"Question"}}),{c(){e=N("div"),G(t.$$.fragment),s=V(),l=N("a"),a=x("📷"),o=V(),G(r.$$.fragment),u=V(),G(h.$$.fragment),p=V(),G(m.$$.fragment),v=V(),M=N("div"),M.innerHTML=T,this.h()},l(g){e=q(g,"DIV",{id:!0,class:!0});var C=L(e);X(t.$$.fragment,C),s=O(C),l=q(C,"A",{href:!0});var P=L(l);a=$(P,"📷"),P.forEach(_),o=O(C),X(r.$$.fragment,C),u=O(C),X(h.$$.fragment,C),p=O(C),X(m.$$.fragment,C),v=O(C),M=q(C,"DIV",{class:!0,"data-svelte-h":!0}),oe(M)!=="svelte-19p7wft"&&(M.innerHTML=T),C.forEach(_),this.h()},h(){w(l,"href",i=de("camera",n[1].params.problemId)),w(M,"class","tool"),R(M,"height",n[0]?"100%":"30px"),w(e,"id","tools"),w(e,"class","svelte-h3rgmi")},m(g,C){D(g,e,C),J(t,e,null),S(e,s),S(e,l),S(l,a),S(e,o),J(r,e,null),S(e,u),J(h,e,null),S(e,p),J(m,e,null),S(e,v),S(e,M),A=!0,E||(j=B(M,"click",n[3]),E=!0)},p(g,[C]){(!A||C&2&&i!==(i=de("camera",g[1].params.problemId)))&&w(l,"href",i),C&1&&R(M,"height",g[0]?"100%":"30px")},i(g){A||(F(t.$$.fragment,g),F(r.$$.fragment,g),F(h.$$.fragment,g),F(m.$$.fragment,g),A=!0)},o(g){z(t.$$.fragment,g),z(r.$$.fragment,g),z(h.$$.fragment,g),z(m.$$.fragment,g),A=!1},d(g){g&&_(e),K(t),K(r),K(h),K(m),E=!1,j()}}}function rt(n,e,t){let s,l;Z(n,ae,r=>t(1,l=r));let{selected:a}=e;Ne("selection",a);let i=ue("eraserEnabled");Z(n,i,r=>t(0,s=r));function o(r){i.set(!s)}return n.$$set=r=>{"selected"in r&&t(4,a=r.selected)},[s,l,i,o,a]}class lt extends te{constructor(e){super(),ne(this,e,rt,st,ee,{selected:4})}}function ot(n){let e,t,s,l,a,i,o;return{c(){e=N("canvas"),t=V(),s=N("canvas"),l=V(),a=N("canvas"),this.h()},l(r){e=q(r,"CANVAS",{width:!0,height:!0,class:!0}),L(e).forEach(_),t=O(r),s=q(r,"CANVAS",{width:!0,height:!0,class:!0}),L(s).forEach(_),l=O(r),a=q(r,"CANVAS",{width:!0,height:!0,class:!0}),L(a).forEach(_),this.h()},h(){w(e,"width",n[2]),w(e,"height",n[3]),w(e,"class","svelte-1rofrvo"),w(s,"width",n[2]),w(s,"height",n[3]),w(s,"class","svelte-1rofrvo"),w(a,"width",n[2]),w(a,"height",n[3]),w(a,"class","svelte-1rofrvo")},m(r,u){D(r,e,u),n[8](e),D(r,t,u),D(r,s,u),n[9](s),D(r,l,u),D(r,a,u),n[10](a),i||(o=B(a,"pointerdown",He(n[5])),i=!0)},p(r,[u]){u&4&&w(e,"width",r[2]),u&8&&w(e,"height",r[3]),u&4&&w(s,"width",r[2]),u&8&&w(s,"height",r[3]),u&4&&w(a,"width",r[2]),u&8&&w(a,"height",r[3])},i:H,o:H,d(r){r&&(_(e),_(t),_(s),_(l),_(a)),n[8](null),n[9](null),n[10](null),i=!1,o()}}}function it(n,e,t){let s,l=H,a=()=>(l(),l=Se(o,f=>t(13,s=f)),o),i;n.$$.on_destroy.push(()=>l());let{selectedTool:o}=e;a();let{problemId:r}=e,{attemptId:u}=e,h=0,p=0,m=!1,v=ue("eraserEnabled");Z(n,v,f=>t(14,i=f));let M,T=[];function A(){typeof window>"u"||r===0||(t(2,h=window.innerWidth),t(3,p=window.innerHeight),requestAnimationFrame(async()=>{if(T[0]==null)return;const f=(await Y.files.get(r)).attempts[u];T[Q.Draw].putImageData(f.work,0,0),T[Q.Correct].putImageData(f.error,0,0),T[Q.Question].putImageData(f.questions,0,0)}))}const E=()=>{const f=[0,0,h,p];Y.files.update(r,k=>{const U=k.attempts[u];U.date=new Date,U.duration=Math.floor((new Date().getTime()-M)/1e3/60),s==Q.Correct&&(U.mistakeCount=1),s==Q.Question&&(U.questionCount=1),U[["work","error","questions"][s]]=T[s].getImageData(...f)})},j=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,g={[Q.Draw]:j?"white":"black",[Q.Correct]:"red",[Q.Question]:"blue"},C=f=>{if(s>=Q.None)return;const k=T[s];m=!0,k.strokeStyle=g[s],k.lineWidth=i?20:1,k.globalCompositeOperation=i?"destination-out":"source-over",k.beginPath(),k.moveTo(f.clientX,f.clientY)},P=()=>{m&&E(),m=!1},I=f=>{if(m){const k=T[s];k.lineTo(f.clientX,f.clientY),k.stroke()}};qe(()=>{window.addEventListener("resize",A),document.addEventListener("pointermove",I),document.addEventListener("pointerup",P),document.addEventListener("touchstart",f=>f.preventDefault()),t(1,T=T.map(f=>f.getContext("2d",{willReadFrequently:!0})))});function b(f){ie[f?"unshift":"push"](()=>{T[Q.Draw]=f,t(1,T)})}function d(f){ie[f?"unshift":"push"](()=>{T[Q.Correct]=f,t(1,T)})}function c(f){ie[f?"unshift":"push"](()=>{T[Q.Question]=f,t(1,T)})}return n.$$set=f=>{"selectedTool"in f&&a(t(0,o=f.selectedTool)),"problemId"in f&&t(6,r=f.problemId),"attemptId"in f&&t(7,u=f.attemptId)},n.$$.update=()=>{if(n.$$.dirty&194){A(),M=new Date().getTime();for(const f of T){const k=f.canvas;f.clearRect(0,0,k.width,k.height)}}},[o,T,h,p,v,C,r,u,b,d,c]}class at extends te{constructor(e){super(),ne(this,e,it,ot,ee,{selectedTool:0,problemId:6,attemptId:7})}}const le=Xe("goto");function ve(n,e,t){const s=n.slice();return s[19]=e[t],s[21]=t,s}function ke(n,e,t){const s=n.slice();return s[22]=e[t],s}function Ie(n){let e,t="🧠 Resolve questions",s,l;return{c(){e=N("button"),e.textContent=t},l(a){e=q(a,"BUTTON",{"data-svelte-h":!0}),oe(e)!=="svelte-ykge1i"&&(e.textContent=t)},m(a,i){D(a,e,i),s||(l=B(e,"click",n[11]),s=!0)},p:H,d(a){a&&_(e),s=!1,l()}}}function Ce(n){let e,t=n[6][n[22]]+"",s;return{c(){e=N("option"),s=x(t),this.h()},l(l){e=q(l,"OPTION",{});var a=L(e);s=$(a,t),a.forEach(_),this.h()},h(){e.__value=n[22],me(e,e.__value)},m(l,a){D(l,e,a),S(e,s)},p:H,d(l){l&&_(e)}}}function Ee(n,e){let t,s=e[19].name+"",l,a,i;return{key:n,first:null,c(){t=N("option"),l=x(s),this.h()},l(o){t=q(o,"OPTION",{});var r=L(t);l=$(r,s),r.forEach(_),this.h()},h(){t.__value=a=e[21],me(t,t.__value),t.selected=i=e[19].id===e[0],this.first=t},m(o,r){D(o,t,r),S(t,l)},p(o,r){e=o,r&16&&s!==(s=e[19].name+"")&&fe(l,s),r&16&&a!==(a=e[21])&&(t.__value=a,me(t,t.__value)),r&17&&i!==(i=e[19].id===e[0])&&(t.selected=i)},d(o){o&&_(t)}}}function ut(n){var I,b,d;let e,t,s=n[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️",l,a,i,o,r,u,h=[],p=new Map,m,v,M="➡️",T,A,E=((d=(b=(I=n[4][n[2]])==null?void 0:I.attempts)==null?void 0:b[n[1]])==null?void 0:d.questions)>0&&Ie(n),j=re(Object.keys(n[6])),g=[];for(let c=0;c<j.length;c+=1)g[c]=Ce(ke(n,j,c));let C=re(n[4]);const P=c=>c[19].id;for(let c=0;c<C.length;c+=1){let f=ve(n,C,c),k=P(f);p.set(k,h[c]=Ee(k,f))}return{c(){E&&E.c(),e=V(),t=N("button"),l=x(s),i=V(),o=N("select");for(let c=0;c<g.length;c+=1)g[c].c();r=V(),u=N("select");for(let c=0;c<h.length;c+=1)h[c].c();m=V(),v=N("button"),v.textContent=M,this.h()},l(c){E&&E.l(c),e=O(c),t=q(c,"BUTTON",{title:!0});var f=L(t);l=$(f,s),f.forEach(_),i=O(c),o=q(c,"SELECT",{});var k=L(o);for(let W=0;W<g.length;W+=1)g[W].l(k);k.forEach(_),r=O(c),u=q(c,"SELECT",{});var U=L(u);for(let W=0;W<h.length;W+=1)h[W].l(U);U.forEach(_),m=O(c),v=q(c,"BUTTON",{"data-svelte-h":!0}),oe(v)!=="svelte-1wjt799"&&(v.textContent=M),this.h()},h(){w(t,"title",a=(n[5]?"un":"")+"flag for later"),n[3]===void 0&&je(()=>n[15].call(o))},m(c,f){E&&E.m(c,f),D(c,e,f),D(c,t,f),S(t,l),D(c,i,f),D(c,o,f);for(let k=0;k<g.length;k+=1)g[k]&&g[k].m(o,null);ge(o,n[3],!0),D(c,r,f),D(c,u,f);for(let k=0;k<h.length;k+=1)h[k]&&h[k].m(u,null);D(c,m,f),D(c,v,f),T||(A=[B(t,"click",n[9]),B(o,"change",n[15]),B(u,"change",n[7]),B(v,"click",n[8])],T=!0)},p(c,[f]){var k,U,W;if(((W=(U=(k=c[4][c[2]])==null?void 0:k.attempts)==null?void 0:U[c[1]])==null?void 0:W.questions)>0?E?E.p(c,f):(E=Ie(c),E.c(),E.m(e.parentNode,e)):E&&(E.d(1),E=null),f&32&&s!==(s=c[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️")&&fe(l,s),f&32&&a!==(a=(c[5]?"un":"")+"flag for later")&&w(t,"title",a),f&64){j=re(Object.keys(c[6]));let y;for(y=0;y<j.length;y+=1){const se=ke(c,j,y);g[y]?g[y].p(se,f):(g[y]=Ce(se),g[y].c(),g[y].m(o,null))}for(;y<g.length;y+=1)g[y].d(1);g.length=j.length}f&72&&ge(o,c[3]),f&17&&(C=re(c[4]),h=Qe(h,f,P,1,c,C,p,u,Ye,Ee,null,ve))},i:H,o:H,d(c){c&&(_(e),_(t),_(i),_(o),_(r),_(u),_(m),_(v)),E&&E.d(c),Le(g,c);for(let f=0;f<h.length;f+=1)h[f].d();T=!1,Ue(A)}}}function ft(n,e,t){let s,l;Z(n,ae,I=>t(14,l=I));var a=(I=>(I.Work="Work",I.Mistakes="Mistakes",I.Questions="Questions",I))(a||{});let{problemRoute:i}=e,{problemId:o}=e,r=-1,u=0,h=l.url.searchParams.get("studyMode")??"Work",p=!1,m;function v(I){t(2,u=Number.parseInt(I.target.value)),t(1,r=-1),A()}function M(){return g[u].attempts.findIndex((I,b)=>I.questions>0&&b>r)}function T(){const I=r;if((h!=="Questions"||M()===-1)&&(t(2,u++,u),t(1,r=-1)),u>=g.length)if(h==="Work"){const b=Array.from(m.matchAll(/\d+/g)).at(-1);let d;b!=null&&(d=m.substring(0,b.index)+(Number.parseInt(b[0])+1)+m.substring(b.index+b[0].length)),Y.newFile({basePath:l.params.path,route:d}).then(c=>{c>=0&&le(String(c))})}else{alert("Hooray! You are done!"),t(2,u--,u),t(1,r=I);return}A()}function A(){t(1,r=h=="Questions"?M():g[u].attempts.length-1)}function E(){t(5,p=!p),Y.files.update(o,{flagged:p})}const j=Oe(()=>Y.files.where("route").startsWith(l.params.path).toArray().then(I=>I.map(b=>({id:b.id,route:b.route,name:b.name,flagged:b.flagged,attempts:b.attempts.map(d=>({questions:d.questionCount,mistakes:d.mistakeCount}))}))));Z(n,j,I=>t(13,s=I));let g=[];function C(){Y.files.update(o,I=>{I.attempts[r].questionCount=0}),T()}function P(){h=We(this),t(3,h),t(6,a)}return n.$$set=I=>{"problemRoute"in I&&t(12,i=I.problemRoute),"problemId"in I&&t(0,o=I.problemId)},n.$$.update=()=>{var I;if(n.$$.dirty&16384&&t(1,r=l.data.attemptIdx),n.$$.dirty&12296){const b=s??[];switch(h){case"Work":t(4,g=b.filter(d=>d.route===i).sort((d,c)=>ze(d.name,c.name)));break;case"Mistakes":t(4,g=b.filter(d=>d.attempts.at(-1).mistakes>0||d.flagged));break;case"Questions":t(4,g=b.filter(d=>d.attempts.some(c=>c.questions>0)));break}}if(n.$$.dirty&17&&t(2,u=Math.max(0,g.findIndex(b=>b.id===o))),n.$$.dirty&30){const b=(I=g[u])==null?void 0:I.id;b&&le(String(b)+Ve({studyMode:h,attempt:String(r+1)}))}n.$$.dirty&1&&Y.files.get(o).then(b=>{t(5,p=(b==null?void 0:b.flagged)??!1),m=(b==null?void 0:b.name)??""})},[o,r,u,h,g,p,a,v,T,E,j,C,i,s,l,P]}class ct extends te{constructor(e){super(),ne(this,e,ft,ut,ee,{problemRoute:12,problemId:0})}}function ht(n){let e,t,s,l,a=n[0]+1+"",i;return{c(){e=N("div"),t=N("canvas"),l=x(`
    Attempt `),i=x(a),this.h()},l(o){e=q(o,"DIV",{class:!0});var r=L(e);t=q(r,"CANVAS",{width:!0,height:!0}),L(t).forEach(_),l=$(r,`
    Attempt `),i=$(r,a),r.forEach(_),this.h()},h(){w(t,"width",n[1]),w(t,"height",s=n[1]-24),w(e,"class","text-center bg-gray-50 rounded-md"),R(e,"width",n[1]+"px")},m(o,r){D(o,e,r),S(e,t),n[4](t),S(e,l),S(e,i)},p(o,[r]){r&2&&w(t,"width",o[1]),r&2&&s!==(s=o[1]-24)&&w(t,"height",s),r&1&&a!==(a=o[0]+1+"")&&fe(i,a),r&2&&R(e,"width",o[1]+"px")},i:H,o:H,d(o){o&&_(e),n[4](null)}}}function mt(n,e,t){let{attempt:s}=e,{idx:l}=e,{size:a=100}=e,i;function o(u,h){const p=document.createElement("canvas");p.width=h[0].width,p.height=h[0].height,u.scale(a/p.width,(a-24)/p.height);for(const m of h)p.getContext("2d").putImageData(m,0,0),u.drawImage(p,0,0)}qe(async()=>{const u=i.getContext("2d");o(u,[s.work,s.error,s.questions])});function r(u){ie[u?"unshift":"push"](()=>{i=u,t(2,i)})}return n.$$set=u=>{"attempt"in u&&t(3,s=u.attempt),"idx"in u&&t(0,l=u.idx),"size"in u&&t(1,a=u.size)},[l,a,i,s,r]}class dt extends te{constructor(e){super(),ne(this,e,mt,ht,ee,{attempt:3,idx:0,size:1})}}function De(n,e,t){const s=n.slice();return s[5]=e[t],s[7]=t,s}function Te(n,e){let t,s,l,a,i;s=new dt({props:{attempt:e[5],idx:e[7]}});function o(){return e[4](e[7])}return{key:n,first:null,c(){t=N("button"),G(s.$$.fragment),this.h()},l(r){t=q(r,"BUTTON",{});var u=L(t);X(s.$$.fragment,u),u.forEach(_),this.h()},h(){this.first=t},m(r,u){D(r,t,u),J(s,t,null),l=!0,a||(i=B(t,"click",o),a=!0)},p(r,u){e=r;const h={};u&4&&(h.attempt=e[5]),u&4&&(h.idx=e[7]),s.$set(h)},i(r){l||(F(s.$$.fragment,r),l=!0)},o(r){z(s.$$.fragment,r),l=!1},d(r){r&&_(t),K(s),a=!1,i()}}}function pt(n){let e=[],t=new Map,s,l,a=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">➕</div>
    New Attempt`,i,o,r,u=re(n[2]??[]);const h=p=>""+p[0]+p[7];for(let p=0;p<u.length;p+=1){let m=De(n,u,p),v=h(m);t.set(v,e[p]=Te(v,m))}return{c(){for(let p=0;p<e.length;p+=1)e[p].c();s=V(),l=N("button"),l.innerHTML=a,this.h()},l(p){for(let m=0;m<e.length;m+=1)e[m].l(p);s=O(p),l=q(p,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(l)!=="svelte-1goxpwn"&&(l.innerHTML=a),this.h()},h(){w(l,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(p,m){for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(p,m);D(p,s,m),D(p,l,m),i=!0,o||(r=B(l,"click",n[3]),o=!0)},p(p,[m]){m&5&&(u=re(p[2]??[]),Pe(),e=Qe(e,m,h,1,p,u,t,s.parentNode,Ge,Te,s,De),Be())},i(p){if(!i){for(let m=0;m<u.length;m+=1)F(e[m]);i=!0}},o(p){for(let m=0;m<e.length;m+=1)z(e[m]);i=!1},d(p){p&&(_(s),_(l));for(let m=0;m<e.length;m+=1)e[m].d(p);o=!1,r()}}}function gt(n,e,t){let s,l=H,a=()=>(l(),l=Se(o,h=>t(2,s=h)),o);n.$$.on_destroy.push(()=>l());let{problemId:i}=e,o;function r(){Y.files.update(i,h=>{le("?attempt="+h.attempts.push(Je.newBlankAttempt()))})}const u=h=>le(Ve({attempt:String(h+1)}));return n.$$set=h=>{"problemId"in h&&t(0,i=h.problemId)},n.$$.update=()=>{n.$$.dirty&1&&a(t(1,o=Oe(()=>Y.files.get(i).then(h=>h.attempts))))},[i,o,s,r,u]}class _t extends te{constructor(e){super(),ne(this,e,gt,pt,ee,{problemId:0})}}function bt(n){let e,t,s;return{c(){e=N("canvas"),this.h()},l(l){e=q(l,"CANVAS",{class:!0}),L(e).forEach(_),this.h()},h(){w(e,"class","fixed left-0 top-[2em]")},m(l,a){D(l,e,a),n[3](e),t||(s=B(e,"mousedown",n[1]),t=!0)},p:H,i:H,o:H,d(l){l&&_(e),n[3](null),t=!1,s()}}}function wt(n,e,t){let{problemId:s}=e,l,a;function i(r){setTimeout(()=>{a.dragStart(r)})}function o(r){ie[r?"unshift":"push"](()=>{l=r,t(0,l),t(2,s)})}return n.$$set=r=>{"problemId"in r&&t(2,s=r.problemId)},n.$$.update=()=>{n.$$.dirty&5&&Y.files.get(s).then(r=>{r!=null&&r.question&&(t(0,l.width=r.question.width,l),t(0,l.height=r.question.height,l),l.getContext("2d").putImageData(r.question,0,0))})},[l,i,s,o]}class vt extends te{constructor(e){super(),ne(this,e,wt,bt,ee,{problemId:2})}}function Me(n,e,t){const s=n.slice();return s[9]=e[t],s}function ye(n){let e,t=n[9]+"",s;return{c(){e=x("/"),s=x(t)},l(l){e=$(l,"/"),s=$(l,t)},m(l,a){D(l,e,a),D(l,s,a)},p(l,a){a&4&&t!==(t=l[9]+"")&&fe(s,t)},d(l){l&&(_(e),_(s))}}}function kt(n){let e,t,s,l,a,i,o,r,u,h,p,m,v,M,T,A,E,j,g,C,P;t=new vt({props:{problemId:n[0]}}),l=new at({props:{selectedTool:n[4],problemId:n[0],attemptId:n[3]}});let I=re(n[2].params.path.split("/")),b=[];for(let d=0;d<I.length;d+=1)b[d]=ye(Me(n,I,d));return M=new ct({props:{problemId:n[0],problemRoute:n[1]}}),E=new lt({props:{selected:n[4]}}),C=new _t({props:{problemId:n[0]}}),{c(){e=V(),G(t.$$.fragment),s=V(),G(l.$$.fragment),a=V(),i=N("div"),o=N("div"),r=N("a"),u=x("🏠"),p=V();for(let d=0;d<b.length;d+=1)b[d].c();m=V(),v=N("div"),G(M.$$.fragment),T=V(),A=N("div"),G(E.$$.fragment),j=V(),g=N("div"),G(C.$$.fragment),this.h()},l(d){Fe("svelte-pyemm1",document.head).forEach(_),e=O(d),X(t.$$.fragment,d),s=O(d),X(l.$$.fragment,d),a=O(d),i=q(d,"DIV",{id:!0,class:!0});var f=L(i);o=q(f,"DIV",{id:!0,class:!0});var k=L(o);r=q(k,"A",{href:!0});var U=L(r);u=$(U,"🏠"),U.forEach(_),p=O(k);for(let ce=0;ce<b.length;ce+=1)b[ce].l(k);k.forEach(_),m=O(f),v=q(f,"DIV",{id:!0,class:!0});var W=L(v);X(M.$$.fragment,W),W.forEach(_),T=O(f),A=q(f,"DIV",{id:!0,class:!0});var y=L(A);X(E.$$.fragment,y),y.forEach(_),j=O(f),g=q(f,"DIV",{id:!0,class:!0});var se=L(g);X(C.$$.fragment,se),se.forEach(_),f.forEach(_),this.h()},h(){document.title="MathMan Draw",w(r,"href",h=pe(n[2])),w(o,"id","breadcrumbs"),w(o,"class","svelte-1je8nl3"),w(v,"id","question-management"),w(v,"class","text-right svelte-1je8nl3"),w(A,"id","tools-container"),w(A,"class","svelte-1je8nl3"),w(g,"id","attempts-container"),w(g,"class","flex flex-col p-3 gap-3 svelte-1je8nl3"),w(i,"id","grid"),w(i,"class","svelte-1je8nl3")},m(d,c){D(d,e,c),J(t,d,c),D(d,s,c),J(l,d,c),D(d,a,c),D(d,i,c),S(i,o),S(o,r),S(r,u),S(o,p);for(let f=0;f<b.length;f+=1)b[f]&&b[f].m(o,null);S(i,m),S(i,v),J(M,v,null),S(i,T),S(i,A),J(E,A,null),S(i,j),S(i,g),J(C,g,null),P=!0},p(d,[c]){const f={};c&1&&(f.problemId=d[0]),t.$set(f);const k={};if(c&1&&(k.problemId=d[0]),c&8&&(k.attemptId=d[3]),l.$set(k),(!P||c&4&&h!==(h=pe(d[2])))&&w(r,"href",h),c&4){I=re(d[2].params.path.split("/"));let y;for(y=0;y<I.length;y+=1){const se=Me(d,I,y);b[y]?b[y].p(se,c):(b[y]=ye(se),b[y].c(),b[y].m(o,null))}for(;y<b.length;y+=1)b[y].d(1);b.length=I.length}const U={};c&1&&(U.problemId=d[0]),c&2&&(U.problemRoute=d[1]),M.$set(U);const W={};c&1&&(W.problemId=d[0]),C.$set(W)},i(d){P||(F(t.$$.fragment,d),F(l.$$.fragment,d),F(M.$$.fragment,d),F(E.$$.fragment,d),F(C.$$.fragment,d),P=!0)},o(d){z(t.$$.fragment,d),z(l.$$.fragment,d),z(M.$$.fragment,d),z(E.$$.fragment,d),z(C.$$.fragment,d),P=!1},d(d){d&&(_(e),_(s),_(a),_(i)),K(t,d),K(l,d),Le(b,d),K(M),K(E),K(C)}}}function It(n,e,t){let s,l,a;Z(n,ae,m=>t(2,l=m));const i=_e(Q.None),o=_e(!1);Ne("eraserEnabled",o);const r=be(ae,m=>m.data.problemId);Z(n,r,m=>t(0,s=m));const u=be(ae,m=>m.data.attemptIdx);Z(n,u,m=>t(3,a=m));let h;function p(m){s!==0&&(m?(t(1,h=m.route),h.startsWith(l.params.path)||le(de(h,l.params.problemId))):le(pe(l)))}return n.$$.update=()=>{n.$$.dirty&1&&Y.files.get(s).then(p)},[s,h,l,a,i,r,u]}class Nt extends te{constructor(e){super(),ne(this,e,It,kt,ee,{})}}export{Nt as component};
