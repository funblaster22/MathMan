import{s as O,n as L,r as we,o as be,f as Ce,b as ae,e as ee}from"../chunks/scheduler.03df403d.js";import{S as R,i as Y,g as b,s as V,h as I,j as N,z,c as q,f as g,l as S,k as p,a as T,x as D,A as M,y as re,m as te,n as ne,B as ce,o as oe,d as Q,p as ke,b as De,t as x,r as G,u as J,v as K,w as Z}from"../chunks/index.5bc90a32.js";import{d as B,e as P,a as Ie,n as Te,p as ue}from"../chunks/index.83a2109c.js";import{j as ye,w as Ee,k as fe,e as de}from"../chunks/singletons.344e2871.js";import{p as le}from"../chunks/stores.ec7edf87.js";var k=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Erase=4]="Erase",n))(k||{});const ie=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href,Ae=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function Ne(n){let e,s,a=`<img src="${ie}" title="Your work" draggable="false"/>`,r,l,f=`<img src="${ie}" title="Correct" draggable="false"/>`,c,t,h=`<img src="${ie}" title="Question" draggable="false"/>`,u,o,i=`<img src="${Ae}" title="Eraser" draggable="false"/>`,v,_;return{c(){e=b("div"),s=b("div"),s.innerHTML=a,r=V(),l=b("div"),l.innerHTML=f,c=V(),t=b("div"),t.innerHTML=h,u=V(),o=b("div"),o.innerHTML=i,this.h()},l(E){e=I(E,"DIV",{id:!0});var C=N(e);s=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),z(s)!=="svelte-1um81qx"&&(s.innerHTML=a),r=q(C),l=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),z(l)!=="svelte-lqddij"&&(l.innerHTML=f),c=q(C),t=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),z(t)!=="svelte-1ovzcqk"&&(t.innerHTML=h),u=q(C),o=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),z(o)!=="svelte-1264pa0"&&(o.innerHTML=i),C.forEach(g),this.h()},h(){S(s,"width","30px"),S(s,"filter","grayscale(1)"),p(s,"data-tool",k.Draw),S(l,"width","30px"),S(l,"filter","hue-rotate(136deg)"),p(l,"data-tool",k.Correct),S(t,"width","30px"),p(t,"data-tool",k.Question),S(o,"width","30px"),p(o,"data-tool",k.Erase),p(e,"id","tools")},m(E,C){T(E,e,C),D(e,s),D(e,r),D(e,l),D(e,c),D(e,t),D(e,u),D(e,o),v||(_=[M(s,"click",n[0]),M(l,"click",n[0]),M(t,"click",n[0]),M(o,"click",n[0])],v=!0)},p:L,i:L,o:L,d(E){E&&g(e),v=!1,we(_)}}}function Ve(n,e,s){let{selected:a}=e;function r(l){l.stopPropagation();const f=l.currentTarget,c=f.style.height=="100%";for(const t of document.querySelectorAll("#tools > div"))t.style.height="30px";for(const t of document.querySelectorAll(".tool"))t.id="";if(c){a.set(k.None);return}a.set(Number.parseInt(f.dataset.tool)),f.style.height="100%"}return n.$$set=l=>{"selected"in l&&s(1,a=l.selected)},[r,a]}class qe extends R{constructor(e){super(),Y(this,e,Ve,Ne,O,{selected:1})}}function Me(n){let e,s,a,r,l,f,c;return{c(){e=b("canvas"),s=V(),a=b("canvas"),r=V(),l=b("canvas"),this.h()},l(t){e=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(e).forEach(g),s=q(t),a=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(a).forEach(g),r=q(t),l=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(l).forEach(g),this.h()},h(){p(e,"width",n[2]),p(e,"height",n[3]),p(e,"class","svelte-1rofrvo"),p(a,"width",n[2]),p(a,"height",n[3]),p(a,"class","svelte-1rofrvo"),p(l,"width",n[2]),p(l,"height",n[3]),p(l,"class","svelte-1rofrvo")},m(t,h){T(t,e,h),n[9](e),T(t,s,h),T(t,a,h),n[10](a),T(t,r,h),T(t,l,h),n[11](l),f||(c=[M(l,"pointerdown",n[4]),M(l,"pointerup",n[5]),M(l,"pointermove",n[6])],f=!0)},p(t,[h]){h&4&&p(e,"width",t[2]),h&8&&p(e,"height",t[3]),h&4&&p(a,"width",t[2]),h&8&&p(a,"height",t[3]),h&4&&p(l,"width",t[2]),h&8&&p(l,"height",t[3])},i:L,o:L,d(t){t&&(g(e),g(s),g(a),g(r),g(l)),n[9](null),n[10](null),n[11](null),f=!1,we(c)}}}function Le(n,e,s){let a,r=L,l=()=>(r(),r=Ce(f,d=>s(13,a=d)),f);n.$$.on_destroy.push(()=>r());let{selectedTool:f}=e;l();let{problemId:c}=e,{attemptId:t}=e,h=0,u=0,o=!1,i=[];function v(){typeof window>"u"||(s(2,h=window.innerWidth),s(3,u=window.innerHeight),requestAnimationFrame(async()=>{const d=(await B.files.get(c)).attempts[t];i[k.Draw].putImageData(d.work,0,0),i[k.Correct].putImageData(d.error,0,0),i[k.Question].putImageData(d.questions,0,0)}))}function _(){const d=[0,0,h,u];B.files.update(c,w=>{w.attempts[t]={date:new Date,work:i[k.Draw].getImageData(...d),error:i[k.Correct].getImageData(...d),questions:i[k.Question].getImageData(...d),rois:w.attempts[t].rois}})}const E=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,C={[k.Draw]:E?"white":"black",[k.Correct]:"red",[k.Question]:"blue"},F=d=>{if(a==k.None)return;const w=i[a];o=!0,w.strokeStyle=C[a],w.beginPath(),w.moveTo(d.clientX,d.clientY)},$=()=>{o=!1,_()},se=d=>{if(o){const w=i[a];w.lineTo(d.clientX,d.clientY),w.stroke()}};be(()=>{window.onresize=v,s(1,i=i.map(d=>d.getContext("2d",{willReadFrequently:!0})))});function H(d){ae[d?"unshift":"push"](()=>{i[k.Draw]=d,s(1,i)})}function y(d){ae[d?"unshift":"push"](()=>{i[k.Correct]=d,s(1,i)})}function m(d){ae[d?"unshift":"push"](()=>{i[k.Question]=d,s(1,i)})}return n.$$set=d=>{"selectedTool"in d&&l(s(0,f=d.selectedTool)),"problemId"in d&&s(7,c=d.problemId),"attemptId"in d&&s(8,t=d.attemptId)},n.$$.update=()=>{if(n.$$.dirty&386){v();for(const d of i){const w=d.canvas;d.clearRect(0,0,w.width,w.height)}}},[f,i,h,u,F,$,se,c,t,H,y,m]}class He extends R{constructor(e){super(),Y(this,e,Le,Me,O,{selectedTool:0,problemId:7,attemptId:8})}}const j=ye("goto");function he(n,e,s){const a=n.slice();return a[4]=e[s],a}function me(n){let e,s=n[4].name+"",a,r;return{c(){e=b("option"),a=te(s),this.h()},l(l){e=I(l,"OPTION",{});var f=N(e);a=ne(f,s),f.forEach(g),this.h()},h(){e.__value=r=n[4].id,ce(e,e.__value)},m(l,f){T(l,e,f),D(e,a)},p(l,f){f&1&&s!==(s=l[4].name+"")&&oe(a,s),f&1&&r!==(r=l[4].id)&&(e.__value=r,ce(e,e.__value))},d(l){l&&g(e)}}}function Se(n){let e,s="üö©",a,r,l,f,c="‚û°Ô∏è",t,h,u=P(n[0]??[]),o=[];for(let i=0;i<u.length;i+=1)o[i]=me(he(n,u,i));return{c(){e=b("button"),e.textContent=s,a=V(),r=b("select");for(let i=0;i<o.length;i+=1)o[i].c();l=V(),f=b("button"),f.textContent=c},l(i){e=I(i,"BUTTON",{"data-svelte-h":!0}),z(e)!=="svelte-yzpet0"&&(e.textContent=s),a=q(i),r=I(i,"SELECT",{});var v=N(r);for(let _=0;_<o.length;_+=1)o[_].l(v);v.forEach(g),l=q(i),f=I(i,"BUTTON",{"data-svelte-h":!0}),z(f)!=="svelte-q61pzu"&&(f.textContent=c)},m(i,v){T(i,e,v),T(i,a,v),T(i,r,v);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(r,null);T(i,l,v),T(i,f,v),t||(h=M(r,"change",n[1]),t=!0)},p(i,[v]){if(v&1){u=P(i[0]??[]);let _;for(_=0;_<u.length;_+=1){const E=he(i,u,_);o[_]?o[_].p(E,v):(o[_]=me(E),o[_].c(),o[_].m(r,null))}for(;_<o.length;_+=1)o[_].d(1);o.length=u.length}},i:L,o:L,d(i){i&&(g(e),g(a),g(r),g(l),g(f)),re(o,i),t=!1,h()}}}function ze(n,e,s){let a,{parentFolder:r}=e;function l(c){const t=c.target.value;j(t)}const f=Ie(()=>B.files.where({parent:r}).toArray());return ee(n,f,c=>s(0,a=c)),n.$$set=c=>{"parentFolder"in c&&s(3,r=c.parentFolder)},[a,l,f,r]}class Qe extends R{constructor(e){super(),Y(this,e,ze,Se,O,{parentFolder:3})}}function xe(n){let e,s,a,r,l=n[0]+1+"",f;return{c(){e=b("div"),s=b("canvas"),r=te(`
    Attempt `),f=te(l),this.h()},l(c){e=I(c,"DIV",{class:!0});var t=N(e);s=I(t,"CANVAS",{width:!0,height:!0}),N(s).forEach(g),r=ne(t,`
    Attempt `),f=ne(t,l),t.forEach(g),this.h()},h(){p(s,"width",n[1]),p(s,"height",a=n[1]-24),p(e,"class","text-center bg-gray-50 rounded-md"),S(e,"width",n[1]+"px")},m(c,t){T(c,e,t),D(e,s),n[4](s),D(e,r),D(e,f)},p(c,[t]){t&2&&p(s,"width",c[1]),t&2&&a!==(a=c[1]-24)&&p(s,"height",a),t&1&&l!==(l=c[0]+1+"")&&oe(f,l),t&2&&S(e,"width",c[1]+"px")},i:L,o:L,d(c){c&&g(e),n[4](null)}}}function Fe(n,e,s){let{attempt:a}=e,{idx:r}=e,{size:l=100}=e,f;function c(h,u){const o=document.createElement("canvas");o.width=u[0].width,o.height=u[0].height,h.scale(l/o.width,(l-24)/o.height);for(const i of u)o.getContext("2d").putImageData(i,0,0),h.drawImage(o,0,0)}be(async()=>{const h=f.getContext("2d");c(h,[a.work,a.error,a.questions])});function t(h){ae[h?"unshift":"push"](()=>{f=h,s(2,f)})}return n.$$set=h=>{"attempt"in h&&s(3,a=h.attempt),"idx"in h&&s(0,r=h.idx),"size"in h&&s(1,l=h.size)},[r,l,f,a,t]}class Ue extends R{constructor(e){super(),Y(this,e,Fe,xe,O,{attempt:3,idx:0,size:1})}}function pe(n,e,s){const a=n.slice();return a[5]=e[s],a[7]=s,a}function ge(n){let e,s,a,r,l;s=new Ue({props:{attempt:n[5],idx:n[7]}});function f(){return n[4](n[7])}return{c(){e=b("div"),G(s.$$.fragment)},l(c){e=I(c,"DIV",{});var t=N(e);J(s.$$.fragment,t),t.forEach(g)},m(c,t){T(c,e,t),K(s,e,null),a=!0,r||(l=M(e,"click",f),r=!0)},p(c,t){n=c;const h={};t&1&&(h.attempt=n[5]),s.$set(h)},i(c){a||(Q(s.$$.fragment,c),a=!0)},o(c){x(s.$$.fragment,c),a=!1},d(c){c&&g(e),Z(s),r=!1,l()}}}function je(n){let e,s,a=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,r,l,f,c=P(n[0]??[]),t=[];for(let u=0;u<c.length;u+=1)t[u]=ge(pe(n,c,u));const h=u=>x(t[u],1,1,()=>{t[u]=null});return{c(){for(let u=0;u<t.length;u+=1)t[u].c();e=V(),s=b("div"),s.innerHTML=a,this.h()},l(u){for(let o=0;o<t.length;o+=1)t[o].l(u);e=q(u),s=I(u,"DIV",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-59ttd9"&&(s.innerHTML=a),this.h()},h(){p(s,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(u,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(u,o);T(u,e,o),T(u,s,o),r=!0,l||(f=M(s,"click",n[2]),l=!0)},p(u,[o]){if(o&1){c=P(u[0]??[]);let i;for(i=0;i<c.length;i+=1){const v=pe(u,c,i);t[i]?(t[i].p(v,o),Q(t[i],1)):(t[i]=ge(v),t[i].c(),Q(t[i],1),t[i].m(e.parentNode,e))}for(ke(),i=c.length;i<t.length;i+=1)h(i);De()}},i(u){if(!r){for(let o=0;o<c.length;o+=1)Q(t[o]);r=!0}},o(u){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)x(t[o]);r=!1},d(u){u&&(g(e),g(s)),re(t,u),l=!1,f()}}}function Be(n,e,s){let a,{problemId:r}=e;const l=Ie(()=>B.files.get(r).then(t=>t.attempts));ee(n,l,t=>s(0,a=t));function f(){B.files.update(r,t=>{j("?attempt="+t.attempts.push(Te()))})}const c=t=>j("?attempt="+(t+1));return n.$$set=t=>{"problemId"in t&&s(3,r=t.problemId)},[a,l,f,r,c]}class Pe extends R{constructor(e){super(),Y(this,e,Be,je,O,{problemId:3})}}function _e(n,e,s){const a=n.slice();return a[8]=e[s],a}function ve(n){let e,s=n[8]+"",a;return{c(){e=te("/"),a=te(s)},l(r){e=ne(r,"/"),a=ne(r,s)},m(r,l){T(r,e,l),T(r,a,l)},p(r,l){l&2&&s!==(s=r[8]+"")&&oe(a,s)},d(r){r&&(g(e),g(a))}}}function Oe(n){let e,s,a,r,l,f="üè†",c,t,h,u,o,i,v,_,E,C,F,$,se;e=new He({props:{selectedTool:n[3],problemId:n[0],attemptId:n[2]}});let H=P(n[1].params.path.split("/")),y=[];for(let m=0;m<H.length;m+=1)y[m]=ve(_e(n,H,m));return u=new Qe({props:{parentFolder:n[1].params.path.split("/").at(-1)}}),v=new qe({props:{selected:n[3]}}),C=new Pe({props:{problemId:n[0]}}),{c(){G(e.$$.fragment),s=V(),a=b("div"),r=b("div"),l=b("button"),l.textContent=f,c=V();for(let m=0;m<y.length;m+=1)y[m].c();t=V(),h=b("div"),G(u.$$.fragment),o=V(),i=b("div"),G(v.$$.fragment),_=V(),E=b("div"),G(C.$$.fragment),this.h()},l(m){J(e.$$.fragment,m),s=q(m),a=I(m,"DIV",{id:!0,class:!0});var d=N(a);r=I(d,"DIV",{class:!0});var w=N(r);l=I(w,"BUTTON",{"data-svelte-h":!0}),z(l)!=="svelte-1xjub06"&&(l.textContent=f),c=q(w);for(let U=0;U<y.length;U+=1)y[U].l(w);w.forEach(g),t=q(d),h=I(d,"DIV",{class:!0});var W=N(h);J(u.$$.fragment,W),W.forEach(g),o=q(d),i=I(d,"DIV",{id:!0,class:!0});var X=N(i);J(v.$$.fragment,X),X.forEach(g),_=q(d),E=I(d,"DIV",{id:!0,class:!0});var A=N(E);J(C.$$.fragment,A),A.forEach(g),d.forEach(g),this.h()},h(){p(r,"class","svelte-aa6inf"),p(h,"class","text-right svelte-aa6inf"),p(i,"id","tools-container"),p(i,"class","svelte-aa6inf"),p(E,"id","attempts-container"),p(E,"class","flex flex-col p-3 gap-3 svelte-aa6inf"),p(a,"id","grid"),p(a,"class","svelte-aa6inf")},m(m,d){K(e,m,d),T(m,s,d),T(m,a,d),D(a,r),D(r,l),D(r,c);for(let w=0;w<y.length;w+=1)y[w]&&y[w].m(r,null);D(a,t),D(a,h),K(u,h,null),D(a,o),D(a,i),K(v,i,null),D(a,_),D(a,E),K(C,E,null),F=!0,$||(se=M(l,"click",n[6]),$=!0)},p(m,[d]){const w={};if(d&1&&(w.problemId=m[0]),d&4&&(w.attemptId=m[2]),e.$set(w),d&2){H=P(m[1].params.path.split("/"));let A;for(A=0;A<H.length;A+=1){const U=_e(m,H,A);y[A]?y[A].p(U,d):(y[A]=ve(U),y[A].c(),y[A].m(r,null))}for(;A<y.length;A+=1)y[A].d(1);y.length=H.length}const W={};d&2&&(W.parentFolder=m[1].params.path.split("/").at(-1)),u.$set(W);const X={};d&1&&(X.problemId=m[0]),C.$set(X)},i(m){F||(Q(e.$$.fragment,m),Q(u.$$.fragment,m),Q(v.$$.fragment,m),Q(C.$$.fragment,m),F=!0)},o(m){x(e.$$.fragment,m),x(u.$$.fragment,m),x(v.$$.fragment,m),x(C.$$.fragment,m),F=!1},d(m){m&&(g(s),g(a)),Z(e,m),re(y,m),Z(u),Z(v),Z(C),$=!1,se()}}}function Re(n,e,s){let a,r,l;ee(n,le,o=>s(1,r=o));const f=Ee(k.None),c=fe(le,o=>Number.parseInt(o.params.problemId));ee(n,c,o=>s(0,a=o));const t=fe(le,o=>Number.parseInt(o.url.searchParams.get("attempt")??"1")-1);ee(n,t,o=>s(2,l=o));function h(o){if(o){const i=o.route.join("/");"/"+r.params.path!==i&&j(ue.join("/",de,i,r.params.problemId))}else j(ue.join("/",de,r.params.path))}const u=()=>j("..");return n.$$.update=()=>{n.$$.dirty&1&&typeof window<"u"&&B.files.get(a).then(h)},[a,r,l,f,c,t,u]}class Je extends R{constructor(e){super(),Y(this,e,Re,Oe,O,{})}}export{Je as component};
