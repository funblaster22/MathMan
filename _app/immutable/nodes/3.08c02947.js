import{s as U,n as H,r as ge,o as _e,f as we,b as ae,e as ee}from"../chunks/scheduler.03df403d.js";import{S as R,i as Y,g as b,s as V,h as I,j as N,z as Q,c as M,f as g,l as S,k as p,a as y,x as D,A as q,y as ie,m as te,n as ne,B as oe,o as re,d as z,p as be,b as Ie,t as x,r as J,u as K,v as Z,w as $}from"../chunks/index.5bc90a32.js";import{d as O,e as j,a as ve,n as Ce}from"../chunks/newBlankAttempt.6980252a.js";import{j as ke,w as De,k as ce}from"../chunks/singletons.3a7a8728.js";import{p as le}from"../chunks/stores.4d916908.js";var k=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Erase=4]="Erase",n))(k||{});function ye(n){let e,s,a='<img src="/marker.png" title="Your work" draggable="false"/>',r,l,f='<img src="/marker.png" title="Correct" draggable="false"/>',c,t,h='<img src="/marker.png" title="Question" draggable="false"/>',u,o,i='<img src="/eraser.png" title="Eraser" draggable="false"/>',v,_;return{c(){e=b("div"),s=b("div"),s.innerHTML=a,r=V(),l=b("div"),l.innerHTML=f,c=V(),t=b("div"),t.innerHTML=h,u=V(),o=b("div"),o.innerHTML=i,this.h()},l(E){e=I(E,"DIV",{id:!0});var C=N(e);s=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(s)!=="svelte-s7g5ry"&&(s.innerHTML=a),r=M(C),l=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(l)!=="svelte-ycay66"&&(l.innerHTML=f),c=M(C),t=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(t)!=="svelte-1pok5wx"&&(t.innerHTML=h),u=M(C),o=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(o)!=="svelte-1sq5307"&&(o.innerHTML=i),C.forEach(g),this.h()},h(){S(s,"width","30px"),S(s,"filter","grayscale(1)"),p(s,"data-tool",k.Draw),S(l,"width","30px"),S(l,"filter","hue-rotate(136deg)"),p(l,"data-tool",k.Correct),S(t,"width","30px"),p(t,"data-tool",k.Question),S(o,"width","30px"),p(o,"data-tool",k.Erase),p(e,"id","tools")},m(E,C){y(E,e,C),D(e,s),D(e,r),D(e,l),D(e,c),D(e,t),D(e,u),D(e,o),v||(_=[q(s,"click",n[0]),q(l,"click",n[0]),q(t,"click",n[0]),q(o,"click",n[0])],v=!0)},p:H,i:H,o:H,d(E){E&&g(e),v=!1,ge(_)}}}function Te(n,e,s){let{selected:a}=e;function r(l){l.stopPropagation();const f=l.currentTarget,c=f.style.height=="100%";for(const t of document.querySelectorAll("#tools > div"))t.style.height="30px";for(const t of document.querySelectorAll(".tool"))t.id="";if(c){a.set(k.None);return}a.set(Number.parseInt(f.dataset.tool)),f.style.height="100%"}return n.$$set=l=>{"selected"in l&&s(1,a=l.selected)},[r,a]}class Ee extends R{constructor(e){super(),Y(this,e,Te,ye,U,{selected:1})}}function Ae(n){let e,s,a,r,l,f,c;return{c(){e=b("canvas"),s=V(),a=b("canvas"),r=V(),l=b("canvas"),this.h()},l(t){e=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(e).forEach(g),s=M(t),a=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(a).forEach(g),r=M(t),l=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(l).forEach(g),this.h()},h(){p(e,"width",n[2]),p(e,"height",n[3]),p(e,"class","svelte-1rofrvo"),p(a,"width",n[2]),p(a,"height",n[3]),p(a,"class","svelte-1rofrvo"),p(l,"width",n[2]),p(l,"height",n[3]),p(l,"class","svelte-1rofrvo")},m(t,h){y(t,e,h),n[9](e),y(t,s,h),y(t,a,h),n[10](a),y(t,r,h),y(t,l,h),n[11](l),f||(c=[q(l,"pointerdown",n[4]),q(l,"pointerup",n[5]),q(l,"pointermove",n[6])],f=!0)},p(t,[h]){h&4&&p(e,"width",t[2]),h&8&&p(e,"height",t[3]),h&4&&p(a,"width",t[2]),h&8&&p(a,"height",t[3]),h&4&&p(l,"width",t[2]),h&8&&p(l,"height",t[3])},i:H,o:H,d(t){t&&(g(e),g(s),g(a),g(r),g(l)),n[9](null),n[10](null),n[11](null),f=!1,ge(c)}}}function Ne(n,e,s){let a,r=H,l=()=>(r(),r=we(f,d=>s(13,a=d)),f);n.$$.on_destroy.push(()=>r());let{selectedTool:f}=e;l();let{problemId:c}=e,{attemptId:t}=e,h=0,u=0,o=!1,i=[];function v(){typeof window>"u"||(s(2,h=window.innerWidth),s(3,u=window.innerHeight),requestAnimationFrame(async()=>{const d=(await O.files.get(c)).attempts[t];i[k.Draw].putImageData(d.work,0,0),i[k.Correct].putImageData(d.error,0,0),i[k.Question].putImageData(d.questions,0,0)}))}function _(){const d=[0,0,h,u];O.files.update(c,w=>{w.attempts[t]={date:new Date,work:i[k.Draw].getImageData(...d),error:i[k.Correct].getImageData(...d),questions:i[k.Question].getImageData(...d),rois:w.attempts[t].rois}})}const E=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,C={[k.Draw]:E?"white":"black",[k.Correct]:"red",[k.Question]:"blue"},F=d=>{if(a==k.None)return;const w=i[a];o=!0,w.strokeStyle=C[a],w.beginPath(),w.moveTo(d.clientX,d.clientY)},W=()=>{o=!1,_()},se=d=>{if(o){const w=i[a];w.lineTo(d.clientX,d.clientY),w.stroke()}};_e(()=>{window.onresize=v,s(1,i=i.map(d=>d.getContext("2d",{willReadFrequently:!0})))});function L(d){ae[d?"unshift":"push"](()=>{i[k.Draw]=d,s(1,i)})}function T(d){ae[d?"unshift":"push"](()=>{i[k.Correct]=d,s(1,i)})}function m(d){ae[d?"unshift":"push"](()=>{i[k.Question]=d,s(1,i)})}return n.$$set=d=>{"selectedTool"in d&&l(s(0,f=d.selectedTool)),"problemId"in d&&s(7,c=d.problemId),"attemptId"in d&&s(8,t=d.attemptId)},n.$$.update=()=>{if(n.$$.dirty&386){v();for(const d of i){const w=d.canvas;d.clearRect(0,0,w.width,w.height)}}},[f,i,h,u,F,W,se,c,t,L,T,m]}class Ve extends R{constructor(e){super(),Y(this,e,Ne,Ae,U,{selectedTool:0,problemId:7,attemptId:8})}}const P=ke("goto");function ue(n,e,s){const a=n.slice();return a[4]=e[s],a}function fe(n){let e,s=n[4].name+"",a,r;return{c(){e=b("option"),a=te(s),this.h()},l(l){e=I(l,"OPTION",{});var f=N(e);a=ne(f,s),f.forEach(g),this.h()},h(){e.__value=r=n[4].id,oe(e,e.__value)},m(l,f){y(l,e,f),D(e,a)},p(l,f){f&1&&s!==(s=l[4].name+"")&&re(a,s),f&1&&r!==(r=l[4].id)&&(e.__value=r,oe(e,e.__value))},d(l){l&&g(e)}}}function Me(n){let e,s="üö©",a,r,l,f,c="‚û°Ô∏è",t,h,u=j(n[0]??[]),o=[];for(let i=0;i<u.length;i+=1)o[i]=fe(ue(n,u,i));return{c(){e=b("button"),e.textContent=s,a=V(),r=b("select");for(let i=0;i<o.length;i+=1)o[i].c();l=V(),f=b("button"),f.textContent=c},l(i){e=I(i,"BUTTON",{"data-svelte-h":!0}),Q(e)!=="svelte-yzpet0"&&(e.textContent=s),a=M(i),r=I(i,"SELECT",{});var v=N(r);for(let _=0;_<o.length;_+=1)o[_].l(v);v.forEach(g),l=M(i),f=I(i,"BUTTON",{"data-svelte-h":!0}),Q(f)!=="svelte-q61pzu"&&(f.textContent=c)},m(i,v){y(i,e,v),y(i,a,v),y(i,r,v);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(r,null);y(i,l,v),y(i,f,v),t||(h=q(r,"change",n[1]),t=!0)},p(i,[v]){if(v&1){u=j(i[0]??[]);let _;for(_=0;_<u.length;_+=1){const E=ue(i,u,_);o[_]?o[_].p(E,v):(o[_]=fe(E),o[_].c(),o[_].m(r,null))}for(;_<o.length;_+=1)o[_].d(1);o.length=u.length}},i:H,o:H,d(i){i&&(g(e),g(a),g(r),g(l),g(f)),ie(o,i),t=!1,h()}}}function qe(n,e,s){let a,{parentFolder:r}=e;function l(c){const t=c.target.value;P(t)}const f=ve(()=>O.files.where({parent:r}).toArray());return ee(n,f,c=>s(0,a=c)),n.$$set=c=>{"parentFolder"in c&&s(3,r=c.parentFolder)},[a,l,f,r]}class He extends R{constructor(e){super(),Y(this,e,qe,Me,U,{parentFolder:3})}}function Le(n){let e,s,a,r,l=n[0]+1+"",f;return{c(){e=b("div"),s=b("canvas"),r=te(`
    Attempt `),f=te(l),this.h()},l(c){e=I(c,"DIV",{class:!0});var t=N(e);s=I(t,"CANVAS",{width:!0,height:!0}),N(s).forEach(g),r=ne(t,`
    Attempt `),f=ne(t,l),t.forEach(g),this.h()},h(){p(s,"width",n[1]),p(s,"height",a=n[1]-24),p(e,"class","text-center bg-gray-50 rounded-md"),S(e,"width",n[1]+"px")},m(c,t){y(c,e,t),D(e,s),n[4](s),D(e,r),D(e,f)},p(c,[t]){t&2&&p(s,"width",c[1]),t&2&&a!==(a=c[1]-24)&&p(s,"height",a),t&1&&l!==(l=c[0]+1+"")&&re(f,l),t&2&&S(e,"width",c[1]+"px")},i:H,o:H,d(c){c&&g(e),n[4](null)}}}function Se(n,e,s){let{attempt:a}=e,{idx:r}=e,{size:l=100}=e,f;function c(h,u){const o=document.createElement("canvas");o.width=u[0].width,o.height=u[0].height,h.scale(l/o.width,(l-24)/o.height);for(const i of u)o.getContext("2d").putImageData(i,0,0),h.drawImage(o,0,0)}_e(async()=>{const h=f.getContext("2d");c(h,[a.work,a.error,a.questions])});function t(h){ae[h?"unshift":"push"](()=>{f=h,s(2,f)})}return n.$$set=h=>{"attempt"in h&&s(3,a=h.attempt),"idx"in h&&s(0,r=h.idx),"size"in h&&s(1,l=h.size)},[r,l,f,a,t]}class Qe extends R{constructor(e){super(),Y(this,e,Se,Le,U,{attempt:3,idx:0,size:1})}}function de(n,e,s){const a=n.slice();return a[5]=e[s],a[7]=s,a}function he(n){let e,s,a,r,l;s=new Qe({props:{attempt:n[5],idx:n[7]}});function f(){return n[4](n[7])}return{c(){e=b("div"),J(s.$$.fragment)},l(c){e=I(c,"DIV",{});var t=N(e);K(s.$$.fragment,t),t.forEach(g)},m(c,t){y(c,e,t),Z(s,e,null),a=!0,r||(l=q(e,"click",f),r=!0)},p(c,t){n=c;const h={};t&1&&(h.attempt=n[5]),s.$set(h)},i(c){a||(z(s.$$.fragment,c),a=!0)},o(c){x(s.$$.fragment,c),a=!1},d(c){c&&g(e),$(s),r=!1,l()}}}function ze(n){let e,s,a=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,r,l,f,c=j(n[0]??[]),t=[];for(let u=0;u<c.length;u+=1)t[u]=he(de(n,c,u));const h=u=>x(t[u],1,1,()=>{t[u]=null});return{c(){for(let u=0;u<t.length;u+=1)t[u].c();e=V(),s=b("div"),s.innerHTML=a,this.h()},l(u){for(let o=0;o<t.length;o+=1)t[o].l(u);e=M(u),s=I(u,"DIV",{class:!0,"data-svelte-h":!0}),Q(s)!=="svelte-59ttd9"&&(s.innerHTML=a),this.h()},h(){p(s,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(u,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(u,o);y(u,e,o),y(u,s,o),r=!0,l||(f=q(s,"click",n[2]),l=!0)},p(u,[o]){if(o&1){c=j(u[0]??[]);let i;for(i=0;i<c.length;i+=1){const v=de(u,c,i);t[i]?(t[i].p(v,o),z(t[i],1)):(t[i]=he(v),t[i].c(),z(t[i],1),t[i].m(e.parentNode,e))}for(be(),i=c.length;i<t.length;i+=1)h(i);Ie()}},i(u){if(!r){for(let o=0;o<c.length;o+=1)z(t[o]);r=!0}},o(u){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)x(t[o]);r=!1},d(u){u&&(g(e),g(s)),ie(t,u),l=!1,f()}}}function xe(n,e,s){let a,{problemId:r}=e;const l=ve(()=>O.files.get(r).then(t=>t.attempts));ee(n,l,t=>s(0,a=t));function f(){O.files.update(r,t=>{P("?attempt="+t.attempts.push(Ce()))})}const c=t=>P("?attempt="+(t+1));return n.$$set=t=>{"problemId"in t&&s(3,r=t.problemId)},[a,l,f,r,c]}class Fe extends R{constructor(e){super(),Y(this,e,xe,ze,U,{problemId:3})}}function me(n,e,s){const a=n.slice();return a[8]=e[s],a}function pe(n){let e,s=n[8]+"",a;return{c(){e=te("/"),a=te(s)},l(r){e=ne(r,"/"),a=ne(r,s)},m(r,l){y(r,e,l),y(r,a,l)},p(r,l){l&2&&s!==(s=r[8]+"")&&re(a,s)},d(r){r&&(g(e),g(a))}}}function Be(n){let e,s,a,r,l,f="üè†",c,t,h,u,o,i,v,_,E,C,F,W,se;e=new Ve({props:{selectedTool:n[3],problemId:n[0],attemptId:n[2]}});let L=j(n[1].params.path.split("/")),T=[];for(let m=0;m<L.length;m+=1)T[m]=pe(me(n,L,m));return u=new He({props:{parentFolder:n[1].params.path.split("/").at(-1)}}),v=new Ee({props:{selected:n[3]}}),C=new Fe({props:{problemId:n[0]}}),{c(){J(e.$$.fragment),s=V(),a=b("div"),r=b("div"),l=b("button"),l.textContent=f,c=V();for(let m=0;m<T.length;m+=1)T[m].c();t=V(),h=b("div"),J(u.$$.fragment),o=V(),i=b("div"),J(v.$$.fragment),_=V(),E=b("div"),J(C.$$.fragment),this.h()},l(m){K(e.$$.fragment,m),s=M(m),a=I(m,"DIV",{id:!0,class:!0});var d=N(a);r=I(d,"DIV",{class:!0});var w=N(r);l=I(w,"BUTTON",{"data-svelte-h":!0}),Q(l)!=="svelte-1xjub06"&&(l.textContent=f),c=M(w);for(let B=0;B<T.length;B+=1)T[B].l(w);w.forEach(g),t=M(d),h=I(d,"DIV",{class:!0});var X=N(h);K(u.$$.fragment,X),X.forEach(g),o=M(d),i=I(d,"DIV",{id:!0,class:!0});var G=N(i);K(v.$$.fragment,G),G.forEach(g),_=M(d),E=I(d,"DIV",{id:!0,class:!0});var A=N(E);K(C.$$.fragment,A),A.forEach(g),d.forEach(g),this.h()},h(){p(r,"class","svelte-aa6inf"),p(h,"class","text-right svelte-aa6inf"),p(i,"id","tools-container"),p(i,"class","svelte-aa6inf"),p(E,"id","attempts-container"),p(E,"class","flex flex-col p-3 gap-3 svelte-aa6inf"),p(a,"id","grid"),p(a,"class","svelte-aa6inf")},m(m,d){Z(e,m,d),y(m,s,d),y(m,a,d),D(a,r),D(r,l),D(r,c);for(let w=0;w<T.length;w+=1)T[w]&&T[w].m(r,null);D(a,t),D(a,h),Z(u,h,null),D(a,o),D(a,i),Z(v,i,null),D(a,_),D(a,E),Z(C,E,null),F=!0,W||(se=q(l,"click",n[6]),W=!0)},p(m,[d]){const w={};if(d&1&&(w.problemId=m[0]),d&4&&(w.attemptId=m[2]),e.$set(w),d&2){L=j(m[1].params.path.split("/"));let A;for(A=0;A<L.length;A+=1){const B=me(m,L,A);T[A]?T[A].p(B,d):(T[A]=pe(B),T[A].c(),T[A].m(r,null))}for(;A<T.length;A+=1)T[A].d(1);T.length=L.length}const X={};d&2&&(X.parentFolder=m[1].params.path.split("/").at(-1)),u.$set(X);const G={};d&1&&(G.problemId=m[0]),C.$set(G)},i(m){F||(z(e.$$.fragment,m),z(u.$$.fragment,m),z(v.$$.fragment,m),z(C.$$.fragment,m),F=!0)},o(m){x(e.$$.fragment,m),x(u.$$.fragment,m),x(v.$$.fragment,m),x(C.$$.fragment,m),F=!1},d(m){m&&(g(s),g(a)),$(e,m),ie(T,m),$(u),$(v),$(C),W=!1,se()}}}function Pe(n,e,s){let a,r,l;ee(n,le,o=>s(1,r=o));const f=De(k.None),c=ce(le,o=>Number.parseInt(o.params.problemId));ee(n,c,o=>s(0,a=o));const t=ce(le,o=>Number.parseInt(o.url.searchParams.get("attempt")??"1")-1);ee(n,t,o=>s(2,l=o));function h(o){if(o){const i=o.route.join("/");"/"+r.params.path!==i&&P(i+"/"+r.params.problemId)}else P("/"+r.params.path)}const u=()=>P("..");return n.$$.update=()=>{n.$$.dirty&1&&typeof window<"u"&&O.files.get(a).then(h)},[a,r,l,f,c,t,u]}class We extends R{constructor(e){super(),Y(this,e,Pe,Be,U,{})}}export{We as component};
