{"version":3,"file":"6.f70426a1.js","sources":["../../../../../../node_modules/.pnpm/svelte@4.2.2/node_modules/svelte/src/runtime/internal/globals.js","../../../../../../src/routes/camera/[problemId=int]/ResizeBox.svelte","../../../../../../src/routes/camera/[problemId=int]/+page.svelte"],"sourcesContent":["/** @type {typeof globalThis} */\nexport const globals =\n\ttypeof window !== 'undefined'\n\t\t? window\n\t\t: typeof globalThis !== 'undefined'\n\t\t? globalThis\n\t\t: // @ts-ignore Node typings have this\n\t\t  global;\n","<script lang=\"ts\">\n  // Needed b/c ios on safari doesn't support `resize` css attribute\n\n  export let size: [number, number] = [170, 70];\n\n  function startDrag(ev: PointerEvent) {\n    document.onpointermove = drag;\n    document.onpointerup = endDrag;\n  }\n  function drag(ev: PointerEvent) {\n    size[0] = (ev.clientX - window.innerWidth / 2) * 2;\n    // Idk why it's like this. Hard-coding 60vh\n    size[1] = (ev.clientY - (window.innerHeight * 0.6) / 2) * 2;\n  }\n  function endDrag() {\n    document.onpointermove = document.onpointerup = null;\n  }\n</script>\n\n<div class=\"relative overflow-auto border min-w-12 min-h-12 border-orange-400\" style:width={size[0] + \"px\"} style:height={size[1] + \"px\"}>\n    <div class=\"absolute right-0 bottom-0 w-5 h-5 bg-orange-400 cursor-nw-resize\" on:pointerdown={startDrag}></div>\n</div>\n\n<style>\n    div {\n        /* VERY IMPORTANT to prevent touch drags from being canceled */\n        touch-action: none;\n    }\n</style>\n","<script lang=\"ts\">\n  import {onDestroy, onMount} from \"svelte\";\n  import {db} from \"$lib/db\";\n  import {page} from \"$app/stores\";\n  import ResizeBox from \"./ResizeBox.svelte\";\n  import {isTouchEnabled} from \"$lib\";\n\n  let video: HTMLVideoElement;\n  let size: [number, number];\n  let placeBottom: boolean;\n  computePlacement();\n\n  onMount(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: {facingMode: \"environment\"}, audio: false })\n      .then((stream) => {\n        video.srcObject = stream;\n        video.play();\n      })\n      .catch((err) => {\n        console.error(`An error occurred: ${err}`);\n      });\n  });\n\n  onDestroy(() => {\n    (video.srcObject as MediaStream).getVideoTracks()[0].stop()\n  });\n\n  function takePicture(ev: MouseEvent) {\n    // videoHeight has some extra whitespace at bottom b/c of scaling, but at least it's proportioned correctly\n    const [width, height] = [video.videoWidth, video.videoHeight];\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = width; canvas.height = height;\n    const context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n    context.drawImage(video, 0, 0, width, height);\n\n    const roiBox = calcCrop();\n    const scaleFactor = width / window.innerWidth;\n\n    const imgData = context.getImageData(roiBox.x * scaleFactor, roiBox.y * scaleFactor, roiBox.width * scaleFactor, roiBox.height * scaleFactor);\n\n    db.files.update(Number.parseInt($page.params.problemId), {question: imgData}).then(() => history.back());\n  }\n\n  function calcCrop() {\n    const {clientWidth, clientHeight} = document.documentElement;\n    const cx = clientWidth / 2;\n    const cy = clientHeight * 0.3;\n    return {\n      x: Math.round(cx - size[0] / 2),\n      y: Math.round(cy - size[1] / 2),\n      width: size[0],\n      height: size[1],\n    }\n  }\n\n  function computePlacement() {\n    placeBottom = window.innerWidth < window.innerHeight ? true : !isTouchEnabled();\n  }\n</script>\n\n<!-- Preview -->\n<div class=\"fixed inset-x-0 inset-y-0\">\n    <video bind:this={video} class=\"w-full\"></video>\n</div>\n\n<!-- Crosshairs -->\n<div class=\"fixed w-full h-[60vh] inset-x-0 top-0 flex items-center justify-center\">\n    <ResizeBox bind:size />\n</div>\n\n<!-- Shutter -->\n<div class=\"fixed flex justify-center items-center\" class:placeBottom class:placeRight={!placeBottom}>\n    <button class=\"rounded-full bg-orange-400 w-[5rem] h-[5rem]\" on:click={takePicture}></button>\n</div>\n<svelte:window on:resize={computePlacement} />\n\n<style>\n    .placeBottom {\n        left: 0;\n        right: 0;\n        bottom: 3rem;\n    }\n    .placeRight {\n        top: 0;\n        bottom: 0;\n        right: 3rem;\n    }\n</style>\n"],"names":["globals","ctx","insert_hydration","target","div1","anchor","append_hydration","div0","endDrag","size","$$props","startDrag","ev","drag","$$invalidate","video_1","div2","button","video","placeBottom","computePlacement","onMount","stream","err","onDestroy","takePicture","width","height","canvas","context","roiBox","calcCrop","scaleFactor","imgData","db","$page","clientWidth","clientHeight","cx","cy","isTouchEnabled","$$value"],"mappings":"oYACO,MAAMA,EACZ,OAAO,OAAW,IACf,OACA,OAAO,WAAe,IACtB,WAEA,kYCYwFC,EAAI,CAAA,EAAC,CAAC,EAAI,IAAI,eAAgBA,EAAI,CAAA,EAAC,CAAC,EAAI,IAAI,UAAxIC,EAEKC,EAAAC,EAAAC,CAAA,EADDC,EAA8GF,EAAAG,CAAA,0BAAhBN,EAAS,CAAA,CAAA,mCADfA,EAAI,CAAA,EAAC,CAAC,EAAI,IAAI,oBAAgBA,EAAI,CAAA,EAAC,CAAC,EAAI,IAAI,mCAL7H,SAAAO,IAAA,CACP,SAAS,cAAgB,SAAS,YAAc,wBAZvC,GAAA,CAAA,KAAAC,EAAA,CAA0B,IAAK,EAAE,CAAA,EAAAC,WAEnCC,EAAUC,EAAA,CACjB,SAAS,cAAgBC,EACzB,SAAS,YAAcL,YAEhBK,EAAKD,EAAA,CACZE,EAAA,EAAAL,EAAK,CAAC,GAAKG,EAAG,QAAU,OAAO,WAAa,GAAK,EAAAH,CAAA,EAEjDK,EAAA,EAAAL,EAAK,CAAC,GAAKG,EAAG,QAAW,OAAO,YAAc,GAAO,GAAK,EAAAH,CAAA,2+BC4D2BR,EAAW,CAAA,CAAA,UAVpGC,EAEKC,EAAAI,EAAAF,CAAA,EADDC,EAA+CC,EAAAQ,CAAA,mBAInDb,EAEKC,EAAAC,EAAAC,CAAA,uBAGLH,EAEKC,EAAAa,EAAAX,CAAA,EADDC,EAA4FU,EAAAC,CAAA,4BAEtEhB,EAAgB,CAAA,CAAA,cAFiCA,EAAW,CAAA,CAAA,gJADGA,EAAW,CAAA,CAAA,+KAjE9F,IAAAiB,EACAT,EACAU,EACJC,IAEAC,EAAA,IAAA,CACE,UAAU,aACP,aAAA,CAAe,MAAA,CAAQ,WAAY,aAAA,EAAgB,MAAO,KAC1D,KAAMC,GAAA,CACLR,EAAA,EAAAI,EAAM,UAAYI,EAAAJ,CAAA,EAClBA,EAAM,KAAA,IAEP,MAAOK,GAAA,CACN,QAAQ,4BAA4BA,CAAG,EAAA,MAI7CC,EAAA,IAAA,CACGN,EAAM,UAA0B,eAAiB,EAAA,CAAC,EAAE,KAAA,aAG9CO,EAAYb,EAAA,CAEZ,KAAA,CAAAc,EAAOC,CAAM,EAAA,CAAKT,EAAM,WAAYA,EAAM,WAAW,EACtDU,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQF,EAAOE,EAAO,OAASD,QAChCE,EAAUD,EAAO,WAAW,IAAI,EACtCC,EAAQ,UAAUX,EAAO,EAAG,EAAGQ,EAAOC,CAAM,QAEtCG,EAASC,IACTC,EAAcN,EAAQ,OAAO,WAE7BO,EAAUJ,EAAQ,aAAaC,EAAO,EAAIE,EAAaF,EAAO,EAAIE,EAAaF,EAAO,MAAQE,EAAaF,EAAO,OAASE,CAAW,EAE5IE,EAAG,MAAM,OAAO,OAAO,SAASC,EAAM,OAAO,SAAS,EAAI,CAAA,SAAUF,CAAU,CAAA,EAAA,KAAA,IAAW,QAAQ,KAAA,CAAA,EAG1F,SAAAF,GAAA,CACA,KAAA,CAAA,YAAAK,EAAa,aAAAC,GAAgB,SAAS,gBACvCC,EAAKF,EAAc,EACnBG,EAAKF,EAAe,UAExB,EAAG,KAAK,MAAMC,EAAK7B,EAAK,CAAC,EAAI,CAAC,EAC9B,EAAG,KAAK,MAAM8B,EAAK9B,EAAK,CAAC,EAAI,CAAC,EAC9B,MAAOA,EAAK,CAAC,EACb,OAAQA,EAAK,CAAC,GAIT,SAAAW,GAAA,KACPD,EAAc,OAAO,WAAa,OAAO,YAAc,GAAQ,CAAAqB,EAAA,CAAA,2CAM7CtB,EAAKuB","x_google_ignoreList":[0]}