import{s as M,n as B,e as ee,f as te,o as le}from"../chunks/scheduler.75de2e2f.js";import{S as N,i as O,e as G,a as w,d as y,p as ae,b as se,t as D,f as h,y as ne,g as p,m as X,s as S,r as L,h as v,j as b,n as Y,c as E,u as z,k as d,l as H,x as m,v as A,o as Z,w as F,z as re,A as ie,B as oe}from"../chunks/index.141df97b.js";import{u as fe,d as C}from"../chunks/db.0a5d7a2c.js";import{e as V,p as k,u as ce,d as ue,n as he}from"../chunks/index.83e76776.js";import{e as I,r as de}from"../chunks/singletons.e8b0b2c2.js";import{p as _e}from"../chunks/stores.e8f2cc35.js";function J(i,s,a){const r=i.slice();return r[3]=s[a],r}function Q(i){let s,a=(i[3]||"/")+"",r,n,o,t,l;return t=new x({props:{fileStruct:i[0][i[3]],indentLevel:i[1]+1,fullPath:k.join(i[2],i[3])}}),{c(){s=p("a"),r=X(a),o=S(),L(t.$$.fragment),this.h()},l(e){s=v(e,"A",{href:!0,class:!0});var f=b(s);r=Y(f,a),f.forEach(h),o=E(e),z(t.$$.fragment,e),this.h()},h(){d(s,"href",n=k.join("/",I,i[2],i[3])),d(s,"class","w-full block text-left"),H(s,"padding-left",i[1]*15+"px")},m(e,f){w(e,s,f),m(s,r),w(e,o,f),A(t,e,f),l=!0},p(e,f){(!l||f&1)&&a!==(a=(e[3]||"/")+"")&&Z(r,a),(!l||f&5&&n!==(n=k.join("/",I,e[2],e[3])))&&d(s,"href",n),f&2&&H(s,"padding-left",e[1]*15+"px");const c={};f&1&&(c.fileStruct=e[0][e[3]]),f&2&&(c.indentLevel=e[1]+1),f&5&&(c.fullPath=k.join(e[2],e[3])),t.$set(c)},i(e){l||(y(t.$$.fragment,e),l=!0)},o(e){D(t.$$.fragment,e),l=!1},d(e){e&&(h(s),h(o)),F(t,e)}}}function me(i){let s,a,r=V(Object.keys(i[0]??{})),n=[];for(let t=0;t<r.length;t+=1)n[t]=Q(J(i,r,t));const o=t=>D(n[t],1,1,()=>{n[t]=null});return{c(){for(let t=0;t<n.length;t+=1)n[t].c();s=G()},l(t){for(let l=0;l<n.length;l+=1)n[l].l(t);s=G()},m(t,l){for(let e=0;e<n.length;e+=1)n[e]&&n[e].m(t,l);w(t,s,l),a=!0},p(t,[l]){if(l&7){r=V(Object.keys(t[0]??{}));let e;for(e=0;e<r.length;e+=1){const f=J(t,r,e);n[e]?(n[e].p(f,l),y(n[e],1)):(n[e]=Q(f),n[e].c(),y(n[e],1),n[e].m(s.parentNode,s))}for(ae(),e=r.length;e<n.length;e+=1)o(e);se()}},i(t){if(!a){for(let l=0;l<r.length;l+=1)y(n[l]);a=!0}},o(t){n=n.filter(Boolean);for(let l=0;l<n.length;l+=1)D(n[l]);a=!1},d(t){t&&h(s),ne(n,t)}}}function pe(i,s,a){let{fileStruct:r}=s,{indentLevel:n=0}=s,{fullPath:o=""}=s;return i.$$set=t=>{"fileStruct"in t&&a(0,r=t.fileStruct),"indentLevel"in t&&a(1,n=t.indentLevel),"fullPath"in t&&a(2,o=t.fullPath)},[r,n,o]}class x extends N{constructor(s){super(),O(this,s,pe,me,M,{fileStruct:0,indentLevel:1,fullPath:2})}}function R(i,s,a){const r=i.slice();return r[3]=s[a],r}function W(i,s){let a,r,n,o,t=s[3].name+"",l,e,f;return{key:i,first:null,c(){a=p("a"),r=p("div"),n=S(),o=p("div"),l=X(t),e=S(),this.h()},l(c){a=v(c,"A",{class:!0,href:!0});var u=b(a);r=v(u,"DIV",{class:!0}),b(r).forEach(h),n=E(u),o=v(u,"DIV",{});var $=b(o);l=Y($,t),$.forEach(h),e=E(u),u.forEach(h),this.h()},h(){d(r,"class","w-12 h-12 bg-red-500 m-auto"),d(a,"class","text-center w-[5rem]"),d(a,"href",f=k.join("/",I,s[0].params.path,s[3].id.toString())),this.first=a},m(c,u){w(c,a,u),m(a,r),m(a,n),m(a,o),m(o,l),m(a,e)},p(c,u){s=c,u&4&&t!==(t=s[3].name+"")&&Z(l,t),u&5&&f!==(f=k.join("/",I,s[0].params.path,s[3].id.toString()))&&d(a,"href",f)},d(c){c&&h(a)}}}function ve(i){let s,a=[],r=new Map,n=V(i[2]);const o=t=>t[3].id;for(let t=0;t<n.length;t+=1){let l=R(i,n,t),e=o(l);r.set(e,a[t]=W(e,l))}return{c(){s=p("div");for(let t=0;t<a.length;t+=1)a[t].c();this.h()},l(t){s=v(t,"DIV",{class:!0});var l=b(s);for(let e=0;e<a.length;e+=1)a[e].l(l);l.forEach(h),this.h()},h(){d(s,"class","flex flex-wrap gap-5")},m(t,l){w(t,s,l);for(let e=0;e<a.length;e+=1)a[e]&&a[e].m(s,null)},p(t,[l]){l&5&&(n=V(t[2]),a=ce(a,l,o,1,t,n,r,s,ue,W,null,R))},i:B,o:B,d(t){t&&h(s);for(let l=0;l<a.length;l+=1)a[l].d()}}}function ge(i,s,a){let r,n,o=B,t=()=>(o(),o=te(l,e=>a(2,n=e)),l);ee(i,_e,e=>a(0,r=e)),i.$$.on_destroy.push(()=>o());let l=de([]);return t(),i.$$.update=()=>{i.$$.dirty&1&&t(a(1,l=fe(()=>C.files.where({"[route]":[["",...r.params.path?r.params.path.split("/"):[]]]}).toArray())))},[r,l,n]}class be extends N{constructor(s){super(),O(this,s,ge,ve,M,{})}}function $e(i){let s,a,r,n,o="âž• file",t,l,e,f,c,u,$,P,q;return e=new x({props:{fileStruct:i[0]}}),u=new be({}),{c(){s=S(),a=p("div"),r=p("div"),n=p("button"),n.textContent=o,t=S(),l=p("div"),L(e.$$.fragment),f=S(),c=p("div"),L(u.$$.fragment),this.h()},l(_){re("svelte-8s10wx",document.head).forEach(h),s=E(_),a=v(_,"DIV",{id:!0,class:!0});var g=b(a);r=v(g,"DIV",{id:!0,class:!0});var T=b(r);n=v(T,"BUTTON",{"data-svelte-h":!0}),ie(n)!=="svelte-1m4mbow"&&(n.textContent=o),T.forEach(h),t=E(g),l=v(g,"DIV",{id:!0,class:!0});var K=b(l);z(e.$$.fragment,K),K.forEach(h),f=E(g),c=v(g,"DIV",{id:!0,class:!0});var U=b(c);z(u.$$.fragment,U),U.forEach(h),g.forEach(h),this.h()},h(){document.title="MathMan Browse",d(r,"id","ribbon"),d(r,"class","text-right svelte-1huhyzt"),d(l,"id","folders"),d(l,"class","svelte-1huhyzt"),d(c,"id","files"),d(c,"class","svelte-1huhyzt"),d(a,"id","grid"),d(a,"class","svelte-1huhyzt")},m(_,j){w(_,s,j),w(_,a,j),m(a,r),m(r,n),m(a,t),m(a,l),A(e,l,null),m(a,f),m(a,c),A(u,c,null),$=!0,P||(q=oe(n,"click",i[2]),P=!0)},p(_,[j]){const g={};j&1&&(g.fileStruct=_[0]),e.$set(g)},i(_){$||(y(e.$$.fragment,_),y(u.$$.fragment,_),$=!0)},o(_){D(e.$$.fragment,_),D(u.$$.fragment,_),$=!1},d(_){_&&(h(s),h(a)),F(e),F(u),P=!1,q()}}}function we(i,s,a){let r={};async function n(){const l={},e=await C.files.orderBy("[route]").uniqueKeys().then(f=>f.flat(1));for(const f of e){let c=l;for(const u of f)u in c||(c[u]={}),c=c[u]}return l}function o(...l){if(l.length<1)throw"Need at least filename";C.files.add({attempts:[he()],parent:l.at(-2)??"",route:["",...l.slice(0,l.length-1)],name:l.at(-1)})}return le(()=>{window.newFile=o,n().then(l=>a(0,r=l))}),[r,o,()=>o(...prompt("Enter path of file to create").split("/"))]}class Ve extends N{constructor(s){super(),O(this,s,we,$e,M,{})}}export{Ve as component};
