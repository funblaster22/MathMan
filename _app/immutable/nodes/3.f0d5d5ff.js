import{s as $,n as z,r as De,o as Ie,f as ke,b as se,e as ne}from"../chunks/scheduler.03df403d.js";import{S as W,i as X,g as b,s as q,h as I,j as M,A as P,c as N,f as g,l as S,k as p,a as D,x as C,B as Q,y as ue,m as B,n as R,C as he,o as de,d as j,p as ye,b as Ee,t as x,r as K,u as Z,v as ee,w as te,z as Te}from"../chunks/index.4e6daf8f.js";import{d as O,e as Y,a as Ce,n as Ae,p as le}from"../chunks/index.7c14a1dd.js";import{j as Me,e as re,w as qe,k as me}from"../chunks/singletons.443fba08.js";import{p as oe}from"../chunks/stores.5a1acd34.js";var k=(a=>(a[a.Draw=0]="Draw",a[a.Correct=1]="Correct",a[a.Question=2]="Question",a[a.None=3]="None",a[a.Erase=4]="Erase",a))(k||{});const ce=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href,Ne=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function Ve(a){let e,n,l=`<img src="${ce}" title="Your work" draggable="false"/>`,r,s,d=`<img src="${ce}" title="Correct" draggable="false"/>`,c,t,h=`<img src="${ce}" title="Question" draggable="false"/>`,u,o,i=`<img src="${Ne}" title="Eraser" draggable="false"/>`,w,_;return{c(){e=b("div"),n=b("div"),n.innerHTML=l,r=q(),s=b("div"),s.innerHTML=d,c=q(),t=b("div"),t.innerHTML=h,u=q(),o=b("div"),o.innerHTML=i,this.h()},l(E){e=I(E,"DIV",{id:!0});var T=M(e);n=I(T,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),P(n)!=="svelte-1um81qx"&&(n.innerHTML=l),r=N(T),s=I(T,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),P(s)!=="svelte-lqddij"&&(s.innerHTML=d),c=N(T),t=I(T,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),P(t)!=="svelte-1ovzcqk"&&(t.innerHTML=h),u=N(T),o=I(T,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),P(o)!=="svelte-1264pa0"&&(o.innerHTML=i),T.forEach(g),this.h()},h(){S(n,"width","30px"),S(n,"filter","grayscale(1)"),p(n,"data-tool",k.Draw),S(s,"width","30px"),S(s,"filter","hue-rotate(136deg)"),p(s,"data-tool",k.Correct),S(t,"width","30px"),p(t,"data-tool",k.Question),S(o,"width","30px"),p(o,"data-tool",k.Erase),p(e,"id","tools")},m(E,T){D(E,e,T),C(e,n),C(e,r),C(e,s),C(e,c),C(e,t),C(e,u),C(e,o),w||(_=[Q(n,"click",a[0]),Q(s,"click",a[0]),Q(t,"click",a[0]),Q(o,"click",a[0])],w=!0)},p:z,i:z,o:z,d(E){E&&g(e),w=!1,De(_)}}}function ze(a,e,n){let{selected:l}=e;function r(s){s.stopPropagation();const d=s.currentTarget,c=d.style.height=="100%";for(const t of document.querySelectorAll("#tools > div"))t.style.height="30px";for(const t of document.querySelectorAll(".tool"))t.id="";if(c){l.set(k.None);return}l.set(Number.parseInt(d.dataset.tool)),d.style.height="100%"}return a.$$set=s=>{"selected"in s&&n(1,l=s.selected)},[r,l]}class Le extends W{constructor(e){super(),X(this,e,ze,Ve,$,{selected:1})}}function He(a){let e,n,l,r,s,d,c;return{c(){e=b("canvas"),n=q(),l=b("canvas"),r=q(),s=b("canvas"),this.h()},l(t){e=I(t,"CANVAS",{width:!0,height:!0,class:!0}),M(e).forEach(g),n=N(t),l=I(t,"CANVAS",{width:!0,height:!0,class:!0}),M(l).forEach(g),r=N(t),s=I(t,"CANVAS",{width:!0,height:!0,class:!0}),M(s).forEach(g),this.h()},h(){p(e,"width",a[2]),p(e,"height",a[3]),p(e,"class","svelte-1rofrvo"),p(l,"width",a[2]),p(l,"height",a[3]),p(l,"class","svelte-1rofrvo"),p(s,"width",a[2]),p(s,"height",a[3]),p(s,"class","svelte-1rofrvo")},m(t,h){D(t,e,h),a[7](e),D(t,n,h),D(t,l,h),a[8](l),D(t,r,h),D(t,s,h),a[9](s),d||(c=Q(s,"pointerdown",a[4]),d=!0)},p(t,[h]){h&4&&p(e,"width",t[2]),h&8&&p(e,"height",t[3]),h&4&&p(l,"width",t[2]),h&8&&p(l,"height",t[3]),h&4&&p(s,"width",t[2]),h&8&&p(s,"height",t[3])},i:z,o:z,d(t){t&&(g(e),g(n),g(l),g(r),g(s)),a[7](null),a[8](null),a[9](null),d=!1,c()}}}function Se(a,e,n){let l,r=z,s=()=>(r(),r=ke(d,f=>n(11,l=f)),d);a.$$.on_destroy.push(()=>r());let{selectedTool:d}=e;s();let{problemId:c}=e,{attemptId:t}=e,h=0,u=0,o=!1,i=[];function w(){typeof window>"u"||(n(2,h=window.innerWidth),n(3,u=window.innerHeight),requestAnimationFrame(async()=>{const f=(await O.files.get(c)).attempts[t];i[k.Draw].putImageData(f.work,0,0),i[k.Correct].putImageData(f.error,0,0),i[k.Question].putImageData(f.questions,0,0)}))}function _(){const f=[0,0,h,u];O.files.update(c,v=>{v.attempts[t]={date:new Date,work:i[k.Draw].getImageData(...f),error:i[k.Correct].getImageData(...f),questions:i[k.Question].getImageData(...f),rois:v.attempts[t].rois}})}const E=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,T={[k.Draw]:E?"white":"black",[k.Correct]:"red",[k.Question]:"blue"},L=f=>{if(l==k.None)return;const v=i[l];o=!0,v.strokeStyle=T[l],v.beginPath(),v.moveTo(f.clientX,f.clientY)},V=()=>{o&&_(),o=!1},F=f=>{if(o){const v=i[l];v.lineTo(f.clientX,f.clientY),v.stroke()}};Ie(()=>{window.onresize=w,document.onpointermove=F,document.onpointerup=V,n(1,i=i.map(f=>f.getContext("2d",{willReadFrequently:!0})))});function H(f){se[f?"unshift":"push"](()=>{i[k.Draw]=f,n(1,i)})}function y(f){se[f?"unshift":"push"](()=>{i[k.Correct]=f,n(1,i)})}function m(f){se[f?"unshift":"push"](()=>{i[k.Question]=f,n(1,i)})}return a.$$set=f=>{"selectedTool"in f&&s(n(0,d=f.selectedTool)),"problemId"in f&&n(5,c=f.problemId),"attemptId"in f&&n(6,t=f.attemptId)},a.$$.update=()=>{if(a.$$.dirty&98){w();for(const f of i){const v=f.canvas;f.clearRect(0,0,v.width,v.height)}}},[d,i,h,u,L,c,t,H,y,m]}class Qe extends W{constructor(e){super(),X(this,e,Se,He,$,{selectedTool:0,problemId:5,attemptId:6})}}const ae=Me("goto");function pe(a,e,n){const l=a.slice();return l[4]=e[n],l}function ge(a){let e,n=a[4].name+"",l,r;return{c(){e=b("option"),l=B(n),this.h()},l(s){e=I(s,"OPTION",{});var d=M(e);l=R(d,n),d.forEach(g),this.h()},h(){e.__value=r=a[4].id,he(e,e.__value)},m(s,d){D(s,e,d),C(e,l)},p(s,d){d&1&&n!==(n=s[4].name+"")&&de(l,n),d&1&&r!==(r=s[4].id)&&(e.__value=r,he(e,e.__value))},d(s){s&&g(e)}}}function je(a){let e,n="üö©",l,r,s,d,c="‚û°Ô∏è",t,h,u=Y(a[0]??[]),o=[];for(let i=0;i<u.length;i+=1)o[i]=ge(pe(a,u,i));return{c(){e=b("button"),e.textContent=n,l=q(),r=b("select");for(let i=0;i<o.length;i+=1)o[i].c();s=q(),d=b("button"),d.textContent=c},l(i){e=I(i,"BUTTON",{"data-svelte-h":!0}),P(e)!=="svelte-yzpet0"&&(e.textContent=n),l=N(i),r=I(i,"SELECT",{});var w=M(r);for(let _=0;_<o.length;_+=1)o[_].l(w);w.forEach(g),s=N(i),d=I(i,"BUTTON",{"data-svelte-h":!0}),P(d)!=="svelte-q61pzu"&&(d.textContent=c)},m(i,w){D(i,e,w),D(i,l,w),D(i,r,w);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(r,null);D(i,s,w),D(i,d,w),t||(h=Q(r,"change",a[1]),t=!0)},p(i,[w]){if(w&1){u=Y(i[0]??[]);let _;for(_=0;_<u.length;_+=1){const E=pe(i,u,_);o[_]?o[_].p(E,w):(o[_]=ge(E),o[_].c(),o[_].m(r,null))}for(;_<o.length;_+=1)o[_].d(1);o.length=u.length}},i:z,o:z,d(i){i&&(g(e),g(l),g(r),g(s),g(d)),ue(o,i),t=!1,h()}}}function Fe(a,e,n){let l,{parentFolder:r}=e;function s(c){const t=c.target.value;ae(t)}const d=Ce(()=>O.files.where({parent:r}).toArray());return ne(a,d,c=>n(0,l=c)),a.$$set=c=>{"parentFolder"in c&&n(3,r=c.parentFolder)},[l,s,d,r]}class Ue extends W{constructor(e){super(),X(this,e,Fe,je,$,{parentFolder:3})}}function Pe(a){let e,n,l,r,s=a[0]+1+"",d;return{c(){e=b("div"),n=b("canvas"),r=B(`
    Attempt `),d=B(s),this.h()},l(c){e=I(c,"DIV",{class:!0});var t=M(e);n=I(t,"CANVAS",{width:!0,height:!0}),M(n).forEach(g),r=R(t,`
    Attempt `),d=R(t,s),t.forEach(g),this.h()},h(){p(n,"width",a[1]),p(n,"height",l=a[1]-24),p(e,"class","text-center bg-gray-50 rounded-md"),S(e,"width",a[1]+"px")},m(c,t){D(c,e,t),C(e,n),a[4](n),C(e,r),C(e,d)},p(c,[t]){t&2&&p(n,"width",c[1]),t&2&&l!==(l=c[1]-24)&&p(n,"height",l),t&1&&s!==(s=c[0]+1+"")&&de(d,s),t&2&&S(e,"width",c[1]+"px")},i:z,o:z,d(c){c&&g(e),a[4](null)}}}function xe(a,e,n){let{attempt:l}=e,{idx:r}=e,{size:s=100}=e,d;function c(h,u){const o=document.createElement("canvas");o.width=u[0].width,o.height=u[0].height,h.scale(s/o.width,(s-24)/o.height);for(const i of u)o.getContext("2d").putImageData(i,0,0),h.drawImage(o,0,0)}Ie(async()=>{const h=d.getContext("2d");c(h,[l.work,l.error,l.questions])});function t(h){se[h?"unshift":"push"](()=>{d=h,n(2,d)})}return a.$$set=h=>{"attempt"in h&&n(3,l=h.attempt),"idx"in h&&n(0,r=h.idx),"size"in h&&n(1,s=h.size)},[r,s,d,l,t]}class Be extends W{constructor(e){super(),X(this,e,xe,Pe,$,{attempt:3,idx:0,size:1})}}function _e(a,e,n){const l=a.slice();return l[5]=e[n],l[7]=n,l}function ve(a){let e,n,l,r,s;n=new Be({props:{attempt:a[5],idx:a[7]}});function d(){return a[4](a[7])}return{c(){e=b("div"),K(n.$$.fragment)},l(c){e=I(c,"DIV",{});var t=M(e);Z(n.$$.fragment,t),t.forEach(g)},m(c,t){D(c,e,t),ee(n,e,null),l=!0,r||(s=Q(e,"click",d),r=!0)},p(c,t){a=c;const h={};t&1&&(h.attempt=a[5]),n.$set(h)},i(c){l||(j(n.$$.fragment,c),l=!0)},o(c){x(n.$$.fragment,c),l=!1},d(c){c&&g(e),te(n),r=!1,s()}}}function Re(a){let e,n,l=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,r,s,d,c=Y(a[0]??[]),t=[];for(let u=0;u<c.length;u+=1)t[u]=ve(_e(a,c,u));const h=u=>x(t[u],1,1,()=>{t[u]=null});return{c(){for(let u=0;u<t.length;u+=1)t[u].c();e=q(),n=b("div"),n.innerHTML=l,this.h()},l(u){for(let o=0;o<t.length;o+=1)t[o].l(u);e=N(u),n=I(u,"DIV",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-59ttd9"&&(n.innerHTML=l),this.h()},h(){p(n,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(u,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(u,o);D(u,e,o),D(u,n,o),r=!0,s||(d=Q(n,"click",a[2]),s=!0)},p(u,[o]){if(o&1){c=Y(u[0]??[]);let i;for(i=0;i<c.length;i+=1){const w=_e(u,c,i);t[i]?(t[i].p(w,o),j(t[i],1)):(t[i]=ve(w),t[i].c(),j(t[i],1),t[i].m(e.parentNode,e))}for(ye(),i=c.length;i<t.length;i+=1)h(i);Ee()}},i(u){if(!r){for(let o=0;o<c.length;o+=1)j(t[o]);r=!0}},o(u){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)x(t[o]);r=!1},d(u){u&&(g(e),g(n)),ue(t,u),s=!1,d()}}}function Oe(a,e,n){let l,{problemId:r}=e;const s=Ce(()=>O.files.get(r).then(t=>t.attempts));ne(a,s,t=>n(0,l=t));function d(){O.files.update(r,t=>{ae("?attempt="+t.attempts.push(Ae()))})}const c=t=>ae("?attempt="+(t+1));return a.$$set=t=>{"problemId"in t&&n(3,r=t.problemId)},[l,s,d,r,c]}class Ye extends W{constructor(e){super(),X(this,e,Oe,Re,$,{problemId:3})}}function we(a,e,n){const l=a.slice();return l[7]=e[n],l}function be(a){let e,n=a[7]+"",l;return{c(){e=B("/"),l=B(n)},l(r){e=R(r,"/"),l=R(r,n)},m(r,s){D(r,e,s),D(r,l,s)},p(r,s){s&2&&n!==(n=r[7]+"")&&de(l,n)},d(r){r&&(g(e),g(l))}}}function $e(a){let e,n,l,r,s,d,c,t,h,u,o,i,w,_,E,T,L,V,F;n=new Qe({props:{selectedTool:a[3],problemId:a[0],attemptId:a[2]}});let H=Y(a[1].params.path.split("/")),y=[];for(let m=0;m<H.length;m+=1)y[m]=be(we(a,H,m));return i=new Ue({props:{parentFolder:a[1].params.path.split("/").at(-1)}}),E=new Le({props:{selected:a[3]}}),V=new Ye({props:{problemId:a[0]}}),{c(){e=q(),K(n.$$.fragment),l=q(),r=b("div"),s=b("div"),d=b("a"),c=B("üè†"),h=q();for(let m=0;m<y.length;m+=1)y[m].c();u=q(),o=b("div"),K(i.$$.fragment),w=q(),_=b("div"),K(E.$$.fragment),T=q(),L=b("div"),K(V.$$.fragment),this.h()},l(m){Te("svelte-pyemm1",document.head).forEach(g),e=N(m),Z(n.$$.fragment,m),l=N(m),r=I(m,"DIV",{id:!0,class:!0});var v=M(r);s=I(v,"DIV",{id:!0,class:!0});var U=M(s);d=I(U,"A",{href:!0});var G=M(d);c=R(G,"üè†"),G.forEach(g),h=N(U);for(let ie=0;ie<y.length;ie+=1)y[ie].l(U);U.forEach(g),u=N(v),o=I(v,"DIV",{id:!0,class:!0});var A=M(o);Z(i.$$.fragment,A),A.forEach(g),w=N(v),_=I(v,"DIV",{id:!0,class:!0});var J=M(_);Z(E.$$.fragment,J),J.forEach(g),T=N(v),L=I(v,"DIV",{id:!0,class:!0});var fe=M(L);Z(V.$$.fragment,fe),fe.forEach(g),v.forEach(g),this.h()},h(){document.title="MathMan Draw",p(d,"href",t=le.join("/",re,a[1].params.path)),p(s,"id","breadcrumbs"),p(s,"class","svelte-1edzgew"),p(o,"id","question-management"),p(o,"class","text-right svelte-1edzgew"),p(_,"id","tools-container"),p(_,"class","svelte-1edzgew"),p(L,"id","attempts-container"),p(L,"class","flex flex-col p-3 gap-3 svelte-1edzgew"),p(r,"id","grid"),p(r,"class","svelte-1edzgew")},m(m,f){D(m,e,f),ee(n,m,f),D(m,l,f),D(m,r,f),C(r,s),C(s,d),C(d,c),C(s,h);for(let v=0;v<y.length;v+=1)y[v]&&y[v].m(s,null);C(r,u),C(r,o),ee(i,o,null),C(r,w),C(r,_),ee(E,_,null),C(r,T),C(r,L),ee(V,L,null),F=!0},p(m,[f]){const v={};if(f&1&&(v.problemId=m[0]),f&4&&(v.attemptId=m[2]),n.$set(v),(!F||f&2&&t!==(t=le.join("/",re,m[1].params.path)))&&p(d,"href",t),f&2){H=Y(m[1].params.path.split("/"));let A;for(A=0;A<H.length;A+=1){const J=we(m,H,A);y[A]?y[A].p(J,f):(y[A]=be(J),y[A].c(),y[A].m(s,null))}for(;A<y.length;A+=1)y[A].d(1);y.length=H.length}const U={};f&2&&(U.parentFolder=m[1].params.path.split("/").at(-1)),i.$set(U);const G={};f&1&&(G.problemId=m[0]),V.$set(G)},i(m){F||(j(n.$$.fragment,m),j(i.$$.fragment,m),j(E.$$.fragment,m),j(V.$$.fragment,m),F=!0)},o(m){x(n.$$.fragment,m),x(i.$$.fragment,m),x(E.$$.fragment,m),x(V.$$.fragment,m),F=!1},d(m){m&&(g(e),g(l),g(r)),te(n,m),ue(y,m),te(i),te(E),te(V)}}}function We(a,e,n){let l,r,s;ne(a,oe,u=>n(1,r=u));const d=qe(k.None),c=me(oe,u=>Number.parseInt(u.params.problemId));ne(a,c,u=>n(0,l=u));const t=me(oe,u=>Number.parseInt(u.url.searchParams.get("attempt")??"1")-1);ne(a,t,u=>n(2,s=u));function h(u){if(u){const o=u.route.join("/");"/"+r.params.path!==o&&ae(le.join("/",re,o,r.params.problemId))}else ae(le.join("/",re,r.params.path))}return a.$$.update=()=>{a.$$.dirty&1&&typeof window<"u"&&O.files.get(l).then(h)},[l,r,s,d,c,t]}class et extends W{constructor(e){super(),X(this,e,We,$e,$,{})}}export{et as component};
