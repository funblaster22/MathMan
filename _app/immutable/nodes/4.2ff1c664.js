import{s as ue,i as He,n as R,e as ae,f as Ye,r as Je,o as Qe,h as Re}from"../chunks/scheduler.a731e211.js";import{S as ce,i as he,e as se,a as T,d as L,p as Ke,b as We,t as Y,f as g,y as De,g as b,m as S,s as V,r as re,h as E,j as w,n as D,c as I,u as ie,k as v,l as qe,x as d,v as oe,o as z,w as fe,z as Ve,A as Ie,B as Xe}from"../chunks/index.f53a124d.js";import{d as X,u as Ze}from"../chunks/db.6208fdf7.js";import{e as $,p as U,u as xe,o as et}from"../chunks/index.73019456.js";import{e as Z,w as tt}from"../chunks/singletons.b542c058.js";import{p as Ae}from"../chunks/stores.4b5dd131.js";function Fe(l,e,n){const t=l.slice();return t[3]=e[n],t}function Pe(l){let e,n=(l[3]||"/")+"",t,s,u,r,i;return r=new Ge({props:{fileStruct:l[0][l[3]],indentLevel:l[1]+1,fullPath:U.join(l[2],l[3])}}),{c(){e=b("a"),t=S(n),u=V(),re(r.$$.fragment),this.h()},l(a){e=E(a,"A",{href:!0,class:!0});var c=w(e);t=D(c,n),c.forEach(g),u=I(a),ie(r.$$.fragment,a),this.h()},h(){v(e,"href",s=U.join("/",Z,l[2],l[3])),v(e,"class","w-full block text-left"),qe(e,"padding-left",l[1]*15+"px")},m(a,c){T(a,e,c),d(e,t),T(a,u,c),oe(r,a,c),i=!0},p(a,c){(!i||c&1)&&n!==(n=(a[3]||"/")+"")&&z(t,n),(!i||c&5&&s!==(s=U.join("/",Z,a[2],a[3])))&&v(e,"href",s),c&2&&qe(e,"padding-left",a[1]*15+"px");const _={};c&1&&(_.fileStruct=a[0][a[3]]),c&2&&(_.indentLevel=a[1]+1),c&5&&(_.fullPath=U.join(a[2],a[3])),r.$set(_)},i(a){i||(L(r.$$.fragment,a),i=!0)},o(a){Y(r.$$.fragment,a),i=!1},d(a){a&&(g(e),g(u)),fe(r,a)}}}function lt(l){let e,n,t=$(Object.keys(l[0]??{})),s=[];for(let r=0;r<t.length;r+=1)s[r]=Pe(Fe(l,t,r));const u=r=>Y(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();e=se()},l(r){for(let i=0;i<s.length;i+=1)s[i].l(r);e=se()},m(r,i){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,i);T(r,e,i),n=!0},p(r,[i]){if(i&7){t=$(Object.keys(r[0]??{}));let a;for(a=0;a<t.length;a+=1){const c=Fe(r,t,a);s[a]?(s[a].p(c,i),L(s[a],1)):(s[a]=Pe(c),s[a].c(),L(s[a],1),s[a].m(e.parentNode,e))}for(Ke(),a=t.length;a<s.length;a+=1)u(a);We()}},i(r){if(!n){for(let i=0;i<t.length;i+=1)L(s[i]);n=!0}},o(r){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)Y(s[i]);n=!1},d(r){r&&g(e),De(s,r)}}}function nt(l,e,n){let{fileStruct:t}=e,{indentLevel:s=0}=e,{fullPath:u=""}=e;return l.$$set=r=>{"fileStruct"in r&&n(0,t=r.fileStruct),"indentLevel"in r&&n(1,s=r.indentLevel),"fullPath"in r&&n(2,u=r.fullPath)},[t,s,u]}class Ge extends ce{constructor(e){super(),he(this,e,nt,lt,ue,{fileStruct:0,indentLevel:1,fullPath:2})}}function at(l){let e,n,t,s,u,r,i=Oe(l[4].date)+"",a,c,_,p,m=l[4].duration+"",o,h,f,B,q=l[0].attempts.length+"",k,C,A,y,K,F=l[0].attempts.reduce(Le,0)+"",x,de,P,_e,je=l[4].mistakeCount+"",me,ve,O,H=l[2]?"üóëÔ∏è":"üîª",ee,ge,W,G,J=l[0].flagged?new Date().getMonth()===5?"üè≥Ô∏è‚Äçüåà ":"üö© ":"",te,Q=l[0].name+"",le,pe,Ce;return{c(){e=b("div"),n=b("div"),t=b("a"),s=b("div"),u=b("div"),r=S("-"),a=S(i),c=V(),_=b("div"),p=S("‚è±Ô∏è "),o=S(m),h=V(),f=b("div"),B=S("‚úèÔ∏è "),k=S(q),C=b("div"),A=V(),y=b("div"),K=S("‚ùî "),x=S(F),de=V(),P=b("div"),_e=S("‚ùå "),me=S(je),ve=V(),O=b("button"),ee=S(H),ge=V(),W=b("a"),G=b("div"),te=S(J),le=S(Q),this.h()},l(N){e=E(N,"DIV",{class:!0});var j=w(e);n=E(j,"DIV",{class:!0});var ne=w(n);t=E(ne,"A",{href:!0});var Me=w(t);s=E(Me,"DIV",{class:!0});var M=w(s);u=E(M,"DIV",{class:!0,title:!0});var be=w(u);r=D(be,"-"),a=D(be,i),be.forEach(g),c=I(M),_=E(M,"DIV",{class:!0,title:!0});var Ee=w(_);p=D(Ee,"‚è±Ô∏è "),o=D(Ee,m),Ee.forEach(g),h=I(M),f=E(M,"DIV",{class:!0,title:!0});var ke=w(f);B=D(ke,"‚úèÔ∏è "),k=D(ke,q),ke.forEach(g),C=E(M,"DIV",{}),w(C).forEach(g),A=I(M),y=E(M,"DIV",{class:!0,title:!0});var we=w(y);K=D(we,"‚ùî "),x=D(we,F),we.forEach(g),de=I(M),P=E(M,"DIV",{class:!0,title:!0});var ye=w(P);_e=D(ye,"‚ùå "),me=D(ye,je),ye.forEach(g),M.forEach(g),Me.forEach(g),ve=I(ne),O=E(ne,"BUTTON",{class:!0,title:!0});var Be=w(O);ee=D(Be,H),Be.forEach(g),ne.forEach(g),ge=I(j),W=E(j,"A",{href:!0});var Te=w(W);G=E(Te,"DIV",{});var Se=w(G);te=D(Se,J),le=D(Se,Q),Se.forEach(g),Te.forEach(g),j.forEach(g),this.h()},h(){v(u,"class","m-auto"),v(u,"title","Time since last attempt ("+Oe(l[4].date,!1)+")"),v(_,"class","m-auto"),v(_,"title","Duration of last attempt ("+l[4].duration+" minutes)"),v(f,"class","m-auto"),v(f,"title","Number of attempts"),v(y,"class","m-auto"),v(y,"title","Number of unresolved questions"),v(P,"class","m-auto"),v(P,"title","Weighted average of incorrect problems"),v(s,"class","w-full aspect-square border m-auto grid grid-cols-2 grid-rows-3"),v(t,"href",l[3]),v(O,"class","attempt-dropdown svelte-wqw3oy"),v(O,"title","Show attempts"),v(n,"class","relative"),v(W,"href",l[3]),v(e,"class","text-center w-[6rem] mr-[11px]")},m(N,j){T(N,e,j),d(e,n),d(n,t),d(t,s),d(s,u),d(u,r),d(u,a),d(s,c),d(s,_),d(_,p),d(_,o),d(s,h),d(s,f),d(f,B),d(f,k),d(s,C),d(s,A),d(s,y),d(y,K),d(y,x),d(s,de),d(s,P),d(P,_e),d(P,me),d(n,ve),d(n,O),d(O,ee),d(e,ge),d(e,W),d(W,G),d(G,te),d(G,le),pe||(Ce=Ve(O,"click",function(){He(l[5].bind(this,l[0].id))&&l[5].bind(this,l[0].id).apply(this,arguments)}),pe=!0)},p(N,[j]){l=N,j&1&&q!==(q=l[0].attempts.length+"")&&z(k,q),j&1&&F!==(F=l[0].attempts.reduce(Le,0)+"")&&z(x,F),j&4&&H!==(H=l[2]?"üóëÔ∏è":"üîª")&&z(ee,H),j&1&&J!==(J=l[0].flagged?new Date().getMonth()===5?"üè≥Ô∏è‚Äçüåà ":"üö© ":"")&&z(te,J),j&1&&Q!==(Q=l[0].name+"")&&z(le,Q)},i:R,o:R,d(N){N&&g(e),pe=!1,Ce()}}}function Oe(l,e=!0){const n=new Date,t=(n.getTime()-l.getTime())/(1e3*60*60*24);if(t<=10)return Math.floor(t)+(e?"d":" days");const s=t/7;if(s<=16)return Math.floor(s)+(e?"w":" weeks");const r=(n.getFullYear()-l.getFullYear())*12+(n.getMonth()-l.getMonth());return r<12?r+(e?"m":" months"):Math.floor(r/12)+(e?"y":" years")}const Le=(l,e)=>l+=e.questionCount;function st(l,e,n){let t,s=R,u=()=>(s(),s=Ye(a,m=>n(2,t=m)),a),r;ae(l,Ae,m=>n(6,r=m)),l.$$.on_destroy.push(()=>s());let{file:i}=e,{deleteEnabled:a}=e;u();const c=U.join("/",Z,r.params.path,i.id.toString()),_=function(m){return m.attempts.length===0?X.newBlankAttempt():m.attempts.reduce((o,h)=>h.date>o.date?h:o)}(i);function p(m){t&&X.files.delete(m)}return l.$$set=m=>{"file"in m&&n(0,i=m.file),"deleteEnabled"in m&&u(n(1,a=m.deleteEnabled))},[i,a,t,c,_,p]}class rt extends ce{constructor(e){super(),he(this,e,st,at,ue,{file:0,deleteEnabled:1})}}function it(l,e,n){const t=l.slice();return t[6]=e[n],t}function Ne(l,e,n){const t=l.slice();return t[9]=e[n],t}function ze(l,e,n){const t=l.slice();return t[12]=e[n],t}function $e(l){let e,n,t="üìÅ",s,u=l[12]+"",r,i;return{c(){e=b("a"),n=b("div"),n.textContent=t,s=V(),r=S(u),this.h()},l(a){e=E(a,"A",{href:!0,class:!0});var c=w(e);n=E(c,"DIV",{class:!0,"data-svelte-h":!0}),Ie(n)!=="svelte-4573lq"&&(n.textContent=t),s=I(c),r=D(c,u),c.forEach(g),this.h()},h(){v(n,"class","text-7xl aspect-square perfect-center font-mono"),v(e,"href",i=U.join("/",Z,l[3].params.path,l[12])),v(e,"class","text-center w-[6rem]")},m(a,c){T(a,e,c),d(e,n),d(e,s),d(e,r)},p(a,c){c&2&&u!==(u=a[12]+"")&&z(r,u),c&10&&i!==(i=U.join("/",Z,a[3].params.path,a[12]))&&v(e,"href",i)},d(a){a&&g(e)}}}function Ue(l,e){let n,t,s;return t=new rt({props:{file:e[9],deleteEnabled:e[0]}}),{key:l,first:null,c(){n=se(),re(t.$$.fragment),this.h()},l(u){n=se(),ie(t.$$.fragment,u),this.h()},h(){this.first=n},m(u,r){T(u,n,r),oe(t,u,r),s=!0},p(u,r){e=u;const i={};r&4&&(i.file=e[9]),r&1&&(i.deleteEnabled=e[0]),t.$set(i)},i(u){s||(L(t.$$.fragment,u),s=!0)},o(u){Y(t.$$.fragment,u),s=!1},d(u){u&&g(n),fe(t,u)}}}function ot(l){let e;return{c(){e=b("div"),this.h()},l(n){e=E(n,"DIV",{class:!0}),w(e).forEach(g),this.h()},h(){v(e,"class","w-[6rem] mr-[11px]")},m(n,t){T(n,e,t)},p:R,d(n){n&&g(e)}}}function ft(l){let e,n,t=[],s=new Map,u,r,i=$(Object.keys(l[1])),a=[];for(let o=0;o<i.length;o+=1)a[o]=$e(ze(l,i,o));let c=$(l[2]??[]);const _=o=>o[9].id;for(let o=0;o<c.length;o+=1){let h=Ne(l,c,o),f=_(h);s.set(f,t[o]=Ue(f,h))}let p=$(Array(10)),m=[];for(let o=0;o<p.length;o+=1)m[o]=ot(it(l,p,o));return{c(){e=b("div");for(let o=0;o<a.length;o+=1)a[o].c();n=V();for(let o=0;o<t.length;o+=1)t[o].c();u=V();for(let o=0;o<m.length;o+=1)m[o].c();this.h()},l(o){e=E(o,"DIV",{class:!0});var h=w(e);for(let f=0;f<a.length;f+=1)a[f].l(h);n=I(h);for(let f=0;f<t.length;f+=1)t[f].l(h);u=I(h);for(let f=0;f<m.length;f+=1)m[f].l(h);h.forEach(g),this.h()},h(){v(e,"class","flex flex-wrap justify-evenly gap-3")},m(o,h){T(o,e,h);for(let f=0;f<a.length;f+=1)a[f]&&a[f].m(e,null);d(e,n);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);d(e,u);for(let f=0;f<m.length;f+=1)m[f]&&m[f].m(e,null);r=!0},p(o,[h]){if(h&10){i=$(Object.keys(o[1]));let f;for(f=0;f<i.length;f+=1){const B=ze(o,i,f);a[f]?a[f].p(B,h):(a[f]=$e(B),a[f].c(),a[f].m(e,n))}for(;f<a.length;f+=1)a[f].d(1);a.length=i.length}h&5&&(c=$(o[2]??[]),Ke(),t=xe(t,h,_,1,o,c,s,e,et,Ue,u,Ne),We())},i(o){if(!r){for(let h=0;h<c.length;h+=1)L(t[h]);r=!0}},o(o){for(let h=0;h<t.length;h+=1)Y(t[h]);r=!1},d(o){o&&g(e),De(a,o);for(let h=0;h<t.length;h+=1)t[h].d();De(m,o)}}}function ut(l,e,n){let t,s=R,u=()=>(s(),s=Ye(_,p=>n(2,t=p)),_),r;ae(l,Ae,p=>n(3,r=p)),l.$$.on_destroy.push(()=>s());let{fileStruct:i}=e,{deleteEnabled:a}=e,c={},_;return l.$$set=p=>{"fileStruct"in p&&n(5,i=p.fileStruct),"deleteEnabled"in p&&n(0,a=p.deleteEnabled)},l.$$.update=()=>{if(l.$$.dirty&42&&i[""]!=null&&(n(1,c=i[""]),r.params.path!==""))for(const p of r.params.path.split("/"))n(1,c=c[p]);l.$$.dirty&8&&u(n(4,_=Ze(()=>X.files.where({"[route]":[["",...r.params.path?r.params.path.split("/"):[]]]}).toArray()))),l.$$.dirty&4&&console.log(t),l.$$.dirty&2&&console.log(c)},[a,c,t,r,_,i]}class ct extends ce{constructor(e){super(),he(this,e,ut,ft,ue,{fileStruct:5,deleteEnabled:0})}}function ht(l){let e,n,t,s,u="üóëÔ∏è file",r,i,a="‚ûï file",c,_,p,m,o,h,f,B,q;return p=new Ge({props:{fileStruct:l[0]}}),h=new ct({props:{fileStruct:l[0],deleteEnabled:l[3]}}),{c(){e=V(),n=b("div"),t=b("div"),s=b("button"),s.textContent=u,r=V(),i=b("button"),i.textContent=a,c=V(),_=b("div"),re(p.$$.fragment),m=V(),o=b("div"),re(h.$$.fragment),this.h()},l(k){Xe("svelte-8s10wx",document.head).forEach(g),e=I(k),n=E(k,"DIV",{id:!0,class:!0});var A=w(n);t=E(A,"DIV",{id:!0,class:!0});var y=w(t);s=E(y,"BUTTON",{"data-svelte-h":!0}),Ie(s)!=="svelte-1e4eght"&&(s.textContent=u),r=I(y),i=E(y,"BUTTON",{"data-svelte-h":!0}),Ie(i)!=="svelte-1ulc69y"&&(i.textContent=a),y.forEach(g),c=I(A),_=E(A,"DIV",{id:!0,class:!0});var K=w(_);ie(p.$$.fragment,K),K.forEach(g),m=I(A),o=E(A,"DIV",{id:!0,class:!0});var F=w(o);ie(h.$$.fragment,F),F.forEach(g),A.forEach(g),this.h()},h(){document.title="MathMan Browse",v(t,"id","ribbon"),v(t,"class","text-right svelte-1huhyzt"),v(_,"id","folders"),v(_,"class","svelte-1huhyzt"),v(o,"id","files"),v(o,"class","svelte-1huhyzt"),v(n,"id","grid"),v(n,"class","svelte-1huhyzt")},m(k,C){T(k,e,C),T(k,n,C),d(n,t),d(t,s),d(t,r),d(t,i),d(n,c),d(n,_),oe(p,_,null),d(n,m),d(n,o),oe(h,o,null),f=!0,B||(q=[Ve(s,"click",l[4]),Ve(i,"click",l[5])],B=!0)},p(k,[C]){const A={};C&1&&(A.fileStruct=k[0]),p.$set(A);const y={};C&1&&(y.fileStruct=k[0]),h.$set(y)},i(k){f||(L(p.$$.fragment,k),L(h.$$.fragment,k),f=!0)},o(k){Y(p.$$.fragment,k),Y(h.$$.fragment,k),f=!1},d(k){k&&(g(e),g(n)),fe(p),fe(h),B=!1,Je(q)}}}function dt(l,e,n){let t,s;ae(l,Ae,_=>n(2,s=_));let u={};const r=tt(!1);ae(l,r,_=>n(1,t=_));async function i(){const _={},p=await X.files.orderBy("[route]").uniqueKeys().then(m=>m.flat(1));for(const m of p){let o=_;for(const h of m)h in o||(o[h]={}),o=o[h]}return console.log(_),_}return Qe(()=>{i().then(_=>n(0,u=_))}),[u,t,s,r,()=>Re(r,t=!t,t),()=>X.newFile({basePath:s.data.path})]}class Et extends ce{constructor(e){super(),he(this,e,dt,ht,ue,{})}}export{Et as component};
