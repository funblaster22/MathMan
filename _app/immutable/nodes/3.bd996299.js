import{s as U,n as H,r as ve,o as we,f as Ie,b as se,e as ee}from"../chunks/scheduler.03df403d.js";import{S as R,i as Y,g as b,s as V,h as I,j as N,z as Q,c as M,f as g,l as S,k as p,a as y,x as D,A as q,y as ie,m as te,n as ne,B as oe,o as re,d as z,p as Ce,b as ke,t as x,r as J,u as K,v as Z,w as $}from"../chunks/index.5bc90a32.js";import{d as P,e as O,a as be,n as De,p as ce}from"../chunks/index.83a2109c.js";import{j as ye,w as Te,k as ue,e as fe}from"../chunks/singletons.c457f596.js";import{p as le}from"../chunks/stores.ce72b9db.js";var k=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Erase=4]="Erase",n))(k||{});function Ee(n){let e,a,s='<img src="/marker.png" title="Your work" draggable="false"/>',r,l,f='<img src="/marker.png" title="Correct" draggable="false"/>',c,t,h='<img src="/marker.png" title="Question" draggable="false"/>',u,o,i='<img src="/eraser.png" title="Eraser" draggable="false"/>',v,_;return{c(){e=b("div"),a=b("div"),a.innerHTML=s,r=V(),l=b("div"),l.innerHTML=f,c=V(),t=b("div"),t.innerHTML=h,u=V(),o=b("div"),o.innerHTML=i,this.h()},l(E){e=I(E,"DIV",{id:!0});var C=N(e);a=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(a)!=="svelte-s7g5ry"&&(a.innerHTML=s),r=M(C),l=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(l)!=="svelte-ycay66"&&(l.innerHTML=f),c=M(C),t=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(t)!=="svelte-1pok5wx"&&(t.innerHTML=h),u=M(C),o=I(C,"DIV",{style:!0,"data-tool":!0,"data-svelte-h":!0}),Q(o)!=="svelte-1sq5307"&&(o.innerHTML=i),C.forEach(g),this.h()},h(){S(a,"width","30px"),S(a,"filter","grayscale(1)"),p(a,"data-tool",k.Draw),S(l,"width","30px"),S(l,"filter","hue-rotate(136deg)"),p(l,"data-tool",k.Correct),S(t,"width","30px"),p(t,"data-tool",k.Question),S(o,"width","30px"),p(o,"data-tool",k.Erase),p(e,"id","tools")},m(E,C){y(E,e,C),D(e,a),D(e,r),D(e,l),D(e,c),D(e,t),D(e,u),D(e,o),v||(_=[q(a,"click",n[0]),q(l,"click",n[0]),q(t,"click",n[0]),q(o,"click",n[0])],v=!0)},p:H,i:H,o:H,d(E){E&&g(e),v=!1,ve(_)}}}function Ae(n,e,a){let{selected:s}=e;function r(l){l.stopPropagation();const f=l.currentTarget,c=f.style.height=="100%";for(const t of document.querySelectorAll("#tools > div"))t.style.height="30px";for(const t of document.querySelectorAll(".tool"))t.id="";if(c){s.set(k.None);return}s.set(Number.parseInt(f.dataset.tool)),f.style.height="100%"}return n.$$set=l=>{"selected"in l&&a(1,s=l.selected)},[r,s]}class Ne extends R{constructor(e){super(),Y(this,e,Ae,Ee,U,{selected:1})}}function Ve(n){let e,a,s,r,l,f,c;return{c(){e=b("canvas"),a=V(),s=b("canvas"),r=V(),l=b("canvas"),this.h()},l(t){e=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(e).forEach(g),a=M(t),s=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(s).forEach(g),r=M(t),l=I(t,"CANVAS",{width:!0,height:!0,class:!0}),N(l).forEach(g),this.h()},h(){p(e,"width",n[2]),p(e,"height",n[3]),p(e,"class","svelte-1rofrvo"),p(s,"width",n[2]),p(s,"height",n[3]),p(s,"class","svelte-1rofrvo"),p(l,"width",n[2]),p(l,"height",n[3]),p(l,"class","svelte-1rofrvo")},m(t,h){y(t,e,h),n[9](e),y(t,a,h),y(t,s,h),n[10](s),y(t,r,h),y(t,l,h),n[11](l),f||(c=[q(l,"pointerdown",n[4]),q(l,"pointerup",n[5]),q(l,"pointermove",n[6])],f=!0)},p(t,[h]){h&4&&p(e,"width",t[2]),h&8&&p(e,"height",t[3]),h&4&&p(s,"width",t[2]),h&8&&p(s,"height",t[3]),h&4&&p(l,"width",t[2]),h&8&&p(l,"height",t[3])},i:H,o:H,d(t){t&&(g(e),g(a),g(s),g(r),g(l)),n[9](null),n[10](null),n[11](null),f=!1,ve(c)}}}function Me(n,e,a){let s,r=H,l=()=>(r(),r=Ie(f,d=>a(13,s=d)),f);n.$$.on_destroy.push(()=>r());let{selectedTool:f}=e;l();let{problemId:c}=e,{attemptId:t}=e,h=0,u=0,o=!1,i=[];function v(){typeof window>"u"||(a(2,h=window.innerWidth),a(3,u=window.innerHeight),requestAnimationFrame(async()=>{const d=(await P.files.get(c)).attempts[t];i[k.Draw].putImageData(d.work,0,0),i[k.Correct].putImageData(d.error,0,0),i[k.Question].putImageData(d.questions,0,0)}))}function _(){const d=[0,0,h,u];P.files.update(c,w=>{w.attempts[t]={date:new Date,work:i[k.Draw].getImageData(...d),error:i[k.Correct].getImageData(...d),questions:i[k.Question].getImageData(...d),rois:w.attempts[t].rois}})}const E=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,C={[k.Draw]:E?"white":"black",[k.Correct]:"red",[k.Question]:"blue"},F=d=>{if(s==k.None)return;const w=i[s];o=!0,w.strokeStyle=C[s],w.beginPath(),w.moveTo(d.clientX,d.clientY)},W=()=>{o=!1,_()},ae=d=>{if(o){const w=i[s];w.lineTo(d.clientX,d.clientY),w.stroke()}};we(()=>{window.onresize=v,a(1,i=i.map(d=>d.getContext("2d",{willReadFrequently:!0})))});function L(d){se[d?"unshift":"push"](()=>{i[k.Draw]=d,a(1,i)})}function T(d){se[d?"unshift":"push"](()=>{i[k.Correct]=d,a(1,i)})}function m(d){se[d?"unshift":"push"](()=>{i[k.Question]=d,a(1,i)})}return n.$$set=d=>{"selectedTool"in d&&l(a(0,f=d.selectedTool)),"problemId"in d&&a(7,c=d.problemId),"attemptId"in d&&a(8,t=d.attemptId)},n.$$.update=()=>{if(n.$$.dirty&386){v();for(const d of i){const w=d.canvas;d.clearRect(0,0,w.width,w.height)}}},[f,i,h,u,F,W,ae,c,t,L,T,m]}class qe extends R{constructor(e){super(),Y(this,e,Me,Ve,U,{selectedTool:0,problemId:7,attemptId:8})}}const B=ye("goto");function de(n,e,a){const s=n.slice();return s[4]=e[a],s}function he(n){let e,a=n[4].name+"",s,r;return{c(){e=b("option"),s=te(a),this.h()},l(l){e=I(l,"OPTION",{});var f=N(e);s=ne(f,a),f.forEach(g),this.h()},h(){e.__value=r=n[4].id,oe(e,e.__value)},m(l,f){y(l,e,f),D(e,s)},p(l,f){f&1&&a!==(a=l[4].name+"")&&re(s,a),f&1&&r!==(r=l[4].id)&&(e.__value=r,oe(e,e.__value))},d(l){l&&g(e)}}}function He(n){let e,a="üö©",s,r,l,f,c="‚û°Ô∏è",t,h,u=O(n[0]??[]),o=[];for(let i=0;i<u.length;i+=1)o[i]=he(de(n,u,i));return{c(){e=b("button"),e.textContent=a,s=V(),r=b("select");for(let i=0;i<o.length;i+=1)o[i].c();l=V(),f=b("button"),f.textContent=c},l(i){e=I(i,"BUTTON",{"data-svelte-h":!0}),Q(e)!=="svelte-yzpet0"&&(e.textContent=a),s=M(i),r=I(i,"SELECT",{});var v=N(r);for(let _=0;_<o.length;_+=1)o[_].l(v);v.forEach(g),l=M(i),f=I(i,"BUTTON",{"data-svelte-h":!0}),Q(f)!=="svelte-q61pzu"&&(f.textContent=c)},m(i,v){y(i,e,v),y(i,s,v),y(i,r,v);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(r,null);y(i,l,v),y(i,f,v),t||(h=q(r,"change",n[1]),t=!0)},p(i,[v]){if(v&1){u=O(i[0]??[]);let _;for(_=0;_<u.length;_+=1){const E=de(i,u,_);o[_]?o[_].p(E,v):(o[_]=he(E),o[_].c(),o[_].m(r,null))}for(;_<o.length;_+=1)o[_].d(1);o.length=u.length}},i:H,o:H,d(i){i&&(g(e),g(s),g(r),g(l),g(f)),ie(o,i),t=!1,h()}}}function Le(n,e,a){let s,{parentFolder:r}=e;function l(c){const t=c.target.value;B(t)}const f=be(()=>P.files.where({parent:r}).toArray());return ee(n,f,c=>a(0,s=c)),n.$$set=c=>{"parentFolder"in c&&a(3,r=c.parentFolder)},[s,l,f,r]}class Se extends R{constructor(e){super(),Y(this,e,Le,He,U,{parentFolder:3})}}function Qe(n){let e,a,s,r,l=n[0]+1+"",f;return{c(){e=b("div"),a=b("canvas"),r=te(`
    Attempt `),f=te(l),this.h()},l(c){e=I(c,"DIV",{class:!0});var t=N(e);a=I(t,"CANVAS",{width:!0,height:!0}),N(a).forEach(g),r=ne(t,`
    Attempt `),f=ne(t,l),t.forEach(g),this.h()},h(){p(a,"width",n[1]),p(a,"height",s=n[1]-24),p(e,"class","text-center bg-gray-50 rounded-md"),S(e,"width",n[1]+"px")},m(c,t){y(c,e,t),D(e,a),n[4](a),D(e,r),D(e,f)},p(c,[t]){t&2&&p(a,"width",c[1]),t&2&&s!==(s=c[1]-24)&&p(a,"height",s),t&1&&l!==(l=c[0]+1+"")&&re(f,l),t&2&&S(e,"width",c[1]+"px")},i:H,o:H,d(c){c&&g(e),n[4](null)}}}function ze(n,e,a){let{attempt:s}=e,{idx:r}=e,{size:l=100}=e,f;function c(h,u){const o=document.createElement("canvas");o.width=u[0].width,o.height=u[0].height,h.scale(l/o.width,(l-24)/o.height);for(const i of u)o.getContext("2d").putImageData(i,0,0),h.drawImage(o,0,0)}we(async()=>{const h=f.getContext("2d");c(h,[s.work,s.error,s.questions])});function t(h){se[h?"unshift":"push"](()=>{f=h,a(2,f)})}return n.$$set=h=>{"attempt"in h&&a(3,s=h.attempt),"idx"in h&&a(0,r=h.idx),"size"in h&&a(1,l=h.size)},[r,l,f,s,t]}class xe extends R{constructor(e){super(),Y(this,e,ze,Qe,U,{attempt:3,idx:0,size:1})}}function me(n,e,a){const s=n.slice();return s[5]=e[a],s[7]=a,s}function pe(n){let e,a,s,r,l;a=new xe({props:{attempt:n[5],idx:n[7]}});function f(){return n[4](n[7])}return{c(){e=b("div"),J(a.$$.fragment)},l(c){e=I(c,"DIV",{});var t=N(e);K(a.$$.fragment,t),t.forEach(g)},m(c,t){y(c,e,t),Z(a,e,null),s=!0,r||(l=q(e,"click",f),r=!0)},p(c,t){n=c;const h={};t&1&&(h.attempt=n[5]),a.$set(h)},i(c){s||(z(a.$$.fragment,c),s=!0)},o(c){x(a.$$.fragment,c),s=!1},d(c){c&&g(e),$(a),r=!1,l()}}}function Fe(n){let e,a,s=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">‚ûï</div>
    New Attempt`,r,l,f,c=O(n[0]??[]),t=[];for(let u=0;u<c.length;u+=1)t[u]=pe(me(n,c,u));const h=u=>x(t[u],1,1,()=>{t[u]=null});return{c(){for(let u=0;u<t.length;u+=1)t[u].c();e=V(),a=b("div"),a.innerHTML=s,this.h()},l(u){for(let o=0;o<t.length;o+=1)t[o].l(u);e=M(u),a=I(u,"DIV",{class:!0,"data-svelte-h":!0}),Q(a)!=="svelte-59ttd9"&&(a.innerHTML=s),this.h()},h(){p(a,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(u,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(u,o);y(u,e,o),y(u,a,o),r=!0,l||(f=q(a,"click",n[2]),l=!0)},p(u,[o]){if(o&1){c=O(u[0]??[]);let i;for(i=0;i<c.length;i+=1){const v=me(u,c,i);t[i]?(t[i].p(v,o),z(t[i],1)):(t[i]=pe(v),t[i].c(),z(t[i],1),t[i].m(e.parentNode,e))}for(Ce(),i=c.length;i<t.length;i+=1)h(i);ke()}},i(u){if(!r){for(let o=0;o<c.length;o+=1)z(t[o]);r=!0}},o(u){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)x(t[o]);r=!1},d(u){u&&(g(e),g(a)),ie(t,u),l=!1,f()}}}function je(n,e,a){let s,{problemId:r}=e;const l=be(()=>P.files.get(r).then(t=>t.attempts));ee(n,l,t=>a(0,s=t));function f(){P.files.update(r,t=>{B("?attempt="+t.attempts.push(De()))})}const c=t=>B("?attempt="+(t+1));return n.$$set=t=>{"problemId"in t&&a(3,r=t.problemId)},[s,l,f,r,c]}class Be extends R{constructor(e){super(),Y(this,e,je,Fe,U,{problemId:3})}}function ge(n,e,a){const s=n.slice();return s[8]=e[a],s}function _e(n){let e,a=n[8]+"",s;return{c(){e=te("/"),s=te(a)},l(r){e=ne(r,"/"),s=ne(r,a)},m(r,l){y(r,e,l),y(r,s,l)},p(r,l){l&2&&a!==(a=r[8]+"")&&re(s,a)},d(r){r&&(g(e),g(s))}}}function Pe(n){let e,a,s,r,l,f="üè†",c,t,h,u,o,i,v,_,E,C,F,W,ae;e=new qe({props:{selectedTool:n[3],problemId:n[0],attemptId:n[2]}});let L=O(n[1].params.path.split("/")),T=[];for(let m=0;m<L.length;m+=1)T[m]=_e(ge(n,L,m));return u=new Se({props:{parentFolder:n[1].params.path.split("/").at(-1)}}),v=new Ne({props:{selected:n[3]}}),C=new Be({props:{problemId:n[0]}}),{c(){J(e.$$.fragment),a=V(),s=b("div"),r=b("div"),l=b("button"),l.textContent=f,c=V();for(let m=0;m<T.length;m+=1)T[m].c();t=V(),h=b("div"),J(u.$$.fragment),o=V(),i=b("div"),J(v.$$.fragment),_=V(),E=b("div"),J(C.$$.fragment),this.h()},l(m){K(e.$$.fragment,m),a=M(m),s=I(m,"DIV",{id:!0,class:!0});var d=N(s);r=I(d,"DIV",{class:!0});var w=N(r);l=I(w,"BUTTON",{"data-svelte-h":!0}),Q(l)!=="svelte-1xjub06"&&(l.textContent=f),c=M(w);for(let j=0;j<T.length;j+=1)T[j].l(w);w.forEach(g),t=M(d),h=I(d,"DIV",{class:!0});var X=N(h);K(u.$$.fragment,X),X.forEach(g),o=M(d),i=I(d,"DIV",{id:!0,class:!0});var G=N(i);K(v.$$.fragment,G),G.forEach(g),_=M(d),E=I(d,"DIV",{id:!0,class:!0});var A=N(E);K(C.$$.fragment,A),A.forEach(g),d.forEach(g),this.h()},h(){p(r,"class","svelte-aa6inf"),p(h,"class","text-right svelte-aa6inf"),p(i,"id","tools-container"),p(i,"class","svelte-aa6inf"),p(E,"id","attempts-container"),p(E,"class","flex flex-col p-3 gap-3 svelte-aa6inf"),p(s,"id","grid"),p(s,"class","svelte-aa6inf")},m(m,d){Z(e,m,d),y(m,a,d),y(m,s,d),D(s,r),D(r,l),D(r,c);for(let w=0;w<T.length;w+=1)T[w]&&T[w].m(r,null);D(s,t),D(s,h),Z(u,h,null),D(s,o),D(s,i),Z(v,i,null),D(s,_),D(s,E),Z(C,E,null),F=!0,W||(ae=q(l,"click",n[6]),W=!0)},p(m,[d]){const w={};if(d&1&&(w.problemId=m[0]),d&4&&(w.attemptId=m[2]),e.$set(w),d&2){L=O(m[1].params.path.split("/"));let A;for(A=0;A<L.length;A+=1){const j=ge(m,L,A);T[A]?T[A].p(j,d):(T[A]=_e(j),T[A].c(),T[A].m(r,null))}for(;A<T.length;A+=1)T[A].d(1);T.length=L.length}const X={};d&2&&(X.parentFolder=m[1].params.path.split("/").at(-1)),u.$set(X);const G={};d&1&&(G.problemId=m[0]),C.$set(G)},i(m){F||(z(e.$$.fragment,m),z(u.$$.fragment,m),z(v.$$.fragment,m),z(C.$$.fragment,m),F=!0)},o(m){x(e.$$.fragment,m),x(u.$$.fragment,m),x(v.$$.fragment,m),x(C.$$.fragment,m),F=!1},d(m){m&&(g(a),g(s)),$(e,m),ie(T,m),$(u),$(v),$(C),W=!1,ae()}}}function Oe(n,e,a){let s,r,l;ee(n,le,o=>a(1,r=o));const f=Te(k.None),c=ue(le,o=>Number.parseInt(o.params.problemId));ee(n,c,o=>a(0,s=o));const t=ue(le,o=>Number.parseInt(o.url.searchParams.get("attempt")??"1")-1);ee(n,t,o=>a(2,l=o));function h(o){if(o){const i=o.route.join("/");"/"+r.params.path!==i&&B(ce.join("/",fe,i,r.params.problemId))}else B(ce.join("/",fe,r.params.path))}const u=()=>B("..");return n.$$.update=()=>{n.$$.dirty&1&&typeof window<"u"&&P.files.get(s).then(h)},[s,r,l,f,c,t,u]}class Ge extends R{constructor(e){super(),Y(this,e,Oe,Pe,U,{})}}export{Ge as component};
