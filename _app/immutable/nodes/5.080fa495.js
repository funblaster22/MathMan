import{s as ee,n as W,f as ue,e as G,m as Ue,k as qe,o as Se,j as Ae,b as ae,p as He,r as We}from"../chunks/scheduler.d208cd37.js";import{S as te,i as ne,s as V,g as N,c as O,h as q,C as oe,k as v,l as R,a as y,A as z,D as Le,f as b,j as Q,x as S,r as X,m as x,u as J,n as $,v as K,d as F,t as j,w as Z,E as Pe,F as ge,o as fe,y as Qe,G as me,H as Be,p as ze,b as Fe,B as je,z as _e}from"../chunks/index.c95bd50b.js";import{e as re,u as Ve,s as Ye,a as Oe,d as Ge,o as Xe}from"../chunks/index.3b6591eb.js";import{j as Je,w as be,k as we}from"../chunks/singletons.5cdf6080.js";import{a as de,d as Y,u as Re,D as Ke,b as pe}from"../chunks/db.17c73a3a.js";import{p as ie}from"../chunks/stores.b3e124d5.js";var L=(n=>(n[n.Draw=0]="Draw",n[n.Correct=1]="Correct",n[n.Question=2]="Question",n[n.None=3]="None",n[n.Select=4]="Select",n))(L||{});const Ze=""+new URL("../assets/eraser.0e084288.png",import.meta.url).href;function ve(n){let e,t="Show Solution";return{c(){e=N("button"),e.textContent=t,this.h()},l(s){e=q(s,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),oe(e)!=="svelte-on8fyx"&&(e.textContent=t),this.h()},h(){v(e,"class","border text-center"),R(e,"position","fixed"),R(e,"left",n[1][0]+"px"),R(e,"top",n[1][1]+"px"),R(e,"width",n[2][0]-n[1][0]+"px"),R(e,"height",n[2][1]-n[1][1]+"px")},m(s,l){y(s,e,l)},p(s,l){l&2&&R(e,"left",s[1][0]+"px"),l&2&&R(e,"top",s[1][1]+"px"),l&6&&R(e,"width",s[2][0]-s[1][0]+"px"),l&6&&R(e,"height",s[2][1]-s[1][1]+"px")},d(s){s&&b(e)}}}function xe(n){let e,t,s='<div style="background-color: green">✅</div>',l,i,a=n[1][1]&&ve(n);return{c(){a&&a.c(),e=V(),t=N("div"),t.innerHTML=s,this.h()},l(o){a&&a.l(o),e=O(o),t=q(o,"DIV",{class:!0,"data-svelte-h":!0}),oe(t)!=="svelte-aiv1v7"&&(t.innerHTML=s),this.h()},h(){v(t,"class","tool"),R(t,"height",n[0]?"100%":"30px")},m(o,r){a&&a.m(o,r),y(o,e,r),y(o,t,r),l||(i=z(t,"pointerdown",Le(n[8])),l=!0)},p(o,[r]){o[1][1]?a?a.p(o,r):(a=ve(o),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),r&1&&R(t,"height",o[0]?"100%":"30px")},i:W,o:W,d(o){o&&(b(e),b(t)),a&&a.d(o),l=!1,i()}}}function $e(n,e,t){let s;const l=L.Select;let i=!1,a=!1,o=[],r=[],u,h,d=ue("selection");G(n,d,g=>t(7,s=g)),window.addEventListener("pointerdown",g=>{i&&(a=!0,t(5,o=t(6,r=[g.x,g.y])))}),window.addEventListener("pointermove",g=>{a&&t(6,r=[g.x,g.y])}),window.addEventListener("pointerup",()=>{a=!1});const p=()=>d.set(i?L.None:l);return n.$$.update=()=>{n.$$.dirty&128&&t(0,i=s===l),n.$$.dirty&96&&(t(1,u=[Math.min(o[0],r[0]),Math.min(o[1],r[1])]),t(2,h=[Math.max(o[0],r[0]),Math.max(o[1],r[1])]))},[i,u,h,l,d,o,r,s,p]}class et extends te{constructor(e){super(),ne(this,e,$e,xe,ee,{})}}const tt=""+new URL("../assets/marker.c9b3b178.png",import.meta.url).href;function nt(n){let e,t,s,l,i;return{c(){e=N("div"),t=N("img"),this.h()},l(a){e=q(a,"DIV",{class:!0});var o=Q(e);t=q(o,"IMG",{style:!0,src:!0,title:!0,draggable:!0}),o.forEach(b),this.h()},h(){R(t,"filter",n[1]),Ue(t.src,s=tt)||v(t,"src",s),v(t,"title",n[2]),v(t,"draggable","false"),v(e,"class","tool"),R(e,"height",n[3]?"100%":"30px")},m(a,o){y(a,e,o),S(e,t),l||(i=z(e,"pointerdown",Le(n[6])),l=!0)},p(a,[o]){o&2&&R(t,"filter",a[1]),o&4&&v(t,"title",a[2]),o&8&&R(e,"height",a[3]?"100%":"30px")},i:W,o:W,d(a){a&&b(e),l=!1,i()}}}function st(n,e,t){let s,{tool:l}=e,{filter:i=""}=e,{title:a}=e,o=ue("selection");G(n,o,h=>t(5,s=h));let r=!1;const u=()=>o.set(r?L.None:l);return n.$$set=h=>{"tool"in h&&t(0,l=h.tool),"filter"in h&&t(1,i=h.filter),"title"in h&&t(2,a=h.title)},n.$$.update=()=>{n.$$.dirty&33&&t(3,r=s===l)},[l,i,a,r,o,s,u]}class he extends te{constructor(e){super(),ne(this,e,st,nt,ee,{tool:0,filter:1,title:2})}}function rt(n){let e,t,s,l,i,a,o,r,u,h,d,p,g,T,E=`<img src="${Ze}" title="Eraser" draggable="false" class="svelte-h3rgmi"/>`,A,D,U;return t=new et({}),r=new he({props:{tool:L.Draw,filter:"grayscale(1)",title:"Your work"}}),h=new he({props:{tool:L.Correct,filter:"hue-rotate(136deg)",title:"Correct"}}),p=new he({props:{tool:L.Question,title:"Question"}}),{c(){e=N("div"),X(t.$$.fragment),s=V(),l=N("a"),i=x("📷"),o=V(),X(r.$$.fragment),u=V(),X(h.$$.fragment),d=V(),X(p.$$.fragment),g=V(),T=N("div"),T.innerHTML=E,this.h()},l(_){e=q(_,"DIV",{id:!0,class:!0});var C=Q(e);J(t.$$.fragment,C),s=O(C),l=q(C,"A",{href:!0});var P=Q(l);i=$(P,"📷"),P.forEach(b),o=O(C),J(r.$$.fragment,C),u=O(C),J(h.$$.fragment,C),d=O(C),J(p.$$.fragment,C),g=O(C),T=q(C,"DIV",{class:!0,"data-svelte-h":!0}),oe(T)!=="svelte-19p7wft"&&(T.innerHTML=E),C.forEach(b),this.h()},h(){v(l,"href",a=de("camera",n[1].params.problemId)),v(T,"class","tool"),R(T,"height",n[0]?"100%":"30px"),v(e,"id","tools"),v(e,"class","svelte-h3rgmi")},m(_,C){y(_,e,C),K(t,e,null),S(e,s),S(e,l),S(l,i),S(e,o),K(r,e,null),S(e,u),K(h,e,null),S(e,d),K(p,e,null),S(e,g),S(e,T),A=!0,D||(U=z(T,"click",n[3]),D=!0)},p(_,[C]){(!A||C&2&&a!==(a=de("camera",_[1].params.problemId)))&&v(l,"href",a),C&1&&R(T,"height",_[0]?"100%":"30px")},i(_){A||(F(t.$$.fragment,_),F(r.$$.fragment,_),F(h.$$.fragment,_),F(p.$$.fragment,_),A=!0)},o(_){j(t.$$.fragment,_),j(r.$$.fragment,_),j(h.$$.fragment,_),j(p.$$.fragment,_),A=!1},d(_){_&&b(e),Z(t),Z(r),Z(h),Z(p),D=!1,U()}}}function lt(n,e,t){let s,l;G(n,ie,r=>t(1,l=r));let{selected:i}=e;qe("selection",i);let a=ue("eraserEnabled");G(n,a,r=>t(0,s=r));function o(r){a.set(!s)}return n.$$set=r=>{"selected"in r&&t(4,i=r.selected)},[s,l,a,o,i]}class ot extends te{constructor(e){super(),ne(this,e,lt,rt,ee,{selected:4})}}function at(n){let e,t,s,l,i,a,o;return{c(){e=N("canvas"),t=V(),s=N("canvas"),l=V(),i=N("canvas"),this.h()},l(r){e=q(r,"CANVAS",{width:!0,height:!0,class:!0}),Q(e).forEach(b),t=O(r),s=q(r,"CANVAS",{width:!0,height:!0,class:!0}),Q(s).forEach(b),l=O(r),i=q(r,"CANVAS",{width:!0,height:!0,class:!0}),Q(i).forEach(b),this.h()},h(){v(e,"width",n[2]),v(e,"height",n[3]),v(e,"class","svelte-1rofrvo"),v(s,"width",n[2]),v(s,"height",n[3]),v(s,"class","svelte-1rofrvo"),v(i,"width",n[2]),v(i,"height",n[3]),v(i,"class","svelte-1rofrvo")},m(r,u){y(r,e,u),n[8](e),y(r,t,u),y(r,s,u),n[9](s),y(r,l,u),y(r,i,u),n[10](i),a||(o=z(i,"pointerdown",Pe(n[5])),a=!0)},p(r,[u]){u&4&&v(e,"width",r[2]),u&8&&v(e,"height",r[3]),u&4&&v(s,"width",r[2]),u&8&&v(s,"height",r[3]),u&4&&v(i,"width",r[2]),u&8&&v(i,"height",r[3])},i:W,o:W,d(r){r&&(b(e),b(t),b(s),b(l),b(i)),n[8](null),n[9](null),n[10](null),a=!1,o()}}}function it(n,e,t){let s,l=W,i=()=>(l(),l=Ae(o,c=>t(13,s=c)),o),a;n.$$.on_destroy.push(()=>l());let{selectedTool:o}=e;i();let{problemId:r}=e,{attemptId:u}=e,h=0,d=0,p=!1,g=ue("eraserEnabled");G(n,g,c=>t(14,a=c));let T,E=[];function A(){typeof window>"u"||r===0||(t(2,h=window.innerWidth),t(3,d=window.innerHeight),requestAnimationFrame(async()=>{if(E[0]==null)return;const c=(await Y.files.get(r)).attempts[u];E[L.Draw].putImageData(c.work,0,0),E[L.Correct].putImageData(c.error,0,0),E[L.Question].putImageData(c.questions,0,0)}))}const D=()=>{const c=[0,0,h,d];Y.files.update(r,k=>{const H=k.attempts[u];H.date=new Date,H.duration=Math.floor((new Date().getTime()-T)/1e3/60),s==L.Correct&&(H.mistakeCount=1),s==L.Question&&(H.questionCount=1),H[["work","error","questions"][s]]=E[s].getImageData(...c)})},U=typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches,_={[L.Draw]:U?"white":"black",[L.Correct]:"red",[L.Question]:"blue"},C=c=>{if(s>=L.None)return;const k=E[s];p=!0,k.strokeStyle=_[s],k.lineWidth=a?20:1,k.globalCompositeOperation=a?"destination-out":"source-over",k.beginPath(),k.moveTo(c.clientX,c.clientY)},P=()=>{p&&D(),p=!1},I=c=>{if(p){const k=E[s];k.lineTo(c.clientX,c.clientY),k.stroke()}};Se(()=>{window.addEventListener("resize",A),document.addEventListener("pointermove",I),document.addEventListener("pointerup",P),E.forEach(c=>c.addEventListener("touchstart",k=>k.preventDefault())),t(1,E=E.map(c=>c.getContext("2d",{willReadFrequently:!0})))});function w(c){ae[c?"unshift":"push"](()=>{E[L.Draw]=c,t(1,E)})}function m(c){ae[c?"unshift":"push"](()=>{E[L.Correct]=c,t(1,E)})}function f(c){ae[c?"unshift":"push"](()=>{E[L.Question]=c,t(1,E)})}return n.$$set=c=>{"selectedTool"in c&&i(t(0,o=c.selectedTool)),"problemId"in c&&t(6,r=c.problemId),"attemptId"in c&&t(7,u=c.attemptId)},n.$$.update=()=>{if(n.$$.dirty&194){A(),T=new Date().getTime();for(const c of E){const k=c.canvas;c.clearRect(0,0,k.width,k.height)}}},[o,E,h,d,g,C,r,u,w,m,f]}class ut extends te{constructor(e){super(),ne(this,e,it,at,ee,{selectedTool:0,problemId:6,attemptId:7})}}const le=Je("goto");function ke(n,e,t){const s=n.slice();return s[19]=e[t],s[21]=t,s}function Ie(n,e,t){const s=n.slice();return s[22]=e[t],s}function Ce(n){let e,t="🧠 Resolve questions",s,l;return{c(){e=N("button"),e.textContent=t},l(i){e=q(i,"BUTTON",{"data-svelte-h":!0}),oe(e)!=="svelte-ykge1i"&&(e.textContent=t)},m(i,a){y(i,e,a),s||(l=z(e,"click",n[11]),s=!0)},p:W,d(i){i&&b(e),s=!1,l()}}}function Ee(n){let e,t=n[6][n[22]]+"",s;return{c(){e=N("option"),s=x(t),this.h()},l(l){e=q(l,"OPTION",{});var i=Q(e);s=$(i,t),i.forEach(b),this.h()},h(){e.__value=n[22],me(e,e.__value)},m(l,i){y(l,e,i),S(e,s)},p:W,d(l){l&&b(e)}}}function De(n,e){let t,s=e[19].name+"",l,i,a;return{key:n,first:null,c(){t=N("option"),l=x(s),this.h()},l(o){t=q(o,"OPTION",{});var r=Q(t);l=$(r,s),r.forEach(b),this.h()},h(){t.__value=i=e[21],me(t,t.__value),t.selected=a=e[19].id===e[0],this.first=t},m(o,r){y(o,t,r),S(t,l)},p(o,r){e=o,r&16&&s!==(s=e[19].name+"")&&fe(l,s),r&16&&i!==(i=e[21])&&(t.__value=i,me(t,t.__value)),r&17&&a!==(a=e[19].id===e[0])&&(t.selected=a)},d(o){o&&b(t)}}}function ft(n){var I,w,m;let e,t,s=n[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️",l,i,a,o,r,u,h=[],d=new Map,p,g,T="➡️",E,A,D=((m=(w=(I=n[4][n[2]])==null?void 0:I.attempts)==null?void 0:w[n[1]])==null?void 0:m.questions)>0&&Ce(n),U=re(Object.keys(n[6])),_=[];for(let f=0;f<U.length;f+=1)_[f]=Ee(Ie(n,U,f));let C=re(n[4]);const P=f=>f[19].id;for(let f=0;f<C.length;f+=1){let c=ke(n,C,f),k=P(c);d.set(k,h[f]=De(k,c))}return{c(){D&&D.c(),e=V(),t=N("button"),l=x(s),a=V(),o=N("select");for(let f=0;f<_.length;f+=1)_[f].c();r=V(),u=N("select");for(let f=0;f<h.length;f+=1)h[f].c();p=V(),g=N("button"),g.textContent=T,this.h()},l(f){D&&D.l(f),e=O(f),t=q(f,"BUTTON",{title:!0});var c=Q(t);l=$(c,s),c.forEach(b),a=O(f),o=q(f,"SELECT",{});var k=Q(o);for(let B=0;B<_.length;B+=1)_[B].l(k);k.forEach(b),r=O(f),u=q(f,"SELECT",{});var H=Q(u);for(let B=0;B<h.length;B+=1)h[B].l(H);H.forEach(b),p=O(f),g=q(f,"BUTTON",{"data-svelte-h":!0}),oe(g)!=="svelte-1wjt799"&&(g.textContent=T),this.h()},h(){v(t,"title",i=(n[5]?"un":"")+"flag for later"),n[3]===void 0&&He(()=>n[15].call(o))},m(f,c){D&&D.m(f,c),y(f,e,c),y(f,t,c),S(t,l),y(f,a,c),y(f,o,c);for(let k=0;k<_.length;k+=1)_[k]&&_[k].m(o,null);ge(o,n[3],!0),y(f,r,c),y(f,u,c);for(let k=0;k<h.length;k+=1)h[k]&&h[k].m(u,null);y(f,p,c),y(f,g,c),E||(A=[z(t,"click",n[9]),z(o,"change",n[15]),z(u,"change",n[7]),z(g,"click",n[8])],E=!0)},p(f,[c]){var k,H,B;if(((B=(H=(k=f[4][f[2]])==null?void 0:k.attempts)==null?void 0:H[f[1]])==null?void 0:B.questions)>0?D?D.p(f,c):(D=Ce(f),D.c(),D.m(e.parentNode,e)):D&&(D.d(1),D=null),c&32&&s!==(s=f[5]?new Date().getMonth()===5?"🏳️‍🌈":"🚩":"🏳️")&&fe(l,s),c&32&&i!==(i=(f[5]?"un":"")+"flag for later")&&v(t,"title",i),c&64){U=re(Object.keys(f[6]));let M;for(M=0;M<U.length;M+=1){const se=Ie(f,U,M);_[M]?_[M].p(se,c):(_[M]=Ee(se),_[M].c(),_[M].m(o,null))}for(;M<_.length;M+=1)_[M].d(1);_.length=U.length}c&72&&ge(o,f[3]),c&17&&(C=re(f[4]),h=Ve(h,c,P,1,f,C,d,u,Ge,De,null,ke))},i:W,o:W,d(f){f&&(b(e),b(t),b(a),b(o),b(r),b(u),b(p),b(g)),D&&D.d(f),Qe(_,f);for(let c=0;c<h.length;c+=1)h[c].d();E=!1,We(A)}}}function ct(n,e,t){let s,l;G(n,ie,I=>t(14,l=I));var i=(I=>(I.Work="Work",I.Mistakes="Mistakes",I.Questions="Questions",I))(i||{});let{problemRoute:a}=e,{problemId:o}=e,r=-1,u=0,h=l.url.searchParams.get("studyMode")??"Work",d=!1,p;function g(I){t(2,u=Number.parseInt(I.target.value)),t(1,r=-1),A()}function T(){return _[u].attempts.findIndex((I,w)=>I.questions>0&&w>r)}function E(){const I=r;if((h!=="Questions"||T()===-1)&&(t(2,u++,u),t(1,r=-1)),u>=_.length)if(h==="Work"){const w=Array.from(p.matchAll(/\d+/g)).at(-1);let m;w!=null&&(m=p.substring(0,w.index)+(Number.parseInt(w[0])+1)+p.substring(w.index+w[0].length)),Y.newFile({basePath:l.params.path,route:m}).then(f=>{f>=0&&le(String(f))})}else{alert("Hooray! You are done!"),t(2,u--,u),t(1,r=I);return}A()}function A(){t(1,r=h=="Questions"?T():_[u].attempts.length-1)}function D(){t(5,d=!d),Y.files.update(o,{flagged:d})}const U=Re(()=>Y.files.where("route").startsWith(l.params.path).toArray().then(I=>I.map(w=>({id:w.id,route:w.route,name:w.name,flagged:w.flagged,attempts:w.attempts.map(m=>({questions:m.questionCount,mistakes:m.mistakeCount}))}))));G(n,U,I=>t(13,s=I));let _=[];function C(){Y.files.update(o,I=>{I.attempts[r].questionCount=0}),E()}function P(){h=Be(this),t(3,h),t(6,i)}return n.$$set=I=>{"problemRoute"in I&&t(12,a=I.problemRoute),"problemId"in I&&t(0,o=I.problemId)},n.$$.update=()=>{var I;if(n.$$.dirty&16384&&t(1,r=l.data.attemptIdx),n.$$.dirty&12296){const w=s??[];switch(h){case"Work":t(4,_=w.filter(m=>m.route===a).sort((m,f)=>Ye(m.name,f.name)));break;case"Mistakes":t(4,_=w.filter(m=>m.attempts.at(-1).mistakes>0||m.flagged));break;case"Questions":t(4,_=w.filter(m=>m.attempts.some(f=>f.questions>0)));break}}if(n.$$.dirty&17&&t(2,u=Math.max(0,_.findIndex(w=>w.id===o))),n.$$.dirty&30){const w=(I=_[u])==null?void 0:I.id;w&&le(String(w)+Oe({studyMode:h,attempt:String(r+1)}))}n.$$.dirty&1&&Y.files.get(o).then(w=>{t(5,d=(w==null?void 0:w.flagged)??!1),p=(w==null?void 0:w.name)??""})},[o,r,u,h,_,d,i,g,E,D,U,C,a,s,l,P]}class ht extends te{constructor(e){super(),ne(this,e,ct,ft,ee,{problemRoute:12,problemId:0})}}function mt(n){let e,t,s,l,i=n[0]+1+"",a;return{c(){e=N("div"),t=N("canvas"),l=x(`
    Attempt `),a=x(i),this.h()},l(o){e=q(o,"DIV",{class:!0});var r=Q(e);t=q(r,"CANVAS",{width:!0,height:!0}),Q(t).forEach(b),l=$(r,`
    Attempt `),a=$(r,i),r.forEach(b),this.h()},h(){v(t,"width",n[1]),v(t,"height",s=n[1]-24),v(e,"class","text-center bg-gray-50 rounded-md"),R(e,"width",n[1]+"px")},m(o,r){y(o,e,r),S(e,t),n[4](t),S(e,l),S(e,a)},p(o,[r]){r&2&&v(t,"width",o[1]),r&2&&s!==(s=o[1]-24)&&v(t,"height",s),r&1&&i!==(i=o[0]+1+"")&&fe(a,i),r&2&&R(e,"width",o[1]+"px")},i:W,o:W,d(o){o&&b(e),n[4](null)}}}function dt(n,e,t){let{attempt:s}=e,{idx:l}=e,{size:i=100}=e,a;function o(u,h){const d=document.createElement("canvas");d.width=h[0].width,d.height=h[0].height,u.scale(i/d.width,(i-24)/d.height);for(const p of h)d.getContext("2d").putImageData(p,0,0),u.drawImage(d,0,0)}Se(async()=>{const u=a.getContext("2d");o(u,[s.work,s.error,s.questions])});function r(u){ae[u?"unshift":"push"](()=>{a=u,t(2,a)})}return n.$$set=u=>{"attempt"in u&&t(3,s=u.attempt),"idx"in u&&t(0,l=u.idx),"size"in u&&t(1,i=u.size)},[l,i,a,s,r]}class pt extends te{constructor(e){super(),ne(this,e,dt,mt,ee,{attempt:3,idx:0,size:1})}}function ye(n,e,t){const s=n.slice();return s[5]=e[t],s[7]=t,s}function Te(n,e){let t,s,l,i,a;s=new pt({props:{attempt:e[5],idx:e[7]}});function o(){return e[4](e[7])}return{key:n,first:null,c(){t=N("button"),X(s.$$.fragment),this.h()},l(r){t=q(r,"BUTTON",{});var u=Q(t);J(s.$$.fragment,u),u.forEach(b),this.h()},h(){this.first=t},m(r,u){y(r,t,u),K(s,t,null),l=!0,i||(a=z(t,"click",o),i=!0)},p(r,u){e=r;const h={};u&4&&(h.attempt=e[5]),u&4&&(h.idx=e[7]),s.$set(h)},i(r){l||(F(s.$$.fragment,r),l=!0)},o(r){j(s.$$.fragment,r),l=!1},d(r){r&&b(t),Z(s),i=!1,a()}}}function gt(n){let e=[],t=new Map,s,l,i=`<div class="w-[100px] h-[76px] align-middle text-5xl leading-[1.65]">➕</div>
    New Attempt`,a,o,r,u=re(n[2]??[]);const h=d=>""+d[0]+d[7];for(let d=0;d<u.length;d+=1){let p=ye(n,u,d),g=h(p);t.set(g,e[d]=Te(g,p))}return{c(){for(let d=0;d<e.length;d+=1)e[d].c();s=V(),l=N("button"),l.innerHTML=i,this.h()},l(d){for(let p=0;p<e.length;p+=1)e[p].l(d);s=O(d),l=q(d,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(l)!=="svelte-1goxpwn"&&(l.innerHTML=i),this.h()},h(){v(l,"class","text-center bg-gray-50 rounded-md w-[100px]")},m(d,p){for(let g=0;g<e.length;g+=1)e[g]&&e[g].m(d,p);y(d,s,p),y(d,l,p),a=!0,o||(r=z(l,"click",n[3]),o=!0)},p(d,[p]){p&5&&(u=re(d[2]??[]),ze(),e=Ve(e,p,h,1,d,u,t,s.parentNode,Xe,Te,s,ye),Fe())},i(d){if(!a){for(let p=0;p<u.length;p+=1)F(e[p]);a=!0}},o(d){for(let p=0;p<e.length;p+=1)j(e[p]);a=!1},d(d){d&&(b(s),b(l));for(let p=0;p<e.length;p+=1)e[p].d(d);o=!1,r()}}}function _t(n,e,t){let s,l=W,i=()=>(l(),l=Ae(o,h=>t(2,s=h)),o);n.$$.on_destroy.push(()=>l());let{problemId:a}=e,o;function r(){Y.files.update(a,h=>{le("?attempt="+h.attempts.push(Ke.newBlankAttempt()))})}const u=h=>le(Oe({attempt:String(h+1)}));return n.$$set=h=>{"problemId"in h&&t(0,a=h.problemId)},n.$$.update=()=>{n.$$.dirty&1&&i(t(1,o=Re(()=>Y.files.get(a).then(h=>h.attempts))))},[a,o,s,r,u]}class bt extends te{constructor(e){super(),ne(this,e,_t,gt,ee,{problemId:0})}}function wt(n){let e,t,s;return{c(){e=N("canvas"),this.h()},l(l){e=q(l,"CANVAS",{class:!0}),Q(e).forEach(b),this.h()},h(){v(e,"class","fixed left-0 top-[2em]")},m(l,i){y(l,e,i),n[3](e),t||(s=z(e,"mousedown",n[1]),t=!0)},p:W,i:W,o:W,d(l){l&&b(e),n[3](null),t=!1,s()}}}function vt(n,e,t){let{problemId:s}=e,l,i;function a(r){setTimeout(()=>{i.dragStart(r)})}function o(r){ae[r?"unshift":"push"](()=>{l=r,t(0,l),t(2,s)})}return n.$$set=r=>{"problemId"in r&&t(2,s=r.problemId)},n.$$.update=()=>{n.$$.dirty&5&&Y.files.get(s).then(r=>{r!=null&&r.question&&(t(0,l.width=r.question.width,l),t(0,l.height=r.question.height,l),l.getContext("2d").putImageData(r.question,0,0))})},[l,a,s,o]}class kt extends te{constructor(e){super(),ne(this,e,vt,wt,ee,{problemId:2})}}function Me(n,e,t){const s=n.slice();return s[10]=e[t],s}function Ne(n){let e,t=n[10]+"",s;return{c(){e=x("/"),s=x(t)},l(l){e=$(l,"/"),s=$(l,t)},m(l,i){y(l,e,i),y(l,s,i)},p(l,i){i&4&&t!==(t=l[10]+"")&&fe(s,t)},d(l){l&&(b(e),b(s))}}}function It(n){let e,t,s,l,i,a,o,r,u,h,d,p,g,T,E,A,D,U,_,C,P;t=new kt({props:{problemId:n[0]}}),l=new ut({props:{selectedTool:n[5],problemId:n[0],attemptId:n[3]}});let I=re(n[2].params.path.split("/")),w=[];for(let m=0;m<I.length;m+=1)w[m]=Ne(Me(n,I,m));return T=new ht({props:{problemId:n[0],problemRoute:n[1]}}),D=new ot({props:{selected:n[5]}}),C=new bt({props:{problemId:n[0]}}),{c(){e=V(),X(t.$$.fragment),s=V(),X(l.$$.fragment),i=V(),a=N("div"),o=N("div"),r=N("a"),u=x("🏠"),d=V();for(let m=0;m<w.length;m+=1)w[m].c();p=V(),g=N("div"),X(T.$$.fragment),E=V(),A=N("div"),X(D.$$.fragment),U=V(),_=N("div"),X(C.$$.fragment),this.h()},l(m){je("svelte-pyemm1",document.head).forEach(b),e=O(m),J(t.$$.fragment,m),s=O(m),J(l.$$.fragment,m),i=O(m),a=q(m,"DIV",{id:!0,class:!0});var c=Q(a);o=q(c,"DIV",{id:!0,class:!0});var k=Q(o);r=q(k,"A",{href:!0,class:!0});var H=Q(r);u=$(H,"🏠"),H.forEach(b),d=O(k);for(let ce=0;ce<w.length;ce+=1)w[ce].l(k);k.forEach(b),p=O(c),g=q(c,"DIV",{id:!0,class:!0});var B=Q(g);J(T.$$.fragment,B),B.forEach(b),E=O(c),A=q(c,"DIV",{id:!0,class:!0});var M=Q(A);J(D.$$.fragment,M),M.forEach(b),U=O(c),_=q(c,"DIV",{id:!0,class:!0});var se=Q(_);J(C.$$.fragment,se),se.forEach(b),c.forEach(b),this.h()},h(){document.title="MathMan Draw",v(r,"href",h=pe(n[2])),v(r,"class","svelte-yabuun"),v(o,"id","breadcrumbs"),v(o,"class","svelte-yabuun"),v(g,"id","question-management"),v(g,"class","text-right svelte-yabuun"),v(A,"id","tools-container"),v(A,"class","svelte-yabuun"),v(_,"id","attempts-container"),v(_,"class","flex flex-col p-3 gap-3 svelte-yabuun"),v(a,"id","grid"),v(a,"class","svelte-yabuun"),_e(a,"selected",n[4]!==L.None)},m(m,f){y(m,e,f),K(t,m,f),y(m,s,f),K(l,m,f),y(m,i,f),y(m,a,f),S(a,o),S(o,r),S(r,u),S(o,d);for(let c=0;c<w.length;c+=1)w[c]&&w[c].m(o,null);S(a,p),S(a,g),K(T,g,null),S(a,E),S(a,A),K(D,A,null),S(a,U),S(a,_),K(C,_,null),P=!0},p(m,[f]){const c={};f&1&&(c.problemId=m[0]),t.$set(c);const k={};if(f&1&&(k.problemId=m[0]),f&8&&(k.attemptId=m[3]),l.$set(k),(!P||f&4&&h!==(h=pe(m[2])))&&v(r,"href",h),f&4){I=re(m[2].params.path.split("/"));let M;for(M=0;M<I.length;M+=1){const se=Me(m,I,M);w[M]?w[M].p(se,f):(w[M]=Ne(se),w[M].c(),w[M].m(o,null))}for(;M<w.length;M+=1)w[M].d(1);w.length=I.length}const H={};f&1&&(H.problemId=m[0]),f&2&&(H.problemRoute=m[1]),T.$set(H);const B={};f&1&&(B.problemId=m[0]),C.$set(B),(!P||f&16)&&_e(a,"selected",m[4]!==L.None)},i(m){P||(F(t.$$.fragment,m),F(l.$$.fragment,m),F(T.$$.fragment,m),F(D.$$.fragment,m),F(C.$$.fragment,m),P=!0)},o(m){j(t.$$.fragment,m),j(l.$$.fragment,m),j(T.$$.fragment,m),j(D.$$.fragment,m),j(C.$$.fragment,m),P=!1},d(m){m&&(b(e),b(s),b(i),b(a)),Z(t,m),Z(l,m),Qe(w,m),Z(T),Z(D),Z(C)}}}function Ct(n,e,t){let s,l,i,a;G(n,ie,g=>t(2,l=g));const o=be(L.None);G(n,o,g=>t(4,a=g));const r=be(!1);qe("eraserEnabled",r);const u=we(ie,g=>g.data.problemId);G(n,u,g=>t(0,s=g));const h=we(ie,g=>g.data.attemptIdx);G(n,h,g=>t(3,i=g));let d;function p(g){s!==0&&(g?(t(1,d=g.route),d.startsWith(l.params.path)||le(de(d,l.params.problemId))):le(pe(l)))}return n.$$.update=()=>{n.$$.dirty&1&&Y.files.get(s).then(p)},[s,d,l,i,a,o,u,h]}class qt extends te{constructor(e){super(),ne(this,e,Ct,It,ee,{})}}export{qt as component};
